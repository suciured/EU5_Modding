I want to continue making the rank mod. to recap:

What the mod is about (Authority Ledger)

Authority Ledger is an EU5 mod that:

Adds dynamic country titles based on rank / authority

Replaces static country names like

Hungary
with contextual names like
Kingdom of Hungary, Duchy of Naples, etc.

Uses customizable localization instead of hardcoded names, so:

ranks

government changes

authority shifts
can all change how a country is named at runtime

Integrates into:

map labels

country selection screen

country info UI

In short:
üëâ It makes country names dynamic, rank-aware, and systemic rather than fixed strings.

The core system you‚Äôre using

The mod relies on three EU5 systems working together:

Customizable localization
(in_game/common/customizable_localization/)

Defines how names are constructed (tokens, rules)

Country name construction
(common/country_name_construction/)

Tells the engine which localization key to use

Localization (.yml)
(in_game/localization/english/, main_menu/localization/english/)

Provides the actual human-readable text

The main problem we fought

You kept seeing things like:

COUNTRY_FLAVOR of Country

ERROR:GetCustom(country_flavor)

Or crashes

This looked like ‚Äúbroken localization‚Äù, but the real causes were layered.

What went wrong (and why)
1. ‚ùå Folder overuse

Initially:

Every folder from the template was included

Localization ended up duplicated across:

localization/

main_menu/localization/

in_game/localization/

This caused:

collisions

overrides

crashes

2. ‚ùå Invalid localization files

Some .yml files had:

multiple l_english: headers

embedded BOM characters inside the file

bad indentation

EU5‚Äôs localization parser is not forgiving ‚Üí hard crashes.

3. ‚ùå Misuse of REPLACE: in customizable localization

This was the critical logic bug.

You had:

REPLACE:country_flavor = { ... }


But the base game defines:

country_flavor = { ... }


Result:

Your mod did not override the base key

The engine never defined country_flavor

The token printed literally as COUNTRY_FLAVOR

This was confirmed by inspecting the COMMON bucket.

4. ‚ùå Wrong name token context

Using:

$COUNTRY$


sometimes resolves to the fallback "Country" depending on UI scope.

Correct approach:

[COUNTRY.GetName]

What we fixed (step by step)
‚úÖ Structural fixes

You correctly identified that:

The template defines allowed paths, not required paths

We switched to a minimal mod structure

Removed unused folders (loading screen, redundant localization roots, etc.)

‚úÖ Localization fixes

Every .yml now:

has exactly one l_english:

has correct indentation

uses UTF-8 BOM correctly (once, at file start)

Split responsibility cleanly:

main_menu/localization ‚Üí pre-game UI

in_game/localization ‚Üí map & in-game UI

‚úÖ Logic fixes (most important)

Removed REPLACE: from country_flavor

Let the mod define, not replace, the customizable key

Stopped overriding country_name_long globally (avoided recursion / fallback)

‚úÖ Token fixes

Final working pattern:

"$country_flavor$ of [COUNTRY.GetName]"


country_flavor ‚Üí customizable localization (rank-aware)

[COUNTRY.GetName] ‚Üí safe, scoped country name

Where you ended up

You now have:

A rank-aware country naming system

Using proper customizable localization

With:

correct folder minimalism

correct token scope

no crashes

no literal tokens showing


CODEX INSTRUCTIONS (EU5 Mod Repo ‚Äì Strict Source-Only)
VERSION: v1.0
SCOPE: This instruction governs ALL actions, answers, edits, and file generation inside this repo.

============================================================
0) ABSOLUTE RULE: SOURCE-ONLY / NO HALLUCINATION
============================================================
- You MUST use ONLY information that exists in this repository:
  (A) /Knowledge Base/ (authoritative KB text files, rules, keys, schemas)
  (B) /Raw/ (base game files used to confirm gaps; read-only reference)
  (C) The current mod workspace output (the files you create/edit for the mod)

- You MUST NOT invent:
  - mechanics, values, IDs, scripted effects/triggers, modifiers, file formats,
    folder names, or dependencies that are not explicitly present in the repo.
- If a needed fact is missing:
  - Write: "NOT DEFINED IN REPO SOURCES"
  - Then state exactly which file(s)/path(s) you need to proceed (1‚Äì5 items max).

============================================================
1) REPO LAYERS AND TRUST ORDER
============================================================
TRUST ORDER (highest ‚Üí lowest):
1) Knowledge Base (canonical ‚Äúallowed knowledge‚Äù for this project)
2) Mod output files (the mod you are building)
3) Raw (base game reference only; NEVER treated as mod output)

Rules:
- If Knowledge Base conflicts with Raw, follow Knowledge Base.
- If mod output intentionally overrides base behavior, document the override.
- Never treat Raw as editable mod content.

============================================================
2) WHAT TO DO WHEN YOU DON‚ÄôT KNOW
============================================================
If the user asks for something and you cannot prove it from repo sources:
1) Do NOT guess.
2) Answer with:
   - "NOT DEFINED IN REPO SOURCES"
   - A short list (1‚Äì5) of the exact missing references (paths/filenames).
3) Offer a minimal next-step request, e.g.:
   - "Provide the missing base file in /Raw/ or add a KB entry in /Knowledge Base/."

============================================================
3) MOD TEMPLATE: MINIMIZE FOLDERS (DELETE WHAT YOU DON‚ÄôT USE)
============================================================
The folder /Mod Template/ contains many possible folders.
When creating a new mod project or updating an existing one:

- Keep ONLY folders that are directly required by files you are actively using.
- Delete (or do not copy) template folders that are not referenced by the mod‚Äôs
  current content.

FOLDER HYGIENE RULES:
- If a folder is empty after changes, remove it.
- If a folder contains only placeholder/example files, remove them unless they
  are explicitly required.
- If you create a new file type, ensure its parent folder is necessary and
  referenced by the mod structure.

Whenever you delete folders/files:
- Record what was removed and why in a short changelog entry (see section 5).

============================================================
4) RAW BASE GAME FILES: REFERENCE-ONLY
============================================================
/Raw/ exists to fill gaps and validate IDs/structures.
Rules:
- Never edit /Raw/.
- Only cite /Raw/ content when you can point to the exact file/path used.
- If you rely on /Raw/ to confirm something, note the source path in your output.

============================================================
5) OUTPUT REQUIREMENTS (EVERY CHANGE)
============================================================
For any change you make to mod files:
- Provide a brief "Change Summary" including:
  - Files added/edited/deleted (with paths)
  - Purpose (1‚Äì3 bullets)
  - Any dependencies or references introduced
  - Any deletions from Mod Template and why

============================================================
6) SAFE DEFAULTS
============================================================
- Prefer minimal edits over broad refactors.
- If multiple implementation options exist, present 1‚Äì5 numbered options.
- Do not create new IDs unless the repo‚Äôs Knowledge Base defines the schema and
  you can place the new ID into valid mod files.
- Do not overwrite canon/base content silently; all overrides must be explicit
  and documented.

============================================================
7) STOP CONDITIONS
============================================================
Stop and ask for inputs if any of these are true:
- A required ID/mechanic/file format is not defined in Knowledge Base or Raw.
- The user requests behavior that cannot be verified from repo sources.
- A file reference target cannot be found in the repo.

When stopping:
- Output "NOT DEFINED IN REPO SOURCES"
- Then list 1‚Äì5 missing items needed to proceed.

============================================================
8) LOGGING: WRITE A SUMMARY FILE TO /Logs/
============================================================
After ANY completed work session (adding/editing/removing files, changing structure,
or producing mod outputs), you MUST create or update a log entry in:

  /Logs/<PARENT_FOLDER>/

Where <PARENT_FOLDER> is the primary folder affected by the work
(e.g., "Authority Ledger", "Economy", "Map", etc.).

LOG FILE NAMING:
- Log files are named: "<PARENT_FOLDER> <VERSION>.txt"
  Example: "Authority Ledger 0.2.txt"

VERSIONING RULE:
- Use integer bumps for MAJOR changes:
  - New feature/system, folder restructuring, large refactor, broad content pass
  - Examples: 0 -> 1, 1 -> 2
- Use decimal bumps for MINOR changes:
  - Small patch, typo fix, balancing tweak, same-bug follow-up, narrow scope edits
  - Examples: 0.1 -> 0.2 -> 0.3
- If no prior log exists, start at:
  - 0.1 for a minor patch
  - 1 for a major change
- If continuing the same bug/issue thread, prefer decimals unless scope clearly grew.

LOG ENTRY CONTENT (REQUIRED HEADERS):
- [VERSION] <VERSION>
- [DATE] <YYYY-MM-DD> (local repo date is acceptable)
- [SCOPE] MAJOR | MINOR
- [PARENT_FOLDER] <PARENT_FOLDER>
- [FILES_CHANGED]
  - Added:
  - Edited:
  - Deleted:
- [TEMPLATE_CLEANUP]
  - Removed unused template folders/files (list paths) OR "None"
- [SOURCES_USED]
  - Knowledge Base: (list file paths used)
  - Raw: (list file paths used) OR "None"
- [NOTES]
  - 2‚Äì8 bullets describing what was done and why
- [OPEN_ITEMS]
  - Missing definitions, TODOs, or blockers OR "None"

STOP CONDITION:
- If you cannot locate /Logs/<PARENT_FOLDER>/, create it.
- Never skip logging; even a no-op must write a short entry explaining why.


============================================================
9) WORKSPACE SYNC RULES (POWER SHELL / CMD)
============================================================
The repository contains automation scripts for syncing workspace
content into the active mod directory.

AUTHORIZED SCRIPTS:
- Sync_AuthorityLedger.ps1
- Sync_AuthorityLedger.cmd

RULES:
- The PowerShell script MAY delete files ONLY in the destination
  path explicitly listed in:
    /Workspace/Config/Mod Output.txt
- The bot MUST NOT:
  - Delete any other directories
  - Change or override the deletion scope
  - Delete without explicit user approval
- The bot MAY:
  - Create new files as needed
  - Update existing files
  - Add new config files
- The bot MUST NOT modify or remove:
  - Mod Output.txt
  - Sync scripts
  unless explicitly instructed.

SYNC BEHAVIOR (CANON):
1) Read destination path from Mod Output.txt
2) Clear destination contents (not the folder itself)
3) Copy everything from:
   /Workspace/Mod/Authority Ledger/
4) Abort safely if any path is missing or ambiguous

If deletion outside this scope is required:
- STOP
- Ask the user for confirmation
- Do NOT proceed until approved


END OF INSTRUCTIONS
