# v_system_authority_effects.txt — V1–V5 Authority Ledger (MOD)
# [DATE] 2025-12-30
#
# This file intentionally removes legacy Authority Ledger formulas/variables.
# It defines ONLY safe placeholder effects until per-province aggregation primitives are confirmed.
#
# NOT DEFINED IN REPO SOURCES:
# - A proven province-iteration + location-iteration pattern to compute V2.1–V2.3 exactly as spec.
# - A proven way to read location 'population' and 'development' values by script name.
# - A proven monthly hook cadence for this system.
#
# Once confirmed, implement:
# - V2 province aggregates (control avg, pop sum, dev sum)
# - V3 routing, governance composite, bases
# - V4 net + TA accumulation (subject halving)
# - V5 rank evaluation from thresholds

al_authority_monthly_update_effect = {
    al_v_system_monthly_update_effect = yes
}

al_v_system_monthly_update_effect = {
    # Tick counter (optional)
    if = {
        limit = { NOT = { has_variable = v4_tick } }
        set_variable = { name = v4_tick value = 0 }
    }
    change_variable = { name = v4_tick add = 1 }

    # Ensure V3/V4 storage exists
    if = {
        limit = { NOT = { has_variable = v3_7 } }
        set_variable = { name = v3_7 value = 0 }
    }
    if = {
        limit = { NOT = { has_variable = v3_8 } }
        set_variable = { name = v3_8 value = 0 }
    }
    if = {
        limit = { NOT = { has_variable = v4_ta } }
        set_variable = { name = v4_ta value = 0 }
    }
    if = {
        limit = { NOT = { has_variable = v5_t_rank } }
        set_variable = { name = v5_t_rank value = 0 }
    }

    # Debug display: total population/dev/locations
    set_variable = { name = al_total_population value = total_population }
    set_variable = { name = al_total_development value = total_development }
    set_variable = { name = al_total_locations value = num_locations }

    # V3 debug proxies: map totals into central/local bases for now
    set_variable = { name = v3_7 value = var:al_total_population }
    set_variable = { name = v3_8 value = var:al_total_development }

    # V4.1/V4.2: role-aware central/local flow
    set_variable = { name = v4_1 value = var:v3_7 }
    set_variable = { name = v4_2 value = var:v3_8 }
    if = {
        limit = { is_subject = yes }
        change_variable = { name = v4_1 multiply = 0.5 }
        change_variable = { name = v4_2 multiply = 0.5 }
    }

    # V4.3: net authority flow (per tick)
    set_variable = { name = v4_3 value = var:v4_1 }
    change_variable = { name = v4_3 add = var:v4_2 }

    # V4.4: title authority accumulation
    change_variable = { name = v4_ta add = var:v4_3 }

}
