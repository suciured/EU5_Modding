lateralview = {
	name = "character_lateralview"

	blockoverride "panel_header" {
		window_header_alt = {
			using = bg_main_inner_alt
			blockoverride "header_text_object" {
				hbox = {
					spacing = 5
					expand = {}

					header_title = {
						layoutpolicy_horizontal = fixed
						autoresize = yes
						maximumsize = { 450 -1 }
						text = "[CharacterLateralview.GetCharacter.GetNameToFitWithNoTooltip('(int32)-1', '(bool)yes')]"
						using = snd_UI_window_state
					}

					button_pin = {
						size = { 23 23 }
						visible = "[IsPlayerValid]"
						datacontext = "[CharacterLateralview.GetCharacter]"
						onclick = "[ToggleCharacterFav(Character.Self)]"
						checked = "[IsCharacterFaved(Character.Self)]"
						tooltipwidget = { 
							LeftClickButtonTooltip = {
								blockoverride "onclick_text" { 
									text = "[SelectLocalization(IsCharacterFaved(Character.Self), 'UNPIN_OUTLINER', 'PIN_OUTLINER')]"
								}
							}
						}
					}

					expand = {}
				}
			}

			blockoverride "window_header_alt_color_texture"{
				using = color_default_brown_texture
			}
		}
	}

	blockoverride "panel_content" {
		vbox = {
			using = layoutpolicy_expanding
			using = bg_main_inner_notabs_alt
			using = window_main_tabs_margin_alt

			# Subheader
			widget = {
				layoutpolicy_horizontal = expanding
				size = { -1 54 }

				datacontext = "[CharacterLateralview.GetCharacter.GetRoleMask]"
				datacontext = "[CharacterLateralview.GetCharacter]"
				datacontext = "[CharacterLateralview.GetCharacter.GetCourtCountry]"

				# CURRENT ROLE
				hbox = {
					

					parentanchor = center
					hbox = {
						set_parent_size_to_minimum = yes
						ignoreinvisible = yes
	
						datamodel = "[DataModelRepeatedItem(CharacterRoleMask.GetRolesCount)]"
						item = {
							widget = {
								size = { 30 30 }
								visible = "[CharacterRoleMask.HasRole(PdxGuiWidget.GetIndexInDataModel)]"
								tagtooltip_enabled = yes
								icon = {
									size = { 100% 100% }
									visible ="[Not(CharacterLateralview.GetCharacter.IsArtist)]"
									texture = "[CharacterRoleMask.GetRoleIcon(PdxGuiWidget.GetIndexInDataModel)]"

									glow = {
										name = "drop_shadow"
										glow_radius = 3
										color = {0.0 0.0 0.0 1.0}
										alpha = 0.7
									}
								}
								
								icon = {
									size = { 100% 100% }
									visible = "[CharacterLateralview.GetCharacter.IsArtist]"
									texture = "[GetArtistIcon(CharacterLateralview.GetCharacter.GetArtistType)]"
									
									glow = {
										name = "drop_shadow"
										glow_radius = 3
										color = {0.0 0.0 0.0 1.0}
										alpha = 0.7
									}
									tooltipwidget = {
										ContextualTooltipType = {
											blockoverride "title_text" {
												text = "[CharacterLateralview.GetCharacter.GetArtistType.GetNameWithNoTooltip]"
											}
									
											blockoverride "concept_link" {
												text = [artist|e]
											}

											blockoverride "title_icon" {
												icon = {
													using = tooltip_title_icon_size
													texture = "[GetArtistIcon(CharacterLateralview.GetCharacter.GetArtistType)]"
												}
											}

											blockoverride "tooltip_content" {
												TooltipTextBlock = {
													blockoverride "text" {
														text = "[CharacterLateralview.GetCharacter.GetArtistType.GetTooltip]"
													}
												}
											}
										}
									}									
								}

								tooltip = "[CharacterRoleMask.GetRoleName(PdxGuiWidget.GetIndexInDataModel)]"
							}
						}
					}
				}
				
				hbox = {
					spacing = 5
					margin = { 10 7 }

					hbox = {
						spacing = 5
						country_flag_very_small = {}
	
						# vbox = {
						# 	maximumsize = { 50 -1 }
						# 	text_single = {
						# 		layoutpolicy_horizontal = expanding
						# 		text = "character_role"
						# 	}
	
						# 	text_single = {
						# 		layoutpolicy_horizontal = expanding
						# 		text = "[CharacterRoleMask.GetRolesName]"
						# 	}					
						# }

						vbox = {
							maximumsize = { 50 -1 }
							
							hbox = {
								layoutpolicy_horizontal = expanding
				
								text_single = {
									minimumsize = { -1 20 }
									autoresize = yes
									text = "character_role"
								}
				
								expand = {}
							}
							
							hbox = {
								layoutpolicy_horizontal = expanding
				
								text_single = {
									minimumsize = { -1 20 }
									autoresize = yes
									text = "[CharacterRoleMask.GetRolesName]"
								}
				
								expand = {}
							}
						}
					}

					expand = {}

					hbox = {
						margin = { 7 5 }
						spacing = 5

						using = bg_square_tile
						blockoverride "container_color" {
							modify_texture = {
								using = color_dark_brown_texture
								blend_mode = multiply
							}
							alpha = 0.7
						}

						tooltipwidget = {
							using = AgeAndSex_tooltip
						}

						using = bg_cabinet_card_frame

						text_single = {
							autoresize = yes
							align = center|nobaseline
							using = Font_Size_Medium
							raw_text = " [Character.GetAge|Y]"
						}

						gender_icon = {
							blockoverride "tooltip_override" {}
						}
					}

					widget = {
						size = { 30 30 }
						visible = "[And(Character.IsAdult,Character.IsAlive)]"
						icon = {
							size = { 100% 100% }
							texture = "gfx/interface/icons/character_roles/adult.dds"
	
							glow = {
								name = "drop_shadow"
								glow_radius = 3
								color = {0.0 0.0 0.0 1.0}
								alpha = 0.7
							}
						}
						tagtooltip_enabled = yes
						tooltip = "[adult|e]"

					}

					widget = {
                        size = { 30 30 }
                        visible = "[And(Not(Character.IsAdult),Character.IsAlive)]"
                        datamodel = "[DataModelRepeatedItem(CharacterRoleMask.GetRolesCount)]"
                        icon = {
                            size = { 100% 100% }
                            texture = "gfx/interface/icons/character_roles/child.dds"
                            glow = {
                                name = "drop_shadow"
                                glow_radius = 3
                                color = {0.0 0.0 0.0 1.0}
                                alpha = 0.7
                            }
                        }
                        item = {
                            widget = {
                                size = { 100% 100% }
                                tagtooltip_enabled = yes
                                tooltip = "[CharacterRoleMask.GetRoleName(PdxGuiWidget.GetIndexInDataModel)]"
                            }
                        }
                    }


					icon = {
						size = { 30 30 }
						visible = "[Not(Character.IsAlive)]"
						texture = "gfx/interface/icons/character_roles/death.dds"

						glow = {
								name = "drop_shadow"
								glow_radius = 3
								color = {0.0 0.0 0.0 1.0}
								alpha = 0.7
							}
						tooltipwidget = {
							using = dead_character_tooltip
						}
					}
				}

				# widget = {
				# 	parentanchor = center
				# 	hbox = {
				# 		set_parent_size_to_minimum = yes
				# 		ignoreinvisible = yes
	
				# 		datamodel = "[DataModelRepeatedItem(CharacterRoleMask.GetRolesCount)]"
				# 		item = {
				# 			widget = {
				# 				size = { 32 32 }
				# 				visible = "[CharacterRoleMask.HasRole(PdxGuiWidget.GetIndexInDataModel)]"
				# 				icon = {
				# 					size = { 100% 100% }
									
				# 					texture = "[CharacterRoleMask.GetRoleIcon(PdxGuiWidget.GetIndexInDataModel)]"

				# 					glow = {
				# 						name = "drop_shadow"
				# 						glow_radius = 3
				# 						color = {0.0 0.0 0.0 1.0}
				# 						alpha = 0.7
				# 					}
				# 				}

				# 				tagtooltip_enabled = yes
				# 				tooltip = "[CharacterRoleMask.GetRoleName(PdxGuiWidget.GetIndexInDataModel)]"
				# 			}
				# 		}
				# 	}
				# }
			}

			datacontext = "[CharacterLateralview.GetCharacter]"

			# CHARACTER HEADER
			character_header = {
				using = bg_age_event_frame

				blockoverride "character_header_extra" {
					# Character role info
					hbox = {
						visible = "[And(CharacterLateralview.GetCharacter.HasUnit,CharacterLateralview.GetCharacter.CanSelectUnit)]"
						spacing = 5
						maximumsize = {72 28}
						position = { 10 10}
						parentanchor = left|top
						margin_right = 10

						datacontext = "[CharacterLateralview.GetCharacter.GetCourtCountry]"

						using = bg_dark_paper_card

						navigational_button_alt = {
							visible = "[Not(Character.GetUnitPointer.IsArmy)]"
							size = { 30 30 }

							blockoverride "button_icon_stretch_sprite" {}

							blockoverride "icon_size" {
								size = { 70% 70% }
							}

							blockoverride "icon_texture" {
								texture = "gfx/interface/buttons/flats/ship_button.dds"
								texture_density = 2
								using = icon_gold_texture_alt
							}
							
							using = bg_circle_alt_brown

							enabled = "[Character.HasUnit]"
							onclick = "[SelectUnitAndPan(Character.GetUnitPointer)]"

							tooltipwidget = {
								LeftClickButtonTooltip = {
									blockoverride "onclick_text" { 
										text = "SELECT_UNIT_TT"
									}
								}
							}
						}

						navigational_button_alt = {
							visible = "[Character.GetUnitPointer.IsArmy]"
							size = { 30 30 }

							blockoverride "button_icon_stretch_sprite" {}

							blockoverride "icon_size" {
								size = { 80% 80% }
							}

							blockoverride "icon_texture" {
								texture = "gfx/interface/buttons/flats/regiments.dds"
								texture_density = 2
								using = icon_gold_texture_alt
							}
							
							using = bg_circle_alt_brown

							enabled = "[Character.HasUnit]"
							onclick = "[SelectUnitAndPan(Character.GetUnitPointer)]"
							tooltipwidget = {
								LeftClickButtonTooltip = {
									blockoverride "onclick_text" { 
										text = "SELECT_UNIT_TT"
									}
								}
							}
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							text_single = {
								layoutpolicy_horizontal = expanding
								text = "[CharacterLateralview.GetCharacter.GetUnitPointer.GetVisualStrength]"
							}
						}
					}
				}
			}

			### INNER MIDDLE TAB SYSTEM
			header_secondary_tabs = {
				blockoverride "content" {
					hbox = {
						using = layoutpolicy_expanding
						maximumsize = { -1 40 }
	
						background = {
							using = button_secondary_tab_alt_color
							using = button_main_tab_icon_texture
						}
					
						text_single = {
							layoutpolicy_horizontal = expanding
							size = {-1 40}
							autoresize = no
							align = center|nobaseline
							using = button_common_textobj_font
							text = "character_breakdown"
						}
					}
				}
			}

			# BREAKDOWN
			vbox = {
				visible = "[CharacterLateralview.Vars.NotExistOrHasValue( 'religions', 'breakdown' )]"
				using = layoutpolicy_expanding
				using = bg_secondary_inner_alt
				spacing = 10
				margin = {5 0}

				subheader = {
					blockoverride "content" {
						hbox = {
							using = layoutpolicy_expanding
							widget = {
								layoutpolicy_horizontal = expanding
								size = { -1 40 }

								# CULTURE
								hbox = {
									spacing = 5
									maximumsize = {50 28}
									position = {4 0}

									datacontext = "[CharacterLateralview.GetCharacter.GetCulture]"
									tooltipwidget = {
										using = culture_tooltip
									}

									icon = {
										size = { 32 32 }
										texture = "gfx/interface/icons/character_interactions/culture.dds"
										texture_density = 2
										
										glow = {
											name = "drop_shadow"
											glow_radius = 3
											color = {0.0 0.0 0.0 1.0}
											alpha = 0.3
										}
									}

									vbox = {
										hbox = {
											layoutpolicy_horizontal = expanding
											text_single = {
												text = "game_concept_culture"
											}
											expand = {}
										}

										hbox = {
											layoutpolicy_horizontal = expanding
											text_single = {
												text = "[CharacterLateralview.GetCharacter.GetCulture.GetNameWithNoTooltip]"
											}
											expand = {}
										}
									}
								}

								# ESTATE
								hbox = {
									spacing = 1
									maximumsize = {110 40}
									parentanchor = hcenter|vcenter

									icon = {
										visible = "[Character.HasCourtCountry]"
										size = { 37 37 }
										texture = "[GetEstateIcon(CharacterLateralview.GetCharacter.GetEstateType)]"
										datacontext = "[Character.GetCourtCountry.GetGovernment.GetEstate(Character.GetEstateType)]"
										datacontext = "[Character.GetCourtCountry]"
										tooltipwidget = {
											using = Estate_tooltip
										}
									}
								}

								# RELIGION
								hbox = {
									spacing = 5
									parentanchor = right|top
									maximumsize = {100 28}
									position = {-4 0}

									datacontext = "[CharacterLateralview.GetCharacter.GetReligion]"
									tooltipwidget = {
										using = religion_tooltip
									}

									vbox = {
										hbox = {
											layoutpolicy_horizontal = expanding
											expand = {}
											text_single = {
												text = "game_concept_religion"
											}
										}

										hbox = {
											layoutpolicy_horizontal = expanding
											expand = {}
											text_single = {
												text = "[CharacterLateralview.GetCharacter.GetReligion.GetAdjectiveWithNoTooltip]"
											}
										}
									}

									icon = {
										size = { 32 32 }
										texture = "[GetReligionIcon(CharacterLateralview.GetCharacter.GetReligion)]"
									}
								}
							}
						}
					}
				}

				# PARENTS
				hbox = {
					layoutpolicy_horizontal = expanding
					visible = "[Or(CharacterLateralview.GetCharacter.GetFather.IsValid, CharacterLateralview.GetCharacter.GetMother.IsValid)]"

					vbox = {
						layoutpolicy_horizontal = expanding
						size = { -1 60 }
						margin_top = 5
						margin_bottom = 5

						using = bg_paper_card
						using = bg_cabinet_card_frame

						hbox = {
							margin = { 10 5 }
							using = layoutpolicy_expanding
							# FATHER
							hbox = {
								visible = "[CharacterLateralview.GetCharacter.GetFather.IsValid]"
								using = layoutpolicy_expanding
								spacing = 5

								character_frame_small = {
									blockoverride "character_frame_size" {
										size = { 39 46 }
									}
									blockoverride "character_frame_estate_visible" {
										visible = no
									}
									blockoverride "portrait_datacontext" {
										datacontext = "[CharacterLateralview.GetCharacter.GetFather]"
									}
									blockoverride "character_portrait_visible" {
										visible = yes
									}
									blockoverride "character_portrait_ani_visible" {
										visible = no
									}
									blockoverride "portrait_position" {position = { 0 0 }}
								
									blockoverride "character_small_ribbon_visible" {
                                        visible = "[And(Not(CharacterLateralview.GetCharacter.GetFather.IsAlive), CharacterLateralview.GetCharacter.GetFather.WasRuler)]"
                                    }	
								}


								vbox = {
									using = layoutpolicy_expanding
									text_single = {
										using = layoutpolicy_expanding
										text = "CHAR_FATHER_COV"
										align = left
									}

									text_single = {
										using = layoutpolicy_expanding
										align = left|nobaseline
										text = "[CharacterLateralview.GetCharacter.GetFather.GetNameToFit('(int32)20', '(bool)yes')]"
										using = Font_Size_Small
									}
								}
							}

							expand = {}

							# MOTHER
							hbox = {
								visible = "[CharacterLateralview.GetCharacter.GetMother.IsValid]"
								using = layoutpolicy_expanding
								spacing = 5
								
								vbox = {
									using = layoutpolicy_expanding
									text_single = {
										using = layoutpolicy_expanding
										align = right
										text = "CHAR_MOTHER_COV"
									}

									text_single = {
										using = layoutpolicy_expanding
										align = right|nobaseline
										text = "[CharacterLateralview.GetCharacter.GetMother.GetNameToFit('(int32)20', '(bool)yes')]"
										autoresize = yes
										using = Font_Size_Small
									}
								}

								character_frame_small = {
									blockoverride "character_frame_size" {
										size = { 39 46 }
									}
									blockoverride "character_frame_estate_visible" {
										visible = no
									}
									blockoverride "portrait_datacontext" {
										datacontext = "[CharacterLateralview.GetCharacter.GetMother]"
									}
									blockoverride "character_portrait_visible" {
										visible = yes
									}
									blockoverride "character_portrait_ani_visible" {
										visible = no
									}
									blockoverride "portrait_position" {position = { 0 0 }}
									
									blockoverride "character_small_ribbon_visible" {
                                        visible = "[And(Not(CharacterLateralview.GetCharacter.GetFather.IsAlive), CharacterLateralview.GetCharacter.GetMother.WasRuler)]"
                                    }
								}
							}
						}
					}
				}

				# DYNASTIC RELATIONS
				hbox = {
					layoutpolicy_horizontal = expanding
					spacing = 5

					# SPOUSES
					widget = {
						visible = "[Not(Or(GreaterThan_int32(CharacterLateralview.GetCharacter.GetSpousesAmount, '(int32)3'), GreaterThan_int32(GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren), '(int32)10')))]"
						size = {160 95}
						using = partner_character_view
					}

					widget = {
						visible = "[Or(GreaterThan_int32(CharacterLateralview.GetCharacter.GetSpousesAmount, '(int32)3'), GreaterThan_int32(GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren), '(int32)10'))]"
						size = {160 120}

						blockoverride "partner_character_view_size" {
							size = { -1 80 }
						}

						blockoverride "partner_character_view_max_size" {
							maximumsize = { -1 80 }
						}

						using = partner_character_view
					}

					# CHILDREN
					widget = {
						visible = "[Not(Or(GreaterThan_int32(CharacterLateralview.GetCharacter.GetSpousesAmount, '(int32)3'), GreaterThan_int32(GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren), '(int32)10')))]"
						layoutpolicy_horizontal = expanding
						size = {-1 95}
						using = children_character_view
					}

					widget = {
						visible = "[Or(GreaterThan_int32(CharacterLateralview.GetCharacter.GetSpousesAmount, '(int32)3'), GreaterThan_int32(GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren), '(int32)10'))]"
						layoutpolicy_horizontal = expanding

						blockoverride "children_character_view_size" {
							size = { -1 80 }
						}

						blockoverride "children_character_overlap_visible" {
							visible = no
						}

						blockoverride "children_character_scroll_visible" {
							visible = yes
						}

						blockoverride "children_character_view_max_size" {
							maximumsize = { -1 80 }
						}

						size = {-1 120}
						using = children_character_view
					}
				}

				# CHARACTER ACTIONS
				# SIZE FOR NOT FATHER & MOTHER
				hbox = {
					visible = "[Not(Or(CharacterLateralview.GetCharacter.GetFather.IsValid, CharacterLateralview.GetCharacter.GetMother.IsValid))]"
					using = layoutpolicy_expanding
					using = character_actions
					# blockoverride "character_actions_max_size" {
					# 	using = layoutpolicy_expanding
					# 	autoresizescrollarea = no
					# }
				}

				# SIZE FOR SINGLE LINE SPOUSES AND CHILDREN
				hbox = {
					visible = "[And(Not(Or(GreaterThan_int32(CharacterLateralview.GetCharacter.GetSpousesAmount, '(int32)3'), GreaterThan_int32(GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren), '(int32)10'))),
					Or(CharacterLateralview.GetCharacter.GetFather.IsValid, CharacterLateralview.GetCharacter.GetMother.IsValid))]"
					using = layoutpolicy_expanding
					using = character_actions
				}

				# SIZE FOR 2 LINES OF SPOUSES AND CHILDREN
				hbox = {
					visible = "[And(Or(GreaterThan_int32(CharacterLateralview.GetCharacter.GetSpousesAmount, '(int32)3'), GreaterThan_int32(GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren), '(int32)10')),
					Or(CharacterLateralview.GetCharacter.GetFather.IsValid, CharacterLateralview.GetCharacter.GetMother.IsValid))]"
					using = layoutpolicy_expanding
					using = character_actions
					# blockoverride "character_actions_max_size" {
					# 	using = layoutpolicy_expanding
					# 	autoresizescrollarea = no
					# }
				}
			}
		}
	}
}

template partner_character_view { 
	vbox = {
		using = layoutpolicy_expanding
		using = bg_paper_card

		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 40 }
			using = bg_card_header_01
			blockoverride "bg_card_header_01_bg" {
				background = {
					using = bg_card_header_01_default
					alpha = 0.6
				}
			}
			blockoverride "header_color" {
				using = color_society_texture
			}
			blockoverride "header_pattern_texture_density" {texture_density = 1.75}
			blockoverride "header_pattern_alpha" { alpha = 0.5 }
			
			hbox = {
				ignoreinvisible = yes
				subheader_unified_icon = {
					blockoverride "subheader_unified_icon_texture" {
						texture = "gfx/interface/icons/character_roles/spouse.dds"
					}
					
					blockoverride "subheader_unified_top_text" {
						text = "CHAR_SPOUSE_COV"
						align = nobaseline
					}
					blockoverride "subheader_unified_bottom_text" {
						text = "[CharacterLateralview.GetCharacter.GetSpousesAmount]"
						align = nobaseline		
					}
				}

				expand = {}
			}
		}

		widget = {
			layoutpolicy_horizontal = expanding
			block "partner_character_view_size" {
				size = { -1 57 }
			}

			scrollarea = {
				layoutpolicy_horizontal = expanding
				block "partner_character_view_max_size" {
					maximumsize = { -1 57 }
				}
				
				scrollbarpolicy_horizontal = always_off

				autoresizescrollarea = yes
				minimumsize = { 160 0 }

				scrollbar_vertical = {
					using = Scrollbar_Vertical
				}

				scrollwidget = {
					dynamicgridbox = {
						layoutpolicy_horizontal = expanding
						flipdirection = yes
						datamodel_wrap = 3

						datamodel = "[CharacterLateralview.GetCharacter.GetSpouses]"
						item = {
							widget = {
								size = {44 55}
								visible = "[Character.IsValid]"

								character_frame_small = {
									blockoverride "character_frame_size" {
										size = { 39 46 }
										parentanchor = center
										position = {3 0}
									}
									blockoverride "character_frame_estate_visible" {
										visible = no
									}
									blockoverride "portrait_datacontext" {
										datacontext = "[Character]"
									}
									blockoverride "character_portrait_visible" {
										visible = yes
									}
									blockoverride "character_portrait_ani_visible" {
										visible = no
									}
									blockoverride "portrait_position" {position = { 0 0 }}
								}
								character_ribbon_3 = {
									datacontext = "[Character]"
									visible = "[And(Not(Character.IsAlive), Character.WasRuler)]"
									blockoverride "ribbon color" {
										modify_texture = {
											using = color_black_texture
											blend_mode = overlay
											alpha = 0.2
										}
									}
									blockoverride "stretchable" {}
								}

								character_ribbon_3 = {
									datacontext = "[Character]"
									visible = "[And(Character.IsAlive, Character.IsRuler)]"										
									blockoverride "stretchable" {}
								}
							}
						}
					}
				}
			}
		}
	}
}

template children_character_view {
	vbox = {
		using = layoutpolicy_expanding
		using = bg_paper_card

		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 40 }
			using = bg_card_header_01
			blockoverride "bg_card_header_01_bg" {
				background = {
					using = bg_card_header_01_default
					alpha = 0.6
				}
			}
			blockoverride "header_color" {
				using = color_society_texture
			}
			blockoverride "header_pattern_texture_density" {texture_density = 1.75}
			blockoverride "header_pattern_alpha" { alpha = 0.5 }
			
			hbox = {
				ignoreinvisible = yes
				subheader_unified_icon = {
					blockoverride "subheader_unified_icon_texture" {
						texture = "gfx/interface/icons/character_roles/children.dds"
					}
					
					blockoverride "subheader_unified_top_text" {
						text = "CHAR_CHILDREN_COV"
						align = nobaseline
					}
					blockoverride "subheader_unified_bottom_text" {
						raw_text = "[GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren)]"
						using = Font_Size_Small
						align = nobaseline		
					}
				}

				expand = {}

				# widget = {
				# 	layoutpolicy_horizontal = expanding
				# 	size = { -1 40 }
				# 	#Countries of Member type
				# 	hbox = {
				# 		spacing = 5
				# 		maximumsize = {50 38}
				# 		position = {4 0}

				# 		icon = {
				# 			size = { 34 34 }
				# 			texture = "gfx/interface/icons/character_roles/children.dds"
				# 			texture_density = 2
							
				# 			alpha = 1
				# 			glow = {
				# 				name = "drop_shadow"
				# 				glow_radius = 4
				# 				color = {0.0 0.0 0.0 1.0}
				# 				alpha = 0.6
				# 			}

				# 		}

				# 		vbox = {
				# 			maximumsize = { 50 -1 }

				# 			text_single = {
				# 				text = "CHAR_CHILDREN_COV"
				# 				layoutpolicy_horizontal = expanding
				# 			}

				# 			text_single = {
				# 				layoutpolicy_horizontal = expanding
				# 				raw_text = "[GetDataModelSize(CharacterLateralview.GetCharacter.GetChildren)]"
				# 				using = Font_Size_Small
				# 			}
				# 		}
				# 	}
				# }
			}
		}

		widget = {
			layoutpolicy_horizontal = expanding
			block "children_character_view_size" {
				size = { -1 57 }
			}
			
			overlappingitembox = {
				block "children_character_overlap_visible" {
					visible = yes
				}
				size = { 325 57 }

				datamodel = "[CharacterLateralview.GetCharacter.GetChildren]"

				item = {
					widget = {
						size = {44 55}
						
						character_frame_small = {
							blockoverride "character_frame_size" {
								size = { 39 46 }
								parentanchor = center
								position = {3 0}
							}
							blockoverride "character_frame_estate_visible" {
								visible = no
							}
							blockoverride "portrait_datacontext" {
								datacontext = "[Character]"
							}
							blockoverride "character_portrait_visible" {
								visible = yes
							}
							blockoverride "character_portrait_ani_visible" {
								visible = no
							}
							blockoverride "portrait_position" {position = { 0 0 }}
						}

						widget = {
							visible = "[Character.IsHeir]"
							size = {12 12}
							parentanchor = right|bottom
							position = { -1 -4 }
							using = bg_circle_piechart
							blockoverride "frame_color" {
								modify_texture = {
									using = color_gold_texture
									blend_mode = overlay
								}
								modify_texture = {
									texture = "gfx/interface/component_overlay/gold_overlay_circle.dds"
									texture_density = 2
									spriteType = stretched
									spriteborder = { 250 250 }
									blend_mode = add
									alpha = 0.1
								}
							}
							icon = {
								size = { 80% 80% }
								texture = "gfx/interface/icons/character_roles/heir.dds"
								parentanchor = center
				
								glow = {
									name = "drop_shadow"
									glow_radius = 3
									color = {0.0 0.0 0.0 1.0}
									alpha = 0.7
								}
							}
						}
					}
				}
			}

			scrollarea = {
				block "children_character_scroll_visible" {
					visible = no
				}
				layoutpolicy_horizontal = expanding
				block "children_character_view_max_size" {
					maximumsize = { -1 50 }
				}
				scrollbarpolicy_horizontal = always_off

				autoresizescrollarea = yes
				minimumsize = { 365 0 }
				scrollbar_vertical = {
					using = Scrollbar_Vertical
				}
				scrollwidget = {
					dynamicgridbox = {
						layoutpolicy_horizontal = expanding
						flipdirection = yes
						datamodel_wrap = 6

						datamodel = "[CharacterLateralview.GetCharacter.GetChildren]"
						item = {
							widget = {
								size = { 44 55 }
								character_frame_small = {
									blockoverride "character_frame_size" {
										size = { 39 46 }
										parentanchor = center
										position = {5 0}
									}
									blockoverride "character_frame_estate_visible" {
										visible = no
									}
									blockoverride "portrait_datacontext" {
										datacontext = "[Character]"
									}
									blockoverride "character_portrait_visible" {
										visible = yes
									}
									blockoverride "character_portrait_ani_visible" {
										visible = no
									}
									blockoverride "portrait_position" {position = { 0 0 }}
								}
							}
						}
					}
				}
			}
		}
	}
}

template "character_actions" {
	vbox = {
		visible = "[CharacterLateralview.GetCharacter.IsAlive]"
		using = bg_paper_card
		using = layoutpolicy_expanding
		margin_top = 10
		scrollarea = {
			using = layoutpolicy_expanding
			minimumsize = { -1 50 }
			scrollbarpolicy_horizontal = always_off

			scrollbar_vertical = {
				using = Scrollbar_Vertical
			}
			
			scrollwidget = {
				fixedgridbox = {
					addcolumn = 100%
					addrow = 40
					setitemsizefromcell = yes
					datacontext = "[Pin('character_actions')]"
					datamodel = "[CharacterLateralview.GetActions]"
					
					item = {
						widget = {
							datacontext = "[CharacterActionItem.GetUIAction]"
							hbox = {
								margin = { 5 4 }
								margin_right = 15

								button_regular_icon = {
									visible = "[CharacterActionItem.HasEffectsInfo]"
									using = layoutpolicy_expanding
									using = button_action_provider
									datacontext = "[Character.GetEducation]"
									tooltipwidget = {
										using = ChildEducation_tooltip
									}

									hbox = {
										margin = { 14 4 }

										icon = {
											size = { 23 23 }
											texture = "gfx/interface/icons/traits/background/education_background.dds"

											icon = {
												size = { 100% 100% }
												texture = "[GetEducationIcon(ChildEducation.Self)]"

												texture_density = 2
												glow = {
													name = "drop_shadow"
													glow_radius = 3
													color = {0.0 0.0 0.0 1.0}
													alpha = 0.5
												}
											}
										}
										expand = {}
									}
								}

								button_regular_icon = {
									visible = "[Not(CharacterActionItem.HasEffectsInfo)]"
									using = layoutpolicy_expanding
									using = button_action_provider
									tooltipwidget = {
										ContextualTooltipType = {
											blockoverride "title_text" {
												text = "[UIAction.GetTitle]"
											}
									
											blockoverride "concept_link" {
												text = "[Localize(Concatenate(CharacterActionItem.GetKey, '_concept'))]"
											}
											
											blockoverride "title_icon" {
												icon = {
													using = tooltip_title_icon_size
													texture = "[CharacterActionItem.GetIcon]"
												}
											}
											
											blockoverride "tooltip_content" {
												using = action_tooltip_inner_content
											}

											blockoverride "tooltip_ui_action_block" {
												TooltipUIActionBlockOld = {
													visible = "[PdxGuiWidget.HasUIAction]"
												}
											}
										}
									}

									hbox = {
										margin = { 14 4 }

										icon = {
											size = { 23 23 }
											texture = "[CharacterActionItem.GetIcon]"
			
											texture_density = 2
											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.5
											}
										}
										expand = {}
									}
								}
							}

							hbox = {
								margin = { 49 4 }
								margin_right = 25
								spacing = 10

								text_single = {
									visible = "[CharacterActionItem.HasEffectsInfo]"
									text = "[Select_CString(Character.HasEducation, CharacterActionItem.GetTitle, Localize('SELECT_EDUCATION'))]"
								}

								text_single = {
									visible = "[Not(CharacterActionItem.HasEffectsInfo)]"
									text = "[UIActionProvider.GetTitle]"
								}

								expand = {}

								text_single = {
									visible = "[CharacterActionItem.HasEffectsInfo]"
									text = "[CharacterActionItem.GetEffectsInfo]"
								}
	
								button_pin = {
									size = { 23 23 }
	
									onclick = "[PinCollection.Toggle( CharacterActionItem.GetKey )]"
									checked = "[PinCollection.IsPinned( CharacterActionItem.GetKey )]"
									tooltipwidget = { 
										LeftClickButtonTooltip = {
											blockoverride "onclick_text" { 
												text = "[SelectLocalization(PinCollection.IsPinned( CharacterActionItem.GetKey ), 'UNPIN_ACTION', 'PIN_ACTION')]"
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

types CharacterPanel {
	type "character_header" = widget {
		scissor = yes
		layoutpolicy_horizontal = expanding
		size = { -1 220 }

		hbox = {
			ecs_scene_viewer_widget =  {
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding
				name = "event_window_scene_viewer"
				scene = "[CharacterLateralview.GetCharacter.GenerateSceneDesc]"
			}
		}

		container = {
			parentanchor = bottom|hcenter

			portrait_standard_full_body_center_button = {
				parentanchor = bottom|hcenter

				position = { 0 -10 }
				size = { 250 220 }
			}
		}

		hbox = {
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding
			

			background = {
				using = color_dark_blue_texture
				alpha = 1

				margin_top = -140

				modify_texture = {
					using = bg_fade_vertical_up_mask_texture
					blend_mode = alphamultiply
					alpha = 1
				}
			}

			### RULER TITLE, COAT, SKILLS
			hbox = {
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding

				margin = { 5 5 }

				vbox = {
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 8

						expand = {}

						# Modifiers
						widget = {
							size = { 95 48 }
							hbox = {
								spacing = 4
								# CHARACTER MODIFIERS
								OneOrSeveralTimedModifiers = {
									datacontext = "[CharacterLateralview.GetCharacter.GetTimedModifierOwner]"
								}
							}
						}
					}

					expand = {}

					hbox =  {
						layoutpolicy_horizontal = expanding
						# background = {
						# 	texture = "gfx/interface/component_tiles/square_tile.dds"
						# 	texture_density = 2
						# 	alpha = 0.7
						# 	modify_texture = {
						# 		using = color_dark_blue_texture
						# 		blend_mode = normal
						# 	}
						# 	modify_texture = {
						# 		texture = "gfx/interface/component_masks/mask_fade_horizontal_middle_overlay.dds"
						# 		blend_mode = alphamultiply
						# 		alpha = 0.9
						# 	}
						# }
						# background = {
						# 	texture = "gfx/interface/component_tiles/square_tile.dds"
						# 	texture_density = 2
						# 	alpha = 0.5
						# 	modify_texture = {
						# 		using = color_dark_blue_texture
						# 		blend_mode = normal
						# 	}
						# 	modify_texture = {
						# 		using = overlay_cloth_texture
						# 		blend_mode = overlay
						# 		alpha = 0.2
						# 	}
						# 	modify_texture = {
						# 		texture = "gfx/interface/component_masks/mask_fade_horizontal_middle_overlay.dds"
						# 		blend_mode = alphamultiply
						# 		alpha = 0.7
						# 	}
						# }

						using = bg_paper_card
						using = bg_cabinet_card_frame

						widget = {
							size = {468 40}
							
							# TRAITS
							widget = {
								size = {196 40}
								parentanchor = left|vcenter

								widget = {
									size = {196 40}
									parentanchor = right|vcenter

									hbox = {
										layoutpolicy_horizontal = expanding
										margin_right = 10
										spacing = 7

										expand = {}

										hbox = {
											datamodel = "[CharacterLateralview.GetTraits]"
											item = {
												widget = {
													size = { 40 40 }
													icon = {
														size = { 100% 100% }
														using = trait_item
														parentanchor = center
													}
												}
											}
										}

										hbox = {
											spacing = 7
											datamodel = "[CharacterLateralview.GetNextRulerTraits]"
											item = {
												widget = {
													size = { 26 26 }
													piechart = {
														tooltipwidget = {
															SimpleContextualTooltipType = {
																blockoverride "concept_link" {
																	text = "[trait|e]"
																}
																
																blockoverride "title_icon" {
																	icon = {
																		using = tooltip_title_icon_size
																		texture = "[GetConceptTexture('ruler_trait')]"
																	}
																}
																lowpriotextcontext =  "[RulerTraitEntry.GetProgressInfo]"
															}
														}
														size = { 26 26 }
														parentanchor = center
									
														using = piechart_angles
									
														icon = {
															texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
															size = { 97% 97% }
															parentanchor = center
															color = { 0 0 0 1 }
														}
														using = bg_circle_piechart
									
														pieslice = {
															texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
															value = "[RulerTraitEntry.GetProgressToNextTrait]"
															using = color_value_progress_blue
														}
									
														pieslice = {
															texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
															value = "[Subtract_float('(float)100.0', RulerTraitEntry.GetProgressToNextTrait)]"
															using = color_value_progress_gray
														}
													}
									
													icon = {
														size = { 19 19 }
														parentanchor = center
														texture = "gfx/interface/icons/ruler_default.dds"
														texture_density = 2
									
														background = {
															texture = "gfx/interface/icons/traits/background/trait_bg.dds"
															texture_density = 2
															margin = { -3 -3 }
															using = color_mid_blue
									
															modify_texture = {
																using = overlay_stone_texture
																blend_mode = overlay
																alpha = 0.8
															}
														}
													}
												}
											}
										}

										hbox = {
											datamodel = "[CharacterLateralview.GetActions]"
											item = {
												icon = {
													visible = "[CharacterActionItem.IsCharacterEducation]"
													allow_outside = yes
													size = { 40 40 }
													texture = "gfx/interface/icons/traits/background/education_background.dds"
													datacontext = "[CharacterActionItem.GetUIAction]"
	
													button = {
														visible = "[ObjectsEqual(CharacterLateralview.GetCharacter.GetCourtCountry, Player.Self)]"
														parentanchor = center
														using = button_action_provider_base
														datacontext = "[Character.GetEducation]"
														tooltipwidget = {
															using = ChildEducation_tooltip
														}
	
														size = { 40 40 }
														texture = "[GetEducationIcon(Character.GetEducation)]"
													}
	
													icon = {
														visible = "[Not(ObjectsEqual(CharacterLateralview.GetCharacter.GetCourtCountry, Player.Self))]"
														parentanchor = center
														datacontext = "[Character.GetEducation]"
														tooltipwidget = {
															using = ChildEducation_tooltip
														}
														
														size = { 40 40 }
														texture = "[GetEducationIcon(Character.GetEducation)]"
													}
												}
											}
										}
									}
								}	
							}

							# DYNASTY
							widget = {
								size = {76 30}
								parentanchor = center

								widget = {
									size = {60 30}
									parentanchor = center

									widget = {
										size = { 15 20 }
										parentanchor = top|left
										position = {5 -3}
	
										icon = {
											size = { 15 20 }
											texture = "gfx/interface/component_tiles/dynasty_tree/dynasty_coa_flavor.dds"
											texture_density = 2
											parentanchor = top|left
											position = {-7 4}
											
											modify_texture = {
												using = color_dark_brown_texture
												blend_mode = multiply
											}
							
											modify_texture = {
												using = overlay_cloth_texture
												blend_mode = overlay
												alpha = 0.3
											}
							
											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
										icon = {
											size = { 15 20 }
											texture = "gfx/interface/component_tiles/dynasty_tree/dynasty_coa_flavor_frame.dds"
											texture_density = 2
											parentanchor = top|left
											position = {-7 4}
											
											modify_texture = {
												using = color_new_gold_texture
												blend_mode = multiply
											}
							
											modify_texture = {
												using = mask_scratches_texture
												blend_mode = overlay
												alpha = 0.3
											}
										}
									}

									widget = {
										size = {40 30}
										position = {-7 -0}
										parentanchor = hcenter|top

										character_label_dynasty = {}

										lowborn_coat_of_arms = {
											visible = "[Not(Character.HasDynasty)]"
											position = {7 -1}
											size = {31 30}
										}
									}

									widget = {
										size = { 15 20 }
										parentanchor = top|right
										position = {0 -3}
	
										icon = {
											size = { 15 20 }
											texture = "gfx/interface/component_tiles/dynasty_tree/dynasty_coa_flavor.dds"
											texture_density = 2
											parentanchor = top|right
											mirror = horizontal
											position = {-7 4}
											
											modify_texture = {
												using = color_dark_brown_texture
												blend_mode = multiply
											}
							
											modify_texture = {
												using = overlay_cloth_texture
												blend_mode = overlay
												alpha = 0.3
											}
							
											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
										icon = {
											size = { 15 20 }
											texture = "gfx/interface/component_tiles/dynasty_tree/dynasty_coa_flavor_frame.dds"
											texture_density = 2
											parentanchor = top|right
											mirror = horizontal
											position = {-7 4}
											
											modify_texture = {
												using = color_new_gold_texture
												blend_mode = multiply
											}
							
											modify_texture = {
												using = mask_scratches_texture
												blend_mode = overlay
												alpha = 0.3
											}
										}
									}
								}
							}

							# ABILITIES
							widget = {
								size = {196 40}
								parentanchor = right
								expand = {}

								hbox = {

									character_abilities = {
										visible = "[Not(Character.IsArtist)]"
	
										blockoverride "abilities_format" {
											layoutpolicy_vertical = expanding
											margin = { 7 0 }
											spacing = 10
										}
	
										blockoverride "ability_icon_size" {
											size = { 20 20 }
										}
	
										blockoverride "abilities_bg" {
											background = {
												texture = "gfx/interface/component_tiles/square_tile.dds"
												texture_density = 2
												alpha = 0.1
												blend_mode = overlay
												modify_texture = {
													using = color_black_texture
													blend_mode = multiply
												}
											}
										}
									}
			
									artist_abilities = {
										visible = "[Character.IsArtist]"

										blockoverride "abilities_format" {
											layoutpolicy_vertical = expanding
											margin = { 7 0 }
											spacing = 10
										}

										blockoverride "abilities_bg" {
											background = {
												texture = "gfx/interface/component_tiles/square_tile.dds"
												texture_density = 2
												alpha = 0.3
												blend_mode = overlay
												modify_texture = {
													using = color_black_texture
													blend_mode = multiply
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}

		block "character_header_extra" {}
	}
}
