namespace = imperial_examination_events

imperial_examination_events.1 = {	#Imperial Examination system base event
	type = country_event
	title = imperial_examination_events.1.title
	desc = imperial_examination_events.1.desc
	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			estate = estate_type:peasants_estate
			adm = { 
				value = { 30 60 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			dip = { 
				value = { 30 60 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
					if = {
						limit = {
							has_country_modifier = strengthened_ministry_of_personnel
						}
						add = { value = 10 }
					}
				}
				max = 100
			}
			mil = { 
				value = { 30 60 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			save_scope_as = target_character
		}
	}

	option = { name = imperial_examination_events.1.a }
}

imperial_examination_events.2 = {	#Liu Bowen 1375 
	type = country_event
	title = imperial_examination_events.1.title
	desc = imperial_examination_events.1.desc
	historical_info = imperial_examination_events.2.historical_info
	illustration_tags = {
		10 = regular
		10 = interior
	}
	fire_only_once = yes
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			estate = estate_type:peasants_estate
			first_name = Bowen_chinese
			last_name = name_liu2
			birth_date = 1311.7.1
			birth_location = location:qingtian 
			adm = { 
				value = { 60 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			dip = { 
				value = { 60 85 }  
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			mil = { 
				value = { 60 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			save_scope_as = target_character
		}
	}

	option = { 
		name = imperial_examination_events.1.a 
	
		add_army_tradition = army_tradition_mild_bonus
		add_research_progress = research_progress_mild_bonus
	}
}

imperial_examination_events.3 = {	#Yu Qian 1457
	type = country_event
	title = imperial_examination_events.1.title
	desc = imperial_examination_events.1.desc
	historical_info = imperial_examination_events.3.historical_info
	illustration_tags = {
		10 = regular
		10 = interior
	}
	fire_only_once = yes
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			estate = estate_type:peasants_estate
			first_name = name_qian1
			last_name = name_yu24
			birth_date = 1398.5.13
			birth_location = location:hangzhou 
			adm = { 
				value = { 60 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			dip = { 
				value = { 60 85 }  
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			mil = { 
				value = { 75 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			save_scope_as = target_character
			script = chi_yu_qian
			add_trait = trait:defensive_planner
		}
	}

	option = { 
		name = imperial_examination_events.1.a 
	
	}
}

imperial_examination_events.4 = {	#Han Yong 1478
	type = country_event
	title = imperial_examination_events.1.title
	desc = imperial_examination_events.1.desc
	historical_info = imperial_examination_events.4.historical_info
	illustration_tags = {
		10 = regular
		10 = interior
	}
	fire_only_once = yes
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			estate = estate_type:peasants_estate
			first_name = name_yong
			last_name = name_han2
			birth_date = 1422.6.1
			birth_location = location:wuxian 
			adm = { 
				value = { 60 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			dip = { 
				value = { 60 85 }  
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			mil = { 
				value = { 75 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			save_scope_as = target_character
			script = chi_han_yong_script
		}
	}

	option = { 
		name = imperial_examination_events.1.a 
		custom_tooltip = chi_while_han_yong_cabinet_tengwang_pavilion_tt
	}
}

imperial_examination_events.5 = {	#Xu Pu 1454
	type = country_event
	title = imperial_examination_events.1.title
	desc = imperial_examination_events.1.desc
	historical_info = imperial_examination_events.5.historical_info
	illustration_tags = {
		10 = regular
		10 = interior
	}
	fire_only_once = yes
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			estate = estate_type:peasants_estate
			first_name = name_pu
			last_name = name_xu
			birth_date = 1429.6.1
			birth_location = location:yixing 
			adm = { 
				value = { 75 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			dip = { 
				value = { 60 85 }  
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			mil = { 
				value = { 60 85 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			save_scope_as = target_character
		}
	}

	option = { 
		name = imperial_examination_events.1.a 
		
	}
}

imperial_examination_events.6 = {	#Wang Yangming 1499
	type = country_event
	title = imperial_examination_events.1.title
	desc = imperial_examination_events.1.desc
	historical_info = imperial_examination_events.6.historical_info
	illustration_tags = {
		10 = regular
		10 = interior
	}
	fire_only_once = yes
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			estate = estate_type:peasants_estate
			first_name = name_yang22.name_ming
			last_name = name_wang
			birth_date = 1472.10.6
			birth_location = location:yuyao 
			adm = { 
				value = { 80 100 } 
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			dip = { 
				value = { 80 100 }   
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			mil = { 
				value = { 80 100 }  
				add = {
					value = root.average_country_literacy
					divide = 4
				}
				if = {
					limit = {
						exists = international_organization:middle_kingdom.leader_country
						international_organization:middle_kingdom.leader_country = root
						international_organization:middle_kingdom = { 
							international_organization_has_policy = policy:new_keju_formats_policy 
						}
					}
					add = { value = 10 }
				}
				if = {
					limit = {
						has_country_modifier = strengthened_ministry_of_personnel
					}
					add = { value = 10 }
				}
				max = 100
			}
			save_scope_as = target_character
		}
	}

	option = { 
		name = imperial_examination_events.1.a 
		
	}
}

#Repeateable event of the national civil service examinations
#https://en.wikipedia.org/wiki/Gwageo
imperial_examination_events.7 = {
	type = country_event
	title = imperial_examination_events.7.title
	desc = imperial_examination_events.7.desc
	
	trigger = {
		has_imperial_examinations = yes
		has_variable = year_of_start_of_examination_system
		current_year >= { #Have 20 years passed since the signing of the law
			value = var:year_of_start_of_examination_system
			add = 20
		}
	}
	illustration_tags = {
        10 = regular
        10 = interior
    }
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		set_variable = {
			name = year_of_start_of_examination_system
			value = current_year
			days = 8000 #Giving it a expiring date to avoid shaenanigans
		}

		random_owned_location = { save_scope_as = random_location_1 }
		random_owned_location = { save_scope_as = random_location_2 }
		random_owned_location = { save_scope_as = random_location_3 }
		
		#Count the number learning buildings in the country
		set_local_variable = { name = num_schools value = 0 }
		every_owned_location = {
			if = { 
				limit = { has_building_with_at_least_one_level = confucian_school } 
				owner = { change_local_variable = { name = num_schools add = 1 } }
			}
			if = { 
				limit = { has_building_with_at_least_one_level = confucian_academy } 
				owner = { change_local_variable = { name = num_schools add = 1 } }
			}
			if = { 
				limit = { has_building_with_at_least_one_level = library } 
				owner = { change_local_variable = { name = num_schools add = 1 } } 
			}
			if = { 
				limit = { has_building_with_at_least_one_level = university } 
				owner = { change_local_variable = { name = num_schools add = 1 } }
			}
		}
		#Use that number to create 3 characters that have better stats if the country 
		# has tons of learning buildings
		set_variable = { 
			name = admvar 
			value = {
				integer_range = {
					min = {
						value = local_var:num_schools
						multiply = 2
						add = 50
						max = 95
					}
					max = 100
				}
			} 
			days = 1
		}
		set_variable = { name = dipvar value = { integer_range = { min = 40 max = 60 } } days = 1}
		set_variable = { name = milvar value = { integer_range = { min = 40 max = 60 } } days = 1 }
		create_character = {
			adm = var:admvar
			dip = var:dipvar
			mil = var:milvar
			estate = estate_type:burghers_estate
			save_scope_as = adm_bureocrat
		}
		set_variable = { name = admvar value = { integer_range = { min = 40 max = 60 } } days = 1}
		set_variable = { 
			name = dipvar 
			value = {
				integer_range = {
					min = {
						value = local_var:num_schools
						multiply = 2
						add = 50
						max = 95
					}
					max = 100
				}
			} 
			days = 1
		}
		set_variable = { name = milvar value = { integer_range = { min = 40 max = 60 } } days = 1}
		
		create_character = {
			adm = var:admvar
			dip = var:dipvar
			mil = var:milvar
			estate = estate_type:burghers_estate
			save_scope_as = dip_bureocrat
		}
		set_variable = { name = admvar value = { integer_range = { min = 40 max = 60 } } days = 1}
		set_variable = { name = dipvar value = { integer_range = { min = 40 max = 60 } } days = 1}
		set_variable = { 
			name = milvar 
			value = {
				integer_range = {
					min = {
						value = local_var:num_schools
						multiply = 2
						add = 50
						max = 95
					}
					max = 100
				}
			} 
			days = 1
		}
		
		create_character = {
			adm = var:admvar
			dip = var:dipvar
			mil = var:milvar
			estate = estate_type:burghers_estate
			save_scope_as = mil_bureocrat
		}
	}

	option = {
		name = imperial_examination_events.7.a
		custom_tooltip = {
			text = imperial_examination_events.7.a.tt
			hidden_effect = { 
				kill_character_silently = scope:dip_bureocrat
				kill_character_silently = scope:mil_bureocrat
			}  
		}
	}
	option = {
		name = imperial_examination_events.7.b
		custom_tooltip = {
			text = imperial_examination_events.7.b.tt
			hidden_effect = { 
				kill_character_silently = scope:adm_bureocrat
				kill_character_silently = scope:mil_bureocrat
			}
		}
	}
	option = {
		name = imperial_examination_events.7.c
		custom_tooltip = {
			text = imperial_examination_events.7.c.tt
			hidden_effect = { 
				kill_character_silently = scope:adm_bureocrat
				kill_character_silently = scope:dip_bureocrat
			}
		}
	}
}