namespace = reformation

scripted_effect add_to_reformer_list = {
	add_to_global_variable_list = {
		name = reformer_list
		target = scope:target_character
	}
}

scripted_trigger is_swiss_tag = {
	OR = {
		tag = SWI
		tag = BCH
		tag = STG
		tag = ZUR
		tag = SYZ
		tag = GLR
		tag = URI
		tag = OBW
		tag = LCU
		tag = SIT
		tag = BRN
		tag = SLT
		tag = NEU
		tag = BAS
		tag = LSA
		tag = KYB
		tag = TRN
		tag = GNV
		tag = SCL
		tag = WER
	}
}

reformation.1 = {
	type = country_event
	category = situation_event
	title = reformation.1.title
	desc = reformation.1.desc
	image = "gfx/interface/illustrations/situation/reformation.dds"
	immediate = {
		situation:reformation = {
			var:lutheran_origin = {
				save_scope_as = target_location
			}
			var:lutheran_character = {
				save_scope_as = target_character
			}
		}
		add_to_reformer_list = yes
	}
	option = {
		name = reformation.1.a
		show_as_tooltip = {
			scope:target_character = {
				move_country = scope:target_location.owner
			}
			scope:target_location = {
				every_pop = {
					limit = { religion = religion:catholic }
					split_pop = {
						fraction = 0.30
						religion = religion:lutheran
					}
				}
				construct_building = {
					building_type = building_type:lutheran_preachers
					cost_multiplier = 0
					cost_multiplier_reason = "preachers_work_for_free"
				}
			}
		}
	}
}


reformation.2 = {
	type = country_event
	category = situation_event

	title = reformation.2.title
	desc = reformation.2.desc


	option = {
		name = reformation.2.a
		add_country_modifier = {
			modifier = bible_translations_banned
			mode = add_and_extend
			years = 25
		}
	}

	option = {
		name = reformation.2.b

		add_religious_influence = religious_influence_weak_penalty

		if = {
			limit = {
				any_owned_location = {
					dominant_religion = religion:catholic
					NOT = { has_building = building_type:lutheran_preachers }
				}
			}
			ordered_owned_location = {
				order_by = population
				limit = {
					dominant_religion = religion:catholic
					NOT = { has_building = building_type:lutheran_preachers }
				}
				max = {
					value = 1
					add = {
						value = root.num_provinces
						multiply = 0.25
					}
				}

				check_range_bounds = no

				change_building_level_in_location = { building = building_type:lutheran_preachers value = 1}
			}
		}
	}

}

reformation.3 = { #Philip Melanchton
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_philip
			last_name = Melanchton
			religion = religion:lutheran
			birth_date = 1497.2.16
			birth_location = location:bruchsal
			estate = estate_type:clergy_estate
			adm = { 40 60 }
			dip = { 40 60 }
			mil = { 80 100 }
			script = reformer_philip_melanchton
			save_scope_as = target_character
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:wittenberg = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:lutheran_preachers
				cost_multiplier = 0
				cost_multiplier_reason = "preachers_work_for_free"
			}
		}
		set_variable = received_reformer
	}
}

reformation.4 = { #Justus Jonas
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_justus
			last_name = Jonas
			religion = religion:lutheran
			birth_date = 1493.6.5
			birth_location = location:nordhausen
			estate = estate_type:clergy_estate
			adm = { 40 60 }
			dip = { 40 60 }
			mil = { 80 100 }
			script = reformer_justus_jonas
			save_scope_as = target_character
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:halle_an_der_saale = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:lutheran_preachers
				cost_multiplier = 0
				cost_multiplier_reason = "preachers_work_for_free"
			}
		}
		set_variable = received_reformer
	}
}

reformation.5 = { #Mikael Agricola
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_michael
			last_name = agricola
			religion = religion:lutheran
			birth_location = location:porvoo
			birth_date = 1510.1.1 #unknown
			estate = estate_type:clergy_estate
			adm = { 40 60 }
			dip = { 40 60 }
			mil = { 80 100 }
			script = swe_mikael_agricola
			save_scope_as = target_character
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:abo = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:lutheran_preachers
				cost_multiplier = 0
				cost_multiplier_reason = "preachers_work_for_free"
			}
		}
		set_variable = received_reformer
	}
}

reformation.6 = { #Hans Tausen
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_john
			last_name = Tausen
			religion = religion:lutheran
			birth_location = location:odense
			culture = culture:danish
			birth_date = 1494.1.1 #unknown
			estate = estate_type:clergy_estate
			adm = 71
			dip = 85
			mil = { 80 100 }
			script = script_hans_tausen
			save_scope_as = target_character
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:kobenhavn = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:lutheran_preachers
				cost_multiplier = 0
				cost_multiplier_reason = "preachers_work_for_free"
			}
		}
		set_variable = received_reformer
	}
}

reformation.7 = { #John Calvin
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_john
			last_name = calvin
			culture = culture:picard
			birth_location = location:noyon
			religion = religion:calvinist
			script = john_calvin
			birth_date = 1509.7.10
			estate = estate_type:clergy_estate
			adm = { 40 60 }
			dip = { 40 60 }
			mil = { 80 100 }
			save_scope_as = target_character
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:basel = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		religion:calvinist = {
			enable_religion = yes
		}

		scope:target_location = {
			construct_building = { building_type = building_type:calvinist_preachers }
		}

		scope:target_location.owner = {
			trigger_event_silently = {
				id = calvinist.2
				days = { 60 90 }
			}
		}
		location:paris.owner = {
			trigger_event_silently = {
				id = calvinist.1
				days = { 60 90 }
			}
		}
		set_variable = received_reformer
	}
}

reformation.8 = { #Huldrych Zwingli
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_ulrick # alternative Huldrych
			last_name = Zwingli
			religion = religion:catholic
			adm = 78
			dip = 82
			mil = { 80 100 }
			birth_date = 1484.1.1
			birth_location = location:werdenberg
			culture = culture:high_alemannic
			estate = estate_type:peasants_estate
			save_scope_as = target_character
			script = swi_huldrych_zwingli
			add_trait = trait:unsuited_for_naval_command
			add_trait = trait:unsuited_for_army_command
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:bern = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:lutheran_preachers
				cost_multiplier = 0
				cost_multiplier_reason = "preachers_work_for_free"
			}
		}
		if = {
			limit = {
				is_swiss_tag = no
			}
			scope:target_character = {
				change_character_religion = religion:lutheran
			}
		}
		set_variable = received_reformer
	}
}

reformation.9 = { #Heinrich Bullinger
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_henry
			last_name = Bullinger
			adm = { 40 60 }
			dip = { 40 60 }
			mil = { 80 100 }
			birth_date = 1504.7.18
			birth_location = location:aarau
			religion = religion:lutheran
			estate = estate_type:clergy_estate
			script = reformation_henry_bullinger
			save_scope_as = target_character
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:zurich = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:lutheran_preachers
				cost_multiplier = 0
				cost_multiplier_reason = "preachers_work_for_free"
			}
		}
		set_variable = received_reformer
	}
}

reformation.10 = { #John Knox
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_john
			last_name = name_knox
			adm = 90
			dip = 90
			mil = { 80 100 }
			birth_date = 1514.1.1 #unknown
			birth_location = location:edinburgh
			culture = culture:scottish
			religion = religion:calvinist
			add_trait = trait:unsuited_for_naval_command
			add_trait = trait:unsuited_for_army_command
			estate = estate_type:clergy_estate
			save_scope_as = target_character
			script = script_john_knox
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:edinburgh = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = { building_type = building_type:calvinist_preachers }
		}
		set_variable = received_reformer
	}
}

reformation.11 = { #Guido de Bres
	type = country_event
	category = situation_event
	title = reformation.3.title
	desc = reformation.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		create_character = {
			first_name = name_wido
			last_name = de_Bres
			adm = { 40 60 }
			dip = { 40 60 }
			mil = { 80 100 }
			birth_date = 1522.1.1 #unknown
			birth_location = location:mons
			estate = estate_type:clergy_estate
			religion = religion:calvinist
			save_scope_as = target_character
			script = reformation_wido_de_bres
		}
		add_to_reformer_list = yes
		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
		location:antwerp = {
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.3.a

		scope:target_location = {
			construct_building = { building_type = building_type:calvinist_preachers }
		}
		set_variable = received_reformer
	}
}

reformation.12 = { #The Conviction of [target_character.GetNameWithNoTooltip]
	type = country_event
	category = situation_event
	title = reformation.12.title
	desc = reformation.12.desc

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:nobles_estate }

		random_character = {
			limit = {
				is_alive = yes
				is_adult = yes
				religion = root.religion
				NOT = {
					is_target_in_global_variable_list = {
						name = reformer_list
						target = this
					}
				}
			}
			save_scope_as = target_character
		}
		religion = {
			save_scope_as = country_religion
		}
		random_neighbor_country = {
			save_scope_as = exile_destination
		}
	}

	option = {
		name = reformation.12.a

		scope:target_character = {
			random_list = {
				1 = {
					trigger = {
						NOT = { scope:country_religion = religion:catholic }
					}
					change_character_religion = religion:catholic
				}
				1 = {
					trigger = {
						religion:anglican = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:anglican }
					}
					change_character_religion = religion:anglican
				}
				1 = {
					trigger = {
						religion:calvinist = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:calvinist }
					}
					change_character_religion = religion:calvinist
				}
				1 = {
					trigger = {
						religion:hussite = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:hussite }
					}
					change_character_religion = religion:hussite
				}
				1 = {
					trigger = {
						religion:lutheran = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:lutheran }
					}
					change_character_religion = religion:lutheran
				}
			}
		}
		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_minor_move_to_right }
	}

	option = {
		name = reformation.12.b

		trigger = {
			scope:target_character = {
				NOT = {
					is_ruler = yes
				}
			}
		}

		scope:target_character = {
			random_list = {
				1 = {
					trigger = {
						NOT = { scope:country_religion = religion:catholic }
					}
					change_character_religion = religion:catholic
				}
				1 = {
					trigger = {
						religion:anglican = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:anglican }
					}
					change_character_religion = religion:anglican
				}
				1 = {
					trigger = {
						religion:calvinist = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:calvinist }
					}
					change_character_religion = religion:calvinist
				}
				1 = {
					trigger = {
						religion:hussite = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:hussite }
					}
					change_character_religion = religion:hussite
				}
				1 = {
					trigger = {
						religion:lutheran = {
							is_religion_enabled = yes
						}
						NOT = { scope:country_religion = religion:lutheran }
					}
					change_character_religion = religion:lutheran
				}
			}
			move_country = scope:exile_destination
		}
		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_minor_move_to_left }
	}
}

reformation.13 = { #Migration of Minority
	type = country_event
	category = situation_event
	title = reformation.13.title
	desc = reformation.13.desc

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		random_owned_location = {
			limit = {
				dominant_religion = { group = root.religion.group }
				dominant_religion != root.religion
			}
			save_scope_as = target_location
		}
		random_neighbor_country = {
			random_owned_location = {
				save_scope_as = escape_target
			}
		}
	}

	option = {
		name = reformation.13.a

		add_migration = {
			owner = root
			from = scope:target_location.province_definition
			to = scope:escape_target.province_definition
			religion = scope:target_location.dominant_religion
			amount = 0.1
			months = 60
		}
	}

	option = {
		name = reformation.13.b

		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_minor_move_to_right }
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_penalty }
	}
}

reformation.14 = { #A Heretic in Our University
	type = country_event
	category = situation_event
	title = reformation.14.title
	desc = reformation.14.desc

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	trigger = {
		any_character = {
			religion.group = root.religion.group
			religion != root.religion
			OR = {
				has_estate = estate_type:burghers_estate
				has_estate = estate_type:clergy_estate
			}
			is_adult = yes
		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }

		random_character = {
			limit = {
				religion.group = root.religion.group
				religion != root.religion
				OR = {
					has_estate = estate_type:burghers_estate
					has_estate = estate_type:clergy_estate
				}
				is_adult = yes
			}
			save_scope_as = target_character
		}
		random_owned_location = {
			limit = {
				has_building_with_at_least_one_level = university
			}
			save_scope_as = target_location
		}
		random_neighbor_country = {
			save_scope_as = target_exile
		}
	}

	option = {
		name = reformation.14.a

		add_research_progress = research_progress_mild_penalty
		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_minor_move_to_left }
	}

	option = {
		name = reformation.14.b

		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_minor_move_to_right }
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_penalty }
	}
}

reformation.15 = { #Monastery joins the reformation
	type = country_event
	category = situation_event
	title = reformation.15.title
	desc = reformation.15.desc

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }


		random_owned_location = {
			limit = {
				has_building_with_at_least_one_level = monastery
			}
			destroy_building = "building(building_type:monastery|root)"
			construct_building = {
				building_type = building_type:lutheran_preachers
			}
			save_scope_as = target_location
		}
	}

	option = {
		name = reformation.15.a

		scope:target_location = {
			construct_building = {
				building_type = building_type:monastery
			}
		}
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_weak_bonus }
	}

	option = {
		name = reformation.15.b


		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_penalty }
	}

	option = {
		name = reformation.15.c

		trigger = {
			has_policy = jesuits_allowed
		}

		scope:target_location = {
			construct_building = {
				building_type = building_type:jesuit_college
				cost_multiplier = 0.6
				cost_multiplier_reason = "clergy_cheap_sponsorship"
			}
			destroy_building = "building(building_type:lutheran_preachers|root)"
		}
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_severe_bonus }
	}
}

reformation.16 = { #Reformer asks for additional funds
	type = country_event
	category = situation_event
	title = reformation.16.title
	desc = reformation.16.desc

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		situation:reformation = {
			var:lutheran_character = {
				save_scope_as = target_luther
			}
		}
	}

	option = {
		name = reformation.16.a

		change_gold_effect = { scale = -3 }
		add_religious_influence = religious_influence_mild_bonus
	}

	option = {
		name = reformation.16.b

		add_prestige = prestige_weak_penalty
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_penalty }
	}
}