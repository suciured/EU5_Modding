namespace = flavor_vol

flavor_vol.1 = { #Invite catholic advisors to Galicia
	hide_portraits = yes
	type = country_event
	title = flavor_vol.1.title
	desc = flavor_vol.1.desc
	historical_info = flavor_vol.1.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		from = 1337.1.1
		to = 1347.1.1
		monthly_chance = 6
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		create_character = { #polish advisor
			adm = {
				value = { 25 75 }
			}
			dip = {
				value = { 55 85 }
			}
			mil = {
				value = { 25 75 }
			}
			culture = culture:lesser_polish
			religion = religion:catholic
			min_age = 30
			estate = estate_type:burghers_estate
			create_in_limbo = yes
			save_scope_as = target_character_1
		}

		create_character = { #czech advisor
			adm = {
				value = { 55 85 }
			}
			dip = {
				value = { 25 75 }
			}
			mil = {
				value = { 25 75 }
			}
			culture = culture:czech
			religion = religion:catholic
			min_age = 30
			estate = estate_type:clergy_estate
			create_in_limbo = yes
			save_scope_as = target_character_2
		}

		ruler = {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		has_ruler = yes
		ruler = {
			religion = religion:catholic
		}
		religion = religion:orthodox
	}

	option = { #Invite them
		name = flavor_vol.1.a
		historical_option = yes

		scope:target_character_1 = {
			move_country = root
		}
		scope:target_character_2 = {
			move_country = root
		}
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_penalty }
	}

	option = { #Reject them
		name = flavor_vol.1.b

		hidden_effect = {
			kill_character_silently = scope:target_character_1
			kill_character_silently = scope:target_character_2

		}
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }
	}
}

flavor_vol.2 = { #Growth of Sanok
	hide_portraits = yes
	type = country_event
	title = flavor_vol.2.title
	desc = flavor_vol.2.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		tag = KIE
		tag = UKR
		from = 1350.1.1
		to = 1450.1.1
		monthly_chance = 1
	}

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }

		ruler = {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		has_ruler = yes
		owns = location:sanok
	}

	option = {
		name = flavor_vol.2.a
		historical_option = yes

		change_gold_effect = { scale = -4 }
		location:sanok = {
			if = {
				limit = {
					location_rank = location_rank:rural_settlement
				}
				change_location_rank = location_rank:town
			}
			else = {
				change_development = development_mild_bonus
				change_prosperity = prosperity_severe_bonus
			}
		}
	}

	option = {
		name = flavor_vol.2.b

		add_legitimacy = legitimacy_mild_penalty
	}
}

flavor_vol.3 = { #Regional Capital of Lviv
	type = country_event
	title = flavor_vol.3.title
	desc = flavor_vol.3.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		tag = KIE
		tag = UKR
		from = 1360.1.1
		to = 1460.1.1
		monthly_chance = 1
	}

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }

		location:lviv = {
			save_scope_as = target_location
		}
	}

	trigger = {
		has_ruler = yes
		owns = location:lviv
		has_estate_privilege = estate_privilege:novi_fori
	}

	option = {
		name = flavor_vol.3.a

		trigger = {
			location:lviv = {
				is_capital = no
			}
		}

		change_gold_effect = { scale = -4 }
		location:lviv = {
			if = {
				limit = {
					location_rank = location_rank:rural_settlement
				}
				change_location_rank = location_rank:town
			}
			else = {
				change_development = development_mild_bonus
				change_prosperity = prosperity_severe_bonus
			}
		}
	}

	option = {
		name = flavor_vol.3.b

		add_legitimacy = legitimacy_mild_penalty
	}

	option = {
		name = flavor_vol.3.c

		trigger = {
			location:lviv = {
				is_capital = yes
			}
		}

		change_gold_effect = { scale = -4 }
		location:lviv = {
			if = {
				limit = {
					location_rank = location_rank:rural_settlement
				}
				change_location_rank = location_rank:town
			}
			else_if = {
				limit = {
					location_rank = location_rank:town
				}
				change_location_rank = location_rank:city
			}
			else = {
				change_development = development_severe_bonus
				change_prosperity = prosperity_severe_bonus
			}
		}
	}
}

flavor_vol.4 = { #Hypatian Codex
	hide_portraits = yes
	type = country_event
	title = flavor_vol.4.title
	desc = flavor_vol.4.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		from = 1580.1.1
		to = 1640.1.1
		monthly_chance = 1
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		ruler = {
			save_scope_as = target_ruler
		}
		create_character = {
			first_name = name_zechariah
			last_name = kopystensky
			religion = religion:orthodox
			estate = estate_type:clergy_estate
			birth_date = 1550.1.1
			female = no
			birth_location = location:przemysl
			adm = 62
			dip = 67
			mil = 45
			save_scope_as = target_character
			create_in_limbo = yes
		}
	}

	option = {
		name = flavor_vol.4.a

		capital = {
			create_art = {
				type = work_of_art_type:chronicle
				quality = 70
				key = hypatian_codex
			}
		}
		scope:target_character = { move_country = root }
	}

	option = {
		name = flavor_vol.4.b

		add_prestige = prestige_mild_bonus
		hidden_effect = {
			kill_character_silently = scope:target_character
		}
	}
}

flavor_vol.1000 = { #Designation of Casimir as heir
	type = country_event
	title = flavor_vol.1000.title
	desc = flavor_vol.1000.desc
	historical_info = flavor_vol.1000.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = HAL
		from = 1337.1.1
		to = 1340.1.1
		monthly_chance = 25
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		ruler = {
			save_scope_as = target_ruler
		}
		save_scope_as = target_country

		character:lit_liubartas_gediminds ?= {
			save_scope_as = lit_target_claimant
		}
	}

	trigger = {
		has_ruler = yes
		ruler = character:vol_boleslaw_jerzy_ii_piast
		has_heir = no
		country_exists = c:POL
		country_exists = c:LIT
		country_exists = c:VOL
	}

	option = { # Pick Casimir
		name = flavor_vol.1000.a
		historical_option = yes

		trigger = {
			character:pol_casimir_iii_piast = {
				is_alive = yes
			}
		}
		custom_tooltip = flavor_vol.1000.a.tt
		set_variable = vol_heir_casimir
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_radical_penalty }
	}

	option = { #Pick Liubartas Gediminid
		name = flavor_vol.1000.b

		trigger = {
			character:lit_liubartas_gediminds = {
				is_alive = yes
			}
		}
		custom_tooltip = flavor_vol.1000.b.tt
		set_variable = vol_heir_liubartas
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_radical_penalty }
	}

	option = { #Pick Dmytro Dedko
		name = flavor_vol.1000.c

		trigger = {
			character:vol_dmytro_dedko = {
				is_alive = yes
			}
		}
		custom_tooltip = flavor_vol.1000.c.tt
		set_variable = vol_heir_dedko
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }

		c:POL = {
			add_casus_belli = {
				type = casus_belli:cb_claim_throne
				target = c:HAL
				years = 20
			}
			trigger_event_non_silently = flavor_vol.1001
		}
		if = {
			limit = {
				scope:lit_target_claimant = {
					is_alive = yes
				}
			}
			c:LIT = {
				add_casus_belli = {
					type = casus_belli:cb_claim_throne
					target = c:VOL
					character = scope:lit_target_claimant
					years = 20
				}
				trigger_event_non_silently = flavor_vol.1001
			}
		}
	}

	option = { #We will wait for a child of Yuri II
		name = flavor_vol.1000.d

		set_variable = vol_waiting_for_heir
	}
}

flavor_vol.1001 = { #Poland Lithuania Information Event
	type = country_event
	title = flavor_vol.1001.title
	desc = flavor_vol.1001.desc

	fire_only_once = yes

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:vol_dmytro_dedko = {
			save_scope_as = target_heir
		}
		character:vol_boleslaw_jerzy_ii_piast = {
			save_scope_as = target_ruler
		}
		character:lit_liubartas_gediminds ?= {
			save_scope_as = lit_target_claimant
		}
		c:VOL = { save_scope_as = target_country }
		c:HAL = { save_scope_as = target_country_2 }
	}

	option = {
		name = flavor_vol.1001.a

		show_as_tooltip = {
			c:LIT = {
				add_casus_belli = {
					type = casus_belli:cb_claim_throne
					target = c:VOL
					character = scope:lit_target_claimant
					years = 20
				}
			}
			c:POL = {
				add_casus_belli = {
					type = casus_belli:cb_claim_throne
					target = c:HAL
					years = 20
				}
			}
		}
	}
}

flavor_vol.1002 = { #Demands of the Nobility - Religion of the Ruler
	type = country_event
	title = flavor_vol.1002.title
	desc = flavor_vol.1002.desc
	historical_info = flavor_vol.1002.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		from = 1338.1.1
		to = 1340.1.1
		monthly_chance = 20
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		ruler = {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		ruler = character:vol_boleslaw_jerzy_ii_piast
		character:vol_boleslaw_jerzy_ii_piast = {
			religion = religion:catholic
		}
		OR = {
			has_variable = vol_heir_casimir
			has_variable = vol_heir_liubartas
			has_variable = vol_waiting_for_heir
		}
	}

	option = {
		name = flavor_vol.1002.a
		historical_option = yes

		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_penalty }
	}

	option = {
		name = flavor_vol.1002.b

		scope:target_ruler = {
			change_character_religion = religion:orthodox
		}
		every_neighbor_country = {
			limit = {
				religion = religion:catholic
			}
			add_opinion = { target = root modifier = opinion_angry }
		}
	}
}

flavor_vol.1003 = { #Demands of the Nobility - Privileges
	type = country_event
	title = flavor_vol.1003.title
	desc = flavor_vol.1003.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		from = 1337.1.1
		to = 1342.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		ruler = {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		ruler ?= {
			religion = religion:catholic
		}
		OR = {
			has_variable = vol_heir_casimir
			has_variable = vol_heir_liubartas
			has_variable = vol_waiting_for_heir
		}
	}

	option = {
		name = flavor_vol.1003.a

		add_legitimacy = legitimacy_mild_bonus
		if = {
			limit = {
				num_possible_estate_privileges:nobles_estate > 0
			}
			add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }

			"estate(estate_type:nobles_estate)" = {
				random_possible_privilege = {
					root = { grant_estate_privilege = prev }
				}
			}
		}
		else = {
			add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_bonus }
		}
	}

	option = {
		name = flavor_vol.1003.b

		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_penalty }
	}
}

#The Succession Crisis of Galicia-Volhynia unfolds
flavor_vol.1100 = { #The Poisoning of Yuri II
	type = country_event
	title = flavor_vol.1100.title
	desc = flavor_vol.1100.desc

	historical_info = flavor_vol.1100.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = VOL
		tag = HAL
		from = 1340.1.1
		to = 1345.1.1
		monthly_chance = 20
	}

	trigger = {
		ruler = {
			this = character:vol_boleslaw_jerzy_ii_piast
		}
		OR = {
			has_variable = vol_heir_casimir
			has_variable = vol_heir_liubartas
			has_variable = vol_heir_dedko
			has_variable = vol_waiting_for_heir
		}
		estate_satisfaction:nobles_estate < 0.6
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:vol_boleslaw_jerzy_ii_piast = {
			save_scope_as = pol_the_dead_monarch
		}
		kill_character = character:vol_boleslaw_jerzy_ii_piast

	}

	option = { #Give the Throne to Casimir
		name = flavor_vol.1100.a
		historical_option = yes

		trigger = {
			has_variable = vol_heir_casimir
			character:pol_casimir_iii_piast = {
				is_alive = yes
			}
		}

		set_new_ruler = character:pol_casimir_iii_piast
		c:LIT ?= {
			trigger_event_non_silently = flavor_vol.1001
		}
		remove_variable = vol_heir_casimir
	}

	option = { #Give the Throne to Liubartas Gediminid
		name = flavor_vol.1100.b

		trigger = {
			has_variable = vol_heir_liubartas
			character:lit_liubartas_gediminds = {
				is_alive = yes
			}
			country_exists = c:LIT
		}

		set_new_ruler = character:lit_liubartas_gediminds
		make_subject_of = {
			target = c:LIT
			type = subject_type:vassal
		}
		c:POL ?= {
			trigger_event_non_silently = flavor_vol.1001
		}
		remove_variable = vol_heir_liubartas
	}

	option = { #Give the Throne to Dmytro Dedko
		name = flavor_vol.1100.c

		trigger = {
			has_variable = vol_heir_dedko
			character:vol_dmytro_dedko = {
				is_alive = yes
			}
		}

		set_new_ruler = character:vol_dmytro_dedko

		c:POL ?= {
			trigger_event_non_silently = flavor_vol.1001
		}
		c:LIT ?= {
				trigger_event_non_silently = flavor_vol.1001
		}
		remove_variable = vol_heir_dedko
	}

	option = { #Fallback when the set variable ruler is dead, or when there was no heir picked
		name = flavor_vol.1100.d

		trigger = {
			NOR = {
				AND = {
					has_variable = vol_heir_casimir
					character:pol_casimir_iii_piast = {
						is_alive = no
					}
				}
				AND = {
					has_variable = vol_heir_dedko
					character:vol_dmytro_dedko = {
						is_alive = no
					}
				}
				AND = {
					has_variable = vol_heir_liubartas
					character:lit_liubartas_gediminds = {
						is_alive = no
					}
				}
				has_variable = vol_waiting_for_heir
			}
		}

		add_stability = stability_mild_penalty

		c:POL ?= {
			trigger_event_non_silently = flavor_vol.1101
		}
		c:LIT ?= {
			trigger_event_non_silently = flavor_vol.1101
		}
		remove_variable = vol_waiting_for_heir
	}
}

flavor_vol.1101 = { #Poisoning of Yuri II Follow Up
	type = country_event
	title = flavor_vol.1101.title
	desc = flavor_vol.1101.desc

	historical_info = flavor_vol.1100.historical_info

	fire_only_once = yes

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:vol_boleslaw_jerzy_ii_piast = {
			save_scope_as = pol_the_dead_monarch
		}
	}

	option = {
		name = flavor_vol.1101.a
		historical_option = yes

		add_casus_belli = { target = c:VOL type = casus_belli:cb_claim_throne years = 20 }
		add_casus_belli = { target = c:HAL type = casus_belli:cb_claim_throne years = 20 }
	}

	option = {
		name = flavor_vol.1101.b

		add_estate_satisfaction = {
			type = estate_type:nobles_estate
			value = estate_satisfaction_mild_bonus
		}
	}
}

flavor_vol.1102 = { #The Poisoning of Yuri II - Fallback
	type = country_event
	title = flavor_vol.1100.title
	desc = flavor_vol.1100.desc

	historical_info = flavor_vol.1100.historical_info

	fire_only_once = yes

	trigger = {
		tag = HAL
		OR = {
			has_variable = vol_heir_casimir
			has_variable = vol_heir_liubartas
			has_variable = vol_heir_dedko
			has_variable = vol_waiting_for_heir
		}
		estate_satisfaction:nobles_estate < 0.6
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:vol_boleslaw_jerzy_ii_piast = {
			save_scope_as = pol_the_dead_monarch
		}
		kill_character = character:vol_boleslaw_jerzy_ii_piast
		c:VOL ?= { save_scope_as = target_country }
		c:HAL ?= { save_scope_as = target_country_2 }
	}

	option = { #Give the Throne to Casimir
		name = flavor_vol.1100.a
		historical_option = yes

		trigger = {
			has_variable = vol_heir_casimir
			character:pol_casimir_iii_piast = {
				is_alive = yes
			}
		}

		set_new_ruler = character:pol_casimir_iii_piast
		c:LIT ?= {
			trigger_event_non_silently = flavor_vol.1001
		}
		remove_variable = vol_heir_casimir
	}

	option = { #Give the Throne to Liubartas Gediminid
		name = flavor_vol.1100.b

		trigger = {
			has_variable = vol_heir_liubartas
			character:lit_liubartas_gediminds = {
				is_alive = yes
			}
			country_exists = c:LIT
		}

		set_new_ruler = character:lit_liubartas_gediminds
		make_subject_of = {
			target = c:LIT
			type = subject_type:vassal
		}
		c:POL ?= {
			trigger_event_non_silently = flavor_vol.1001
		}
		remove_variable = vol_heir_liubartas
	}

	option = { #Give the Throne to Dmytro Dedko
		name = flavor_vol.1100.c

		trigger = {
			has_variable = vol_heir_dedko
			character:vol_dmytro_dedko = {
				is_alive = yes
			}
		}

		set_new_ruler = character:vol_dmytro_dedko

		c:POL ?= {
			trigger_event_non_silently = flavor_vol.1001
		}
		c:LIT ?= {
				trigger_event_non_silently = flavor_vol.1001
		}
		remove_variable = vol_heir_dedko
	}

	option = { #Fallback when the set variable ruler is dead, or when there was no heir picked
		name = flavor_vol.1100.d

		trigger = {
			NOR = {
				AND = {
					has_variable = vol_heir_casimir
					character:pol_casimir_iii_piast = {
						is_alive = no
					}
				}
				AND = {
					has_variable = vol_heir_dedko
					character:vol_dmytro_dedko = {
						is_alive = no
					}
				}
				AND = {
					has_variable = vol_heir_liubartas
					character:lit_liubartas_gediminds = {
						is_alive = no
					}
				}
				has_variable = vol_waiting_for_heir
			}
		}

		add_stability = stability_mild_penalty

		c:POL ?= {
			trigger_event_non_silently = flavor_vol.1101
		}
		c:LIT ?= {
			trigger_event_non_silently = flavor_vol.1101
		}
		remove_variable = vol_waiting_for_heir
	}
}