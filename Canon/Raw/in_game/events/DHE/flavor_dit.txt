namespace = flavor_dit

#The Peasants Republic is established
flavor_dit.1 = {
	hide_portraits = yes
	type = country_event
	title = flavor_dit.1.title
	desc = flavor_dit.1.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = DIT
		from = 1350.1.1
		to = 1450.1.1
		monthly_chance = 1
	}

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:peasants background = pop_type:peasants }

		random_estate_privilege = {
			limit = {
				estate_type = estate_type:peasants_estate
			}
			save_scope_as = first_privilege
		}
		ruler = {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		has_ruler = yes
	}

	option = {
		name = flavor_dit.1.a
		
		historical_option = yes
		if = {
			limit = {
				any_current_reforms = { is_major_reform = yes }
				NOT = {
					has_reform = government_reform:peasant_republic_reform
				}
			}
			random_current_reforms = {
				limit = { is_major_reform = yes }
				root = { remove_reform = prev }
			}
		}
		if = {
			limit = {
				NOT = {
					has_reform = government_reform:peasant_republic_reform
				}
			}
			add_reform = government_reform:peasant_republic_reform
		}
		change_heir_selection = heir_selection:peasant_elective
		if = {
			limit = {
				is_subject = yes
			}
			overlord = {
				cancel_subject = root
			}
		}
	}

	option = {
		name = flavor_dit.1.b

		if = {
			limit = {
				exists = scope:first_privilege
			}
			revoke_estate_privilege = scope:first_privilege
		}
	}
}