namespace = flavor_eng_diplomacy

# Diplomatic proposal accepted - dynamic
flavor_eng_diplomacy.1 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = matter_of_matrimony_dowry_paid
					}
				}
				desc = flavor_eng_diplomacy.1.desc_matter_of_matrimony_dowry_paid
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = fields_of_the_cloth_of_gold_accepted
					}
				}
				desc = flavor_eng_diplomacy.1.desc_fields_of_the_cloth_of_gold_accepted
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = treaty_of_windsor
					}
				}
				desc = flavor_eng_diplomacy.1.desc_treaty_of_windsor
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = treaty_of_perpetual_peace_marriage
					}
				}
				desc = flavor_eng_diplomacy.1.desc_treaty_of_perpetual_peace_marriage
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = union_of_the_crowns
					}
				}
				desc = flavor_eng_diplomacy.1.desc_union_of_the_crowns
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = treaty_of_windsor_renegotiated
					}
				}
				desc = flavor_eng_diplomacy.1.desc_treaty_of_windsor_renegotiated
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = treaty_of_stjames
					}
				}
				desc = flavor_eng_diplomacy.1.desc_treaty_of_stjames
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_eng_diplomacy.1.desc_generic_treaty
			}
		}
	}

	immediate = {

		scope:sender = { capital = { save_scope_as = target_location } ruler = { save_scope_as = target_character } }

	}

	option = {
		name = flavor_eng_diplomacy.1.a
		trigger = {
			scope:sender = {
				has_variable = matter_of_matrimony_dowry_paid
			}
		}

		scope:sender = { remove_variable = matter_of_matrimony_dowry_paid }

		add_gold = { 
			value = scope:sender.monthly_income_trade_and_tax 
			multiply = 6 
		}

		add_opinion = { 
			target = scope:sender
			modifier = opinion_pleased
		} 

	}

	option = {
		name = flavor_eng_diplomacy.1.b
		trigger = {
			scope:sender = {
				has_variable = fields_of_the_cloth_of_gold_accepted
			}
		}

		scope:sender = { remove_variable = fields_of_the_cloth_of_gold_accepted }

		capital.market = {
			add_temporary_demand = { 
				type = demand:field_of_the_cloth_of_gold
				months = 12 
			} 
		}

	}

	option = {
		name = flavor_eng_diplomacy.1.c
		trigger = {
			scope:sender = {
				has_variable = treaty_of_windsor
			}
		}

		scope:sender = { remove_variable = treaty_of_windsor }

		add_government_power = government_power_extreme_bonus

	}

	option = {
		name = flavor_eng_diplomacy.1.d
		trigger = {
			scope:sender = {
				has_variable = treaty_of_perpetual_peace_marriage
			}
		}

		scope:sender = {
			remove_variable = treaty_of_perpetual_peace_marriage
			remove_variable = border_reivers_enabled
		}

		remove_variable = border_reivers_enabled

		custom_tooltip = flavor_eng_diplomacy.1.tt1

	}

	option = {
		name = flavor_eng_diplomacy.1.e
		trigger = {
			scope:sender = {
				has_variable = union_of_the_crowns
			}
		}

		scope:sender = { remove_variable = union_of_the_crowns }

		set_global_variable = union_of_the_crowns_possible

		custom_tooltip = flavor_eng_diplomacy.1.tt2

	}

	option = {
		name = flavor_eng_diplomacy.1.f
		trigger = {
			scope:sender = {
				has_variable = treaty_of_nonsuch
			}
		}

		scope:sender = { remove_variable = treaty_of_nonsuch }

		add_manpower = { value = root.monthly_manpower multiply = 6 }

		location:amsterdam.market = {
			ordered_location_in_market = {
				limit = {
					owner != root
					NOT = { location_rank = location_rank:rural_settlement }
				}
				order_by = population
				max = 5

				change_building_level_in_location = {
					building = building_type:trade_office
					value = 1
					owner = root
				}
			}
		}

	}

	option = {
		name = flavor_eng_diplomacy.1.g
		trigger = {
			scope:sender = {
				has_variable = treaty_of_windsor_renegotiated
			}
		}

		create_relation = {
			first = this
			second = scope:sender
			type = relation_type:alliance
		}
		
		add_government_power = government_power_severe_bonus

		add_opinion = {
			target = scope:sender
			modifier = eng_accepted_alliance_with_us
		}

		scope:sender = { remove_variable = treaty_of_windsor_renegotiated }

		custom_tooltip = flavor_eng_diplomacy.1.tt3
		custom_tooltip = flavor_eng_diplomacy.1.tt4

	}

	option = {
		name = flavor_eng_diplomacy.1.h
		trigger = {
			scope:sender = {
				has_variable = treaty_of_stjames
			}
		}

		scope:target_location.market = {
			ordered_location_in_market = {
				limit = {
					owner != root
					is_coastal = yes
					NOT = { location_rank = location_rank:rural_settlement }
				}
				order_by = population
				max = 1

				change_building_level_in_location = {
					building = building_type:trade_office
					value = 1
					owner = root
				}
			}
		}

		scope:sender = { remove_variable = treaty_of_stjames }

	}

	option = {
		name = flavor_eng_diplomacy.1.i
		trigger = {
			scope:sender = {
				has_variable = treaty_approved
			}
		}

		scope:sender = { remove_variable = treaty_approved }

		add_opinion = { 
			target = scope:sender
			modifier = opinion_pleased
		} 

	}

}

# Diplomatic proposal rejected - dynamic
flavor_eng_diplomacy.2 = {
	type = country_event

	title = flavor_eng_diplomacy.2.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = fields_of_the_cloth_of_gold_declined
					}
				}
				desc = flavor_eng_diplomacy.2.desc_fields_of_the_cloth_of_gold_declined
			}
			triggered_desc = {
				trigger = {
					scope:sender = {
						has_variable = treaty_of_newcastle_declined
					}
				}
				desc = flavor_eng_diplomacy.2.desc_treaty_of_newcastle_declined
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_eng_diplomacy.2.desc_generic_treaty
			}
		}
	}

	immediate = {

		scope:sender = {
			capital = { save_scope_as = target_location }
			if = {
				limit = { has_regent = no }
				ruler = { save_scope_as = target_character }
			}
			else = {
				regent = { save_scope_as = target_character }
			}
		}

	}

	option = {
		name = flavor_eng_diplomacy.2.a
		trigger = {
			scope:sender = {
				has_variable = fields_of_the_cloth_of_gold_declined
			}
		}

		scope:sender = { remove_variable = fields_of_the_cloth_of_gold_declined }

		add_opinion = { 
			target = scope:sender
			modifier = opinion_insulted 
		} 

		add_prestige = prestige_mild_penalty

	}

	option = {
		name = flavor_eng_diplomacy.2.b
		trigger = {
			scope:sender = {
				has_variable = union_of_the_crowns_declined
			}
		}

		scope:sender = { remove_variable = union_of_the_crowns_declined }

		add_opinion = { 
			target = scope:sender
			modifier = opinion_insulted 
		} 

		add_prestige = prestige_mild_penalty

	}

	option = {
		name = flavor_eng_diplomacy.2.c
		trigger = {
			scope:sender = {
				has_variable = treaty_of_newcastle_declined
			}
		}

		scope:sender = { remove_variable = treaty_of_newcastle_declined }

		add_opinion = { target = scope:sender modifier = opinion_angry }

		if = {
			limit = {
				scope:sender = {
					character:sco_edward_balliol ?= {
						scope:sender.ruler = this
					}
				}
			}
			add_casus_belli = {	target = scope:sender type = casus_belli:cb_conquer_province province = scope:lothian_cb_location.province }
			add_casus_belli = {	target = scope:sender type = casus_belli:cb_conquer_province province = scope:teviotdale_cb_location.province }
		}
	}

	option = {
		name = flavor_eng_diplomacy.2.d
		trigger = {
			scope:sender = {
				has_variable = treaty_declined
			}
		}

		scope:sender = { remove_variable = treaty_declined }

		add_opinion = { 
			target = scope:sender
			modifier = opinion_insulted 
		} 

		custom_tooltip = flavor_eng_diplomacy.2.tt

	}

}

# Catherine? of Aragon
flavor_eng_diplomacy.1000 = {
	type = country_event

	fire_only_once = yes	

	title = flavor_eng_diplomacy.1000.title
	desc = flavor_eng_diplomacy.1000.desc

	dynamic_historical_event = {
		tag = ENG
        tag = GBR
		from = 1498.1.1
		to = 1550.1.1
		monthly_chance = 5
	}
	
	trigger = {
		
		ruler ?= {
			any_child = {
			is_heir = yes
			age_in_years < 30
			is_female = no
			is_married = no
			}
		}
		
		has_trust = { modifier = trust_treaty_of_medina_del_campo target = c:CAS }
		has_trust = { modifier = trust_treaty_of_medina_del_campo target = c:ARA } 

		country_exists = c:ARA
		c:ARA = {
			 ruler = {
				OR  = {
					AND = {
						is_female = no
						any_child = {
							is_heir = no
							is_female = yes
							is_married = no
							age_in_years < 30
						}
					}
					dynasty = dynasty:trastamara_dynasty
				}
			}
			NOT = { is_at_war_with = root }
		}

	}
	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		c:ARA = { 
			ruler = {
				save_scope_as = aragon_ruler
			}
			if = {
				limit = {
					ruler = {
						dynasty = dynasty:trastamara_dynasty
					}
					current_year <= 1515
				}
				create_character = {	
					first_name = name_catherine
					adm = 70
					dip = 70
					mil = 5
					fertility = 10
					female = yes
					dynasty = dynasty:trastamara_dynasty
					father = scope:aragon_ruler
					religion = religion:catholic
					birth_date = 1485.1.1
					birth_location = location:madrid
					save_scope_as = suitable_daughter
					script = eng_catherine_of_aragon
				}
			}
			else = {
				ruler = {
					random_child = {
						limit = {
							is_heir = no
							is_female = yes
							is_married = no
							age_in_years < 30
						}
						save_scope_as = suitable_daughter
					}
				}
			}
		}

		ruler ?= {
			random_child = {
				limit = {
					is_heir = yes
					is_female = no
					is_married = no
				}
				save_scope_as = heir
			}
		}

		root = { save_scope_as = target_root_country }

	}

	option = {
		name = flavor_eng_diplomacy.1000.a
		
		scope:heir = {
			marry_character = scope:suitable_daughter
		}

		set_variable = { name = dowry_demanded value = 1 }

		c:ARA = { trigger_event_silently = { id = flavor_eng_diplomacy.1001 days = 0 } }
		
		custom_tooltip = flavor_eng_diplomacy.1000.tt1		

	}

	option = {
		name = flavor_eng_diplomacy.1000.b

		ruler ?= {
			add_trait = trait:kind_hearted
			scope:heir = {
				marry_character = scope:suitable_daughter
			}
		}

		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_move_to_right
		}

		set_variable = { name = dowry_foregone value = 1 }

		c:ARA = { trigger_event_silently = { id = flavor_eng_diplomacy.1001 days = 0 } }

		custom_tooltip = flavor_eng_diplomacy.1000.tt2

	}

	option = {
		name = flavor_eng_diplomacy.1000.c

		remove_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = c:CAS
		}

		remove_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = c:ARA
		}

		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_move_to_left
		}

		set_variable = { name = wedding_cancelled value = 1 }

		c:ARA = { trigger_event_silently = { id = flavor_eng_diplomacy.1001 days = 0 } }

		custom_tooltip = flavor_eng_diplomacy.1000.tt3

	}

	historical_info = flavor_eng_diplomacy.1000.historical_info

}

# The Matter of Matrimony
flavor_eng_diplomacy.1001 = {
	type = country_event

	title = flavor_eng_diplomacy.1001.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { OR = { root = c:ENG root = c:GBR } }
					scope:target_root_country = { has_variable = dowry_foregone }
				}
				desc = flavor_eng_diplomacy.1001.desc_dowry_foregone
			}
			triggered_desc = {
				trigger = {
					NOT = { OR = { root = c:ENG root = c:GBR } }
					scope:target_root_country = { has_variable = wedding_cancelled }
				}
				desc = flavor_eng_diplomacy.1001.desc_marriage_refused
			}
			triggered_desc = {
				trigger = {
					OR = { root = c:ENG root = c:GBR }
				}
				desc = flavor_eng_diplomacy.1001.desc_dowry_refused
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_eng_diplomacy.1001.desc
			}
		}
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		scope:target_root_country = { ruler ?= { save_scope_as = target_character } }

		capital = { save_scope_as = target_location }

		save_scope_as = sender

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1001.a
		trigger = {
			NOT = { OR = { root = c:ENG root = c:GBR } }
			scope:target_root_country = { has_variable = dowry_demanded }
		}

		remove_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = scope:target_root_country
		}

		c:CAS = {
			remove_trust = { 
				modifier = trust_treaty_of_medina_del_campo
				target = scope:target_root_country
			}
		}

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1001 days = 0 } }

		custom_tooltip = flavor_eng_diplomacy.1001.tt

	}

	option = {
		name = flavor_eng_diplomacy.1001.b
		trigger = {
			NOT = { OR = { root = c:ENG root = c:GBR } }
			scope:target_root_country = { has_variable = dowry_foregone }
		}

		add_favors = { target = scope:target_root_country value = 1 }

	}

	option = {
		name = flavor_eng_diplomacy.1001.c
		trigger = {
			NOT = { OR = { root = c:ENG root = c:GBR } }
			scope:target_root_country = { has_variable = wedding_cancelled }
		}

		every_country = {
			limit = {
				has_trust = { modifier = trust_treaty_of_medina_del_campo target = scope:target_root_country }
			}
			remove_trust = { 
				modifier = trust_treaty_of_medina_del_campo
				target = scope:target_root_country
			}
		}

		custom_tooltip = flavor_eng_diplomacy.1001.tt

	}

	option = {
		name = flavor_eng_diplomacy.1001.d
		trigger = {
			NOT = { OR = { root = c:ENG root = c:GBR } }
			scope:target_root_country = { has_variable = dowry_demanded }
		}

		add_gold = { 
			value = root.monthly_income_trade_and_tax 
			multiply = -6 
		}

		set_variable = { name = matter_of_matrimony_dowry_paid value = 1 }

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1001.e
		trigger = {	OR = { root = c:ENG root = c:GBR } }

		remove_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = c:ARA
		}

		remove_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = c:CAS
		}
		

		custom_tooltip = flavor_eng_diplomacy.1001.tt

	}

}

# Treaty of Medina de Campo
flavor_eng_diplomacy.1100 = {
	hide_portraits = yes
	type = country_event
	title = flavor_eng_diplomacy.1100.title
	desc = flavor_eng_diplomacy.1100.desc
	
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ENG
        tag = GBR
		from = 1485.1.1
		to = 1550.1.1
		monthly_chance = 5
	}
	
	trigger = {
		country_exists = c:ARA
		country_exists = c:CAS
		country_exists = c:FRA

		OR = {
			c:CAS = {
				in_union_with = c:ARA
				is_enemy_of = root
			}
			c:ARA = {
				in_union_with = c:CAS
				is_enemy_of = root
			}
		}

		OR = {
			c:CAS = { is_enemy_of = c:FRA }
			c:ARA = { is_enemy_of = c:FRA }
		}

		at_war = no

	}
	illustration_tags = {
		10 = happy
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		if = {
			limit = {
				c:CAS = {
					is_subject_of = c:ARA
				}
			}
			c:CAS = { save_scope_as = overlord }
			c:ARA = { save_scope_as = lesser_partner }
		}

		if = {
			limit = {
				c:ARA = {
					is_subject_of = c:CAS
				}
			}
			c:ARA = { save_scope_as = overlord }
			c:CAS = { save_scope_as = lesser_partner }
		}

		capital = { save_scope_as = target_location }

		overlord.ruler = { save_scope_as = target_character }

		root = { save_scope_as = target_root_country }

	}

	option = {
		name = flavor_eng_diplomacy.1100.a
		historical_option = yes

		add_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = scope:overlord 
		}

		add_trust = { 
			modifier = trust_treaty_of_medina_del_campo
			target = scope:lesser_partner 
		}

		hidden_effect = { 
			scope:overlord = { trigger_event_silently = flavor_eng_diplomacy.1101 } 
		}

		custom_tooltip = flavor_eng_diplomacy.1100.tt1
		custom_tooltip = flavor_eng_diplomacy.1100.tt2

		c:FRA = {
			add_opinion = {
				target = root
				modifier = signed_medina_del_campo_treaty
			}
		}

		custom_tooltip = flavor_eng_diplomacy.1100.tt3
		custom_tooltip = flavor_eng_diplomacy.1100.tt4
	
	}

	option = {
		name = flavor_eng_diplomacy.1100.b

		c:FRA = {
			add_opinion = {
				target = root
				modifier = declined_advantageous_treaty
			}
		}

		custom_tooltip = flavor_eng_diplomacy.1100.tt5
	
	}

	historical_info = flavor_eng_diplomacy.1100.historical_info

}

# Treaty of Medina Del Campo 
flavor_eng_diplomacy.1101 = {
	hide_portraits = yes
	type = country_event
	title = flavor_eng_diplomacy.1101.title
	desc = flavor_eng_diplomacy.1101.desc
	illustration_tags = {
		10 = happy
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		scope:target_root_country = { ruler = { save_scope_as = target_character } }

		capital = { save_scope_as = target_location }

		scope:overlord = { save_scope_as = sender }

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1101.a

		set_variable = { name = treaty_approved value = 1 }

		add_trust = {
			modifier = trust_treaty_of_medina_del_campo
			target = scope:target_root_country
		}

		scope:lesser_partner = {
			add_trust = {
				modifier = trust_treaty_of_medina_del_campo
				target = scope:target_root_country
			}
		}

		if = {
			limit = {
				country_exists = c:FRA
			}
			c:FRA = {
				add_opinion = {
					target = scope:overlord
					modifier = signed_medina_del_campo_treaty
				}

				add_opinion = {
					target = scope:lesser_partner
					modifier = signed_medina_del_campo_treaty
				}
			}	
		}
		
		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1101.b

		set_variable = { name = treaty_declined value = 1 }

		scope:target_root_country = {
			remove_trust = { 
				modifier = trust_treaty_of_medina_del_campo
				target = scope:overlord 
			}
			remove_trust = { 
				modifier = trust_treaty_of_medina_del_campo
				target = scope:lesser_partner 
			}
		}

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.2 days = 0 } }

		custom_tooltip = flavor_eng_diplomacy.1101.tt1

		if = {
			limit = {
				country_exists = c:FRA
			}
			c:FRA = {
				add_opinion = {
					target = root
					modifier = declined_advantageous_treaty
				}
			}

			custom_tooltip = flavor_eng_diplomacy.1101.tt2
			
		}

	}
}

# Treaty of Windsor
flavor_eng_diplomacy.1200 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1200.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					ruler = { 
						is_female = no 
						age_in_years > 30
						any_child = {
							is_female = no
							is_alive = yes
							count < 1
						}
					}
				}
				desc = flavor_eng_diplomacy.1200.desc_no_male_heir
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_eng_diplomacy.1200.desc
			}
		}
	}

	fire_only_once = yes
	dynamic_historical_event = {
		tag = POR
		from = 1386.1.1
		to = 1500.1.1
		monthly_chance = 5
	}
	
	trigger = {

		OR = {
			ruler ?= { 
				is_female = no 
				age_in_years > 30
				any_child = {
					is_female = no
					is_alive = yes
					count < 1
				}
			}
			government_power < 50
		}

		OR = {
			AND = {
				country_exists = c:ENG
				c:ENG = {
					is_subject = no
					NOT = { is_at_war_with = root }
				}
			}
			AND = {
				country_exists = c:GBR
				c:GBR = {
					is_subject = no
					NOT = { is_at_war_with = root }
				}
			}
		}

		country_exists = c:CAS
		c:CAS = {
			is_subject = no
			is_neighbor_of = root
			NOT = { is_allied_with = { target = root } }
		}
		
		OR = {
			trigger_if = {
				limit = { country_exists = c:ENG }
				opinion = {
					target = c:ENG
					value >= 100 
				}
				has_trust = { modifier = trust_treaty_of_tagilde target = c:ENG }
			}
			trigger_if = {
				limit = { country_exists = c:GBR }
				opinion = {
					target = c:GBR
					value >= 100 
				}
				has_trust = { modifier = trust_treaty_of_tagilde target = c:GBR }
			}
		}

	}

	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		capital = { save_scope_as = target_location }

		ruler = { save_scope_as = target_character }

		if = {
			limit = {
				country_exists = c:ENG
			}
			c:ENG = { save_scope_as = target_root_country }
		}
		else = {
			c:GBR = { save_scope_as = target_root_country }
		}

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1200.a

		add_trust = {
			modifier = trust_treaty_of_windsor
			target = scope:target_root_country
		}

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1201 days = 0 } }
		
		
		custom_tooltip = flavor_eng_diplomacy.1200.tt

	}

	option = {
		name = flavor_eng_diplomacy.1200.b

		add_prestige = prestige_mild_bonus

	}
	
	historical_info = flavor_eng_diplomacy.1201.historical_info

}

# Treaty of Windsor
flavor_eng_diplomacy.1201 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1201.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					c:POR = {
						ruler = { 
							is_female = no 
							age_in_years > 30
							any_child = {
								is_female = no
								is_alive = yes
								count < 1
							}
						}
					}
				}
				desc = flavor_eng_diplomacy.1201.desc_no_male_heir
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_eng_diplomacy.1201.desc_low_legitimacy
			}
		}
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		c:POR.capital = { save_scope_as = target_location }

		c:POR.ruler = { save_scope_as = target_character }

		save_scope_as = sender

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1201.a

		set_variable = { name = treaty_of_windsor value = 1 }

		add_trust = {
			modifier = trust_treaty_of_windsor
			target = c:POR
		}

		c:POR = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1201.b

		set_variable = { name = treaty_declined value = 1 }

		c:POR = {
			remove_trust = { 
				modifier = trust_treaty_of_windsor
				target = c:ENG
			}
		}

		c:POR = { trigger_event_silently = { id = flavor_eng_diplomacy.2 days = 0 } }

	}

	historical_info = flavor_eng_diplomacy.1201.historical_info

}

# The Enduring Friendship
flavor_eng_diplomacy.1300 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1300.title
	desc = flavor_eng_diplomacy.1300.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = POR
		from = 1658.1.1
		to = 1700.1.1
		monthly_chance = 5
	}
	
	trigger = {

		owns = location:tangier

		government_type = government_type:monarchy
		has_regent = no
		is_subject = no
		at_war = no

		ruler = {
			OR  = {
				AND = {
					any_child = {
						is_heir = no
						is_female = yes
						is_married = no
						age_in_years > 13
						age_in_years < 30
					}
				}
				dynasty = dynasty:braganca_dynasty
			}
		}
		
		OR = {
			AND = {
				country_exists = c:ENG
				c:ENG = {
					ruler = { is_married = no }
					government_type = government_type:monarchy
					has_regent = no
					has_trust = { modifier = trust_treaty_of_windsor target = c:POR }
					is_subject = no
					NOT = { is_allied_with = { target = root } }
				}
			}
			AND = {
				country_exists = c:GBR
				c:GBR = {
					ruler = { is_married = no }
					government_type = government_type:monarchy
					has_regent = no
					has_trust = { modifier = trust_treaty_of_windsor target = c:POR }
					is_subject = no
					NOT = { is_allied_with = { target = root } }
				}
			}
		}

	}

	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		if = {
			limit = {
				country_exists = c:ENG
			}
			c:ENG = { save_scope_as = target_root_country }
		}
		else = {
			c:GBR = { save_scope_as = target_root_country }
		}

		region:western_india_region = {
			random_location_in_region ?= {
				limit = {
					is_discovered_by = scope:target_root_country
					is_coastal = yes
					owner = root
				}
			}
			save_scope_as = overseas_location
		}

		scope:target_root_country.ruler = { save_scope_as = target_character }

		location:tangier = { save_scope_as = ceded_location }

	}

	option = {
		name = flavor_eng_diplomacy.1300.a

		custom_tooltip = {
			text = flavor_eng_diplomacy.1300.a.custom
			area:north_portugal_area = {
				every_location_in_area = {
					limit = {
						owner ?= root
					}
					every_pop = {
						limit = {
							owner = root
							OR = {
								pop_type = pop_type:peasants
								pop_type = pop_type:nobles
							}
							
						}
						add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					}
				}
			}
			
			area:south_portugal_area = {
				every_location_in_area = {
					limit = {
						owner ?= root
					}
					every_pop = {
						limit = {
							owner = root
							OR = {
								pop_type = pop_type:peasants
								pop_type = pop_type:nobles
							}
							
						}
						add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					}
				}
			}
		}

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1301 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1300.b
		trigger = {
			region:western_india_region = {
				any_location_in_region = {
					is_discovered_by = scope:target_root_country
					is_coastal = yes
					owner = root
				}
			}
		}

		scope:overseas_location = { save_scope_as = ceded_location }

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1301 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1300.c

		add_prestige = prestige_mild_bonus

	}
	
	historical_info = flavor_eng_diplomacy.1301.historical_info

}

# The Auld Alliance Revived
flavor_eng_diplomacy.1301 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1301.title
	desc = flavor_eng_diplomacy.1301.desc
	illustration_tags = {
		10 = happy
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		c:POR = { 
			ruler = {
				save_scope_as = portugal_ruler
			}
			if = {
				limit = {
					ruler = {
						dynasty = dynasty:braganca_dynasty
					}
					current_year <= 1668
				}
				create_character = {	
					first_name = name_catherine
					adm = 75
					dip = 36
					mil = 12
					female = yes
					dynasty = dynasty:braganca_dynasty
					father = scope:portugal_ruler
					religion = c:POR.religion
					birth_date = 1638.1.1
					birth_location = location:lisbon
					save_scope_as = suitable_daughter
					script = eng_catherine_of_braganza
				}
			}
			else = {
				ruler = {
					random_child = {
						limit = {
							is_heir = no
							is_female = yes
							is_married = no
							age_in_years > 13
							age_in_years < 30
						}
						save_scope_as = suitable_daughter
					}
				}
			}
		}

		c:POR.ruler = { save_scope_as = target_character }

		save_scope_as = sender

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1301.a

		ruler ?= { marry_character = scope:suitable_daughter }

		scope:ceded_location = { change_location_owner = root }

		add_opinion = {
			target = c:POR
			modifier = eng_accepted_alliance_with_us
		}

		set_variable = { name = treaty_of_windsor_renegotiated value = 1 }

		c:POR = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1301.b

		set_variable = { name = treaty_declined value = 1 }

		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_severe_penalty }

		c:POR = { trigger_event_silently = { id = flavor_eng_diplomacy.2 days = 0 } }

	}

	historical_info = flavor_eng_diplomacy.1301.historical_info

}

# Treaty of Nonsuch
flavor_eng_diplomacy.1400 = {
	hide_portraits = yes
	type = country_event

	fire_only_once = yes

	title = flavor_eng_diplomacy.1400.title
	desc = flavor_eng_diplomacy.1400.desc

	dynamic_historical_event = {
		tag = ENG
		tag = GBR
		from = 1580.1.1
		to = 1700.1.1
		monthly_chance = 5
	}

	trigger = {

		manpower >= 5

		country_exists = c:NED
		c:NED = {
			capital = { is_market_center = yes }
			own_entire_area = area:holland_area
			is_great_power = no
		}

		any_country = {
			is_great_power = yes
			is_neighbor_of = c:NED
			is_enemy_of = c:NED
		}

		at_war = no

	}
	illustration_tags = {
		10 = happy
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		c:NED.capital = { save_scope_as = target_location }

		c:NED.ruler = { save_scope_as = target_character }
		
		root = { save_scope_as = target_root_country }

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1400.a

		add_trust = { 
			modifier = trust_treaty_of_nonsuch  
			target = c:NED
		}

		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_severe_bonus }

		hidden_effect = { 
			c:NED = { trigger_event_silently = { id = flavor_eng_diplomacy.1401 days = 0 } }
		}

		custom_tooltip = flavor_eng_diplomacy.1400.tt1
		custom_tooltip = flavor_eng_diplomacy.1400.tt2
		custom_tooltip = flavor_eng_diplomacy.1400.tt3

	}

	option = {
		name = flavor_eng_diplomacy.1400.b

		capital = {
			add_location_modifier = { 
				modifier = favoring_own_interests
				years = 5
				mode = add_and_extend
			}
		}

		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_severe_penalty }

		custom_tooltip = flavor_eng_diplomacy.1400.tt4

	}

}

# Treaty of Nonsuch
flavor_eng_diplomacy.1401 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1401.title
	desc = flavor_eng_diplomacy.1401.desc
	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		scope:target_root_country.capital = { save_scope_as = target_location }

		scope:target_root_country.ruler = { save_scope_as = target_character }

		save_scope_as = sender

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1401.a

		set_variable = { name = treaty_of_nonsuch value = 1 }

		add_manpower = { value = root.monthly_manpower multiply = 6 }

		add_trust = {
			modifier = trust_treaty_of_nonsuch
			target = scope:target_root_country
		}

		custom_tooltip = flavor_eng_diplomacy.1401.tt1

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1401.b

		set_variable = { name = treaty_declined value = 1 }

		scope:target_root_country = {
			remove_trust = { 
				modifier = trust_treaty_of_nonsuch 
				target = c:NED 
			}
		}

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.2 days = 0 } }

	}

}

# Treaty of Tagilde
flavor_eng_diplomacy.1500 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1500.title
	desc = flavor_eng_diplomacy.1500.desc
	
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ENG
        tag = GBR
		from = 1337.1.1
		to = 1500.1.1
		monthly_chance = 5
	}

	trigger = {
		NOT = { is_at_war_with = c:CAS }
		c:POR ?= {
			is_neighbor_of = c:CAS
			OR = {
				is_at_war_with = c:CAS
				has_truce_with = c:CAS
			}
			NOT = { is_allied_with = { target = root } }
			opinion = {
				target = root
				value >= 50 
			}
		}
		root = {
			opinion = {
				target = c:POR
				value >= 50 
			}
		}
	}
	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		capital = { save_scope_as = target_location }

		ruler = { save_scope_as = target_character }

		root = { save_scope_as = target_root_country }

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1500.a

		add_trust = { 
			modifier = trust_treaty_of_tagilde  
			target = c:POR
		}

		c:CAS = {	
			add_opinion = { 
				target = root 
				modifier = signed_tagilde_treaty 
			} 
		}

		hidden_effect = { 
			c:POR = { trigger_event_silently = { id = flavor_eng_diplomacy.1501 days = 0 } }
		}

		custom_tooltip = flavor_eng_diplomacy.1500.tt

	}

	option = {
		name = flavor_eng_diplomacy.1500.b

		c:CAS = { 
			add_opinion = { 
				target = root 
				modifier = declined_advantageous_treaty
			} 
		}

	}

	historical_info = flavor_eng_diplomacy.1500.historical_info

}

# Treaty of Tagilde
flavor_eng_diplomacy.1501 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1501.title
	desc = flavor_eng_diplomacy.1501.desc

	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		scope:target_root_country.capital = { save_scope_as = target_location }

		scope:target_root_country.ruler = { save_scope_as = target_character }

		save_scope_as = sender

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1501.a

		set_variable = { name = treaty_approved value = 1 }

		add_trust = {
			modifier = trust_treaty_of_tagilde
			target = scope:target_root_country
		}

		c:CAS = { add_opinion = { target = root modifier = signed_tagilde_treaty } }

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }

	}

	option = {
		name = flavor_eng_diplomacy.1501.b

		set_variable = { name = treaty_declined value = 1 }

		scope:target_root_country = {
			remove_trust = { 
				modifier = trust_treaty_of_tagilde 
				target = c:POR 
			}
		}

		c:CAS = {
			add_opinion = {
				target = root
				modifier = declined_advantageous_treaty
			}
		}

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.2 days = 0 } }

	}

}

# The Adventures of Robert Shirley
flavor_eng_diplomacy.1600 = {
	type = country_event

	fire_only_once = yes	

	title = flavor_eng_diplomacy.1600.title
	desc = flavor_eng_diplomacy.1600.desc

	dynamic_historical_event = {
		tag = ENG
		tag = GBR
		from = 1605.1.1
		to = 1625.1.1
		monthly_chance = 5
	}
	
	trigger = {

		country_exists = c:IRA
		c:IRA = {
			 is_neighbor_of = c:TUR
			 NOT = { is_allied_with = { target = c:TUR } }
		}

		region:persia_region = {
			any_location_in_region = {
				is_coastal = yes
				owner = c:IRA
			}
		}

		c:TUR = { is_great_power = yes }

		religion.group = religion_group:christian

	}
	illustration_tags = {
		10 = regular
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_robert
			last_name = Shirley
			estate = estate_type:nobles_estate
			adm = 45
			dip = 90
			mil = 90
			birth_date = 1581.1.1
			religion = root.religion
			birth_location = location:shoreham
			script = eng_robert_shirley
			save_scope_as = robert_shirley
		}

		c:IRA.capital = { save_scope_as = target_location }

		root = { save_scope_as = target_root_country }

	}

	option = {
		name = flavor_eng_diplomacy.1600.a
		historical_option = yes

		add_trust = {
			modifier = trust_treaty_of_stjames
			target = c:IRA
		}

		c:IRA = { trigger_event_silently = { id = flavor_eng_diplomacy.1601 } }

		custom_tooltip = flavor_eng_diplomacy.1600.tt1
		custom_tooltip = flavor_eng_diplomacy.1600.tt2
		
	}

	option = {
		name = flavor_eng_diplomacy.1600.b

		change_societal_value = {
			type = outward_vs_inward
			value = societal_value_move_to_right
		}

		custom_tooltip = flavor_eng_diplomacy.1600.tt3

	}
	
	historical_info = flavor_eng_diplomacy.1600.historical_info

}

# The Reforms of Rouzbeh-e Shirazi
flavor_eng_diplomacy.1601 = {
	hide_portraits = yes
	type = country_event

	title = flavor_eng_diplomacy.1601.title
	desc = flavor_eng_diplomacy.1601.desc
	illustration_tags = {
		10 = angry
		10 = interior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		capital = { save_scope_as = target_location }

		region:persia_region = {
			random_location_in_region = {
				limit = {
					is_coastal = yes
					owner = c:IRA
				}
				save_scope_as = target_location
			}
		}

		scope:robert_shirley = { save_scope_as = target_character }

		save_scope_as = sender

	}

	option = {
		historical_option = yes
		name = flavor_eng_diplomacy.1601.a

		set_variable = { name = treaty_of_stjames value = 1 }

		scope:robert_shirley = {
			move_country = c:IRA
			add_character_modifier = {
				modifier = modernizer
				months = -1
				mode = add_and_extend
			}
		}

		custom_tooltip = {
			text = enable_european_militia_reform
			set_variable = { name = european_militia value = 1 }
		}

		add_trust = {
			modifier = trust_treaty_of_stjames
			target = scope:target_root_country
		}

		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_penalty }

		scope:target_root_country = { trigger_event_silently = { id = flavor_eng_diplomacy.1 days = 0 } }
		
		custom_tooltip = flavor_eng_diplomacy.1601.tt1
		custom_tooltip = flavor_eng_diplomacy.1601.tt2
		custom_tooltip = flavor_eng_diplomacy.1601.tt3

	}

	option = {
		name = flavor_eng_diplomacy.1601.b

		set_variable = { name = treaty_declined value = 1 }

		scope:target_root_country = {
			remove_trust = { 
				modifier = trust_treaty_of_stjames 
				target = c:IRA 
			}
			trigger_event_silently = { id = flavor_eng_diplomacy.2 days = 0 }
		}

	}

	historical_info = flavor_eng_diplomacy.1600.historical_info

}