namespace = flavor_hab_tir

flavor_hab_tir.1 = { #Tirols Troubled Marriage
	type = country_event
	title = flavor_hab_tir.1.title
	desc = flavor_hab_tir.1.desc
	#historical_info = flavor_hab_tir.1.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIR
		from = 1337.1.1
		to = 1344.1.1
		monthly_chance = 5
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:tir_margarete_von_tirol = {
			save_scope_as = target_ruler
		}
		character:tir_jan_jindrich_luxembourg = {
			save_scope_as = target_spouse
		}
	}

	trigger = {
		character:tir_margarete_von_tirol = {
			is_ruler = yes
			is_married = yes
			first_spouse = character:tir_jan_jindrich_luxembourg
		}
	}

	option = {
		name = flavor_hab_tir.1.a
		historical_option = yes

		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }
		add_stability = stability_mild_bonus
	}

	option = {
		name = flavor_hab_tir.1.b

		scope:target_spouse = {
			hidden_effect = {
				add_fertility = 15
			}
		}
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_extreme_penalty }
		add_stability = stability_severe_penalty
		# set_variable = margarete_luxembourg_husband
	}
}

flavor_hab_tir.2 = { #A new husband for Margarete
	type = country_event
	title = flavor_hab_tir.2.title
	desc = flavor_hab_tir.2.desc
	#historical_info = flavor_hab_tir.2.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIR
		from = 1340.1.1
		to = 1360.1.1
		monthly_chance = 100
	}

	illustration_tags = {
		10 = happy
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:tir_margarete_von_tirol = {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		character:tir_margarete_von_tirol = {
			is_ruler = yes
			is_married = no
		}
	}

	option = {
		name = flavor_hab_tir.2.a
		custom_tooltip = flavor_hab_tir.2.a.tt
		historical_option = yes

		character:tir_margarete_von_tirol = {
			set_variable = search_for_margaretes_husband
			add_character_modifier = {
				modifier = block_marriage
				years = 40
				mode = add_and_extend
			}
		}
	}

	option = {
		name = flavor_hab_tir.2.b
	}
}

flavor_hab_tir.3 = { #A new husband for Margarete
	hide_portraits = yes
	type = country_event
	title = flavor_hab_tir.3.title
	desc = flavor_hab_tir.3.desc

	illustration_tags = {
		10 = happy
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:tir_margarete_von_tirol = {
			save_scope_as = target_ruler
		}
		dynasty:wittelsbach_dynasty = {
			random_character_in_dynasty = {
				limit = {
					is_female = no
					is_adult = yes
					is_married = no
				}
				save_scope_as = wittelsbach_husband
			}
		}
		dynasty:habsburg_dynasty = {
			random_character_in_dynasty = {
				limit = {
					is_female = no
					is_adult = yes
					is_married = no
				}
				save_scope_as = habsburg_husband
			}
		}
	}

	trigger = {
		tag = TIR
		character:tir_margarete_von_tirol = {
			is_ruler = yes
			is_married = no
		}
		OR = {
			dynasty:wittelsbach_dynasty = {
				any_character_in_dynasty = {
					is_female = no
					is_adult = yes
					is_married = no
				}
			}
			dynasty:habsburg_dynasty = {
				any_character_in_dynasty = {
					is_female = no
					is_adult = yes
					is_married = no
				}
			}
		}
	}

	option = {
		name = flavor_hab_tir.3.a
		historical_option = yes

		trigger = {
			dynasty:wittelsbach_dynasty = {
				any_character_in_dynasty = {
					is_female = no
					is_adult = yes
					is_married = no
				}
			}
		}
		remove_variable = search_for_margaretes_husband
		scope:target_ruler = {
			remove_character_modifier = block_marriage
			marry_character = scope:wittelsbach_husband
		}
	}

	option = {
		name = flavor_hab_tir.3.b

		trigger = {
			dynasty:habsburg_dynasty = {
				any_character_in_dynasty = {
					is_female = no
					is_adult = yes
					is_married = no
				}
			}
		}
		remove_variable = search_for_margaretes_husband
		scope:target_ruler = {
			remove_character_modifier = block_marriage
			marry_character = scope:habsburg_husband
		}
	}
}

flavor_hab_tir.4 = { #The new dynasty takes charge of Tirol
	type = country_event
	title = flavor_hab_tir.4.title
	desc = flavor_hab_tir.4.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIR
		from = 1350.1.1
		to = 1390.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		ruler ?= {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		has_ruler = yes
		ruler = {
			OR = {
				dynasty = dynasty:wittelsbach_dynasty
				dynasty = dynasty:habsburg_dynasty
				dynasty = dynasty:luxembourg_dynasty
			}
		}
		OR = {
			c:UBV ?= { ruler.dynasty = root.ruler.dynasty }
			c:BAV ?= { ruler.dynasty = root.ruler.dynasty }
			c:HAB ?= { ruler.dynasty = root.ruler.dynasty }
			c:BOH ?= { ruler.dynasty = root.ruler.dynasty }
		}
	}

	option = { #Wittelsbacher reign in Tirol!
		name = flavor_hab_tir.4.a

		trigger = {
			ruler = {
				dynasty = dynasty:wittelsbach_dynasty
			}
		}

		if = {
			limit = {
				c:BAV ?= { ruler.dynasty = root.ruler.dynasty }
			}
			remove_rival = c:BAV
			create_alliance = { target = c:BAV }
			add_opinion = { target = c:BAV modifier = opinion_dynastic_allies }
		}
		else_if = {
			limit = {
				c:UBV ?= { ruler.dynasty = root.ruler.dynasty }
			}
			remove_rival = c:UBV
			create_alliance = { target = c:UBV }
			add_opinion = { target = c:UBV modifier = opinion_dynastic_allies }
		}
	}

	option = { #Habsburgs reign in Tirol!
		name = flavor_hab_tir.4.b

		trigger = {
			ruler = {
				dynasty = dynasty:habsburg_dynasty
			}
		}
		remove_rival = c:HAB
		create_alliance = { target = c:HAB }
		add_opinion = { target = c:HAB modifier = opinion_dynastic_allies }
	}

	option = { #Luxembourgs reign in Tirol!
		name = flavor_hab_tir.4.c

		trigger = {
			ruler = {
				dynasty = dynasty:luxembourg_dynasty
			}
		}
		remove_rival = c:BOH
		create_alliance = { target = c:BOH }
		add_opinion = { target = c:BOH modifier = opinion_dynastic_allies }
	}
}

flavor_hab_tir.5 = { #Wittelsbacher contest Tirol!
	type = country_event
	title = flavor_hab_tir.5.title
	desc = flavor_hab_tir.5.desc
	#historical_info = flavor_hab_tir.5.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = UBV
		tag = BAV
		from = 1350.1.1
		to = 1390.1.1
		monthly_chance = 20
	}

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		c:TIR = {
			ruler = {
				save_scope_as = target_ruler
			}
		}
	}

	trigger = {
		country_exists = c:TIR
		c:TIR = {
			has_ruler = yes
			ruler = {
				dynasty = dynasty:habsburg_dynasty
			}
		}
		has_ruler = yes
		ruler = {
			dynasty = dynasty:wittelsbach_dynasty
		}
	}

	option = { 
		name = flavor_hab_tir.5.a

		change_societal_value = { type = belligerent_vs_conciliatory value = societal_value_move_to_left }
		add_casus_belli = { 
			target = c:TIR 
			type = casus_belli:cb_claim_throne 
		}
	}

	option = { 
		name = flavor_hab_tir.5.b

		change_societal_value = { type = belligerent_vs_conciliatory value = societal_value_move_to_right }
	}
}

flavor_hab_tir.1000 = { #Tirols Troubled Marriage
	type = country_event
	title = flavor_hab_tir.1000.title
	desc = flavor_hab_tir.1000.desc
	#historical_info = flavor_hab_tir.1000.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIR
		from = 1340.1.1
		to = 1350.1.1
		monthly_chance = 4
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:tir_margarete_von_tirol = {
			save_scope_as = target_ruler
		}
		character:tir_jan_jindrich_luxembourg = {
			save_scope_as = target_spouse
		}
		international_organization:hre.leader_country = {
			save_scope_as = target_emperor_country
		}
	}

	trigger = {
		character:tir_margarete_von_tirol = {
			is_ruler = yes
			first_spouse = character:tir_jan_jindrich_luxembourg
		}
		character:tir_jan_jindrich_luxembourg = {
			is_alive = yes
		}
		c:UBV = {
			is_leader_of_international_organization = international_organization:hre
		}
	}

	option = {
		name = flavor_hab_tir.1000.a
		historical_option = yes

		scope:target_ruler = {
			divorce_character = scope:target_spouse
			add_character_modifier = {
				modifier = block_marriage
				months = 6
				mode = add_and_extend
			}
		}
		scope:target_spouse = {
			move_country = c:BOH
			hidden_effect = {
				add_fertility = 45
			}
		}
		scope:target_emperor_country = {
			add_opinion = { target = root modifier = opinion_dynastic_helper }
		}
		add_opinion = { target = scope:target_emperor_country modifier = opinion_dynastic_helper }

		c:BOH = {
			add_opinion = { target = root modifier = opinion_insulted }
			trigger_event_non_silently = flavor_hab_tir.1001
		}
	}

	option = {
		name = flavor_hab_tir.1000.b

		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_penalty }
	}
}

flavor_hab_tir.1001 = { #Tirols Troubled Marriage
	type = country_event
	title = flavor_hab_tir.1001.title
	desc = flavor_hab_tir.1001.desc
	#historical_info = flavor_hab_tir.1001.historical_info

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_hab_tir.1001.a
		
		add_prestige = prestige_mild_penalty
	}
}

flavor_hab_tir.1100 = { #Tirol has no Habsburg Heir
	hide_portraits = yes
	type = country_event
	title = flavor_hab_tir.1100.title
	desc = flavor_hab_tir.1100.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = HAB
		from = 1355.1.1
		to = 1370.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = happy
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		character:tir_margarete_von_tirol = {
			save_scope_as = target_ruler
		}
		ruler = {
			save_scope_as = target_habsburg_ruler
		}
	}

	trigger = {
		has_ruler = yes
		ruler = {
			dynasty = dynasty:habsburg_dynasty
		}
		c:TIR = {
			character:tir_margarete_von_tirol = {
				is_ruler = yes
			}
			has_heir = no
		}
	}

	option = {
		name = flavor_hab_tir.1100.a
		historical_option = yes

		add_prestige = prestige_mild_bonus
		c:TIR = {
			trigger_event_non_silently = { id = flavor_hab_tir.1101 }
		}
	}

	option = {
		name = flavor_hab_tir.1100.b

		change_societal_value = { type = belligerent_vs_conciliatory value = societal_value_move_to_right }
	}
}

flavor_hab_tir.1101 = { #Tirol has no Heir
	type = country_event
	title = flavor_hab_tir.1101.title
	desc = flavor_hab_tir.1101.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_hab_tir.1101.a
		historical_option = yes

		c:HAB = {
			trigger_event_non_silently = {
				id = flavor_hab_tir.1102
			}
		}
	}

	option = {
		name = flavor_hab_tir.1101.b

		c:HAB = {
			add_casus_belli = { 
				target = c:TIR 
				type = casus_belli:cb_claim_throne 
			}
		}
	}
}

flavor_hab_tir.1102 = { #Tirol accepts
	type = country_event
	title = flavor_hab_tir.1102.title
	desc = flavor_hab_tir.1102.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_hab_tir.1102.a
		historical_option = yes

		c:TIR = {
			set_new_ruler = scope:target_habsburg_ruler
		}
		scope:target_ruler = {
			move_country = root
		}
		if = {
			limit = {
				c:TIR = {
					is_human = no
				}
			}
			c:TIR = {
				make_subject_of = {
					target = c:HAB
					type = subject_type:fiefdom
				}
			}
		}
	}
}