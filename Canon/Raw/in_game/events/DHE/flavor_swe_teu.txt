namespace = flavor_swe_teu

# Gotland is taken over by the Victual Brothers
flavor_swe_teu.1 = {
	type = country_event
	title = flavor_swe_teu.1.title
	desc = flavor_swe_teu.1.desc
	historical_info = flavor_swe_teu.1.historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = SWE
		from = 1380.1.1
		to = 1401.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	trigger = {
		at_war = no
		own_entire_province = province_definition:gotland_province
		NOT = { has_reform = government_reform:pirate_brethren_reform }
		num_locations > province_definition:gotland_province.location_counter
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }

		save_scope_as = event_chain_initiator
		c:TEU = {
			save_scope_as = fief_offer_target
		}
		create_character = {
			estate = estate_type:peasants_estate
			first_name = name_nicholas
			last_name = Stortebeker
			birth_date = 1360.6.1
			birth_location = location:rugen
			adm = { 25 100 }
			dip = { 25 100 }
			mil = { 25 100 }
			save_scope_as = target_character
			add_trait = trait:extortioner
			create_in_limbo = yes
		}
		location:visby = { save_scope_as = target_location }
		ruler_or_regent ?= { save_scope_as = target_character_2 }
		province:gotland_province = {
			create_location_country_from_province = {
				hidden_effect = {
					capital.province = { change_province_integration = core }
				}
				unlock_government_reform_effect = { type = pirate_brethren_reform }
				if = {
					limit = { navy_size_percentage < 1 }
					custom_tooltip = {
						text = build_galleys_to_navy_size_percentage_tt
						scope:target_location = {
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley
							create_sub_unit_of_category = sub_unit_category:navy_galley

						}
					}
				}
				name = {
					name = VTB
				}
				reforms = {
					pirate_brethren_reform
				}
				add_policy = policy:state_piracy_policy
				add_policy = policy:council_of_captains
				add_policy = policy:articles_of_agreement
				add_policy = policy:smugglers_haven
				add_policy = policy:authority_of_the_captain
				add_policy = policy:loyal_pirate_crews
				add_policy = policy:ship_boarding
				add_policy = policy:benefits_for_privateers
				add_policy = policy:port_logs
				save_scope_as = target_country
				change_government_type = government_type:republic
				change_heir_selection = heir_selection:pirate_elective
				add_gold = 1000
				add_government_power = 100
				set_new_ruler = scope:target_character

				change_societal_value = {
					type = serfdom_vs_free_subjects
					value = 200
				}
				change_societal_value = {
					type = land_vs_naval
					value = 200
				}
				change_societal_value = {
					type = belligerent_vs_conciliatory
					value = -200
				}
				if = {
					limit = {
						owns = location:visby
					}
					set_capital = location:visby
				}
				grant_estate_privilege = estate_privilege:peasants_in_administration
				save_scope_as = pirate_nation

			}

		}
		location:visby = {
			construct_building = {
				building_type = building_type:pirate_stronghold
				instant = yes
				cost_multiplier = 0
				cost_multiplier_reason = "game_concept_event"
			}
			construct_building = {
				building_type = building_type:pirate_tavern
				instant = yes
				cost_multiplier = 0
				cost_multiplier_reason = "game_concept_event"
			}
		}
	}


	option = {
		name = flavor_swe_teu.1.a

		historical_option = yes
		trigger = {
			country_exists = scope:fief_offer_target
			scope:fief_offer_target = {
				is_subject = no
			}
		}

		custom_tooltip = vtb_operates_in_the_baltic_tt

		show_as_tooltip = {
			scope:target_location = {
				construct_building = {
					building_type = building_type:pirate_stronghold
					instant = yes
					cost_multiplier = 0
					cost_multiplier_reason = "game_concept_event"
					owner = scope:target_country
				}
				construct_building = {
					building_type = building_type:pirate_tavern
					instant = yes
					cost_multiplier = 0
					cost_multiplier_reason = "game_concept_event"
					owner = scope:target_country
				}
			}
		}

		province_definition:gotland_province = {
			every_location_in_province_definition = {
				remove_core = ROOT
			}
		}

		scope:fief_offer_target = {
			trigger_event_non_silently = flavor_swe_teu.2
		}
	}
	option = {
		name = flavor_swe_teu.1.b

		add_casus_belli = { target = scope:pirate_nation type = casus_belli:cb_annex }

		show_as_tooltip = {
			scope:target_location = {
				construct_building = {
					building_type = building_type:pirate_stronghold
					instant = yes
					cost_multiplier = 0
					cost_multiplier_reason = "game_concept_event"
					owner = scope:target_country
				}
				construct_building = {
					building_type = building_type:pirate_tavern
					instant = yes
					cost_multiplier = 0
					cost_multiplier_reason = "game_concept_event"
					owner = scope:target_country
				}
			}
		}

		add_country_modifier = {
			modifier = teu_wrath_of_the_pirates
			years = 15
		}
	}

	option = {
		name = pirate_events.1.a

		trigger = {
			hidden_trigger = { is_ai = no }
		}

		add_casus_belli = { target = scope:pirate_nation type = casus_belli:cb_annex }

		add_country_modifier = {
			modifier = teu_wrath_of_the_pirates
			years = 15
		}

		change_player = scope:pirate_nation

		scope:pirate_nation = {
			trigger_event_non_silently = flavor_swe_teu.4
		}
	}
}

# Offer to Teutonic Order to defeat the victual brothers
flavor_swe_teu.2 = {
	type = country_event
	title = flavor_swe_teu.2.title
	desc = flavor_swe_teu.2.desc
	historical_info = flavor_swe_teu.1.historical_info

	option = {
		name = flavor_swe_teu.2.a

		historical_option = yes

		add_casus_belli = { target = scope:pirate_nation type = casus_belli:cb_annex }
		add_army_tradition = army_tradition_mild_bonus

		scope:event_chain_initiator = { set_variable = TEU_take_on_responsibility }
	}

	option = {
		name = flavor_swe_teu.2.b

		show_as_tooltip = {
			scope:event_chain_initiator = {
				add_casus_belli = { target = scope:pirate_nation type = casus_belli:cb_annex }
				add_army_tradition = army_tradition_mild_bonus
				scope:pirate_nation.province:gotland_province = {
					every_location_in_province = {
						add_core = scope:event_chain_initiator
					}
				}
			}
		}

		scope:event_chain_initiator = { set_variable = TEU_left_to_our_devices }
	}

	after = {
		scope:event_chain_initiator = {
			trigger_event_non_silently = flavor_swe_teu.3
		}
	}
}

# Swedish Notification
flavor_swe_teu.3 = {
	type = country_event
	title = flavor_swe_teu.3.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = TEU_take_on_responsibility
				}
				desc = flavor_swe_teu.3.desc_success
			}
			triggered_desc = {
				trigger = {
					has_variable = TEU_left_to_our_devices
				}
				desc = flavor_swe_teu.3.desc_failure
			}
		}
	}

	option = {
		name = flavor_swe_teu.3.a

		trigger = { has_variable = TEU_take_on_responsibility }

		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_minor_move_to_right
		}
	}
	option = {
		name = flavor_swe_teu.3.b

		trigger = { has_variable = TEU_left_to_our_devices }

		add_casus_belli = { target = scope:pirate_nation type = casus_belli:cb_annex }
		add_army_tradition = army_tradition_mild_bonus
		scope:pirate_nation.province:gotland_province = {
			every_location_in_province = {
				add_core = ROOT
			}
		}
	}
	after = {
		if = {
			limit = {
				has_variable = TEU_take_on_responsibility
			}
			remove_variable = TEU_take_on_responsibility
		}
		if = {
			limit = {
				has_variable = TEU_left_to_our_devices
			}
			remove_variable = TEU_left_to_our_devices
		}
	}
}

# The Victual Brotherhood
flavor_swe_teu.4 = {
	type = country_event
	title = flavor_swe_teu.4.title
	desc = flavor_swe_teu.4.desc

	#A Pirate's life for me!
	option = {
		name = flavor_swe_teu.4.a

		add_sailors = { value = root.monthly_sailors multiply = 3 min = 1 }
		add_gold = { 100 300 }
		add_prestige = prestige_severe_bonus
		drop_antagonism_bomb = {
			target = capital
			modifier = antagonism_embraced_piracy
		}
	}
}

flavor_swe_teu.5 = {
	type = country_event
	title = flavor_swe_teu.5.title
	desc = flavor_swe_teu.5.desc

	dynamic_historical_event = {
		tag = TEU
		from = 1400.1.1
		to = 1420.1.1
		monthly_chance = 5
	}
	fire_only_once = yes

	trigger = {
		own_entire_province = province_definition:gotland_province
		OR = {
			AND = {
				country_exists = c:SWE
				c:SWE = { is_subject = no has_ports = yes }
			}
			AND = {
				country_exists = c:DAN
				c:DAN = { is_subject = no has_ports = yes }
			}
		}
	}

	immediate = {
		save_scope_as = gotland_province_owner
		if = {
			limit = {
				country_exists = c:SWE
				c:SWE = { is_subject = no has_ports = yes }
			}
			c:SWE = {
				save_scope_as = first_offer
			}
			set_local_variable = first_offer_found
		}
		if = {
			limit = {
				country_exists = c:DAN
				c:DAN = { is_subject = no has_ports = yes }
			}
			c:DAN = {
				save_scope_as = second_offer
			}
			set_local_variable = second_offer_found
		}
		set_local_variable = {
			name = price_for_gotland
			value = 0
		}
		province:gotland_province = {
			every_location_in_province = {
				change_local_variable = {
					name = price_for_gotland
					add = this.location_tax_base
				}
			}
			save_scope_as = gutnish_province
		}
		change_local_variable = {
			name = price_for_gotland
			multiply = 120
		}
	}

	option = {
		name = flavor_swe_teu.5.a

		trigger =  {
			has_local_variable = first_offer_found
		}

		show_as_tooltip = {
			add_gold = {
				value = local_var:price_for_gotland
			}
			scope:first_offer = {
				trigger_event_non_silently = flavor_swe_teu.7
				add_gold = {
					value = local_var:price_for_gotland
					multiply = -1
				}
			}
		}


		show_as_tooltip = {
			scope:gutnish_province = {
				change_province_owner = scope:first_offer
				change_province_integration = integrated
				every_location_in_province = {
					if = {
						limit = {
							is_core_of = ROOT
						}
						remove_core = ROOT
					}
					add_core = scope:first_offer
				}
			}
		}
	}

	option = {
		name = flavor_swe_teu.5.b

		trigger =  {
			has_local_variable = second_offer_found
		}

		show_as_tooltip = {
			add_gold = {
				value = local_var:price_for_gotland
			}
			scope:second_offer = {
				trigger_event_non_silently = flavor_swe_teu.7
				add_gold = {
					value = local_var:price_for_gotland
					multiply = -1
				}
			}
		}



		show_as_tooltip = {
			scope:gutnish_province = {
				change_province_owner = scope:second_offer
				change_province_integration = integrated
				every_location_in_province = {
					if = {
						limit = {
							is_core_of = ROOT
						}
						remove_core = ROOT
					}
					add_core = scope:second_offer
				}
			}
		}
	}
	option = {
		name = flavor_swe_teu.5.c

		scope:first_offer ?= {
			show_as_tooltip = {
				add_casus_belli = {
					target = scope:gutnish_province.owner
					type = casus_belli:cb_conquer_province
					province = scope:gutnish_province
				}
			}
			trigger_event_non_silently = flavor_swe_teu.6
		}
		scope:second_offer ?= {
			show_as_tooltip = {
				add_casus_belli = {
					target = scope:gutnish_province.owner
					type = casus_belli:cb_conquer_province
					province = scope:gutnish_province
				}
			}
			trigger_event_non_silently = flavor_swe_teu.6
		}
	}
}

flavor_swe_teu.6 = {
	type = country_event
	title = flavor_swe_teu.6.title
	desc = flavor_swe_teu.6.desc

	option = {
		name = flavor_swe_teu.6.a

		add_casus_belli = {
			target = scope:gutnish_province.owner
			type = casus_belli:cb_conquer_province
			province = scope:gutnish_province
		}
	}
}

flavor_swe_teu.7 = {
	type = country_event
	title = flavor_swe_teu.7.title
	desc = flavor_swe_teu.7.desc

	immediate = {
		save_scope_as = offer_nation
	}
	option = {
		name = flavor_swe_teu.7.a

		scope:gotland_province_owner = {
			show_as_tooltip = {
				add_gold = {
					value = local_var:price_for_gotland
				}
			}
		}
		add_gold = {
			value = local_var:price_for_gotland
			multiply = -1
		}
		scope:gutnish_province = {
			change_province_owner = ROOT
			change_province_integration = integrated
			every_location_in_province = {
				if = {
					limit = {
						is_core_of = scope:gotland_province_owner
					}
					remove_core = scope:gotland_province_owner
				}
				add_core = ROOT
			}
		}

		scope:gotland_province_owner = {
			set_variable = teu_positive_response
		}
	}
	option = {
		name = flavor_swe_teu.7.b

		add_casus_belli = {
			target = scope:gotland_province_owner
			type = casus_belli:cb_conquer_province
			province = scope:gutnish_province
		}
		save_scope_as = nation_rejecting
		scope:gotland_province_owner = {
			set_variable = teu_negative_response
		}
	}
	after = {
		scope:gotland_province_owner = { trigger_event_non_silently = flavor_swe_teu.8 }
	}
}

flavor_swe_teu.8 = {
	type = country_event
	title = flavor_swe_teu.8.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = teu_positive_response
				}
				desc = flavor_swe_teu.8.desc_success
			}
			triggered_desc = {
				trigger = {
					has_variable = teu_negative_response
				}
				desc = flavor_swe_teu.8.desc_failure
			}
		}
	}

	option = {
		name = flavor_swe_teu.8.a

		trigger = { has_variable = teu_positive_response }

		add_gold = {
			value = local_var:price_for_gotland
		}
		add_prestige = prestige_mild_bonus
	}
	option = {
		name = flavor_swe_teu.8.b

		trigger = { has_variable = teu_negative_response }

		add_opinion = {
			target = scope:nation_rejecting
			modifier = teu_rejected_sale
		}
	}
	after = {
		if = {
			limit = {
				has_variable = teu_negative_response
			}
			remove_variable = teu_negative_response
		}
		if = {
			limit = {
				has_variable = teu_positive_response
			}
			remove_variable = teu_positive_response
		}
	}
}