scripted_effect TEU_reduce_crusader_fervor = {
	add_army_tradition = army_tradition_mild_penalty
}
scripted_effect TEU_increase_crusader_fervor = {
	add_army_tradition = army_tradition_mild_bonus
}

namespace = flavor_pol_teu

#Judgement of 1339
flavor_pol_teu.1 = {
	type = country_event
	title = flavor_pol_teu.1.title
	desc = flavor_pol_teu.1.desc
	historical_info = flavor_pol_teu.1.historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = POL
		from = 1339.1.1
		to = 1340.12.30
		monthly_chance = 40
	}

	illustration_tags = {
		10 = happy
		10 = interior
	}

	trigger = {
		country_exists = c:TEU
		NOT = { is_at_war_with = c:TEU }
		c:TEU = {
			any_owned_location = {
				is_core_of = ROOT
			}
		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		c:TEU = {
			random_province = {
				limit = {
					any_location_in_province = {
						is_core_of = ROOT
					}
				}
				save_scope_as = target_province
			}
			save_scope_as = pol_teutonic_side
			ruler_or_regent = {
				save_scope_as = teutonic_ruler_or_regent
			}
		}
		c:POL = {
			save_scope_as = pol_polish_side
			ruler_or_regent = {
				save_scope_as = polish_ruler_or_regent
			}
		}
	}

	option = {
		name = flavor_pol_teu.1.a
		
		
		scope:pol_teutonic_side = {
			trigger_event_non_silently = {
				id = flavor_pol_teu.2
				days = { 10 30 }
			}
		}
	}
}

#Judgement of 1339 - Teuton Response
flavor_pol_teu.2 = {
	type = country_event
	title = flavor_pol_teu.2.title
	desc = flavor_pol_teu.2.desc
	historical_info = flavor_pol_teu.1.historical_info

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	option = {
		name = flavor_pol_teu.2.a
		
		historical_option = yes
		trigger = {
			country_exists = c:PAP
		}
		
		c:PAP = {
			trigger_event_non_silently = {
				id = flavor_pol_teu.3
				months = { 1 3 }
			}
		}

		scope:pol_polish_side = { set_variable = teu_appealed_to_pap }
	}
	option = {
		name = flavor_pol_teu.2.b

		TEU_reduce_crusader_fervor = yes

		show_as_tooltip = {
			every_owned_location = {
				limit = {
					OR = {
						is_core_of = scope:pol_polish_side
						this = location:bytow
						this = location:lebork
					}
				}
				change_location_owner = scope:pol_polish_side
			}
			every_subject = {
				limit = {
					is_ai = yes
				}
				every_owned_location = {
					limit = {
						is_core_of = scope:pol_polish_side
					}
					change_location_owner = scope:pol_polish_side
				}
			}
		}
		
		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_large_move_to_right
		}

		add_prestige = prestige_severe_penalty

		scope:pol_polish_side = { set_variable = teu_returned_cores }
	}

	option = {
		name = flavor_pol_teu.2.c

		TEU_increase_crusader_fervor = yes

		show_as_tooltip = {
			scope:pol_polish_side = {
				add_casus_belli = { type = casus_belli:cb_conquer_province target = scope:pol_teutonic_side province = scope:target_province  }
			}
		}

		scope:pol_polish_side = { set_variable = teu_refused_to_return_core }
	}

	after = {
		scope:pol_polish_side = {
			trigger_event_non_silently = flavor_pol_teu.4
		}
	}
}

#Judgement of 1339 - Papal Judgement
flavor_pol_teu.3 = {
	type = country_event
	title = flavor_pol_teu.3.title
	desc = flavor_pol_teu.3.desc
	historical_info = flavor_pol_teu.1.historical_info

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler_or_regent = {
			save_scope_as = the_pope
		}
		location:dobrzyn = {
			add_to_list = teu_list_of_borderlands_to_cede
		}
		location:inowroclaw = {
			add_to_list = teu_list_of_borderlands_to_cede
		}
		location:bydgoszcz = {
			add_to_list = teu_list_of_borderlands_to_cede
		}
		location:zlotow = {
			add_to_list = teu_list_of_borderlands_to_cede
		}
		province_definition:dobrzyn_province = {
			every_location_in_province_definition = {
				add_to_list = teu_list_of_borderlands_to_cede
			}
		}
		province_definition:znin_province = {
			every_location_in_province_definition = {
				add_to_list = teu_list_of_borderlands_to_cede
			}
		}
		random_in_list = {
			list = teu_list_of_borderlands_to_cede
			limit = {
				owner ?= scope:pol_polish_side
			}
			province = {
				save_scope_as = target_province
			}
		}
	}
	
	option = {
		name = flavor_pol_teu.3.a

		historical_option = yes

		show_as_tooltip = {
			every_in_list = {
				list = teu_list_of_borderlands_to_cede
				limit = {
					owner = scope:pol_teutonic_side
					is_core_of = scope:pol_polish_side
				}
				change_location_owner = scope:pol_polish_side
			}
			scope:pol_teutonic_side = {
				add_prestige = prestige_extreme_penalty
			}
		}
		hidden_effect = {
			scope:pol_teutonic_side = {
				trigger_event_non_silently = flavor_pol_teu.8
			}
		}
	}
	option = {
		name = flavor_pol_teu.3.b
		
		scope:pol_teutonic_side = {
			add_opinion = {
				target = ROOT
				modifier = teu_supported_us
			}
			show_as_tooltip = {
				if = {
					limit = {
						exists = scope:target_province
					}
					add_casus_belli = {
						target = scope:pol_polish_side
						type = casus_belli:cb_conquer_province
						province = scope:target_province
					}
				}
			}
		}
		
		scope:pol_polish_side = {
			add_opinion = {
				target = ROOT
				modifier = teu_supported_other_side
			}
		}

		add_devotion = devotion_mild_bonus

		hidden_effect = {
			scope:pol_teutonic_side = {
				trigger_event_non_silently = flavor_pol_teu.5
			}
		}
	}
	option = {
		name = flavor_pol_teu.3.c

		scope:pol_teutonic_side = {
			add_opinion = {
				target = ROOT
				modifier = teu_supported_other_side
			}
		}
		
		scope:pol_polish_side = {
			add_opinion = {
				target = ROOT
				modifier = teu_supported_us
			}
		}

		add_stability = stability_mild_bonus
		scope:pol_teutonic_side = {
			trigger_event_non_silently = flavor_pol_teu.6
		}

		show_as_tooltip = {
			scope:pol_teutonic_side = {
				every_owned_location = {
					limit = {
						OR = {
							is_core_of = scope:pol_polish_side
							this = location:bytow
							this = location:lebork
						}
					}
					change_location_owner = scope:pol_polish_side
				}
				every_subject = {
					limit = {
						is_ai = yes
					}
					every_owned_location = {
						limit = {
							is_core_of = scope:pol_polish_side
						}
						change_location_owner = scope:pol_polish_side
					}
				}
			}
		}
	}
}

flavor_pol_teu.4 = {
	type = country_event
	title = flavor_pol_teu.4.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { has_variable = teu_appealed_to_pap }
				desc = flavor_pol_teu.4.desc.a
			}
			triggered_desc = {
				trigger = { has_variable = teu_returned_cores }
				desc = flavor_pol_teu.4.desc.b
			}
			triggered_desc = {
				trigger = { has_variable = teu_returned_cores_dobrzyn_golub }
				desc = flavor_pol_teu.4.desc.c
			}
			triggered_desc = {
				trigger = { has_variable = teu_refused_to_return_core }
				desc = flavor_pol_teu.4.desc.d
			}
			triggered_desc = {
				desc = flavor_pol_teu.4.desc.fallback
			}
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	option = {
		name = flavor_pol_teu.4.a

		trigger = {
			has_variable = teu_appealed_to_pap
		}
		
		add_prestige = prestige_mild_penalty
	}
	option = {
		name = flavor_pol_teu.4.b

		trigger = {
			has_variable = teu_returned_cores
		}

		scope:pol_teutonic_side = {
			every_owned_location = {
				limit = {
					OR = {
						is_core_of = ROOT
						this = location:bytow
						this = location:lebork
					}
				}
				change_location_owner = ROOT
			}
			every_subject = {
				limit = {
					is_ai = yes
				}
				every_owned_location = {
					limit = {
						is_core_of = ROOT
					}
					change_location_owner = ROOT
				}
			}
		}

		add_prestige = prestige_mild_bonus
	}
	option = {
		name = flavor_pol_teu.4.c

		trigger = {
			has_variable = teu_returned_cores_dobrzyn_golub
		}

		every_in_list = {
			list = teu_list_of_borderlands_to_cede
			limit = {
				owner = scope:pol_teutonic_side
				is_core_of = scope:pol_polish_side
			}
			change_location_owner = scope:pol_polish_side
		}
	}
	option = {
		name = flavor_pol_teu.4.d

		trigger = {
			has_variable = teu_refused_to_return_core
		}

		add_casus_belli = { 
			type = casus_belli:cb_conquer_province 
			target = scope:pol_teutonic_side 
			province = scope:target_province 
			years = 15
		}
	}
	after = {
		if = {
			limit = {
				has_variable = teu_appealed_to_pap
			}
			remove_variable = teu_appealed_to_pap
		}
		if = {
			limit = {
				has_variable = teu_returned_cores
			}
			remove_variable = teu_returned_cores
		}
		if = {
			limit = {
				has_variable = teu_refused_to_return_core
			}
			remove_variable = teu_refused_to_return_core
		}
		if = {
			limit = {
				has_variable = teu_returned_cores_dobrzyn_golub
			}
			remove_variable = teu_returned_cores_dobrzyn_golub
		}
	}
}

flavor_pol_teu.5 = {
	type = country_event
	title = flavor_pol_teu.5.title
	desc = flavor_pol_teu.5.desc

	illustration_tags = {
        10 = happy
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	option = {
		name = flavor_pol_teu.5.a
		
		add_prestige = prestige_severe_bonus

		add_country_modifier = {
			modifier = teu_papal_resolution
			years = 10
		}

		if = {
			limit = {
				exists = scope:target_province
			}
			add_casus_belli = {
				target = scope:pol_polish_side
				type = casus_belli:cb_conquer_province
				province = scope:target_province
			}
		}

		every_owned_location = {
			limit = {
				is_core_of = scope:pol_polish_side
				integration_level = conquered
			}
			change_integration_level = integrated
		}
	}
	after = {
		scope:pol_polish_side = {
			trigger_event_non_silently = flavor_pol_teu.7
		}
	}
}

flavor_pol_teu.6 = {
	type = country_event
	title = flavor_pol_teu.6.title
	desc = flavor_pol_teu.6.desc

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	option = {
		name = flavor_pol_teu.6.a

		show_as_tooltip = {
			every_owned_location = {
				limit = {
					OR = {
						is_core_of = ROOT
						this = location:bytow
						this = location:lebork
					}
				}
				change_location_owner = ROOT
			}
			every_subject = {
				limit = {
					is_ai = yes
				}
				every_owned_location = {
					limit = {
						is_core_of = ROOT
					}
					change_location_owner = ROOT
				}
			}
		}
		
		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_large_move_to_right
		}

		add_prestige = prestige_severe_penalty

		scope:pol_polish_side = { set_variable = teu_returned_cores }
	}

	option = {
		name = flavor_pol_teu.6.b

		TEU_reduce_crusader_fervor = yes

		show_as_tooltip = {
			scope:pol_polish_side = {
				add_casus_belli = { type = casus_belli:cb_conquer_province target = scope:pol_teutonic_side province = scope:target_province  }
			}
		}

		scope:pol_polish_side = { set_variable = teu_refused_to_return_core }
	}

	after = {
		hidden_effect = {
			scope:pol_polish_side = {
				trigger_event_non_silently = flavor_pol_teu.4
			}
		}
	}
}

flavor_pol_teu.7 = {
	type = country_event
	title = flavor_pol_teu.7.title
	desc = flavor_pol_teu.7.desc

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	option = {
		name = flavor_pol_teu.7.a
		
		add_prestige = prestige_severe_penalty
	}
}

flavor_pol_teu.8 = {
	type = country_event
	title = flavor_pol_teu.8.title
	desc = flavor_pol_teu.8.desc

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	option = {
		name = flavor_pol_teu.8.a

		show_as_tooltip = {
			every_in_list = {
				list = teu_list_of_borderlands_to_cede
				limit = {
					owner = scope:pol_teutonic_side
					OR = {
						is_core_of = scope:pol_polish_side
						this = location:bytow
						this = location:lebork
					}
				}
				change_location_owner = scope:pol_polish_side
			}
		}
		add_prestige = prestige_extreme_penalty
		
		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_large_move_to_right
		}

		add_prestige = prestige_severe_penalty

		scope:pol_polish_side = { set_variable = teu_returned_cores_dobrzyn_golub }
	}

	option = {
		name = flavor_pol_teu.8.b

		TEU_reduce_crusader_fervor = yes

		show_as_tooltip = {
			scope:pol_polish_side = {
				add_casus_belli = { type = casus_belli:cb_conquer_province target = scope:pol_teutonic_side province = scope:target_province  }
			}
		}

		scope:pol_polish_side = { set_variable = teu_refused_to_return_core }
	}

	after = {
		hidden_effect = {
			scope:pol_polish_side = {
				trigger_event_non_silently = flavor_pol_teu.4
			}
		}
	}
}