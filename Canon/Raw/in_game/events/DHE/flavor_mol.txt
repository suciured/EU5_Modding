namespace = flavor_mol

# Dragoș Vodă of Drăgoșești
flavor_mol.1000 = {
	type = country_event
	title = flavor_mol.1000.title
	desc = flavor_mol.1000.desc
	historical_info = flavor_mol.1000.historical_info
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = HUN
		from = 1340.1.1
		to = 1360.1.1
		monthly_chance = 15
	}
	
	trigger = {
		has_ruler = yes
		own_entire_province = province_definition:maramaros_province
		country_exists = c:GLH
		c:GLH = {
			stability < 0
			any_subject = {
				OR = {
					capital.area = area:moldavia_area
					has_presence_in = area:moldavia_area
				}
				culture = culture:moldovan
			}
			NOT = { 
				any_subject = {
					OR = {
						capital.area = area:moldavia_area
						has_presence_in = area:moldavia_area
					}
					culture = culture:moldovan
					is_human = yes
				}
			}
		}
		NOT = { is_allied_with = { target = c:GLH } }
		at_war = no
	}
	
	illustration_tags = {
		10 = regular
		10 = exterior
	}
	
	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		save_scope_as = root_country
		c:GLH = { save_scope_as = target_country }
		province_definition:maramaros_province = {
			ordered_location_in_province_definition = {
				limit = { 
					has_owner = yes
					owner = root
				}
				order_by = development
				check_range_bounds = no
				max = 1
				save_scope_as = target_location
			}
		}
		area:moldavia_area = {
			save_scope_as = target_area
		}
		create_character = {
			first_name = name_dragomir
			nickname = Voda
			dynasty = dynasty:dragosesti_dynasty
			birth_date = 1325.1.1
			adm = { 60 80 }
			dip = { 60 80 }
			mil = { 60 80 }
			culture = culture:moldovan
			religion = religion:orthodox
			estate = estate_type:nobles_estate
			save_scope_as = target_character
		}
		ruler ?= { save_scope_as = root_character }
	}
	
	option = {
		name = flavor_mol.1000.a
		historical_option = yes
		custom_tooltip = {
			text = flavor_mol.1000.a.at
			if = { 
				limit = { 
					NOT = { owns = location:suceava } 
					location:suceava.owner = {
						culture = culture:moldovan
					}
				} 
				location:suceava = { save_scope_as = release_location } 
			}
			else = {
				scope:target_area = {
					ordered_location_in_area = {
						limit = {
							owner ?= { culture = culture:moldovan }
						}
						order_by = { value = population multiply = rank_index }
						check_range_bounds = no
						max = 1
						save_scope_as = release_location
					}
				}
			}
			if = {
				limit = { exists = scope:release_location }
				scope:release_location = {
					owner = {
						trigger_event_silently = flavor_mol.1003
					}
				}
			}
		}
		custom_tooltip = flavor_mol.1000.a.bt
	}
	
	option = {
		name = flavor_mol.1000.b
		add_prestige = prestige_mild_penalty
	}
}

# The March of Moldavia
flavor_mol.1001 = {
	type = country_event
	title = flavor_mol.1001.title
	desc = flavor_mol.1001.desc
	historical_info = flavor_mol.1001.historical_info

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
	}
	
	# We cannot afford a conflict with Hungary at this moment
	option = {
		name = flavor_mol.1001.a
		historical_option = yes
		add_prestige = prestige_extreme_penalty
		add_horde_unity = horde_unity_extreme_penalty
	}
	# This is a decleration of war!
	option = {
		name = flavor_mol.1001.b
		declare_war_with_cb = {
			target = scope:release_country
			type = casus_belli:cb_horde_vs_civ
		}
		scope:root_country = { trigger_event_silently = flavor_mol.1002 }
	}
}

# The Horde is not amused
flavor_mol.1002 = {
	type = country_event
	title = flavor_mol.1002.title
	desc = flavor_mol.1002.desc

	illustration_tags = {
        10 = armed
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		clear_saved_scope = target_character
		scope:target_country = {
			ruler_or_regent ?= {
				save_scope_as = target_character
			}
		}
	}
	# To arms!
	option = {
		name = flavor_mol.1002.a
		show_as_tooltip = {
			scope:target_country = {
				declare_war_with_cb = {
					target = scope:release_country
					type = casus_belli:cb_horde_vs_civ
				}
			}
		}
	}
}

# [target_character.GetName] of [release_location.GetName]
flavor_mol.1003 = {
	type = country_event
	title = flavor_mol.1003.title
	desc = flavor_mol.1003.desc
	historical_info = flavor_mol.1000.historical_info
	
	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		save_scope_as = release_country
	}

	# Seek protection of the Hungarians
	option = {
		name = flavor_mol.1003.a
		historical_option = yes
		custom_tooltip = {
			text = become_moldavia_tt
			if = {
				limit = { exists = scope:release_country }
				scope:target_area = { every_location_in_area = { limit = { owner ?= root } add_core = scope:release_country } }
				scope:target_character = { move_country = scope:release_country }
				set_country_rank_effect = { rank = country_rank:rank_duchy }
				if = {
					limit = { NOT = { country_exists = scope:release_country } }
					create_country_from_cores_in_our_locations = scope:release_country
					scope:release_country = {
						change_government_type = government_type:monarchy
						add_all_estate_satisfaction = { value = estate_satisfaction_radical_bonus }
						if = {
							limit = { exists = scope:release_location }
							set_capital = scope:release_location
						}
						if = {
							limit = { exists = scope:target_character }
							set_new_ruler = scope:target_character
						}
						change_culture = culture:moldovan
						every_owned_location = {
							change_control = control_ultimate_bonus
						}
					}
				}
				if = {
					limit = { exists = scope:root_country }
					scope:release_country = {
						form_country = formable_country:MOL_f
						if = {
							limit = { exists = scope:target_character }
							set_new_ruler = scope:target_character
						}
						make_subject_of = {
							target = scope:root_country
							type = subject_type:march
						}
					}
				}
				if = {
					limit = { exists = scope:target_area }
					custom_tooltip = {
						text = flavor_mol.1003.a.tt
						scope:target_area = {
							every_country_with_capital_in_geography = {
								limit = {
									this != scope:release_country
									culture = root.culture
								}
								trigger_event_silently = flavor_mol.1004
							}
						}
					}
				}
				hidden_effect = {
					scope:target_country = {
						trigger_event_silently = flavor_mol.1001
					}
				}
			}
		}
	}
	# We will not switch one master for another
	option = {
		name = flavor_mol.1003.b
		add_opinion_mutual_effect = {
			modifier = opinion_hun_moldavian_push
			target = scope:root_country
		}
	}
}

# Join Moldavia
flavor_mol.1004 = {
	type = country_event
	title = {
		first_valid = {
			triggered_desc = {
				desc = flavor_mol.1004.title
				trigger = { exists = scope:release_country }
			}
			triggered_desc = {
				desc = flavor_mol.1004.title_default
				trigger = { NOT = { exists = scope:release_country } }
			}
		}
	}
	desc = flavor_mol.1004.desc

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	
	#We shall join them
	option = {
		name = flavor_mol.1004.a
		historical_option = yes
		trigger = { is_ai = yes }	#We don't want a player to commit accidental seppoku...
		scope:release_country = {
			annex_country_diplomatically = { country = root }
			hidden_effect = {
				every_owned_location = {
					change_control = control_ultimate_bonus
				}
			}
		}
	}
	#The Hungarians should not get involved here
	option = {
		name = flavor_mol.1004.b
		add_opinion_mutual_effect = {
			modifier = opinion_hun_moldavian_push
			target = scope:root_country
		}
	}
}