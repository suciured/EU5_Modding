namespace = flavor_dan_skane_war

flavor_dan_skane_war.1 = { #The Rebellion of Johan Offesson
	type = country_event
	title = flavor_dan_skane_war.1.title
	desc = flavor_dan_skane_war.1.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = SKE
		from = 1339.1.1
		to = 1345.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_john
			last_name = Offesson
			adm = 53
			dip = 45
			mil = 64
			min_age = 30
			birth_location = location:lund
			culture = culture:danish
			religion = religion:catholic
			estate = estate_type:nobles_estate
			save_scope_as = target_character
			script = johan_offesson
		}
		ruler ?= {
			save_scope_as = target_ruler
		}
	}

	trigger = {
		is_subject_of = c:SWE
		government_type = government_type:monarchy
		opinion = {
			target = c:SWE
			value <= 150
		}
		c:SWE = {
			has_ruler = yes
		}
		c:DAN = {
			has_ruler = yes
		}
		has_ruler = yes
	}

	option = {
		name = flavor_dan_skane_war.1.a
		historical_option = yes

		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_extreme_penalty }
		add_stability = stability_severe_penalty
		add_legitimacy = legitimacy_mild_penalty
		scope:target_character = {
			move_country = c:DAN
		}
		c:DAN = {
			trigger_event_silently = flavor_dan_skane_war.2
		}
	}

	option = {
		name = flavor_dan_skane_war.1.b
		custom_tooltip = flavor_dan_skane_war.1.b.tt
		c:DAN = {
			trigger_event_silently = flavor_dan_skane_war.3
		}
	}
}

flavor_dan_skane_war.2 = { #Johan Offesson arrives in Denmark
	type = country_event
	title = flavor_dan_skane_war.2.title
	desc = flavor_dan_skane_war.2.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = interior
	}

	trigger = {
		exists = character:johan_offesson
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:johan_offesson = { save_scope_as = target_character }
	}

	option = {
		name = flavor_dan_skane_war.2.a
		historical_option = yes
		custom_tooltip = flavor_dan_skane_war.2.a.tt

		c:DAN = {
			trigger_event_silently = {
				id = flavor_dan_skane_war.5
				years = 10
			}
		}
	}

	option = {
		name = flavor_dan_skane_war.2.b

		add_prestige = prestige_mild_penalty
		add_legitimacy = legitimacy_mild_penalty
		kill_character_silently = {
			target = scope:target_character
			reason = vanished
		}
	}
}

flavor_dan_skane_war.3 = { #Scania elects the danish King - Denmark
	hide_portraits = yes
	type = country_event
	title = flavor_dan_skane_war.3.title
	desc = flavor_dan_skane_war.3.desc

	fire_only_once = yes

	illustration_tags = {
		10 = happy
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:johan_offesson = { save_scope_as = target_character }
		ruler ?= {
			save_scope_as = target_ruler
		}
	}

	option = {
		name = flavor_dan_skane_war.3.a

		add_prestige = prestige_severe_bonus
		if = {
			limit = {
				c:SKE = {
					is_human = no
				}
			}
			c:SKE = {
				every_core_location = {
					add_core = c:DAN
				}
			}
			annex_country = { country = c:SKE }
		}
		else = {
			c:SWE = {
				cancel_subject = c:SKE
			}
		}
		c:SWE = {
			trigger_event_silently = flavor_dan_skane_war.4
		}
	}

	option = {
		name = flavor_dan_skane_war.3.b

		add_prestige = prestige_severe_penalty
		add_opinion = {
			target = c:SWE
			modifier = opinion_decline_crown_of_vassal
		}
	}
}

flavor_dan_skane_war.4 = { #Scania elects the danish King - Sweden
	hide_portraits = yes
	type = country_event
	title = flavor_dan_skane_war.4.title
	desc = flavor_dan_skane_war.4.desc

	fire_only_once = yes

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		location:lund.owner = {
			save_scope_as = skane_owner
		}
	}

	option = {
		name = flavor_dan_skane_war.4.a

		add_prestige = prestige_mild_penalty
		add_casus_belli = {	target = scope:skane_owner	type = casus_belli:cb_conquer_province	}
	}
}

flavor_dan_skane_war.5 = { #Offer to purchase Scania - Denmark
	type = country_event
	title = flavor_dan_skane_war.5.title
	desc = flavor_dan_skane_war.5.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:nobles_estate }
		character:johan_offesson = { save_scope_as = target_character }
	}

	trigger = {
		c:SKE = {
			is_subject_of = c:SWE
			government_type = government_type:monarchy
		}
	}

	option = {
		name = flavor_dan_skane_war.5.a
		custom_tooltip = flavor_dan_skane_war.5.a.tt
		c:SWE = {
			trigger_event_silently = flavor_dan_skane_war.6
		}
	}

	option = {
		name = flavor_dan_skane_war.5.b

		add_prestige = prestige_mild_penalty
		add_legitimacy = legitimacy_mild_penalty
	}
}

flavor_dan_skane_war.6 = { #Offer to purchase Scania - Sweden
	hide_portraits = yes
	type = country_event
	title = flavor_dan_skane_war.6.title
	desc = flavor_dan_skane_war.6.desc

	fire_only_once = yes

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		c:DAN = {
			ruler ?= { save_scope_as = danish_king }
		}
	}

	option = {
		name = flavor_dan_skane_war.6.a

		c:DAN = {
			transfer_yearly_gold = {
				value = 0.5
				target = c:SWE
			}
		}
		c:SWE = {
			cancel_subject = c:SKE
		}
		c:SKE = {
			make_subject_of = {
				target = c:DAN
				type = subject_type:vassal
			}
			set_new_ruler = scope:danish_king
		}
		c:DAN = {
			trigger_event_silently = flavor_dan_skane_war.7
		}
	}

	option = {
		name = flavor_dan_skane_war.6.b

		add_prestige = prestige_mild_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }

	}
}

flavor_dan_skane_war.7 = {
	hide_portraits = yes
	type = country_event
	title = flavor_dan_skane_war.7.title
	desc = flavor_dan_skane_war.7.desc

	fire_only_once = yes

	illustration_tags = {
		10 = happy
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		c:DAN = {
			ruler ?= { save_scope_as = danish_king }
		}
	}

	option = {
		name = flavor_dan_skane_war.7.a

		add_prestige = prestige_weak_bonus
		add_legitimacy = legitimacy_weak_bonus
	}
}