namespace = flavor_chi_dai


# Ho Quy Ly
flavor_chi_dai.1 = {
	type = country_event
	title = flavor_chi_dai.1.title
	desc = flavor_chi_dai.1.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = DAI
		from = 1375.1.1
		to = 1410.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_named_dynasty = ho_dynasty
		create_character = {
			estate = estate_type:nobles_estate
			first_name = name_quy.name_ly
			dynasty = dynasty:ho_dynasty
			birth_location = location:thanh_hoa
			birth_date = 1336.6.1
			script = dai_ho_quy_ly
			mil = { 70 80 }
			adm = { 40 60 }
			dip = { 30 50 }

			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_chi_dai.1.a
		
		scope:target_character = {
			add_random_trait_from_category = general
		}
	}
}

# Throne is Seized
flavor_chi_dai.2 = {
	type = country_event
	title = flavor_chi_dai.2.title
	desc = flavor_chi_dai.2.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = DAI
		from = 1398.1.1
		to = 1405.1.1
		monthly_chance = 10
	}

	trigger = {
		exists = ruler_or_heir_if_regent
		exists = ruler_or_heir_if_regent.dynasty
		overlord ?= {
			is_leader_of_international_organization_of_type = {
				type = middle_kingdom
			}
		}
		is_subject_type = tributary
		
		character:dai_ho_quy_ly ?= {
			owner = ROOT
			in_cabinet = yes
		}
	}

	illustration_tags = {
		10 = armed
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		save_scope_as = target_country

		character:dai_ho_quy_ly ?= {
			save_scope_as = target_character
		}

		ruler_or_heir_if_regent = {
			save_scope_as = ousted_character
		}

		capital.province = {
			add_to_list = rebellion_provinces
		}

		create_rebel = {
			category = pretender
			name = dai_ho_quy_ly_pretender_rebellion
			save_scope_as = target_rebel
		}

		scope:target_character = {
			change_character_allegiance = scope:target_rebel
		}
	}

	option = {
		name = flavor_chi_dai.2.a

		historical_option = yes

		ai_chance = {
			factor = 0.75
		}
		
		set_new_ruler = scope:target_character
		change_country_name = DAI_NGU
		set_variable = {
			name = dai_dai_ngu_variable
		}

		add_country_modifier = {
			mode = add
			modifier = chi_ho_quy_ly_reforms
			years = 25
		}

		overlord ?= {
			trigger_event_non_silently = {
				id = flavor_chi_dai.3
			}
		}

		scope:ousted_character = {
			imprison_character_effect = {
				years = -1
			}
		}

		hidden_effect = { destroy_rebel = scope:target_rebel }
	}

	option = {
		name = flavor_chi_dai.2.b

		ai_chance = {
			factor = 0.25
		}
		
		if = {
			limit = {
				num_provinces > 3
			}
			create_instant_rebellion = {
				list = rebellion_provinces
				rebel = scope:target_rebel
			}
		}
		else = {
			add_stability = stability_ultimate_penalty
			hidden_effect = { destroy_rebel = scope:target_rebel }
		}
	}
}

# Tran Dynasty Member in China
flavor_chi_dai.3 = {
	type = country_event
	title = flavor_chi_dai.3.title
	desc = flavor_chi_dai.3.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	trigger = {
		dynasty:tran_dynasty ?= {
			any_character_in_dynasty = {
				can_become_a_ruler = yes
			}
		}
	}

	illustration_tags = {
		10 = angry
		10 = interior
	}

	immediate = {
		save_scope_as = china_side
		dynasty:tran_dynasty = {
			random_character_in_dynasty = {
				limit = {
					can_become_a_leader = yes
				}
				save_scope_as = claimant_character
			}
		}

		c:DAI = {
			event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		}
	}

	option = {
		name = flavor_chi_dai.3.a

		ai_chance = {
			factor = 0.8
		}

		historical_option = yes
		
		add_country_modifier = {
			mode = replace
			modifier = chi_supporting_tributary_system
			years = 25
		}
		scope:target_country = {
			trigger_event_non_silently = {
				id = flavor_chi_dai.4
			}
		}
	}

	option = {
		name = flavor_chi_dai.3.b

		ai_chance = {
			factor = 0.2
		}
	
		add_prestige = prestige_mild_bonus
	}
}

# Demand of the Chinese
flavor_chi_dai.4 = {
	type = country_event
	title = flavor_chi_dai.4.title
	desc = flavor_chi_dai.4.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_chi_dai.4.a
		
		historical_option = yes

		ai_chance = {
			factor = 1
		}

		scope:china_side = {
			trigger_event_non_silently = {
				id = flavor_chi_dai.5 
			}
		}
		scope:claimant_character = {
			imprison_character_effect = {
				years = -1
			}
		}
		add_liberty_desire = liberty_desire_mild_plus
		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_minor_move_to_left
		}
	}

	option = {
		name = flavor_chi_dai.4.b
		
		ai_chance = {
			factor = 0
		}

		set_new_ruler = scope:claimant_character
		change_country_name = DAI
		remove_country_modifier = chi_ho_quy_ly_reforms
		remove_variable = dai_dai_ngu_variable
	}
}

# Notification for China
flavor_chi_dai.5 = {
	type = country_event
	title = flavor_chi_dai.5.title
	desc = flavor_chi_dai.5.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}
	

	option = {
		name = flavor_chi_dai.5.a
		
		historical_option = yes

		ai_chance = {
			factor = 1
		}

		declare_war_with_cb = {
			target = scope:target_country
			type = casus_belli:cb_annex
		}

		c:CHA ?= {
			trigger_event_non_silently = {
				id = flavor_chi_dai.10
				months = { 2 4 }
			}
		}
	}

	option = {
		name = flavor_chi_dai.5.b

		ai_chance = {
			factor = 0
		}
		
		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_large_move_to_right
		}
	}
}

# Province of Jiaozhi
flavor_chi_dai.6 = {
	type = country_event
	title = flavor_chi_dai.6.title
	desc = flavor_chi_dai.6.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		from = 1390.1.1
		to = 1500.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = exterior 
		10 = regular
	}

	trigger = {
		area:red_river_delta_area = {
			any_location_in_area = {
				percent >= 0.5
				owner ?= ROOT
			}
		}
		any_character = {
			is_general = yes	
		}
		NOT = { country_exists = c:DAI }
	}

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		random_character = {
			limit = {
				is_general = yes
			}
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_chi_dai.6.a

		historical_option = yes

		ai_chance = {
			factor = 0.8
		}
		
		set_variable = has_province_of_jiaozhi
		area:red_river_delta_area = {
			every_province_in_area = {
				limit = {
					owner = ROOT
				}
				add_province_modifier = {
					mode = replace
					modifier = chi_integrating_vietnam
				}
			}
		}
	}

	option = {
		name = flavor_chi_dai.6.b

		ai_chance = {
			factor = 0.2
		}
		
		area:red_river_delta_area = {
			every_province_in_area = {
				limit = {
					owner = ROOT
				}
				change_province_owner = c:DAI
			}
		}

		c:DAI = {
			make_subject_of = {
				target = ROOT
				type = subject_type:tributary
			}
			add_liberty_desire = liberty_desire_extreme_minus
		}
	}
}

# Chinese Involvement in Jiaozhi
flavor_chi_dai.7 = {
	type = country_event
	title = flavor_chi_dai.7.title
	desc = flavor_chi_dai.7.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		from = 1410.1.1
		to = 1440.1.1
		monthly_chance = 10
	}

	trigger = {
		has_variable = has_province_of_jiaozhi
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		remove_variable = has_province_of_jiaozhi
		area:red_river_delta_area = {
			random_province_definition_in_area = {
				limit = {
					any_province_in_province_definition = {
						owner = ROOT
					}
				}
				save_scope_as = target_province_definition
			}
		}
	}

	option = {
		name = flavor_chi_dai.7.a

		ai_chance = {
			factor = 0.66
		}
		
		area:red_river_delta_area = {
			ordered_province_in_area = {
				limit = {
					owner ?= ROOT
				}
				order_by = population
				max = 3
				add_province_modifier = {
					mode = replace
					modifier = chi_vietnamese_assimilation
				}
			}
		}

		add_migration = {
			amount = 0.1
			months = 24
			from = scope:target_province_definition
			owner = ROOT
			to = capital.province_definition
		}

		culture:vietnamese_culture = {
			add_cultural_tradition = cultural_influence_extreme_penalty
		}
	}

	option = {
		name = flavor_chi_dai.7.b

		ai_chance = {
			factor = 0.33
		}
	
		change_societal_value = {
			type = centralization_vs_decentralization
			value = societal_value_minor_move_to_right
		}
	}
}

# Rise of the Le Dynasty
flavor_chi_dai.8 = {
	type = country_event
	title = flavor_chi_dai.8.title
	desc = flavor_chi_dai.8.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		from = 1420.1.1
		to = 1430.1.1
		monthly_chance = 10
	}

	trigger = {
		area:red_river_delta_area = {
			any_location_in_area = {
				percent >= 0.25
				owner ?= ROOT
			}
		}
		NOT = { country_exists = c:DAI }
	}

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		area:red_river_delta_area = {
			every_province_in_area = {
				limit = {
					owner = ROOT
				}
				add_to_list = revolt_provinces
			}
		}

		create_named_dynasty = le_dynasty

		create_character = {
			estate = estate_type:nobles_estate
			first_name = Loi
			dynasty = dynasty:le_dynasty
			adm = { 50 60 }
			dip = { 30 40 }
			mil = { 65 80 }
			birth_date = 1385.9.10
			birth_location = location:thanh_hoa
			save_scope_as = target_character
		}

		create_rebel = {
			category = nationalist
			name = le_loi_rebellion
			culture = culture:vietnamese_culture
			save_scope_as = target_rebels
		}
	}

	option = {
		name = flavor_chi_dai.8.a
	
		historical_option = yes

		ai_chance = {
			factor = 0.33
		}

		create_country_from_cores_in_our_locations = c:DAI

		every_in_list = {
			list = revolt_provinces
			change_province_owner = c:DAI
		}

		scope:target_character = {
			move_country = c:DAI
		}

		c:DAI = {
			change_country_name = DAI
			set_new_ruler = scope:target_character
		}
	}

	option = {
		name = flavor_chi_dai.8.b

		ai_chance = {
			factor = 0.66
		}
		
		create_instant_rebellion = {
			list = revolt_provinces
			rebel = scope:target_rebels
		}
	}
}

# Tran Loyalist Revolt
flavor_chi_dai.9 = {
	type = country_event
	title = flavor_chi_dai.9.title
	desc = flavor_chi_dai.9.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		from = 1400.1.1
		to = 1415.1.1
		monthly_chance = 5
	}

	trigger = {
		area:red_river_delta_area = {
			any_province_in_area = {
				owner ?= ROOT
			}
		}

		dynasty:tran_dynasty ?= {
			any_character_in_dynasty = {
				is_alive = yes
				can_become_a_ruler = yes
			}
		}
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:nobles_estate }
		area:red_river_delta_area = {
			every_province_in_area = {
				limit = {
					owner ?= ROOT
				}
				add_to_list = revolt_provinces
			}
		}

		dynasty:tran_dynasty = {
			random_character_in_dynasty = {
				limit = {
					is_alive = yes
					can_become_a_ruler = yes
				}
				save_scope_as = target_character
			}
		}

		random_in_list = {
			list = revolt_provinces
			
			random_location_in_province = {
				event_illustration_poptype_effect = { foreground = pop_type:burghers   background = pop_type:burghers }
			}
		}

		create_rebel = {
			category = nationalist
			name = tran_rebellion
			culture = culture:vietnamese_culture
			save_scope_as = target_rebel
		}

		scope:target_character = {
			change_character_allegiance = scope:target_rebel
		}
	}

	option = {
		name = flavor_chi_dai.9.a
		
		create_instant_rebellion = {
			list = revolt_provinces
			rebel = scope:target_rebel
		}
	}
}

# Champa Intervention
flavor_chi_dai.10 = {
	type = country_event
	title = flavor_chi_dai.10.title
	desc = flavor_chi_dai.10.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	trigger = {
		scope:target_country = {
			exists = "war_with_country(scope:china_side)"
		}
		is_neighbor_of = scope:target_country
		exists = scope:target_country.province:hue_province
	}

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		scope:target_country = {
			"war_with_country(scope:china_side)" = {
				save_scope_as = target_war
			}
		}
	}

	option = {
		name = flavor_chi_dai.10.a
		
		historical_option = yes

		ai_chance = {
			factor = 0.8
		}

		add_casus_belli = {
			target = scope:target_country
			type = casus_belli:cb_border_war
		}

		drop_antagonism_bomb = {
			modifier = chi_intervention_in_vietnam
			target = capital
		}
	}

	option = {
		name = flavor_chi_dai.10.b

		ai_chance = {
			factor = 0.2
		}
		
		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_large_move_to_right
		}
	}
}

flavor_chi_dai.11 = {
	type = country_event
	title = flavor_chi_dai.11.title
	desc = flavor_chi_dai.11.desc
	historical_info = flavor_chi_dai.ho_quy_ly_historical_info

	trigger = {
		any_work_of_art_in_country = {
			location.area = area:red_river_delta_area
			count >= 5
		}
		exists = ruler_or_regent
	}

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		from = 1400.1.1
		to = 1420.1.1
		monthly_chance = 10
	}

	illustration_tags = {
        10 = armed
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		ruler_or_regent = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_chi_dai.11.a

		ai_chance = {
			factor = 0.75
		}

		historical_option = yes
		
		ordered_work_of_art_in_country = {
			limit = {
				location.area = area:red_river_delta_area
			}
			order_by = art_quality
			max = 5
			destroy_art = THIS
		}

		culture:vietnamese_culture = {
			add_cultural_tradition = cultural_tradition_extreme_penalty
		}

		add_prestige = prestige_mild_bonus
	}

	option = {
		name = flavor_chi_dai.11.b

		ai_chance = {
			factor = 0.25
		}
	
		add_stability = stability_mild_bonus
	}
}