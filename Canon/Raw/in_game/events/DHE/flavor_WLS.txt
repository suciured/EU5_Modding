namespace = flavor_wls

scripted_trigger country_eisteddfod_trigger = {
	NOT = { culture = culture:welsh }
	any_owned_location = { location_eisteddfod_trigger = yes }
}

scripted_trigger location_eisteddfod_trigger = {
	dominant_culture = culture:welsh
}

# Eisteddfod festival
flavor_wls.10 = {
	type = country_event
	fire_only_once = yes
	title = flavor_wls.10.title
	desc = flavor_wls.10.desc
	
	trigger = {
		country_eisteddfod_trigger = yes
	}

	illustration_tags = {
        10 = happy
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		random_owned_location = {
			limit = { location_eisteddfod_trigger = yes }
			save_scope_as = target_location
		}
	}

	# Embrace the festival
	option = {
		name = flavor_wls.10.a
		scope:target_location = {
			dominant_culture = {
				add_cultural_tradition = cultural_tradition_severe_bonus
			}
			province = {
				every_location_in_province = {
					change_control = control_severe_penalty
				}
			}
		}
		scope:target_location.province = {

		}
	}

	# Co-opt the festival
	option = {
		name = flavor_wls.10.b
		scope:target_location = {
			dominant_culture = {
				add_cultural_tradition = cultural_tradition_weak_bonus
			}
			province = {
				every_location_in_province = {
				change_control = control_mild_bonus
				}
			}
		}
		culture = {
			add_cultural_influence = cultural_influence_weak_bonus
		}
		change_gold_effect = { scale = -2 }
	}

	# Break up the festival
	option = {
		name = flavor_wls.10.c
		culture = {
			add_cultural_influence = cultural_influence_mild_bonus
		}
		change_gold_effect = { scale = -6 }
		scope:target_location.province = {
			every_location_in_province = {
				change_control = control_mild_bonus
			}
		}
	}
}

# Owain Glyndŵr
flavor_wls.11 = {
	type = country_event

	fire_only_once = yes

	title = flavor_wls.11.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					is_subject_of = c:ENG
					culture = culture:english
				}
				desc = flavor_wls.11.desc_subject
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_wls.11.desc
			}
		}
	}

	dynamic_historical_event = {
		tag = WLS
		from = 1370.1.1
		to = 1400.1.1
		monthly_chance = 1
	}

	trigger = {

		dynasty_exists = mortimer_dynasty

		is_neighbor_of = c:ENG

	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_eugene # Owain
			dynasty = dynasty:mathrafal_dynasty
			nickname = nick_glendower
			adm = 22
			dip = 10
			mil = 45
			birth_date = 1354
			birth_location = location:montgomery # Sycharth
			culture = culture:welsh
			religion = religion:catholic
			estate = estate_type:nobles_estate
			script = wls_owain_glyndwr
			save_scope_as = owain_glyndwr
		}

		dynasty:mathrafal_dynasty = { save_scope_as = mathrafal_dynasty }

		location:montgomery = { save_scope_as = target_location }

	}

	option = {
		historical_option = yes
		name = flavor_wls.11.a

		random_list =  {
			50 = { character:wls_owain_glyndwr ?= { add_adm = 20 } }
			50 = { character:wls_owain_glyndwr ?= { add_mil = 20 } }
		}

		custom_tooltip = flavor_wls.11.tt1

	}

	option = {
		name = flavor_wls.11.b

		change_gold_effect = { scale = -3 }

		character:wls_owain_glyndwr ?= { add_adm = 30 }

		custom_tooltip = flavor_wls.11.tt2

	}

	option = {
		name = flavor_wls.11.c

		change_gold_effect = { scale = -3 }

		character:wls_owain_glyndwr ?= { add_mil = 30 }

		custom_tooltip = flavor_wls.11.tt3

	}

}

# Appeal to the King
flavor_wls.12 = {
	type = country_event

	fire_only_once = yes

	title = flavor_wls.12.title
	desc = flavor_wls.12.desc

	dynamic_historical_event = {
		tag = WLS
		from = 1390.1.1
		to = 1420.1.1
		monthly_chance = 1
	}

	trigger = {

		character:wls_owain_glyndwr ?= { is_alive = yes }

		is_subject_of = c:ENG

		is_neighbor_of = c:ENG

	}

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:wls_owain_glyndwr ?= { save_scope_as = owain_glyndwr }

		capital = { save_scope_as = target_location }

	}

	option = {
		historical_option = yes
		name = flavor_wls.12.a

		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }

		c:ENG = { trigger_event_silently = flavor_eng.89 }

		custom_tooltip = flavor_wls.12.tt

	}

	option = {
		name = flavor_wls.12.b

		change_gold_effect = { scale = -12 }

	}

}

# Glyndŵr Rising

scripted_effect flavor_wls_13_create_revolt = {
	scope:owain_glyndar_rebels = {

		character:wls_owain_glyndwr ?= { 
			change_character_allegiance = scope:owain_glyndar_rebels

			remove_character_modifier = disloyal_noble_officer
		}
		start_civil_war = {
			save_scope_as = glyndwr_country
		}
	}

	scope:glyndwr_country = {
		raise_all_levies = {
			type = army
			instant = yes
		}
		set_variable = glyndwr_revolt_war
		root = {
			every_owned_location = {
				limit = {
					is_neighbor_of = scope:glyndwr_country
					region = root.capital.region
					NOT = { is_connected_to = root.capital }
					dominant_culture = culture:welsh
				}
				change_location_owner = scope:glyndwr_country
			}
		}
		scope:target_location = {
			province = {
				every_location_in_province = { change_location_owner = scope:glyndwr_country }
			}
		}
		set_new_ruler = scope:owain_glyndwr
		change_country_flag = WLS_glyndwr

		if = {
			limit = { NOT = { culture = culture:welsh } }
			change_culture = culture:welsh
		}

		if = {
			limit = { NOT = { court_dialect = dialect:welsh_dialect } }
			set_court_language = dialect:welsh_dialect
		}

		if = {
			limit = { root = { has_reform =  government_reform:iron_ring_reform } }
			add_reform = government_reform:iron_ring_reform
		}
		add_reform = government_reform:celtic_traditions_reform
	}
}
flavor_wls.13 = {
	hide_portraits = no
	type = country_event
	title = flavor_wls.13.title
	desc = flavor_wls.13.desc

	illustration_tags = {
        10 = armed
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:wls_owain_glyndwr ?= { save_scope_as = owain_glyndwr }

		create_rebel = {
			category = pretender
			name = owain_glyndar_rebels
			save_scope_as = owain_glyndar_rebels
		}

		capital = { save_scope_as = target_location }

	}

	option = {
		historical_option = yes
		name = flavor_wls.13.a

		custom_tooltip = {
			text = flavor_wls.13.tt1
			flavor_wls_13_create_revolt = yes

			every_disloyal_subject = {
				make_subject_of = {
					target = scope:glyndwr_country
					type = subject_type
				}
				every_subject = {
					join_war_with = {
						target = scope:glyndwr_country
						war = scope:glyndwr_country.civil_war
						call_in_subjects = yes
					}
				}
			}

			every_loyal_subject = {
				join_war_with = {
					target = root
					war = root.civil_war
					call_in_subjects = yes
				}
			}
		}
	}

	option = {
		name = flavor_wls.13.b

		custom_tooltip = {
			text = flavor_wls.13.tt2
			flavor_wls_13_create_revolt = yes

			every_loyal_subject = {
				make_subject_of = {
					target = scope:glyndwr_country
					type = subject_type
				}
				every_subject = {
					join_war_with = {
						target = scope:glyndwr_country
						war = scope:glyndwr_country.civil_war
						call_in_subjects = yes
					}
				}
			}
			
			every_disloyal_subject = {
				join_war_with = {
					target = root
					war = root.civil_war
					call_in_subjects = yes
				}
			}

			change_player = scope:glyndwr_country
		}
	}

}

# Glyndŵr land and honor restored
flavor_wls.14 = {
	type = country_event

	title = flavor_wls.14.title
	desc = flavor_wls.14.desc

	illustration_tags = {
        10 = happy
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:wls_owain_glyndwr ?= { save_scope_as = owain_glyndwr }

		location:cardiff = { save_scope_as = target_location }

	}

	option = {
		name = flavor_wls.14.a

		add_liberty_desire = liberty_desire_severe_minus

		add_opinion = {
			target = c:ENG
			modifier = opinion_pleased
		}

		custom_tooltip = flavor_wls.14.tt

	}

}

# English noble captured
flavor_wls.15 = {
	hide_portraits = yes
	type = country_event
	fire_only_once = yes
	title = flavor_wls.15.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {	c:ENG = { has_variable = ransom_paid_edmund_mortimer } }
				desc = flavor_wls.15.desc_ransom_paid
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_wls.15.desc
			}
		}
	}

	dynamic_historical_event = {
		tag = WLS
		from = 1400.1.1
		to = 1420.1.1
		monthly_chance = 20
	}

	trigger = {

		character:wls_owain_glyndwr ?= { is_alive = yes is_ruler = yes }

		character:wls_edmund_mortimer_1376 ?= { is_alive = yes }

		c:ENG = {
			OR = {
			has_variable = tripartite_indenture
			has_variable = ransom_paid_edmund_mortimer
			}
		}

	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		location:shrewsbury = { save_scope_as = shropshire }

		dynasty:percy_dynasty = { save_scope_as = percy_dynasty }

		dynasty:mortimer_dynasty = { save_scope_as = mortimer_dynasty }

		c:ENG = { save_scope_as = england }

		character:wls_edmund_mortimer_1376 ?= { save_scope_as = edmund_mortimer }

		province_definition:northumberland_province = { save_scope_as = northumberland }

		location:cardiff = { save_scope_as = target_location }

	}

	option = {
		historical_option = yes
		name = flavor_wls.15.a
		trigger = { c:ENG = { has_variable = tripartite_indenture } }

		set_variable = { name = tripartite_indenture }

		if = {
			limit = {
				NOT = { is_at_war_with = c:ENG }
			}
			custom_tooltip = flavor_wls.15.tt1
		}
		else = {
			custom_tooltip = flavor_wls.15.tt2
		}



	}

	option = {
		name = flavor_wls.15.b
		trigger = { c:ENG = { has_variable = tripartite_indenture } }

		set_variable = { name = tripartite_indenture }

		set_variable = { name = tripartite_indenture_bribe }

		change_gold_effect = { scale = -12 }

		if = {
			limit = {
				NOT = { is_at_war_with = c:ENG }
			}
			custom_tooltip = flavor_wls.15.tt3
		}
		else = {
			custom_tooltip = flavor_wls.15.tt4
		}

	}

	option = {
		name = flavor_wls.15.c
		trigger = { c:ENG = { has_variable = tripartite_indenture } }

		custom_tooltip = flavor_wls.15.tt5

	}


	option = {
		name = flavor_wls.15.d
		trigger = { c:ENG = { has_variable = ransom_paid_edmund_mortimer } }

		add_gold = {
			value = scope:england.monthly_income_trade_and_tax
			multiply = 6
		}

		custom_tooltip = flavor_wls.15.tt6

	}

}

# English lords dishonor agreement
flavor_wls.16 = {
	type = country_event
	title = flavor_wls.16.title
	
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {	has_variable = bribe_accepted }
				desc = flavor_wls.16.desc_england_success
			}
			triggered_desc = {
				trigger = {	has_variable = bribe_refused }
				desc = flavor_wls.16.desc_england_failure
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = flavor_wls.16.desc
			}
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:wls_owain_glyndwr ?= { save_scope_as = owain_glyndwr }

		location:cardiff = { save_scope_as = target_location }

	}

	option = {
		name = flavor_wls.16.a
		trigger = { root = c:WLS }

		custom_tooltip = flavor_wls.16.tt1

	}

	option = {
		name = flavor_wls.16.b
		trigger = {	has_variable = bribe_accepted }

		custom_tooltip = flavor_wls.16.tt1

	}

	option = {
		name = flavor_wls.16.c
		trigger = {	has_variable = bribe_refused }

		custom_tooltip = flavor_wls.16.tt2

	}

}
