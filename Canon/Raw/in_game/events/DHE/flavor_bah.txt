namespace = flavor_bah

# Mahmud Gawan Madrasa

flavor_bah.1 = {
	type = country_event
	title = flavor_bah.1.title
	desc = flavor_bah.1.desc
    historical_info = flavor_bah.1.historical_info
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = BAH
		from = 1420.1.1
		to = 1520.1.1
		monthly_chance = 2
	}

	trigger = {
		religion = religion:shia
        location:bidar.owner ?= root
	}
	
	illustration_tags = {
		10 = interior
		10 = happy
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:clergy_estate }

        location:bidar ?= {
            save_scope_as = target_location
        }

        ruler_or_regent ?= {
            save_scope_as = target_character
        }

		root.capital ?= {
			create_dynasty_from_location = random
			last_dynasty_in_location = { save_scope_as = target_dynasty }
		}

        create_character = {
            artist = architect
            age = 40
			dynasty = scope:target_dynasty
            artist_skill = 0.79
            culture = root.culture
            religion = root.religion
            birth_location = location:bidar
            save_scope_as = target_artist
            estate = estate_type:nobles_estate
            create_in_limbo = yes
        }
	}

	option = {
		name = flavor_bah.1.a
		historical_option = yes

        scope:target_location = {
            construct_building = {
				building_type = building_type:mahmud_gawan_madrasa
				cost_multiplier = 1
			}
        }
        scope:target_artist = {
            move_country = root
        }

        add_estate_satisfaction = {
            type = estate_type:clergy_estate
			value = estate_satisfaction_extreme_bonus
		}

	}
	
	option = {
		name = flavor_bah.1.b

		add_estate_satisfaction = {
            type = estate_type:clergy_estate
			value = estate_satisfaction_mild_penalty
		}

        add_prestige = prestige_mild_penalty

        kill_character_silently = scope:target_artist
	}
}

#A Throne for Peace
flavor_bah.1000 = {
	type = country_event
	title = flavor_bah.1000.title
	desc = flavor_bah.1000.desc
    historical_info = flavor_bah.1000.historical_info
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = BAH
		from = 1337.1.1
		to = 1400.1.1
		monthly_chance = 5
	}

	trigger = {
        location:warangal.owner != root
        location:warangal.owner ?= {
            at_war = no
			is_subject = no
        }
        location:warangal = {
            any_work_of_art_in_location = {
                this = work_of_art:takht_i_firoza
            }
        }
	}
	
	illustration_tags = {
		10 = interior
		10 = regular
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

        location:warangal.owner ?= {
            save_scope_as = target_country
            ruler_or_regent ?= {
                save_scope_as = target_character
            }
        }

		location:warangal = {
			random_work_of_art_in_location = {
                limit = {
                    this = work_of_art:takht_i_firoza
                }
                save_scope_as = target_art
            }
		}

		save_scope_as = target_country2

		ruler_or_regent ?= {
			save_scope_as = target_character2
		}
	}

	option = {
		name = flavor_bah.1000.a
		historical_option = yes

        show_as_tooltip = {
            scope:target_art = {
                move_art = root.capital
            }
            add_truce_with = { target = scope:target_country }
        }

		custom_tooltip = bah_target_must_accept_tt

		scope:target_country = {
			trigger_event_non_silently = flavor_bah.1001
		}

	}
	
	option = {
		name = flavor_bah.1000.b

		custom_tooltip = bah_no_deal_tt
	}
}

#A Throne for Peace
flavor_bah.1001 = {
	type = country_event
	title = flavor_bah.1001.title
	desc = flavor_bah.1001.desc
    historical_info = flavor_bah.1001.historical_info

	fire_only_once = yes
	major = yes

	major_trigger = {
		this = scope:target_country2
	}

	illustration_tags = {
		10 = exterior
		10 = regular
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_bah.1001.a
		historical_option = yes

        scope:target_art = {
			move_art = scope:target_country2.capital
		}
		add_truce_with = { target = scope:target_country2 mutual = yes }

		trigger_event_silently = flavor_bah.1001

	}
	option = {
		name = flavor_bah.1001.b

		add_opinion = { target = scope:target_country2 modifier = bah_rejected_giving_up_throne }
		scope:target_country2 = {
			add_opinion = { target = root modifier = bah_rejected_giving_up_throne }
		}
	}
}

