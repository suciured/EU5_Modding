namespace = flavor_glh

# Tatar Yoke
flavor_glh.1 = {
	hide_portraits = yes
	type = country_event
	fire_only_once = yes
	title = flavor_glh.1.title
	desc = flavor_glh.1.desc

	dynamic_historical_event = {
		tag = GLH
		from = 1337.1.1
		to = 1377.1.1
		monthly_chance = 100
	}

	trigger = {
		has_ruler = yes
		sub_continent:eastern_europe = {
			any_country_with_capital_in_geography = {
				count > 0
				is_member_of_international_organization = international_organization:tatar_yoke
			}
		}

		unique_international_organization_type_exists = international_organization_type:tatar_yoke

	}

	illustration_tags = {
        10 = armed
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		capital = {
			save_scope_as = target_location
		}

		ruler ?= {
			save_scope_as = target_character
		}
		
		root = { save_scope_as = target_root_country }

		international_organization:tatar_yoke = {
			save_scope_as = tatar_yoke
		}

	}

	option = {
		name = flavor_glh.1.a
		historical_option = yes

		custom_tooltip = flavor_glh.1.tt

		ai_chance = {
			factor = 1
		}
	}

	historical_info = flavor_glh.1.historical_info

}

# Kalita the Tax Collector
flavor_glh.2 = {
	hide_portraits = yes
	type = country_event
	fire_only_once = yes
	title = flavor_glh.2.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = c:GLH
					has_variable = kalita_the_tax_collector
				}
				desc = flavor_glh.2.desc_kalita_the_tax_collector
			}
			triggered_desc = {
				trigger = {
					root = c:GLH
					has_variable = discovered_treachery
				}
				desc = flavor_glh.2.desc_discovered_treachery
			}
			triggered_desc = {
				trigger = {
					NOT = { root = c:GLH }
				}
				desc = flavor_glh.2.desc
			}
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:nobles_estate }
		capital = {
			save_scope_as = target_location
		}

		scope:target_root_country.ruler = {
			save_scope_as = target_character
		}

	}

	option = {
		name = flavor_glh.2.a
		trigger = {
			root = c:GLH
			has_variable = kalita_the_tax_collector
		}

		remove_variable = kalita_the_tax_collector

		add_country_modifier = { 
			modifier = kalita 
			months = 120 
			mode = add_and_extend 
		} 

		custom_tooltip = flavor_glh.2.tt1

		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = flavor_glh.2.b
		trigger = {
			root = c:GLH
			has_variable = discovered_treachery
		}

		remove_variable = discovered_treachery

		add_trust = {
			modifier = trust_discovered_treachery
			target = scope:target_root_country
		} 

		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = flavor_glh.2.c
		trigger = {
			NOT = { root = c:GLH }
		}

		add_trust = {
			modifier = trust_opposing_the_mongols
			target = scope:target_root_country
		} 

		ai_chance = {
			factor = 1
		}
	}

	historical_info = flavor_mos.9.historical_info

}

# The Battle of the Princes
flavor_glh.3 = {
	type = country_event
	fire_only_once = yes
	title = flavor_glh.3.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					root = c:GLH
				}
				desc = flavor_glh.3.desc_direct_appeal_to_khan
			}
			triggered_desc = {
				trigger = {
					NOT = { root = c:GLH }
					scope:target_root_country = {
						has_variable = endorses_ruler
					}
				}
				desc = flavor_glh.3.desc_endorses_ruler
			}
			triggered_desc = {
				trigger = {
					NOT = { root = c:GLH }
					scope:target_root_country = {
						has_variable = endorses_pretender
					}
				}
				desc = flavor_glh.3.desc_endorses_pretender
			}
		}
	}

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		capital = {
			save_scope_as = target_location
		}
		
	}

	option = {
		name = flavor_glh.3.a
		historical_option = yes
		trigger = {
			root = c:GLH
		}

		scope:target_root_country = {
			remove_variable = direct_appeal_to_khan
			set_variable = { name = endorses_ruler value = 1 }
			trigger_event_silently = flavor_glh.3
		}

		custom_tooltip = flavor_glh.3.tt1

		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = flavor_glh.3.b
		trigger = {
			root = c:GLH
		}

		scope:target_root_country = {
			remove_variable = direct_appeal_to_khan
			set_variable = { name = endorses_pretender value = 1 }
			trigger_event_silently = flavor_glh.3
		}

		custom_tooltip = flavor_glh.3.tt2

		ai_chance = {
			factor = 1
		}
	}

	option = {
		name = flavor_glh.3.c
		trigger = {
			NOT = {
				root = c:GLH
			}	
		}

		if = {
			limit = {
				has_variable = endorses_pretender
			}
		add_government_power = government_power_severe_penalty
		remove_variable = endorses_pretender
		}
		else = {
			add_government_power = government_power_severe_bonus
			remove_variable = endorses_ruler
		}

		ai_chance = {
			factor = 1
		}
	}

	historical_info = flavor_mos.16.historical_info

}

flavor_glh.1000 = {
	hide_portraits = yes
	type = country_event
	title = flavor_glh.1000.title
	desc = flavor_glh.1000.desc

	major = yes

	major_trigger = {
		exists = capital
		capital.sub_continent = sub_continent:eastern_europe
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }

		international_organization:tatar_yoke = {
			random_country_with_special_status_of_type = {
				type = tatar_tax_collector
				save_scope_as = old_tax_collector
			}
		}
		international_organization:tatar_yoke.leader_country = {
			save_scope_as = target
		}
	}

	option = {
		name = flavor_glh.1000.a

		international_organization:tatar_yoke = {
			international_organization_remove_special_status = {
				type = special_status:tatar_tax_collector
				country = scope:old_tax_collector
			}
			international_organization_add_special_status = {
				type = special_status:tatar_tax_collector
				country = scope:actor
			}
		}
		scope:actor = {
			add_opinion = {
				target = scope:target
				modifier = opinion_tax_collector_granted
			}
		}
		scope:old_tax_collector = {
			add_opinion = {
				target = scope:target
				modifier = opinion_tax_collector_revoked
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				factor = 10
				scope:target = {
					is_allied_with = {
						target = scope:actor
					}
				}
			}
			modifier = {
				factor = 0.1
				scope:target = {
					opinion = {
						target = scope:actor
						value < 50
					}
				}
			}
			modifier = {
				factor = 10
				scope:target = {
					opinion = {
						target = scope:actor
						value > 100
					}
				}
			}
			modifier = {
				factor = 0
				scope:target = {
					opinion = {
						target = scope:old_tax_collector
						value > 75
					}
				}
			}
		}
	}

	option = {
		name = flavor_glh.1000.b

		scope:actor = {
			add_opinion = {
				target = scope:target
				modifier = opinion_tax_collector_rejected
			}
		}
	}
}
