namespace = flavor_mch

flavor_mch.1 = {
	type = country_event
	title = flavor_mch.1.title
	desc = flavor_mch.1.desc
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = MCH
		from = 1584.1.1
		to = 1630.1.1
		monthly_chance = 10
	}

	trigger = {
		has_ruler = yes
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.1.a
		historical_option = yes

		change_societal_value = { type = centralization_vs_decentralization value = societal_value_move_to_left }
		change_societal_value = { type = traditionalist_vs_innovative value = societal_value_move_to_right }
		change_societal_value = { type = capital_economy_vs_traditional_economy value = societal_value_move_to_left }

	}
	
	option = {
		name = flavor_mch.1.b

		change_societal_value = { type = centralization_vs_decentralization value = societal_value_move_to_right }
		change_societal_value = { type = traditionalist_vs_innovative value = societal_value_move_to_left }
		change_societal_value = { type = capital_economy_vs_traditional_economy value = societal_value_move_to_right }

	}
}

flavor_mch.2 = {
	type = country_event
	title = flavor_mch.2.title
	desc = flavor_mch.2.desc
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 5
	}

	major = yes
	
	major_trigger = {
		this = scope:target_country
	}

	trigger = {
		country_exists = c:CHI
		at_war = no
		is_neighbor_of = c:CHI
	}

	illustration_tags = {
        10 = angry
        10 = interior
    }
	
	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:nobles background = pop_type:soldiers }
		c:CHI = {
			save_scope_as = target_country
		}
	}

	option = {
		name = flavor_mch.2.a
		add_casus_belli =  { type = casus_belli:cb_imperialism target = scope:target_country }

		add_opinion_mutual_effect = {
			modifier = mch_seven_grievances
			target = scope:target_country
		}
	}
}

flavor_mch.3 = {
	type = country_event
	title = flavor_mch.3.title
	desc = flavor_mch.3.desc
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = MCH
		tag = CHI
		from = 1645.1.1
		to = 1660.1.1
		monthly_chance = 5
	}

	trigger = {
		culture = culture:jurchen_culture
		own_entire_area = area:beiping_area
		own_entire_area = area:yannan_area
		own_entire_area = area:yanbei_area
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
	}

	option = {
		name = flavor_mch.3.a
		historical_option = yes
		change_societal_value = { type = land_vs_naval value = societal_value_move_to_left }
		change_societal_value = { type = offensive_vs_defensive value = societal_value_minor_move_to_left }
		change_societal_value = { type = quality_vs_quantity value = societal_value_minor_move_to_left }
	}
	
	option = {
		name = flavor_mch.3.b
		change_societal_value = { type = offensive_vs_defensive value = societal_value_minor_move_to_right }
	}
}

flavor_mch.4 = {
	type = country_event
	title = flavor_mch.4.title
	desc = flavor_mch.4.desc
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = MCH
		tag = CHI
		from = 1770.1.1
		to = 1800.1.1
		monthly_chance = 5
	}

	trigger = {
		culture = culture:jurchen_culture
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_heshen
			last_name = Niohuru
			culture = culture:jurchen_culture
			birth_location = location:fushun_liaoyang
			birth_date = 1750.7.1
			religion = root.religion
			create_in_limbo = yes
			save_scope_as = target_character
		}
		scope:target_character = {
			set_to_limited_random_stats = {
				max_adm = 90
				min_adm = 50
				max_dip = 90
				min_dip = 50
				max_mil = 90
				min_mil = 50
			}
		}
	}

	option = {
		name = flavor_mch.4.a
		historical_option = yes

		scope:target_character = {
			move_country = ROOT
		}
		change_gold_effect = { scale = -4 }
	}
	option = {
		name = flavor_mch.4.b
		add_prestige = prestige_weak_bonus
		hidden_effect = { kill_character_silently = scope:target_character }
	}
}

# Proclaim the Later Jin
flavor_mch.5 = {
	type = country_event
	title = flavor_mch.5.title
	desc = flavor_mch.5.desc

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_mch.5.a

		change_country_name = MCH_LATER_JIN
		add_legitimacy = legitimacy_extreme_bonus

		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_large_move_to_left
		}

		set_variable = unlocked_warring_state
		add_reform = government_reform:warring_state
	}

	option = {
		name = flavor_mch.5.b

		add_prestige = prestige_mild_bonus
		culture = {
			add_cultural_tradition = cultural_tradition_mild_bonus
		}
	}
}

# The Queue Hairstyle
flavor_mch.6 = {
	type = country_event
	title = flavor_mch.6.title
	desc = flavor_mch.6.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = MCH
		tag = CHI
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		is_leader_of_international_organization = international_organization:middle_kingdom
		has_ruler = yes
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		unlock_law_effect = {
			type = mch_queue_hair
		}

		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }

		ruler = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.6.a

		add_policy = policy:enforce_queue_hair
		culture = {
			add_cultural_influence = cultural_influence_severe_bonus
		}
	}

	option = {
		name = flavor_mch.6.b

		add_policy = policy:queue_hair_status_quo
		add_all_estate_satisfaction = {
			value = 0.1
		}
	}
}

# Dragon-tiger General
flavor_mch.7 = {
	type = country_event
	title = flavor_mch.7.title
	desc = flavor_mch.7.desc
	fire_only_once = yes
	
	dynamic_historical_event = {
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 20
	}

	trigger = {
		has_ruler = yes
		ruler = {
			mil >= 80
			has_variable = mch_num_of_battles_won
			var:mch_num_of_battles_won >= 10
		}
	}
	
	illustration_tags = {
        10 = happy
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:nobles background = pop_type:soldiers }
		ruler = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.7.a

		add_prestige = prestige_extreme_bonus
		scope:target_character = {
			add_trait = trait:dragon_tiger
		}
	}
}

# 8 Banners of Mongolia
flavor_mch.8 = {
	type = country_event
	title = flavor_mch.8.title
	desc = flavor_mch.8.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = MCH
		tag = CHI
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		has_unlocked_any_unit_of_category = army_cavalry
		has_advance = unlock_horsemen_advance
		50 <= { # At least 50k mongolian pops in our country
			value = this.total_population
			multiply = "culture_group_percentage_in_country(culture_group:mongolian_group)"
		}
	}

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		ordered_pop = {
			limit = {
				culture = {
					has_culture_group = culture_group:mongolian_group
				}
			}
			order_by = pop_size
			save_scope_as = target_pop
		}
		scope:target_pop.location = {
			save_scope_as = target_location
		}

		create_character = {
			estate = estate_type:peasants_estate
			culture = scope:target_pop.culture
			religion = scope:target_pop.religion
			mil = { 60 70 }
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.8.a

		scope:target_location = {
			while = {
				count = 8
				create_sub_unit_of_category = sub_unit_category:army_cavalry
			}
			random_unit_in_location = {
				set_as_commander = scope:target_character
			}
		}

		add_manpower = {
			value = this.total_population
			multiply = "culture_group_percentage_in_country(culture_group:mongolian_group)"
			multiply = 0.05
		}
	}
}

# 8 Banners of China
flavor_mch.9 = {
	type = country_event
	title = flavor_mch.9.title
	desc = flavor_mch.9.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = MCH
		tag = CHI
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	trigger = {
		culture = culture:jurchen_culture
		has_unlocked_any_unit_of_category = army_cavalry
		has_advance = unlock_horsemen_advance
		300 <= { #at least 300k chinese pops in our country
			value = this.total_population
			multiply = "culture_group_percentage_in_country(culture_group:chinese_group)"
		}
	}

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		ordered_pop = {
			limit = {
				culture = {
					has_culture_group = culture_group:chinese_group
				}

			}
			order_by = pop_size
			save_scope_as = target_pop
		}
		scope:target_pop.location = {
			save_scope_as = target_location
		}
		create_character = {
			estate = estate_type:peasants_estate
			culture = scope:target_pop.culture
			religion = scope:target_pop.religion
			mil = { 60 70 }
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.9.a

		scope:target_location = {
			while = {
				count >= 8
				create_sub_unit_of_category = sub_unit_category:army_cavalry
			}
			random_unit_in_location = {
				save_scope_as = target_unit
				set_as_commander = scope:target_character
			}
		}

		add_manpower = {
			value = this.total_population
			multiply = "culture_group_percentage_in_country(culture_group:chinese_group)"
			multiply = 0.02
		}

		set_variable = chinese_banners
	}
}

# Invasion of Korea
flavor_mch.10 = {
	type = country_event
	title = flavor_mch.10.title
	desc = flavor_mch.10.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = MCH
		tag = CHI
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	major = yes
	major_trigger = {
		this = scope:target_country
	}

	trigger = {
		culture = culture:jurchen_culture
		country_exists = c:KOR
		is_leader_of_international_organization = international_organization:middle_kingdom
		c:KOR = {
			is_neighbor_of = ROOT
			NOT = { is_subject_or_below_of = ROOT }
		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		c:KOR = {
			save_scope_as = target_country
		}
	}

	option = {
		name = flavor_mch.10.a

		add_casus_belli = {
			target = scope:target_country
			type = casus_belli:cb_make_tributary
		}

		custom_tooltip = mch_benefits_of_subjugating_korea
		set_variable = seeking_korean_tributary
		trigger_event_silently = {
			id = flavor_mch.11
			years = 25
		}
	}

	option = {
		name = flavor_mch.10.b

		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_move_to_right
		}
		change_celestial_authority = { value = celestial_authority_strong_penalty }
	}
}

scripted_trigger succeeded_at_subjugating_korea = {
	is_leader_of_international_organization = international_organization:middle_kingdom
	scope:target_country = {
		is_subject_or_below_of = ROOT
	}
}

flavor_mch.11 = {
	type = country_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					succeeded_at_subjugating_korea = yes
				}
				desc = flavor_mch.11.success_title
			}
			triggered_desc = {
				desc = flavor_mch.11.failure_title
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					succeeded_at_subjugating_korea = yes
				}
				desc = flavor_mch.11.success_desc
			}
			triggered_desc = {
				desc = flavor_mch.11.failure_desc
			}
		}
	}
	major = yes
	major_trigger = {
		this = scope:target_country
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
	}

	option = {
		name = flavor_mch.11.a

		if = {
			limit = {
				succeeded_at_subjugating_korea = yes
			}
			drop_antagonism_bomb = {
				modifier = antagonism_established_dominance_in_middle_kingdom
				target = capital
			}
			change_celestial_authority = { value = celestial_authority_mild_bonus }
			set_variable = mch_korea_conquest
			custom_tooltip = mch_improve_warring_state_gov_reform
		}
		else = {
			add_prestige = prestige_mild_penalty
			if = {
				limit = {
					is_leader_of_international_organization = international_organization:middle_kingdom
				}
				change_celestial_authority = { value = celestial_authority_strong_penalty }
			}
		}
	}
	after = {
		remove_variable = seeking_korean_tributary
	}
}

# Lifan Yuan
flavor_mch.12 = {
	type = country_event
	title = flavor_mch.12.title
	desc = flavor_mch.12.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		any_province = {
			count >= 50
			OR = {
				region = region:mongolia_region
				region = region:tibet_region
				region = region:xinjiang_region
				sub_continent = sub_continent:north_asia
				sub_continent = sub_continent:central_asia
			}
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_mch.12.a

		unlock_government_reform_effect = { type = lifan_yuan }
		add_reform = government_reform:lifan_yuan
	}

	option = {
		name = flavor_mch.12.b

		unlock_government_reform_effect = { type = lifan_yuan }
	}
}

# Hetu Ala
flavor_mch.13 = {
	type = country_event
	title = flavor_mch.13.title
	desc = flavor_mch.13.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		NOT = { is_leader_of_international_organization = international_organization:middle_kingdom }
		owns = location:hetu_ala
		has_ruler = yes
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		location:hetu_ala = {
			save_scope_as = target_location
		}
		ruler = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.13.a

		if = {
			limit = {
				capital != scope:target_location
			}
			set_capital = scope:target_location
		}
		scope:target_location = {
			change_development = development_severe_bonus
			change_prosperity = prosperity_extreme_bonus
		}

		if = {
			limit = {
				scope:target_location = {
					rank_index < 2
				}
			}
			scope:target_location = {
				change_location_rank = location_rank:city
			}
		}

		add_yearly_gold = -1
	}

	option = {
		name = flavor_mch.13.b

		change_societal_value = {
			type = centralization_vs_decentralization
			value = societal_value_move_to_right
		}
	}
}

# Beijing Capital
flavor_mch.14 = {
	type = country_event
	title = flavor_mch.14.title
	desc = flavor_mch.14.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	illustration_tags = {
		10 = regular
		10 = interior
	}


	trigger = {
		culture = culture:jurchen_culture
		owns = location:dadu
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		location:dadu = {
			save_scope_as = target_location
		}

		set_local_variable = {
			name = diff_between_beijing_and_capital
			value = {
				value = scope:target_location.development
				subtract = capital.development
				min = 0
			}
		}
	}

	option = {
		name = flavor_mch.14.a

		if = {
			limit = {
				capital != scope:target_location
			}
			set_capital = scope:target_location
		}
		scope:target_location = {
			change_development = development_severe_bonus
			change_prosperity = prosperity_extreme_bonus
		}

		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_huge_move_to_left
		}

		add_stability = stability_mild_bonus
	}

	option = {
		name = flavor_mch.14.b

		trigger = {
			capital != scope:target_location
			scope:target_location.development > capital.development
		}

		capital = {
			change_development = {
				value = local_var:diff_between_beijing_and_capital
				multiply = 0.75
			}
		}

		scope:target_location = {
			change_development = {
				value = local_var:diff_between_beijing_and_capital
				multiply = -0.75
			}
		}
	}
}

# Green Standard Army
flavor_mch.15 = {
	type = country_event
	title = flavor_mch.15.title
	desc = flavor_mch.15.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		has_variable = chinese_banners
		2000 <= { #at least 2M pops of chinese culture group in our country
			value = this.total_population
			multiply = "culture_group_percentage_in_country(culture_group:chinese_group)"
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
	}

	option = {
		name = flavor_mch.15.a

		add_army_tradition = army_tradition_weak_bonus

		change_gold_effect = { scale = -6 }

		unlock_policy_effect = {
			type = mch_green_standard_army
		}

		add_policy = policy:mch_green_standard_army
	}

	option = {
		name = flavor_mch.15.b

		unlock_policy_effect = {
			type = mch_green_standard_army
		}
	}

	after = {
		remove_variable = chinese_banners
	}
}

#Inheriting the Ming Reforms
flavor_mch.16 = {
	type = country_event
	title = flavor_mch.16.title
	desc = flavor_mch.16.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		is_leader_of_international_organization = international_organization:middle_kingdom
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_mch.16.a

		custom_tooltip = unlock_chinese_language_reforms
		set_variable = unlocked_mandarin_language_reforms
		change_celestial_authority = { value = celestial_authority_mild_bonus }
	}

	option = {
		name = flavor_mch.16.b

		unlock_estate_privilege_effect = {
			type = mch_tribal_favor
		}
		custom_tooltip = MCH_conditional_benefit
	}
}

# Proclamation of the Qing
flavor_mch.17 = {
	type = country_event
	title = flavor_mch.17.title
	desc = flavor_mch.17.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 100
	}

	trigger = {
		culture = culture:jurchen_culture
		OR = {
			NOT = { exists = international_organization:middle_kingdom }
			is_leader_of_international_organization = international_organization:middle_kingdom
		}
		has_ruler = yes
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.17.a

		form_country = formable_country:CHI_f
		hidden_effect = {
			change_country_tag = CHI
			change_country_flag = CHI
		}
		change_country_adjective = QNG_ADJ
		change_country_name = QNG
		change_country_color = map_QNG
	}

	option = {
		name = flavor_mch.17.b

		add_prestige = prestige_severe_bonus
	}
}

# Manchu script
flavor_mch.18 = {
	type = country_event
	title = flavor_mch.18.title
	desc = flavor_mch.18.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHI
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
		culture.language = language:jurchen_language
		has_ruler = yes
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		ruler = {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_mch.18.a

		culture = {
			add_cultural_influence = cultural_influence_extreme_bonus
		}
		scope:target_character = {
			add_adm = 5
		}
	}
}

# Manchu Identity
flavor_mch.19 = {
	type = country_event
	title = flavor_mch.19.title
	desc = flavor_mch.19.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = MCH
		from = 1337.1.1
		to = 1821.1.1
		monthly_chance = 10
	}

	trigger = {
		culture = culture:jurchen_culture
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_mch.19.a

		add_country_modifier = {
			mode = add_and_extend
			modifier = mch_manchu_identity
			years = -1
		}

		add_estate_satisfaction = {
			type = estate_type:tribes_estate
			value = estate_satisfaction_extreme_penalty
		}
	}

	option = {
		name = flavor_mch.19.b

		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}

		change_societal_value = {
			type = traditionalist_vs_innovative
			value = societal_value_large_move_to_left
		}

		add_prestige = prestige_mild_bonus
	}
}