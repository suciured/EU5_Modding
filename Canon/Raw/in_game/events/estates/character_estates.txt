namespace = character_estates

# burgher loses fortune
scripted_trigger character_estates_1_character_trigger = {
	is_alive = yes
	is_ruler = no
	is_adult = yes
	has_estate = estate_type:burghers_estate
	location = {
		any_pop = {
			estate_type = estate_type:burghers_estate
		}
	}
}
character_estates.1 = {
	type = country_event
	title = character_estates.1.title
	desc = character_estates.1.desc
	
	trigger = {
		any_character = {
			character_estates_1_character_trigger = yes
		}
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		random_character = {
			limit = {
				character_estates_1_character_trigger = yes
			}
			save_scope_as = target_character
			location = {
				save_scope_as = target_location
				random_pop = {
					limit = { estate_type = estate_type:burghers_estate }
					save_scope_as = target_pop
					save_scope_as = target_pop_bckg
				}
			}
		}
	}

	option = {
		name = character_estates.1.a
		
		add_estate_satisfaction = { type = estate_type:burghers_estate
			value = estate_satisfaction_weak_penalty
		}

		scope:target_character = {
			change_character_estate = estate_type:peasants_estate

			every_descendant = {
				limit = { 
					is_ruler = no
					has_estate = estate_type:burghers_estate
				}
				change_character_estate = estate_type:peasants_estate
			}
		}
	}
	option = {
		name = character_estates.1.b
			
		add_estate_satisfaction = { type = estate_type:burghers_estate
			value = estate_satisfaction_mild_bonus
		}

		change_gold_effect = { scale = -3 }

		add_gold_to_estate = {
			estate_type = estate_type:burghers_estate
			value = { 
				value = monthly_income_trade_and_tax
				multiply = 3
			}
		}
	}
}


# peasant inherits title
scripted_trigger character_estates_2_character_trigger = {
	is_alive = yes
	is_ruler = no
	is_adult = yes
	OR = {
		has_estate = estate_type:peasants_estate
		has_estate = estate_type:burghers_estate
	}
	NOT = { any_parent = { is_alive = yes } }
}
character_estates.2 = {
	type = country_event
	title = character_estates.2.title
	desc = character_estates.2.desc
	
	trigger = {
		has_advance = legalism_advance
		government_type = government_type:monarchy
		country_can_ennoble_trigger = yes
		any_character = {
			character_estates_2_character_trigger = yes
		}
	}

	immediate = {
		random_character = {
			limit = {
				character_estates_2_character_trigger = yes
			}
			save_scope_as = target_character
			location = {
				save_scope_as = target_location
			}
		}
	}

	option = {
		name = character_estates.2.a

		add_estate_satisfaction = { type = estate_type:nobles_estate
			value = estate_satisfaction_weak_penalty
		}

		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_right }
		change_societal_value = { type = centralization_vs_decentralization value = societal_value_move_to_right }

		scope:target_character = {
			change_character_estate = estate_type:nobles_estate


			every_descendant = {
				limit = { 
					is_ruler = no
					has_estate = estate_type:peasants_estate
				}
				change_character_estate = estate_type:nobles_estate
			}
		}
	}
	option = {
		name = character_estates.2.b

		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_left }
		change_societal_value = { type = centralization_vs_decentralization value = societal_value_move_to_left }

		add_prestige = prestige_mild_bonus
	}
}


# peasant amasses fortune
scripted_trigger character_estates_3_character_trigger = {
	is_alive = yes
	is_ruler = no
	is_adult = yes
	has_estate = estate_type:peasants_estate
}
character_estates.3 = {
	type = country_event
	title = character_estates.3.title
	desc = character_estates.3.desc
	
	trigger = {
		any_character = {
			character_estates_3_character_trigger = yes
		}
	}

	immediate = {
		random_character = {
			limit = {
				character_estates_3_character_trigger = yes
			}
			save_scope_as = target_character
			location = {
				save_scope_as = target_location
			}
		}
	}

	option = {
		name = character_estates.3.a
		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_right }

		scope:target_character = {
			change_character_estate = estate_type:burghers_estate

			every_descendant = {
				limit = { 
					has_estate = estate_type:peasants_estate
				}
				change_character_estate = estate_type:burghers_estate
			}
		}

		add_gold_to_estate = {
			estate_type = estate_type:burghers_estate
			value = { value = root.estate_tax_base:peasants_estate multiply = 10 }
		}
	}
	option = {
		name = character_estates.3.b

		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_left }

		add_gold_to_estate = {
			estate_type = estate_type:peasants_estate
			value = { value = root.estate_tax_base:peasants_estate multiply = 10 }
		}

		add_stability = stability_mild_bonus
	}
}


# the call of god
scripted_trigger character_estates_4_character_trigger = {
	is_alive = yes
	is_ruler = no
	is_adult = yes
	is_married = no
	religion = root.religion
	OR = {
		religion.group = religion_group:christian
		AND = {
			religion.group = religion_group:muslim
			is_female = no
		}
	}
	NOT = { has_estate = estate_type:clergy_estate }
}
character_estates.4 = {
	type = country_event
	title = character_estates.4.title
	desc = character_estates.4.desc
	
	trigger = {
		any_character = {
			character_estates_4_character_trigger = yes
		}
	}

	illustration_tags = {
		10 = exterior
		10 = happy
	}
	immediate = {
		random_character = {
			limit = {
				character_estates_4_character_trigger = yes
			}
			save_scope_as = target_character
			location = {
				save_scope_as = target_location
			random_pop = {
					limit = { estate_type = estate_type:clergy_estate }
					save_scope_as = target_pop
					save_scope_as = target_pop_bckg
				}
			}
		}
	}

	option = {
		name = character_estates.4.a

		scope:target_character = {
			change_character_estate = estate_type:clergy_estate
		}

		add_estate_satisfaction = { type = estate_type:clergy_estate
			value = estate_satisfaction_weak_bonus
		}
	}
	option = {
		name = character_estates.4.b

		add_prestige = prestige_mild_bonus

		add_estate_satisfaction = { type = estate_type:clergy_estate
			value = estate_satisfaction_mild_penalty
		}
	}
}


# military service
scripted_trigger character_estates_5_character_trigger = {
	is_alive = yes
	is_ruler = no
	is_adult = yes
	OR = {
		AND = {
			is_general = yes
			has_trait_category = general
		}
		AND = {
			is_admiral = yes
			has_trait_category = admiral
		}
	}
	
	NOR = { 
		has_estate = estate_type:nobles_estate
		has_estate = estate_type:clergy_estate
		has_estate = estate_type:crown_estate
	}
}
character_estates.5 = {
	type = country_event
	title = character_estates.5.title
	desc = character_estates.5.desc
	
	trigger = {
		country_can_ennoble_trigger = yes
		any_character = {
			character_estates_5_character_trigger = yes
		}
	}

	illustration_tags = {
		10 = exterior
		10 = armed
	}
	immediate = {
		random_character = {
			limit = {
				character_estates_5_character_trigger = yes
			}
			save_scope_as = target_character
			location = {
				save_scope_as = target_location
			random_pop = {
					limit = { estate_type = estate_type:nobles_estate }
					save_scope_as = target_pop
					save_scope_as = target_pop_bckg
				}
			}
		}
	}

	option = {
		name = character_estates.5.a
		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_right }

		scope:target_character = {
			change_character_estate = estate_type:nobles_estate


			every_descendant = {
				limit = { 
					is_ruler = no
					NOR = { 
						has_estate = estate_type:nobles_estate
						has_estate = estate_type:clergy_estate
						has_estate = estate_type:crown_estate
					}
				}
				change_character_estate = estate_type:nobles_estate
			}
		}
	}
	option = {
		name = character_estates.5.b

		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_move_to_left }

		add_prestige = prestige_mild_bonus
	}
}
