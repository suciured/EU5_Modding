namespace = dissolution_of_delhi

dissolution_of_delhi.1 = {
	image = "gfx/interface/illustrations/situation/fall_of_delhi.dds"
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.1.title
	desc = dissolution_of_delhi.1.desc

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
	}

	option = {
		name = dissolution_of_delhi.1.a
		add_stability = stability_extreme_penalty
		add_government_power = government_power_extreme_penalty
		custom_tooltip = all_estates_lose_20_loyalty_tt
		if = {
			limit = { country_rank = country_rank:rank_empire }
			set_country_rank = country_rank:rank_kingdom
		}
		else_if = {
			limit = { country_rank = country_rank:rank_kingdom }
			set_country_rank = country_rank:rank_duchy
		}
		hidden_effect = {
			add_estate_satisfaction = { type = estate_type:nobles_estate 
				value = estate_satisfaction_extreme_penalty 
			}
			add_estate_satisfaction = { type = estate_type:burghers_estate 
				value = estate_satisfaction_extreme_penalty 
			}
			add_estate_satisfaction = { type = estate_type:peasants_estate 
				value = estate_satisfaction_extreme_penalty 
			}
			add_estate_satisfaction = { type = estate_type:clergy_estate 
				value = estate_satisfaction_extreme_penalty 
			}
		}
	}
}

dissolution_of_delhi.2 = {
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.2.title
	desc = dissolution_of_delhi.2.desc

	trigger = {
		any_province = {
			province_satisfaction < 0.5
			NOT = {
				any_location_in_province = { has_variable = local_event_timer }
			}
		}
	}

	immediate = {
		random_province = {
			limit = {
				province_satisfaction < 0.5
			}
			save_scope_as = target_province
		}
		ordered_owned_location = {
			limit = { province = scope:target_province }
			order_by = population
			check_range_bounds = no
			save_scope_as = target_location
			set_variable = {
				name = local_event_timer
				value = yes 
				years = 1
			}
		}
	}

	option = {
		name = dissolution_of_delhi.2.a
		
		trigger = {
			scope:target_location = {
				any_pop = { pop_type = pop_type:nobles }
			}
		}

		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_tiny_move_to_left }
		add_estate_satisfaction = { type = estate_type:nobles_estate 
			value = estate_satisfaction_weak_bonus
		}
		scope:target_location = {
			random_pop = {
				limit = {
					owner = root
					pop_type = pop_type:peasants
				}
				add_pop_satisfaction = pop_satisfaction_extreme_penalty
			}
			random_pop = {
				limit = {
					owner = root
					pop_type = pop_type:nobles
				}
				add_pop_satisfaction = pop_satisfaction_mild_bonus
			}
		}
		scope:target_location.province = {
			every_location_in_province = {
				change_control = control_mild_penalty
			}
		}
	}

	option = {
		name = dissolution_of_delhi.2.b
		
		trigger = {
			scope:target_location = {
				any_pop = { pop_type = pop_type:burghers }
			}
		}

		change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_tiny_move_to_right }
		add_estate_satisfaction = { type = estate_type:burghers_estate 
			value = estate_satisfaction_weak_bonus 
		}
		scope:target_location = {
			random_pop = {
				limit = {
					owner = root
					pop_type = pop_type:peasants
				}
				add_pop_satisfaction = pop_satisfaction_extreme_penalty
			}
			random_pop = {
				limit = {
					owner = root
					pop_type = pop_type:burghers
				}
				add_pop_satisfaction = pop_satisfaction_mild_bonus
			}
		}
		scope:target_location.province = {
			every_location_in_province = {
				change_control = control_mild_penalty
			}
		}
	}

	option = {
		name = dissolution_of_delhi.2.c
		
		change_gold_effect = { scale = -1 }
		add_stability = stability_weak_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate 
			value = estate_satisfaction_mild_penalty
		}
		add_estate_satisfaction = { type = estate_type:burghers_estate 
			value = estate_satisfaction_mild_penalty
		}
		scope:target_location = {
			random_pop = {
				limit = {
					owner = root
					pop_type = pop_type:peasants
				}
				add_pop_satisfaction = pop_satisfaction_extreme_bonus
			}
		}
		scope:target_location.province = {
			every_location_in_province = {
				change_control = control_weak_bonus
			}
		}
	}
}

dissolution_of_delhi.3 = {
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.3.title
	desc = dissolution_of_delhi.3.desc

	trigger = {
		OR = {
			estate_satisfaction:nobles_estate < 0.50
			estate_satisfaction:burghers_estate < 0.50
			estate_satisfaction:clergy_estate < 0.50
			estate_satisfaction:peasants_estate < 0.50
		}
	}

	immediate = {
		random_list = {
			25 = {
				trigger = { estate_satisfaction:nobles_estate < 0.50 }
				set_variable = { name = nobles_dissatisfied_variable value = yes days = 3 }
			}
			25 = {
				trigger = { estate_satisfaction:burghers_estate < 0.50 }
				set_variable = { name = burghers_dissatisfied_variable value = yes days = 3 }
			}
			25 = {
				trigger = { estate_satisfaction:clergy_estate < 0.50 }
				set_variable = { name = clergy_dissatisfied_variable value = yes days = 3 }
			}
			25 = {
				trigger = { estate_satisfaction:peasants_estate < 0.50 }
				set_variable = { name = peasants_dissatisfied_variable value = yes days = 3 }
			}
		}
	}

	option = {
		name = dissolution_of_delhi.3.a

		change_gold_effect = { scale = -1 }
		if = {
			limit = { has_variable = nobles_dissatisfied_variable }
			change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_tiny_move_to_left }
			add_gold_to_estate = {
				estate_type = estate_type:nobles_estate
				value = monthly_income_trade_and_tax
			}
			add_estate_satisfaction = { type = estate_type:nobles_estate 
				value = estate_satisfaction_mild_bonus 
			}
		}
		else_if = {
			limit = { has_variable = burghers_dissatisfied_variable }
			change_societal_value = { type = aristocracy_vs_plutocracy value = societal_value_tiny_move_to_right }
			add_gold_to_estate = {
				estate_type = estate_type:burghers_estate
				value = monthly_income_trade_and_tax
			}
			
			add_estate_satisfaction = { type = estate_type:burghers_estate 
				value = estate_satisfaction_mild_bonus 
			}
		}
		else_if = {
			limit = { has_variable = clergy_dissatisfied_variable }
			change_societal_value = { type = spiritualist_vs_humanist value = societal_value_tiny_move_to_left }
			add_gold_to_estate = {
				estate_type = estate_type:clergy_estate
				value = monthly_income_trade_and_tax
			}
			add_estate_satisfaction = { type = estate_type:clergy_estate 
				value = estate_satisfaction_mild_bonus 
			}
		}
		else_if = {
			limit = { has_variable = peasants_dissatisfied_variable }
			change_societal_value = { type = serfdom_vs_free_subjects value = societal_value_tiny_move_to_left }
			add_gold_to_estate = {
				estate_type = estate_type:peasants_estate
				value = monthly_income_trade_and_tax
			}
			add_estate_satisfaction = { type = estate_type:peasants_estate 
				value = estate_satisfaction_mild_bonus
			}
		}
		add_stability = stability_weak_bonus
	}

	option = {
		name = dissolution_of_delhi.3.b
		
		add_government_power = government_power_weak_bonus
		if = {
			limit = { has_variable = nobles_dissatisfied_variable }
			add_estate_satisfaction = { type = estate_type:nobles_estate 
				value = estate_satisfaction_mild_penalty 
			}
		}
		else_if = {
			limit = { has_variable = burghers_dissatisfied_variable }			
			add_estate_satisfaction = { type = estate_type:burghers_estate 
				value = estate_satisfaction_mild_penalty 
			}
		}
		else_if = {
			limit = { has_variable = clergy_dissatisfied_variable }
			add_estate_satisfaction = { type = estate_type:clergy_estate 
				value = estate_satisfaction_mild_penalty 
			}
		}
		else = {
			add_estate_satisfaction = { type = estate_type:peasants_estate 
				value = estate_satisfaction_mild_penalty
			}
		}
	}
}

dissolution_of_delhi.4 = {
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.4.title
	desc = dissolution_of_delhi.4.desc

	trigger = {
		any_province = {
			province_satisfaction < 0.5
			NOT = {
				any_location_in_province = { has_variable = local_event_timer }
			}
		}
	}

	immediate = {
		random_province = {
			limit = { province_satisfaction < 0.5 }
			save_scope_as = target_province
		}
		ordered_owned_location = {
			limit = { province = scope:target_province }
			order_by = population
			check_range_bounds = no
			save_scope_as = target_location
			set_variable = {
				name = local_event_timer
				value = yes 
				years = 1
			}
		}
		if = {
			limit = {
				any_province ?= {
					this != scope:target_province
					province_food >= 100
				}
			}
			random_province = {
				limit = {
					this != scope:target_province
					province_food >= 100
				}
				save_scope_as = target_province2
			}
		}
	}

	option = {
		name = dissolution_of_delhi.4.a

		trigger = {
			exists = scope:target_province2
		}
		
		change_gold_effect = { scale = -1 }
		add_stability = stability_weak_bonus
		add_government_power = government_power_weak_bonus
		scope:target_province2 = { change_province_food = -100 }
		custom_tooltip = target_province_peasants_get_20_satisfaction_tt
		scope:target_province = { change_province_food = 100 }
		hidden_effect = {
			scope:target_province = {
				change_province_food = 100
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							pop_type = pop_type:peasants
						}
						add_pop_satisfaction = pop_satisfaction_severe_bonus
					}
				}
			}
		}
	}

	option = {
		name = dissolution_of_delhi.4.b
		
		custom_tooltip = target_province_peasants_lose_10_satisfaction_tt
		hidden_effect = {
			scope:target_province = {
				change_prosperity = prosperity_weak_penalty
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							pop_type = pop_type:peasants
						}
						add_pop_satisfaction = pop_satisfaction_mild_penalty
					}
				}
			}
		}
	}
}

dissolution_of_delhi.5 = {
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.5.title
	desc = dissolution_of_delhi.5.desc

	trigger = {
		any_province = {
			NOT = {
				any_location_in_province = { has_variable = local_event_timer }
			}
		}
	}

	immediate = {
		ordered_province = {
			limit = {
				NOT = {
					any_location_in_province = { has_variable = local_event_timer }
				}
			}
			order_by = {
				value = province_satisfaction
				multiply = -1
			}
			save_scope_as = target_province
		}
		scope:target_province = {
			ordered_location_in_province = {
				max = 1 
				order_by = population
				check_range_bounds = no
				save_scope_as = target_location
				set_variable = {
					name = local_event_timer
					value = yes 
					years = 1
				}
			}
		}
	}
	option = {
		name = dissolution_of_delhi.5.a

		trigger = {
			scope:location = {
				any_pop = { pop_type = pop_type:nobles }
			}
		}
		
		scope:target_location = {
			random_pop = {
				limit = {
					pop_type = pop_type:nobles
				}
				add_pop_size = {
					value = pop_size
					multiply = -0.5
				}
			}
		}
		add_government_power = government_power_mild_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate 
			value = estate_satisfaction_extreme_penalty
		}
		custom_tooltip = target_province_peasants_get_20_satisfaction_tt
		custom_tooltip = target_province_nobles_lose_25_satisfaction_tt
		hidden_effect = {
			scope:target_province = {
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							pop_type = pop_type:peasants
						}
						add_pop_satisfaction = pop_satisfaction_severe_bonus
					}
					every_pop = {
						limit = {
							owner = root
							pop_type = pop_type:nobles
						}
						add_pop_satisfaction = pop_satisfaction_extreme_penalty
					}
				}
			}
		}
	}

	option = {
		name = dissolution_of_delhi.5.b
		
		add_estate_satisfaction = { type = estate_type:nobles_estate 
			value = estate_satisfaction_weak_bonus
		}
		add_stability = stability_weak_bonus
		if = {
			limit = {
				scope:target_province = {
					any_location_in_province = {
						any_pop = { pop_type = pop_type:nobles }
					}
				}
			}
			custom_tooltip = target_province_nobles_gain_20_satisfaction_tt
			hidden_effect = {
				scope:target_province = {
					every_location_in_province = {
						every_pop = {
							limit = {
								owner = root
								pop_type = pop_type:nobles
							}
							add_pop_satisfaction = pop_satisfaction_extreme_bonus
						}
					}
				}
			}
		}
		custom_tooltip = target_province_peasants_lose_25_satisfaction_tt
		hidden_effect = {
			scope:target_province = {
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							pop_type = pop_type:peasants
						}
						add_pop_satisfaction = pop_satisfaction_extreme_penalty
					}
				}
			}
		}
	}
}

dissolution_of_delhi.6 = {	#Coinage Loses Value
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.6.title
	desc = dissolution_of_delhi.6.desc

	trigger = {
		inflation >= 0.1
		OR = {
			AND = {
				has_country_modifier = allowed_provincial_barter_markets
				has_country_modifier = dlh_coinage_reforms_modifier
				inflation >= 0.2
			}
			NOR = {
				has_country_modifier = allowed_provincial_barter_markets
				has_country_modifier = dlh_coinage_reforms_modifier
			}
		}
	}

	option = {	#Print More
		name = dissolution_of_delhi.6.a
		
		add_inflation = inflation_mild_penalty
		add_stability = stability_weak_bonus
	}

	option = {	#Allow barter
		name = dissolution_of_delhi.6.b
		
		add_country_modifier = {
			modifier = allowed_provincial_barter_markets
			mode = add_and_extend
			years = 2
		}
	}

	option = {	#Push for reforms
		name = dissolution_of_delhi.6.c
		
		add_country_modifier = {
			modifier = dlh_coinage_reforms_modifier
			mode = add_and_extend
			years = 2
		}
		add_stability = stability_extreme_penalty
		add_government_power = government_power_mild_bonus
	}
}

dissolution_of_delhi.7 = {
	type = country_event
	category = disaster_event

	title = dissolution_of_delhi.7.title
	desc = dissolution_of_delhi.7.desc

	option = {
		name = dissolution_of_delhi.7.a

		add_country_modifier = {
			modifier = dlh_restored_authority_modifier
			years = 20
			mode = add_and_extend
		}
		add_inflation = inflation_mild_bonus
	}
}

