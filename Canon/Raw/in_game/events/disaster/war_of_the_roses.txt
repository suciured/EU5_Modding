namespace = war_of_the_roses
war_of_the_roses.1 = {
	hide_portraits = yes
	type = country_event
	category = disaster_event
	title = war_of_the_roses.1.title
	desc = war_of_the_roses.1.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	immediate = {
		create_rebel = {
			category = pretender
			name = york_rebel_name
			destroy = no

			save_scope_as = york_rebel
		}

		create_rebel = {
			category = pretender
			name = lancaster_rebel_name
			destroy = no

			save_scope_as = lancaster_rebel
		}
		
	}

	option = {
		name = war_of_the_roses.1.a
		add_stability = stability_ultimate_penalty
		
		if = {
			limit = {
				dynasty:lancaster_dynasty = {
					exists = dynasty_head
				}
			}
			set_as_designated_heir = {
				target = "dynasty:lancaster_dynasty.dynasty_head"
				reason = preferred_heir_of_ruler
			}
		}

		set_variable = { name = supports_house_of_lancaster value = 1 }

		dynasty:york_dynasty = {
			dynasty_head ?= {
				change_character_allegiance = scope:york_rebel
			}
		}


		hidden_effect = {
			destroy_rebel = scope:lancaster_rebel
			dynasty:york_dynasty = {
				every_character_in_dynasty = {
					limit = {
						this != prev.dynasty_head
					}
					change_character_allegiance = scope:york_rebel
				}
			}

		}


		custom_tooltip = {
			text = york_rebels_joining
			every_owned_location = {
				limit = {
					province_definition = province_definition:north_riding_province
				}
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					change_pop_allegiance = scope:york_rebel
				}
			}		

		}

	}
	option = {
		name = war_of_the_roses.1.b
		add_stability = stability_ultimate_penalty
		
		if = {
			limit = {
				dynasty:york_dynasty = {
					exists = dynasty_head
				}
			}
			set_as_designated_heir = {
				target = "dynasty:york_dynasty.dynasty_head"
				reason = preferred_heir_of_ruler
			}
		}
		
		set_variable = { name = supports_house_of_york value = 1 }
		
		dynasty:lancaster_dynasty = {
			dynasty_head ?= {
				change_character_allegiance = scope:lancaster_rebel
			}
		}

		
		hidden_effect = {
			destroy_rebel = scope:york_rebel
			dynasty:lancaster_dynasty = {
				every_character_in_dynasty = {
					limit = {
						this != prev.dynasty_head
					}
					change_character_allegiance = scope:lancaster_rebel
				}
			}
		}



		custom_tooltip = {
			text = lancaster_rebels_joining
			every_owned_location = {
				limit = {
					province_definition = province_definition:lancashire_province
				}
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					change_pop_allegiance = scope:lancaster_rebel
				}
			}		

		}
		
	}
}

war_of_the_roses.2 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.2.title
	desc = war_of_the_roses.2.desc
	trigger = {
		any_owned_location = {
			any_pop = {
				rebel ?= { rebel_category = pretender }
			}
		}
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	immediate = {
		random_owned_location = {
			limit = {
				any_pop = {
					rebel ?= { rebel_category = pretender }
				}
			}
			random_pop = {
				limit = {
					rebel ?= { rebel_category = pretender }
				}
				save_scope_as = target_pop
			}
		}
	}

	option = {
		name = war_of_the_roses.2.a
		scope:target_pop = {
			remove_pop_allegiance = no_arg
		}
	}
}

war_of_the_roses.3 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.3.title
	desc = war_of_the_roses.3.desc
	trigger = {
		has_variable = supports_house_of_york
		exists = scope:lancaster_rebel
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	immediate = {
		random_owned_location = {
			limit = {
				any_pop = {
					rebel != scope:lancaster_rebel
				}
			}
			save_scope_as = disloyal_target
		}
	}

	option = {
		name = war_of_the_roses.3.a
		
		scope:disloyal_target = {
			ordered_pop = {
				limit = {
					owner = root
					rebel != scope:lancaster_rebel
				}
				order_by = pop_size
				max = 1
				
				add_pop_satisfaction = pop_satisfaction_ultimate_penalty
				change_pop_allegiance = scope:lancaster_rebel
			}
		}

	}
}

war_of_the_roses.4 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.4.title
	desc = war_of_the_roses.4.desc
	trigger = {
		has_variable = supports_house_of_lancaster
		exists = scope:york_rebel
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	immediate = {
		random_owned_location = {
			limit = {
				any_pop = {
					rebel != scope:york_rebel
				}
			}
			save_scope_as = disloyal_target
		}
	}

	

	option = {
		name = war_of_the_roses.4.a
		
		scope:disloyal_target = {
			ordered_pop = {
				limit = {
					owner = root
					rebel != scope:york_rebel
				}
				order_by = pop_size
				max = 1
				
				add_pop_satisfaction = pop_satisfaction_ultimate_penalty
				change_pop_allegiance = scope:york_rebel
			}
		}
	}
}

war_of_the_roses.5 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.5.title
	desc = war_of_the_roses.5.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	option = {
		name = war_of_the_roses.5.a
		add_gold_to_estate = {
			estate_type = estate_type:nobles_estate
			value = { value = root.monthly_income_trade_and_tax	multiply = 3	}
		}
		change_gold_effect = { scale = -3.00 }
	}
	option = {
		name = war_of_the_roses.5.b
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_penalty }
	}
}


scripted_trigger valid_dynasty_alternative = {
	this != dynasty:york_dynasty
	this != dynasty:lancaster_dynasty
	this != dynasty:plantagenet_dynasty
	dynasty_head ?= {
		is_adult = yes
		is_female = no
		NOT = { exists = rebel }
		NOT = { has_variable = wor_kingmaker }
	}
}

war_of_the_roses.6 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.6.title
	desc = war_of_the_roses.6.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	trigger = {
		any_dynasty = {
			valid_dynasty_alternative = yes
		}
	}
	
	immediate = {
		random_dynasty = {
			limit = {
				valid_dynasty_alternative = yes
			}
			dynasty_head = {
				set_variable = { name = wor_kingmaker value = 1}
				save_scope_as = kingmaker
			}
		}
		
	}

	option = {
		name = war_of_the_roses.6.a
		if = {
			limit = {
				has_variable = supports_house_of_lancaster
			}
			scope:kingmaker = {	
				change_character_allegiance = scope:york_rebel
			}
		}
		if = {
			limit = {
				has_variable = supports_house_of_york
			}
			scope:kingmaker = {	
				change_character_allegiance = scope:lancaster_rebel
			}
		}
	}
	option = {
		name = war_of_the_roses.6.b
		trigger = {
			num_loans <= 0
			legitimacy > 40
			
		}
		add_gold = { 
			value = root.monthly_income_trade_and_tax
			multiply = {
				value = 110
				subtract = legitimacy
				divide = -10
			}
		}
		
		if = {
			limit = {
				has_variable = supports_house_of_lancaster
			}
			scope:york_rebel = {	
				add_rebel_progress = -0.25
			}
		}
		if = {
			limit = {
				has_variable = supports_house_of_york
			}
			scope:lancaster_rebel = {	
				add_rebel_progress = -0.25
			}
		}
		
	}
	
}


war_of_the_roses.8 = {
	type = country_event
	category = disaster_event
	fire_only_once = yes
	title = war_of_the_roses.8.title
	desc = war_of_the_roses.8.desc
	trigger = {
		legitimacy < 70
		prestige > 10
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	option = {
		name = war_of_the_roses.8.a
		change_gold_effect = { scale = -3 }
	}
	option = {
		name = war_of_the_roses.8.b
		add_prestige = prestige_mild_penalty
	}
}

war_of_the_roses.9 = {
	type = country_event
	category = disaster_event
	fire_only_once = yes
	title = war_of_the_roses.9.title
	desc = war_of_the_roses.9.desc
	trigger = {
		any_owned_location = {
			average_satisfaction < 0.4
			AND = {
					region != region:great_britain_region
					region != region:ireland_region
			}
		}
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	immediate = {
		random_owned_location = {
			limit = {
				average_satisfaction < 0.4
				AND = {
					region != region:great_britain_region
					region != region:ireland_region
				}
			}
			save_scope_as = target_location
		}
	}
		

	option = {
		name = war_of_the_roses.9.a
		add_gold = { 
			value = scope:target_location.location_tax_base
			multiply = -2
		}
		add_prestige = prestige_weak_penalty
	}
	option = {
		name = war_of_the_roses.9.b
		scope:target_location = {
			every_pop = {	add_pop_satisfaction = pop_satisfaction_severe_penalty	}
		}
	}
}

war_of_the_roses.12 = {
	hide_portraits = yes
	type = country_event
	category = disaster_event
	title = war_of_the_roses.12.title
	desc = war_of_the_roses.12.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	option = {
		name = war_of_the_roses.12.a
		trigger = {
			manpower > root.monthly_manpower
		}
		add_manpower = { value = root.monthly_manpower multiply = -6 }
		save_scope_as = from
		c:ENG = {
			trigger_event_silently = war_of_the_roses.14
		}
		set_variable = { name = supports_house_of_lancaster value = 1}
		custom_tooltip = wotr_lan_rebels_will_progress
	}
	option = {
		name = war_of_the_roses.12.b
		trigger = {
			is_during_bankruptcy = no
		}
		save_scope_as = from
		change_gold_effect = { scale = -6 }
		c:ENG = {
			trigger_event_silently = war_of_the_roses.14
		}
		set_variable = { name = supports_house_of_lancaster value = 1}
		custom_tooltip = wotr_lan_rebels_will_progress
	}
	option = {
		name = war_of_the_roses.12.c
		add_prestige = prestige_mild_bonus
	}
}

war_of_the_roses.13 = {
	hide_portraits = yes
	type = country_event
	category = disaster_event
	title = war_of_the_roses.13.title
	desc = war_of_the_roses.13.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	option = {
		name = war_of_the_roses.13.a
		trigger = {
			manpower > root.monthly_manpower
		}
		add_manpower = { value = root.monthly_manpower multiply = -6 }
		save_scope_as = from
		c:ENG = {
			trigger_event_silently = war_of_the_roses.14
		}
		set_variable = { name = supports_house_of_york value = 1}
		custom_tooltip = wotr_yor_rebels_will_progress
	}
	option = {
		name = war_of_the_roses.13.b
		trigger = {
			is_during_bankruptcy = no
		}
		change_gold_effect = { scale = -6 }
		save_scope_as = from
		c:ENG = {
			trigger_event_silently = war_of_the_roses.14
		}
		custom_tooltip = wotr_yor_rebels_will_progress
		set_variable = { name = supports_house_of_york value = 1}
	}
	option = {
		name = war_of_the_roses.13.c
		add_prestige = prestige_mild_bonus
	}
}

war_of_the_roses.14 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.14.title
	desc = war_of_the_roses.14.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	option = {
		name = war_of_the_roses.14.a
		
		if = {
			limit = {
				has_variable = supports_house_of_york
			}
			scope:lancaster_rebel ?= {
				add_rebel_progress = rebel_progress_weak_bonus
			}
		}
		
		if = {
			limit = {
				has_variable = supports_house_of_lancaster
			}
			scope:york_rebel ?= {
				add_rebel_progress = rebel_progress_weak_bonus
			}
		}
	}
}


scripted_trigger valid_lancaster_growth = {
	any_location_in_province = {
		any_pop = {
			rebel = scope:lancaster_rebel
		}
	}
	any_location_in_province = {
		any_pop = {
			rebel != scope:lancaster_rebel
		}
	}
}


war_of_the_roses.15 = {
	type = country_event
	category = disaster_event
	title = {
		first_valid = {
			triggered_desc = {
				desc = war_of_the_roses.15.title
				trigger = { exists = scope:disloyal_target }
			}
			triggered_desc = {
				desc = war_of_the_roses.15.title.fallback
				trigger = { always = yes }
			}
		}
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	desc = war_of_the_roses.15.desc
	trigger = {
		has_variable = supports_house_of_york
		exists = scope:lancaster_rebel
		any_province = {
			valid_lancaster_growth = yes
		}
	}


	immediate = {
		random_province = {
			limit = {
				valid_lancaster_growth = yes
			}
			save_scope_as = disloyal_target
		}
	}

	option = {
		name = war_of_the_roses.15.a
		
		scope:disloyal_target = {
			every_location_in_province = {
				every_pop = {
					limit = {
						owner = root
						rebel != scope:lancaster_rebel
					}
					add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					change_pop_allegiance = scope:lancaster_rebel
				}
			}
		}
	}
}


scripted_trigger valid_york_growth = {
	any_location_in_province = {
		any_pop = {
			rebel = scope:york_rebel
		}
	}
	any_location_in_province = {
		any_pop = {
			rebel != scope:york_rebel
		}
	}
}


war_of_the_roses.16 = {
	type = country_event
	category = disaster_event
	title = {
		first_valid = {
			triggered_desc = {
				desc = war_of_the_roses.16.title
				trigger = { exists = scope:disloyal_target }
			}
			triggered_desc = {
				desc = war_of_the_roses.16.title.fallback
				trigger = { always = yes }
			}
		}
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	desc = war_of_the_roses.16.desc
	trigger = {
		has_variable = supports_house_of_york
		exists = scope:york_rebel
		any_province = {
			valid_york_growth = yes
		}
	}


	immediate = {
		random_province = {
			limit = {
				valid_york_growth = yes
			}
			save_scope_as = disloyal_target
		}
	}

	option = {
		name = war_of_the_roses.16.a
		
		scope:disloyal_target = {
			every_location_in_province = {
				every_pop = {
					limit = {
						owner = root
						rebel != scope:york_rebel
					}
					add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					change_pop_allegiance = scope:york_rebel
				}
			}
		}
	}
}

war_of_the_roses.17 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.17.title
	desc = war_of_the_roses.17.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"
	immediate = {
		scope:target_siege = { 
			save_scope_as = target_siege	
			change_garrison_size = -2000
		}
	}

	option = {
		name = war_of_the_roses.17.a
		
		custom_tooltip = chosen_siege_tt
	}
}

war_of_the_roses.18 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.18.title
	desc = war_of_the_roses.18.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	trigger = {
		any_active_disaster = {
			disaster_type = disaster_type:war_of_the_roses
			disaster_is_active = yes
		}
		has_ruler = yes
		ruler = { has_dynasty = yes }
		in_civil_war = yes
	}

	immediate = {
		set_variable = wotr_bribe_garrison_variable
		ruler = { 
			save_scope_as = target_character 
			dynasty = { save_scope_as = target_dynasty }
		}
	}

	option = {
		name = war_of_the_roses.18.a
		
		custom_tooltip = wotr_explain_action_tt
	}
}


war_of_the_roses.100 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.100.title
	desc = war_of_the_roses.100.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	option = {
		name = war_of_the_roses.100.a
		add_stability = stability_extreme_bonus
		add_prestige = prestige_weak_bonus
		
		hidden_effect = {
			if = {
				limit = {
					ruler.dynasty = dynasty:york_dynasty
				}
				every_country = {
					limit = {
						has_variable = supports_house_of_york
					}
					trigger_event_silently = { id = war_of_the_roses.103 }
				}
				remove_variable = supports_house_of_york
			}
			
			if = {
				limit = {
					ruler.dynasty = dynasty:lancaster_dynasty
				}
				every_country = {
					limit = {
						has_variable = supports_house_of_lancaster
					}
					trigger_event_silently = { id = war_of_the_roses.103 }
				}
				remove_variable = supports_house_of_lancaster
			}
			
			if = {
				limit = {
					ruler.dynasty = dynasty:york_dynasty
				}
				every_country = {
					limit = {
						has_variable = supports_house_of_lancaster
					}
					trigger_event_silently = { id = war_of_the_roses.104 }
				}
				remove_variable = supports_house_of_lancaster
			}
			
			
			if = {
				limit = {
					ruler.dynasty = dynasty:lancaster_dynasty
				}
				every_country = {
					limit = {
						has_variable = supports_house_of_york
					}
					trigger_event_silently = { id = war_of_the_roses.105 }
				}
				remove_variable = supports_house_of_york
			}
			
		}
	}
}


war_of_the_roses.103 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.103.title
	desc = war_of_the_roses.103.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	option = {
		name = war_of_the_roses.103.a
		c:ENG = {
			add_opinion = { target = root modifier = eng_support_during_war_of_the_roses }
		}
	}
}

war_of_the_roses.104 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.104.title
	desc = war_of_the_roses.104.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	option = {
		name = war_of_the_roses.104.a
		c:ENG = {
			add_opinion = { target = root modifier = eng_supported_rebels_during_war_of_the_roses }
		}
	}
}

war_of_the_roses.105 = {
	type = country_event
	category = disaster_event
	title = war_of_the_roses.105.title
	desc = war_of_the_roses.105.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_roses.dds"

	option = {
		name = war_of_the_roses.105.a
		c:ENG = {
			add_opinion = { target = root modifier = eng_supported_rebels_during_war_of_the_roses }
		}
	}
}





