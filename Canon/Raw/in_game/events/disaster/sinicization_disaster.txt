namespace = sinicization_disaster

scripted_effect chi_scopes = {
	if = {
		limit = {
			country_exists = c:CHI
			OR = {
				NOT = { exists = international_organization:middle_kingdom }
				c:CHI = { is_leader_of_international_organization = international_organization:middle_kingdom }
			}
		}
		c:CHI = {
			culture = { save_scope_as = chi_culture_scope }
			court_language = { save_scope_as = chi_language_scope }
			save_scope_as = target_emperor_scope
		}
	}
	else = {
		international_organization:middle_kingdom.leader_country = {
			culture = { save_scope_as = chi_culture_scope }
			court_language = { save_scope_as = chi_language_scope }
			save_scope_as = target_emperor_scope
		}
	}
}

sinicization_disaster.1 = {
	type = country_event
	category = disaster_event
	title = sinicization_disaster.1.title
	desc = sinicization_disaster.1.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	immediate = {
		root.capital.area = {
			save_scope_as = target_capital_area
		}
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.1.a

		add_opinion = {
			target = scope:target_emperor_scope
			modifier = opinion_accepted_chinese_influences
		}
		reverse_add_opinion = {
			target = scope:target_emperor_scope
			modifier = opinion_accepted_chinese_influences
		}
		custom_tooltip = chi_may_be_sympathetic_tt
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 5
			}
		}
	}

	option = {
		name = sinicization_disaster.1.b

		add_opinion = {
			target = scope:target_emperor_scope
			modifier = opinion_denied_chinese_influences
		}
		reverse_add_opinion = {
			target = scope:target_emperor_scope
			modifier = opinion_denied_chinese_influences
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side 
				add = 5
			}
		}
	}
}

sinicization_disaster.2 = { #Cabinet Member Holds Chinese Sympathies
	type = country_event
	category = disaster_event
	title = sinicization_disaster.2.title
	desc = sinicization_disaster.2.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	trigger = {
		exists = scope:target_emperor_scope.culture
		any_cabinet_character ?= {
			not = { culture ?= scope:target_emperor_scope.culture }
			not = { has_variable = character_cooldown_variable }
		}
	}

	immediate = {
		chi_scopes = yes
		random_cabinet_character = {
			limit = { 
				not = { culture ?= scope:target_emperor_scope.culture }
				not = { has_variable = character_cooldown_variable }
			}
			save_scope_as = target_character
			set_variable = {
				name = character_cooldown_variable
				value = yes
				years = 2
			}
		}
	}

	option = {
		name = sinicization_disaster.2.a

		add_government_power = government_power_weak_penalty
		add_stability = stability_weak_penalty
		scope:target_emperor_scope.culture = { 
			add_cultural_influence = {
				value = scope:target_character.total_abilities
				divide = 30
				min = 1
			}
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 2
			}
		}
	}

	option = {
		name = sinicization_disaster.2.b

		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}
		scope:target_character = {
			move_country = scope:target_emperor_scope
		}
		add_prestige = prestige_weak_bonus
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 2
			}
		}
	}

	option = {
		name = sinicization_disaster.2.c

		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_move_to_right
		}
		if = {
			limit = {  exists = scope:target_character }
			kill_character = {
				target = scope:target_character
				reason = execution
			}
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 3
			}
		}
	}
}

sinicization_disaster.3 = { #Clergy Resist Sinicization
	type = country_event
	category = disaster_event
	title = sinicization_disaster.3.title
	desc = sinicization_disaster.3.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	trigger = {
		OR = {
			estate_satisfaction:clergy_estate < 0.5
			"estate_power(estate_type:clergy_estate)" > 0.5
		}
	}

	immediate = {
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.3.a

		add_government_power = {
			value = "root.estate_power(estate_type:clergy_estate)"
			multiply = -100
			min = -3
			max = -10
		}
		add_estate_satisfaction = { type = estate_type:clergy_estate
			value = {
				value = "root.estate_power(estate_type:clergy_estate)"
				multiply = 100
				min = 0.05
				max = 0.25
			}
		}
		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 3
			}
		}
	}

	option = {
		name = sinicization_disaster.3.b
		
		add_stability = stability_weak_penalty
		add_estate_satisfaction = { type = estate_type:clergy_estate
			value = {
				value = "root.estate_power(estate_type:clergy_estate)"
				multiply = -100
				min = -0.25
				max = -0.05
			}
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 3
			}
		}
	}
}

sinicization_disaster.4 = { #Nobles Resist Sinicization
	type = country_event
	category = disaster_event
	title = sinicization_disaster.4.title
	desc = sinicization_disaster.4.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	trigger = {
		OR = {
			estate_satisfaction:nobles_estate < 0.5
			"estate_power(estate_type:nobles_estate)" > 0.5
		}
	}

	immediate = {
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.4.a

		add_government_power = {
			value = "root.estate_power(estate_type:nobles_estate)"
			multiply = -100
			min = -3
			max = -10
		}
		add_estate_satisfaction = { type = estate_type:nobles_estate
			value = {
				value = "root.estate_power(estate_type:nobles_estate)"
				multiply = 100
				max = 0.25
				min = 0.05
			}
		}
		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 3
			}
		}
	}

	option = {
		name = sinicization_disaster.4.b
		
		add_stability = stability_weak_penalty
		add_estate_satisfaction = { type = estate_type:nobles_estate
			value = {
				value = "root.estate_power(estate_type:nobles_estate)"
				multiply = -100
				max = -0.05
				min = -0.25
			}
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 3
			}
		}
	}
}

sinicization_disaster.5 = { #Burghers Resist Sinicization
	type = country_event
	category = disaster_event
	title = sinicization_disaster.5.title
	desc = sinicization_disaster.5.desc
	
	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	trigger = {
		OR = {
			estate_satisfaction:burghers_estate < 0.5
			"estate_power(estate_type:burghers_estate)" > 0.5
		}
	}

	immediate = {
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.5.a

		add_government_power = {
			value = "root.estate_power(estate_type:burghers_estate)"
			multiply = -100
			min = -3
			max = -10
		}
		add_estate_satisfaction = { type = estate_type:burghers_estate
			value = {
				value = "root.estate_power(estate_type:burghers_estate)"
				multiply = 100
				max = 0.25
				min = 0.05
			}
		}
		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 3
			}
		}
	}

	option = {
		name = sinicization_disaster.5.b
		
		add_stability = stability_weak_penalty
		add_estate_satisfaction = { type = estate_type:burghers_estate
			value = {
				value = "root.estate_power(estate_type:burghers_estate)"
				multiply = -100
				max = -0.05
				min = -0.25
			}
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 3
			}
		}
	}
}

sinicization_disaster.6 = { #Peasants Resist Sinicization
	type = country_event
	category = disaster_event
	title = sinicization_disaster.6.title
	desc = sinicization_disaster.6.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"
	
	trigger = {
		OR = {
			estate_satisfaction:peasants_estate < 0.5
			"estate_power(estate_type:peasants_estate)" > 0.5
		}
	}

	immediate = {
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.6.a

		add_government_power = {
			value = "root.estate_power(estate_type:peasants_estate)"
			multiply = -100
			min = -3
			max = -10
		}
		add_estate_satisfaction = { type = estate_type:peasants_estate
			value = {
				value = "root.estate_power(estate_type:peasants_estate)"
				multiply = 100
				min = 0.05
				max = 0.25
			}
		}
		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 3
			}
		}
	}

	option = {
		name = sinicization_disaster.6.b
		
		add_stability = stability_weak_penalty
		add_estate_satisfaction = { type = estate_type:peasants_estate
			value = {
				value = "root.estate_power(estate_type:peasants_estate)"
				multiply = -100
				max = -0.05
				min = -0.25
			}
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 3
			}
		}
	}
}

sinicization_disaster.7 = {
	type = country_event
	category = disaster_event
	title = sinicization_disaster.7.title
	desc = sinicization_disaster.7.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	immediate = {
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.7.a

		change_societal_value = {
			type = sinicized_vs_unsinicized
			value = societal_value_minor_move_to_right
		}
		add_government_power = government_power_weak_bonus
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 2
			}
		}
		add_opinion = {
			target = scope:target_emperor_scope
			modifier = opinion_refused_tribute
		}
		reverse_add_opinion = {
			target = scope:target_emperor_scope
			modifier = opinion_refused_tribute
		}
	}
	option = {
		name = sinicization_disaster.7.b


		change_gold_effect = { scale = -1 }
		scope:target_emperor_scope = {
			add_gold = {
				value = root.monthly_income_trade_and_tax
			}
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 2
			}
		}
	}
}

sinicization_disaster.8 = {
	type = country_event
	category = disaster_event
	title = sinicization_disaster.8.title
	desc = sinicization_disaster.8.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	trigger = {
		NOT = { has_variable = sinicization_attitude_event_variable }
	}

	immediate = {
		set_variable = {
			name = sinicization_attitude_event_variable
			value = yes
		}
		chi_scopes = yes
	}

	option = {
		name = sinicization_disaster.8.a

		add_country_modifier = {
			modifier = struggle_against_china_modifier
			years = -1
			mode = add_and_extend
			desc = until_disaster_ends
		}
		hidden_effect = {
			change_variable = {
				name = sovereign_side
				add = 5
			}
		}
	}
	option = {
		name = sinicization_disaster.8.b


		add_country_modifier = {
			modifier = embracing_sinicization_modifier
			years = -1
			mode = add_and_extend
			desc = until_disaster_ends
		}
		hidden_effect = {
			change_variable = {
				name = china_side
				add = 5
			}
		}
	}
}

sinicization_disaster.100 = {
	type = country_event
	category = disaster_event
	title = sinicization_disaster.100.title
	desc = {
		first_valid = {
			triggered_desc = {
				desc = sinicization_disaster.100.desc.a	#China Influence Wins
				trigger = {
					var:china_side >= 30
				}
			}
			triggered_desc = {
				desc = sinicization_disaster.100.desc.b	#Sovereign Influence Wins
				trigger = {
					var:sovereign_side >= 30
				}
			}
			triggered_desc = {
				desc = sinicization_disaster.100.desc.c	#We outgrew China
				trigger = {
					OR = { 
						expected_army_size > scope:target_emperor_scope.expected_army_size
						country_total_army_levy_size >= scope:target_emperor_scope.country_total_army_levy_size
						societal_value:sinicized_vs_unsinicized > 0
					}
				}
			}
			triggered_desc = {
				desc = sinicization_disaster.100.desc.d	#We are a subject of China
				trigger = {
					is_subject_of = scope:target_emperor_scope
				}
			}
			triggered_desc = {
				desc = sinicization_disaster.100.desc.e	#Fallback
				trigger = {
					always = yes
				}
			}
		}
	}

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	immediate = {
		save_scope_as = target_sinicized_country
		chi_scopes = yes
	}

	option = { #China Influence Wins option A
		name = sinicization_disaster.100.a
		
		trigger = {
			var:china_side >= 30
			is_subject = no
		}
		scope:target_emperor_scope = {
			set_variable = { 
				name = chi_make_trib_variable
				value = yes
			}
			trigger_event_non_silently = sinicization_disaster.101
		}
		custom_tooltip = make_us_tributary_tt
	}

	option = { #China Influence Wins option B
		name = sinicization_disaster.100.b

		trigger = {
			var:china_side >= 30
			is_subject = no
		}

		if = {
			limit = { 
				this != scope:target_emperor_scope
				is_allied_with = { target = scope:target_emperor_scope }
			}
			remove_relation = {
				type = relation_type:alliance
				first = this
				second = scope:target_emperor_scope
			}
			add_government_power = government_power_mild_penalty
		}
		else_if = {
			limit = { 
				has_truce_with = scope:target_emperor_scope
			}
			add_government_power = government_power_mild_penalty
		}
		else = {
			scope:target_emperor_scope = {
				set_variable = { 
					name = chi_gain_cb_variable
					value = yes
				}
				trigger_event_non_silently = sinicization_disaster.101
			}
			custom_tooltip = this_may_lead_to_war_tt
		}
	}

	option = { #Already a subject and east_asia side
		name = sinicization_disaster.100.c

		trigger = {
			var:china_side >= 30
			is_subject = yes
			overlord = {
				NOT = { this = scope:target_emperor_scope }
			}
		}

		scope:target_emperor_scope = {
			set_variable = { 
				name = chi_cultural_bonuses_variable
				value = yes
			}
			trigger_event_non_silently = sinicization_disaster.101
		}
		custom_tooltip = gains_cultural_bonuses_tt
	}

	option = { #Already subject and sovereign
		name = sinicization_disaster.100.d

		trigger = {
			var:sovereign_side >= 30
			is_subject = yes
			overlord = {
				NOT = { this = scope:target_emperor_scope }
			}
		}
		
		overlord = {
			add_government_power = government_power_mild_bonus
		}
		add_government_power = government_power_mild_bonus
		add_stability = stability_weak_penalty
	}

	option = { #Outgrew China
		name = sinicization_disaster.100.e

		trigger = {
			OR = {
				expected_army_size > scope:target_emperor_scope.expected_army_size
				country_total_army_levy_size >= scope:target_emperor_scope.country_total_army_levy_size
				societal_value:sinicized_vs_unsinicized > 0
			}
		}
		
		if = {
			limit = {
				OR = { 
					expected_army_size > scope:target_emperor_scope.expected_army_size
					country_total_army_levy_size >= scope:target_emperor_scope.country_total_army_levy_size
				}
			}
			add_government_power = government_power_extreme_bonus
			add_prestige = prestige_extreme_bonus
			add_stability = stability_extreme_bonus
		}
		if = {
			limit = {
				societal_value:sinicized_vs_unsinicized > 0
			}
			add_stability = stability_extreme_bonus
			culture = {
				add_cultural_influence = cultural_influence_extreme_bonus
				add_cultural_tradition = cultural_tradition_extreme_bonus
			}
		}
	}


	option = { #Subject of CHI
		name = sinicization_disaster.100.f

		trigger = {
			is_subject = yes
			overlord = { this = scope:target_emperor_scope }
		}

		scope:target_emperor_scope = {
			set_variable = { 
				name = chi_subject_already_bonuses_variable
				value = yes
			}
			trigger_event_non_silently = sinicization_disaster.101
		}
		custom_tooltip = gains_cultural_bonuses_tt
	}

	option = {
		name = sinicization_disaster.100.g

		trigger = {
			NOT = { 
				country_exists = c:CHI
				OR = {
					NOT = { exists = international_organization:middle_kingdom }
					NOT = { exists = international_organization:middle_kingdom.leader_country }
				}
			}
		}

		add_stability = stability_mild_bonus
	}
	after = {
		remove_variable = sovereign_side 
		remove_variable = china_side
		remove_variable = sinicization_attitude_event_variable
		remove_country_modifier = struggle_against_china_modifier
		remove_country_modifier = embracing_sinicization_modifier
	}
}

sinicization_disaster.101 = { #News from [target_sinicized_country.GetNameWithNoTooltip]
	type = country_event
	category = disaster_event
	title = sinicization_disaster.101.title
	desc = sinicization_disaster.101.desc

	image = "gfx/interface/illustrations/disaster/sinicization_disaster.dds"

	option = {
		name = sinicization_disaster.101.a

		trigger = {
			has_variable = chi_gain_cb_variable
		}

		add_casus_belli =  { 
			target = scope:target_sinicized_country	
			type = casus_belli:cb_subject_broke_free	
		}
		hidden_effect = { remove_variable = chi_gain_cb_variable }
	}

	option = { 
		name = sinicization_disaster.101.b

		trigger = {
			has_variable = chi_make_trib_variable
		}

		scope:target_sinicized_country = {
			make_subject_of = {
				target = scope:target_emperor_scope
				type = subject_type:tributary
			}
		}
		hidden_effect = { remove_variable = chi_make_trib_variable }
	}

	option = { 
		name = sinicization_disaster.101.c
		trigger = {
			has_variable = chi_cultural_bonuses_variable
		}

		add_prestige = prestige_weak_bonus
		culture = {
			add_cultural_influence = cultural_influence_weak_bonus
		}
		hidden_effect = { remove_variable = chi_cultural_bonuses_variable }
	}

	option = { 
		name = sinicization_disaster.101.d

		trigger = {
			has_variable = chi_subject_already_bonuses_variable
		}

		add_government_power = government_power_weak_bonus
		culture = {
			add_cultural_tradition = cultural_tradition_weak_bonus
		}
		hidden_effect = { remove_variable = chi_subject_already_bonuses_variable }
	}
}
