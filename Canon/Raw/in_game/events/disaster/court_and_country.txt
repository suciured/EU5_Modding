namespace = court_and_country

court_and_country.1 = {
	type = country_event
	category = disaster_event

	title = court_and_country.1.title
	desc = court_and_country.1.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }
	}


	option = {
		name = court_and_country.1.a
		
		add_country_modifier = {
			modifier = absolutist_influences_government_modifier
			years = modifier_duration_years_long
			mode = replace
		}
		change_societal_value = {
			type = absolutism_vs_liberalism 
			value = societal_value_large_move_to_left
		}

		add_stability = stability_ultimate_penalty
	}

	option = {
		name = court_and_country.1.b

		add_country_modifier = {
			modifier = liberal_influences_government_modifier
			years = modifier_duration_years_long
			mode = replace
		}

		change_societal_value = {
			type = absolutism_vs_liberalism 
			value = societal_value_large_move_to_right
		}

		add_government_power = government_power_ultimate_penalty
	}
}

court_and_country.2 = {
	type = country_event
	category = disaster_event

	title = court_and_country.2.title
	desc = court_and_country.2.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }
		set_ended_disaster_flag_effect = { type = court_and_country }
	}

	option = {
		name = court_and_country.2.a

		trigger = {
			"estate_power(estate_type:crown_estate)" >= var:final_crown_power_value_variable
			num_privileges <= var:final_privilege_number_variable
		}
		change_societal_value = {
			type = centralization_vs_decentralization 
			value = societal_value_minor_move_to_left
		}
		if = {
			limit = { uses_government_power = legitimacy }
			custom_tooltip = {
				text = legitimacy_yields_more_crown_power_tt
				set_variable = successful_court_and_country_variable
			}
		}

		if = {
			limit = { has_country_modifier = absolutist_influences_government_modifier }
			remove_country_modifier = absolutist_influences_government_modifier
		}
		if = {
			limit = { has_country_modifier = liberal_influences_government_modifier }
			remove_country_modifier = liberal_influences_government_modifier
		}
	}

	option = {
		name = court_and_country.2.b

		trigger = {
			NAND = {
				"estate_power(estate_type:crown_estate)" >= var:final_crown_power_value_variable
				num_privileges <= var:final_privilege_number_variable
				estate_satisfaction:nobles_estate < 0.5
				estate_satisfaction:clergy_estate < 0.5
				estate_satisfaction:burghers_estate < 0.5
				estate_satisfaction:peasants_estate < 0.5
			}
		}
		add_government_power = government_power_mild_penalty
	}

	option = {
		name = court_and_country.2.c

		trigger = {
			estate_satisfaction:nobles_estate > 0.5
			estate_satisfaction:clergy_estate > 0.5
			estate_satisfaction:burghers_estate > 0.5
			estate_satisfaction:peasants_estate > 0.5
		}
		change_societal_value = {
			type = absolutism_vs_liberalism 
			value = societal_value_large_move_to_right
		}
		add_government_power = government_power_ultimate_penalty
	}
}

court_and_country.3 = {
	type = country_event
	category = disaster_event

	title = court_and_country.3.title
	desc = court_and_country.3.desc

	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }

		if = {
			limit = {
				"estate(estate_type:nobles_estate)" = { num_privileges > 1 }
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:nobles_estate
				}
				save_scope_as = first_privilege
			}
		
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:nobles_estate
					this != scope:first_privilege
				}
				save_scope_as = second_privilege
			}
		}
	}


	option = {
		name = court_and_country.3.a
		trigger = {
			"estate(estate_type:nobles_estate)" = { num_privileges > 1 }
		}

		if = {
			limit = { exists = scope:first_privilege }
			revoke_estate_privilege = scope:first_privilege
		}
		if = {
			limit = { exists = scope:second_privilege }
			revoke_estate_privilege = scope:second_privilege
		}

		add_government_power = government_power_extreme_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_extreme_penalty }
	}

	option = {
		name = court_and_country.3.b

		if = {
			limit = { has_country_modifier = curbed_noble_power_modifier }
			add_country_modifier = {
				modifier = curbed_noble_power_modifier
				years = 5
				mode = add_and_extend
			}
		}
		else = {
			add_country_modifier = {
				modifier = curbed_noble_power_modifier
				years = 5
				mode = replace
			}
		}
	}

	option = {
		name = court_and_country.3.c

		trigger = {
			has_parliament = yes
		}

		if = {
			limit = { has_country_modifier = no_nobles_parliament_modifier }
			add_country_modifier = {
				modifier = no_nobles_parliament_modifier
				years = 1
			}
		}
		else = {
			add_country_modifier = {
				modifier = no_nobles_parliament_modifier
				years = 5
				mode = replace
			}
		}
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_extreme_penalty }
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_bonus }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_mild_bonus }
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_mild_bonus }
	}
}

court_and_country.4 = {
	type = country_event
	category = disaster_event

	title = court_and_country.4.title
	desc = court_and_country.4.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }

		if = {
			limit = {
				"estate(estate_type:burghers_estate)" = { num_privileges > 1 }
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:burghers_estate
				}
				save_scope_as = first_privilege
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:burghers_estate
					this != scope:first_privilege
				}
				save_scope_as = second_privilege
			}
		}
	}


	option = {
		name = court_and_country.3.a
		trigger = {
			"estate(estate_type:burghers_estate)" = { num_privileges > 1 }
		}

		if = {
			limit = { exists = scope:first_privilege }
			revoke_estate_privilege = scope:first_privilege
		}
		if = {
			limit = { exists = scope:second_privilege }
			revoke_estate_privilege = scope:second_privilege
		}

		add_government_power = government_power_extreme_bonus
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_extreme_penalty }
	}

	option = {
		name = court_and_country.3.b

		add_country_modifier = {
			modifier = curbed_burghers_power_modifier
			years = 5
			mode = add_and_extend
		}
	}

	option = {
		name = court_and_country.3.c

		trigger = {
			has_parliament = yes
		}

		if = {
			limit = { has_country_modifier = no_burghers_parliament_modifier }
			add_country_modifier = {
				modifier = no_burghers_parliament_modifier
				mode = add_and_extend
				years = 1
			}
		}
		else = {
			add_country_modifier = {
				modifier = no_burghers_parliament_modifier
				years = 5
				mode = replace
			}
		}
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_extreme_penalty }
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_bonus }
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_mild_bonus }
	}
}

court_and_country.5 = {
	type = country_event
	category = disaster_event

	title = court_and_country.5.title
	desc = court_and_country.5.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }

		if = {
			limit = {
				"estate(estate_type:clergy_estate)" = { num_privileges > 1 }
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:clergy_estate
				}
				save_scope_as = first_privilege
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:clergy_estate
					this != scope:first_privilege
				}
				save_scope_as = second_privilege
			}
		}
	}


	option = {
		name = court_and_country.3.a
		trigger = {
			"estate(estate_type:clergy_estate)" = { num_privileges > 1 }
		}

		if = {
			limit = { exists = scope:first_privilege }
			revoke_estate_privilege = scope:first_privilege
		}
		if = {
			limit = { exists = scope:second_privilege }
			revoke_estate_privilege = scope:second_privilege
		}

		add_government_power = government_power_extreme_bonus
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_extreme_penalty }
	}

	option = {
		name = court_and_country.3.b

		if = {
			limit = { has_country_modifier = curbed_clergy_power_modifier }
			add_country_modifier = {
				modifier = curbed_clergy_power_modifier
				years = 5
				mode = add_and_extend
			}
		}
		else = {
			add_country_modifier = {
				modifier = curbed_clergy_power_modifier
				years = 5
				mode = replace
			}
		}
	}

	option = {
		name = court_and_country.3.c

		trigger = {
			has_parliament = yes
		}

		if = {
			limit = { has_country_modifier = no_clergy_parliament_modifier }
			add_country_modifier = {
				modifier = no_clergy_parliament_modifier
				years = 1
			}
		}
		else = {
			add_country_modifier = {
				modifier = no_clergy_parliament_modifier
				years = 5
				mode = replace
			}
		}
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_extreme_penalty }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_mild_bonus }
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_mild_bonus }
	}
}

court_and_country.6 = {
	type = country_event
	category = disaster_event

	title = court_and_country.6.title
	desc = court_and_country.6.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }

		if = {
			limit = {
				"estate(estate_type:peasants_estate)" = { num_privileges > 1 }
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:peasants_estate
				}
				save_scope_as = first_privilege
			}
			random_estate_privilege = {
				limit = {
					estate_type = estate_type:peasants_estate
					this != scope:first_privilege
				}
				save_scope_as = second_privilege
			}
		}
	}


	option = {
		name = court_and_country.3.a
		trigger = {
			"estate(estate_type:peasants_estate)" = { num_privileges > 1 }
		}

		if = {
			limit = { exists = scope:first_privilege }
			revoke_estate_privilege = scope:first_privilege
		}
		if = {
			limit = { exists = scope:second_privilege }
			revoke_estate_privilege = scope:second_privilege
		}

		add_government_power = government_power_extreme_bonus
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_extreme_penalty }
	}

	option = {
		name = court_and_country.3.b

		if = {
			limit = { has_country_modifier = curbed_peasants_power_modifier }
			add_country_modifier = {
				modifier = curbed_peasants_power_modifier
				years = 5
				mode = add_and_extend
			}
		}
		else = {
			add_country_modifier = {
				modifier = curbed_peasants_power_modifier
				years = 5
				mode = replace
			}
		}
	}
}

court_and_country.7 = {
	type = country_event
	category = disaster_event

	title = court_and_country.7.title
	desc = court_and_country.7.desc

	trigger = {
		any_province = {
			NOT = {
				any_location_in_province = {
					OR = {
						is_capital = yes
						has_location_modifier = cnc_refused_to_pay_taxes
					}
				}
			}
		}
	}
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	immediate = {
		capital = { save_scope_as = target_capital }
		ruler_or_regent = { save_scope_as = target_character }
		ordered_province = {  
			limit = {
				NOT = {
					any_location_in_province = {
						OR = {
							is_capital = yes
							has_location_modifier = cnc_refused_to_pay_taxes
						}
					}
				}
			}  
			order_by = {
				value = province_satisfaction
				multiply = -1
			}  
			position = 1
			check_range_bounds = no
			save_scope_as = target_province
			random_location_in_province = {
				limit = { is_province_capital = yes }
				save_scope_as = target_location
			}
		}
	}

	option = {
		name = court_and_country.7.a
		change_societal_value = {
			type = centralization_vs_decentralization 
			value = societal_value_minor_move_to_left
		}
		scope:target_province = {
			custom_tooltip = every_pop_in_target_province_loses_20_satisfaction_tt
			custom_tooltip = every_location_in_target_province_gets_cnc_local_authority_asserted_tt
			hidden_effect = {
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
						}
						add_pop_satisfaction = pop_satisfaction_severe_penalty
					}
					add_location_modifier = { 
						modifier = cnc_local_authority_asserted 
						years = 3 
						mode = add_and_extend 
					}
				}
			}
		}
	}
	option = {
		name = court_and_country.7.b
		change_societal_value = {
			type = centralization_vs_decentralization 
			value = societal_value_minor_move_to_right
		}
		scope:target_province = {
			custom_tooltip = every_pop_in_target_province_gains_20_satisfaction_tt
			custom_tooltip = every_location_in_target_province_gets_cnc_refused_to_pay_taxes_tt
			hidden_effect = {
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
						}
						add_pop_satisfaction = pop_satisfaction_severe_bonus
					}
					add_location_modifier = { 
						modifier = cnc_refused_to_pay_taxes 
						years = 3 
						mode = add_and_extend 
					}
				}
			}
		}
	}
}

court_and_country.8 = {
	type = country_event
	category = disaster_event
	title = court_and_country.8.title
	desc = court_and_country.8.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	trigger = {
		num_rebels > 0
		any_province = {
			NOT = { has_variable = province_cooldown_variable }
			province_satisfaction > 0
		}
	}

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }
		ordered_rebel = {
			order_by = rebel_size
			position = 1
			check_range_bounds = no
			save_scope_as = target_rebel
		}
		ordered_province = {
			limit = { province_satisfaction > 0 }
			order_by = {
				value = population
				divide = province_satisfaction
				multiply = -1
			}
			position = 1
			set_variable = {
				name = province_cooldown_variable
				years = 2
			}
			save_scope_as = target_province
		}
	}

	option = {
		name = court_and_country.8.a

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_left
		}
		scope:target_rebel = { add_rebel_progress = 0.05 }
		scope:target_province = {
			custom_tooltip = {
				text = rebel_pops_in_target_province_lose_10_satisfaction_tt
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							has_rebel = yes
						}
						add_pop_satisfaction = pop_satisfaction_mild_penalty
					}
				}
			}
			custom_tooltip = {
				text = non_rebel_pops_in_target_province_lose_5_satisfaction_tt
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							has_rebel = no
						}
						add_pop_satisfaction = pop_satisfaction_weak_penalty
					}
				}
			}
		}
	}

	option = {
		name = court_and_country.8.b

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_right
		}
		scope:target_province = {
			every_location_in_province = { change_control = control_mild_penalty }
			if = {
				limit = {
					any_location_in_province = {
						any_pop = {
							owner = root
							has_rebel = yes
						}
					}
					
				}
				custom_tooltip = {
					text = rebel_pops_in_target_province_gain_10_satisfaction_tt
					every_location_in_province = {
						every_pop = {
							limit = {
								owner = root
								has_rebel = yes
							}
							add_pop_satisfaction = pop_satisfaction_mild_bonus
						}
					}
					
				}
			}
			
			custom_tooltip = {
				text = non_rebel_pops_in_target_province_gain_5_satisfaction_tt
				every_location_in_province = {
					every_pop = {
						limit = {
							owner = root
							has_rebel = no
						}
						add_pop_satisfaction = pop_satisfaction_weak_bonus
					}
				}
			}
		}
	}
}

court_and_country.9 = {
	type = country_event
	category = disaster_event
	title = court_and_country.9.title
	desc = court_and_country.9.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	trigger = {
		any_rebel = {
			rebel_estate_type = estate_type:nobles_estate
		}
	}

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }
		ordered_rebel = {
			limit = { rebel_estate_type = estate_type:nobles_estate }
			order_by = rebel_size
			position = 1
			check_range_bounds = no
			save_scope_as = target_rebel
		}
	}

	option = {
		name = court_and_country.9.a

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_left
		}
		scope:target_rebel = { add_rebel_progress = 0.05 }
		custom_tooltip = {
			text = every_supporter_pop_loses_5_satisfaction_tt
			scope:target_rebel = {
				every_pops_supporting_rebel = {
					add_pop_satisfaction = pop_satisfaction_weak_penalty
				}
			}
		}
	}

	option = {
		name = court_and_country.9.b

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_right
		}
		add_government_power = government_power_mild_penalty
		scope:target_rebel = { add_rebel_progress = -0.1 }
	}
}

court_and_country.10 = {
	type = country_event
	category = disaster_event
	title = court_and_country.10.title
	desc = court_and_country.10.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	trigger = {
		any_rebel = {
			rebel_estate_type = estate_type:burghers_estate
			any_pops_supporting_rebel = {
				location = { location_rank = location_rank:city }
			}
		}
	}

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		ordered_rebel = {
			limit = { rebel_estate_type = estate_type:burghers_estate }
			order_by = rebel_size
			position = 1
			check_range_bounds = no
			save_scope_as = target_rebel
		}
		scope:target_rebel ?= {
			ordered_pops_supporting_rebel = {  
				limit = {
					location = { location_rank = location_rank:city }
				}  
				order_by = pop_size  
				position = 1  
				check_range_bounds = no
				save_scope_as = target_rebel_pop
				location = { save_scope_as = target_location }
			}
		}
	}

	option = {
		name = court_and_country.10.a

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_left
		}
		scope:target_rebel ?= { add_rebel_progress = 0.05 }
		custom_tooltip = {
			text = every_pop_in_location_loses_5_satisfaction_tt
			scope:target_location = {
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_weak_penalty
				}
			}
		}
	}

	option = {
		name = court_and_country.10.b

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_right
		}
		change_societal_value = {
			type = aristocracy_vs_plutocracy
			value = societal_value_minor_move_to_right
		}
		custom_tooltip = {
			text = every_pop_in_target_location_10_satisfaction_tt
			scope:target_location = {
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_mild_bonus
				}
			}
		}
	}
}

court_and_country.11 = {
	type = country_event
	category = disaster_event
	title = court_and_country.11.title
	desc = court_and_country.11.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	trigger = {
		OR = {
			army_tradition >= 10
			manpower_percentage >= 0.1
		}
	}

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
	}

	option = {
		name = court_and_country.10.a

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_left
		}
		add_army_tradition = army_tradition_mild_penalty
		add_yearly_manpower = -1
	}

	option = {
		name = court_and_country.10.b

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_right
		}
		add_war_exhaustion = war_exhaustion_weak_penalty
		add_government_power = government_power_mild_penalty
	}
}

court_and_country.12 = {
	type = country_event
	category = disaster_event
	title = court_and_country.12.title
	desc = court_and_country.12.desc
	image = "gfx/interface/illustrations/disaster/court_and_country.dds"

	trigger = {
		OR = {
			government_power < 90
			AND = {
				manpower_percentage <= 0.5
				monthly_manpower > 0
			}
		}
	}

	immediate = {
		ruler_or_regent ?= { save_scope_as = target_character }
		capital = { save_scope_as = target_location }
	}

	option = {
		name = court_and_country.12.a
		trigger = {
			manpower_percentage < 1
		}
		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_left
		}
		add_yearly_manpower = 1
	}

	option = {
		name = court_and_country.12.b

		trigger = { government_power < 100 }

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_left
		}
		change_gold_effect = { scale = -3 }
		add_government_power = government_power_mild_bonus
	}

	option = {
		name = court_and_country.12.c

		change_societal_value = {
			type = absolutism_vs_liberalism
			value = societal_value_minor_move_to_right
		}
		add_all_estate_satisfaction = { value = estate_satisfaction_weak_bonus }
	}
}