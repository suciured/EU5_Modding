namespace = crisis_of_the_chinese_dynasty

crisis_of_the_chinese_dynasty.1 = {
	type = country_event
	category = disaster_event

	title = crisis_of_the_chinese_dynasty.1.title
	desc = crisis_of_the_chinese_dynasty.1.desc
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
	}
	option = {
		name = crisis_of_the_chinese_dynasty.1.a
		add_stability = stability_ultimate_penalty
		custom_tooltip = {
			text = every_member_of_mkio_loses_20_opinion_tt
			international_organization:middle_kingdom = {
				every_international_organization_member = {
					limit = {
						this != root
					}
					add_opinion = {
						modifier = opinion_internal_crisis
						target = root
					}
				}
			}
		}
	}
}

crisis_of_the_chinese_dynasty.2 = {
	type = country_event
	category = disaster_event

	title = crisis_of_the_chinese_dynasty.2.title
	desc = crisis_of_the_chinese_dynasty.2.desc
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
	}
	option = {
		name = crisis_of_the_chinese_dynasty.2.a
		add_stability = stability_extreme_penalty
		add_prestige = prestige_extreme_penalty
	}
}

crisis_of_the_chinese_dynasty.3 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.3.title
	desc = crisis_of_the_chinese_dynasty.3.desc

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
	}
	option = {
		name = crisis_of_the_chinese_dynasty.3.a
		
		add_war_exhaustion = war_exhaustion_radical_bonus
		add_inflation = inflation_ultimate_bonus
	}
}

crisis_of_the_chinese_dynasty.4 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.4.title
	desc = crisis_of_the_chinese_dynasty.4.desc

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
		ordered_province = {
			limit = { population > 0 }
			order_by = {
				value = province_satisfaction
				multiply = -1
			}
			position = {
				1 10
			}
			check_range_bounds = no 
			save_scope_as = target_province
			random_location_in_province = {
				limit = { is_province_capital = yes }
				save_scope_as = target_location
			}
		}
	}
	option = {
		name = crisis_of_the_chinese_dynasty.4.a

		if = {
			limit = {
				scope:target_province = {
					NOT = { 
						any_location_in_province = {
							is_capital = yes
						}
					}
				}
			}
			scope:target_province = {
				if = {
					limit = { province_food_percentage > 0 }
					change_province_food_percentage = -0.25
				}
				every_location_in_province = {
					hidden_effect = {
						every_pop = {
							limit = {
								owner = root
							}
							add_pop_satisfaction = pop_satisfaction_mild_penalty
						}
						change_prosperity = prosperity_weak_penalty
					}
				}
				custom_tooltip = pops_in_target_province_lose_10_satisfaction_tt
				custom_tooltip = every_location_in_target_province_suffers_10_devastation_tt
			}
			capital = {
				province = {
					if = {
						limit = { scope:target_province.province_food_percentage > 0 }
						change_province_food_percentage = {
							value = scope:target_province.province_food_percentage
							multiply = 0.25
						}
					}
					else = {
						change_province_food_percentage = 0.1
					}
				}
				change_prosperity = prosperity_mild_bonus
			}
		}
		else = {
			scope:target_province = {
				hidden_effect = {
					every_location_in_province = {
						every_pop = {
							limit = {
								owner = root
							}
							add_pop_satisfaction = pop_satisfaction_mild_penalty
						}
					}
				}
				custom_tooltip = pops_in_target_province_lose_10_satisfaction_tt
			}
		}
		add_government_power = government_power_weak_bonus
	}

	option = {
		name = crisis_of_the_chinese_dynasty.4.b

		if = {
			limit = {
				exists = international_organization:middle_kingdom
				international_organization:middle_kingdom.leader_country = root
			}
			change_celestial_authority = { value = celestial_authority_very_weak_bonus }
		}
		change_gold_effect = { scale = -2 }
		scope:target_province = {
			custom_tooltip = {
				text = every_pop_in_target_province_gains_5_satisfaction_tt
				every_location_in_province = {
					every_pop = {
						limit = {
							owner ?= root
						}
						add_pop_satisfaction = pop_satisfaction_weak_bonus
					}
				}
			}
			if = {
				limit = {
					NOT = { has_province_modifier = reduced_taxation_modifier }
				}
				add_province_modifier = {
					modifier = reduced_taxation_modifier
					years = 2
					mode = extend
				}
			}
			else = {
				add_province_modifier = {
					modifier = reduced_taxation_modifier
					years = 1
					mode = extend
				}
			}
		}
	}
}

crisis_of_the_chinese_dynasty.5 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.5.title
	desc = crisis_of_the_chinese_dynasty.5.desc

	trigger = {
		any_province = {
			province_prosperity <= 0.33
		}
	}

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
		ordered_province = {
			order_by = {
				value = province_prosperity
				multiply = -1
			}
			position = {
				1 10
			}
			check_range_bounds = no 
			save_scope_as = target_province
			random_location_in_province = {
				limit = { is_province_capital = yes }
				save_scope_as = target_location
			}
		}
		if = {
			limit = { 
				any_cabinet_character = { 
					total_abilities > 25
					NOT = { has_character_modifier = away_from_the_court_modifier }
					count > 0
				}
			}
			ordered_cabinet_character = {
				limit = {
					NOT = { has_character_modifier = away_from_the_court_modifier }
				}
				order_by = total_abilities
				max = 1
				check_range_bounds = no
				save_scope_as = target_character_1
			}
			set_variable = {
				name = display_character_ability_variable
				value = {
					add = scope:target_character_1.total_abilities
					multiply = 0.05
				}
			}
			set_variable = {
				name = character_ability_prosperity_variable
				value = {
					add = var:display_character_ability_variable
					divide = 100
				}
			}
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.5.a

		trigger = {
			scope:target_province = { province_food_percentage <= 0.75 }
		}
		change_gold_effect = { scale = -2.5 }
		scope:target_province = {
			change_province_food_percentage = 0.15
			custom_tooltip = {
				text = every_location_in_target_province_5_prosperity_tt
				every_location_in_province = {
					change_prosperity = prosperity_very_weak_bonus
				}
			}
		}
		if = {
			limit = {
				exists = international_organization:middle_kingdom
				international_organization:middle_kingdom.leader_country = root
			}
			change_celestial_authority = { value = celestial_authority_very_weak_bonus }
		}

	}

	option = {
		name = crisis_of_the_chinese_dynasty.5.b

		trigger = {
			exists = scope:target_character_1
		}

		scope:target_province = {
			custom_tooltip = {
				text = every_location_in_target_province_scales_with_character_tt
				every_location_in_province = {
					change_prosperity = root.var:character_ability_prosperity_variable
				}
			}
		}
		scope:target_character_1 = {
			add_character_modifier = {
				modifier = away_from_the_court_modifier
				years = 3
				mode = replace
			}
		}
		change_gold_effect = { scale = -1 }
		if = {
			limit = {
				exists = international_organization:middle_kingdom
				international_organization:middle_kingdom.leader_country = root
			}
			change_celestial_authority = { value = celestial_authority_very_weak_bonus }
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.5.c 

		change_gold_effect = { scale = -5 }
		scope:target_province = {
			custom_tooltip = {
				text = every_location_in_target_province_5_prosperity_tt
				every_location_in_province = {
					change_prosperity = prosperity_very_weak_bonus
				}
			}
		}
		if = {
			limit = {
				exists = international_organization:middle_kingdom
				international_organization:middle_kingdom.leader_country = root
			}
			change_celestial_authority = { value = celestial_authority_very_weak_bonus }
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.5.d

		add_stability = stability_weak_penalty
		if = {
			limit = {
				exists = international_organization:middle_kingdom
				international_organization:middle_kingdom.leader_country = root
			}
			change_celestial_authority = { value = celestial_authority_weak_penalty }
		}
	}

	after = {
		if = {
			limit = { has_variable = display_character_ability_variable }
			remove_variable = display_character_ability_variable
		}
	}
}

crisis_of_the_chinese_dynasty.6 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.6.title
	desc = crisis_of_the_chinese_dynasty.6.desc

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
		scope:target_rebel = {
			every_pops_supporting_rebel = {
				location = {
					add_to_list = cmd_affected_locations_list
				}
			}
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.6.a
		trigger = {
			scope:target_rebel = { rebel_category = estate }
		}
		change_celestial_authority = { value = celestial_authority_very_weak_penalty }
		if = {
			limit = {
				scope:target_rebel = { rebel_estate_type = estate_type:nobles_estate }
			}
			if = {
				limit = {
					NOT = { has_country_modifier = noble_concessions_modifier }
				}
				add_country_modifier = {
					modifier = noble_concessions_modifier
					years = 3
					mode = add_and_extend
					size = {
						value = 1
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:nobles_estate)"
						}			
					}
				}
			}
			else = {
				add_country_modifier = {
					modifier = noble_concessions_modifier
					years = 1
					mode = extend
					size = {
						value = 0.5
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:nobles_estate)"
						}			
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:target_rebel = { rebel_estate_type = estate_type:burghers_estate }
			}
			if = {
				limit = { 
					NOT = { has_country_modifier = burghers_concessions_modifier }
				}
				add_country_modifier = {
					modifier = burghers_concessions_modifier
					years = 3
					mode = add_and_extend
					size = {
						value = 1
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:burghers_estate)"
						}			
					}
				}
			}
			else = {
				add_country_modifier = {
					modifier = burghers_concessions_modifier
					years = 1
					mode = extend
					size = {
						value = 0.5
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:burghers_estate)"
						}			
					}
				}
			}
			
		}
		else_if = {
			limit = {
				scope:target_rebel = { rebel_estate_type = estate_type:clergy_estate }
			}
			if = {
				limit = { 
					NOT = { has_country_modifier = clergy_concessions_modifier }
				}
				add_country_modifier = {
					modifier = clergy_concessions_modifier
					years = 3
					mode = add_and_extend
					size = {
						value = 1
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:clergy_estate)"
						}			
					}
				}
			}
			else = {
				add_country_modifier = {
					modifier = clergy_concessions_modifier
					years = 1
					mode = extend
					size = {
						value = 0.5
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:clergy_estate)"
						}			
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:target_rebel = { rebel_estate_type = estate_type:peasants_estate }
			}
			if = {
				limit = { 
					NOT = { has_country_modifier = peasants_concessions_modifier }
				}
				add_country_modifier = {
					modifier = peasants_concessions_modifier
					years = 3
					mode = add_and_extend
					size = {
						value = 1
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:peasants_estate)"
						}			
					}
				}
			}
			else = {
				add_country_modifier = {
					modifier = peasants_concessions_modifier
					years = 1
					mode = extend
					size = {
						value = 0.5
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:peasants_estate)"
						}			
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:target_rebel = { rebel_estate_type = estate_type:dhimmi_estate }
			}
			if = {
				limit = { 
					NOT = { has_country_modifier = dhimmi_concessions_modifier }
				}
				add_country_modifier = {
					modifier = dhimmi_concessions_modifier
					years = 3
					mode = add_and_extend
					size = {
						value = 1
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:dhimmi_estate)"
						}			
					}
				}
			}
			else = {
				add_country_modifier = {
					modifier = dhimmi_concessions_modifier
					years = 1
					mode = extend
					size = {
						value = 0.5
						multiply = {
							desc = "[estate_power|e]"
							value = "estate_power(estate_type:dhimmi_estate)"
						}			
					}
				}
			}
		}
		scope:target_rebel = { add_rebel_progress = -0.25 }
		custom_tooltip = {
			text = pops_supporting_target_rebel_will_gain_30_satisfaction_and_cease_their_support_tt
			scope:target_rebel = {
				every_pops_supporting_rebel = {
					add_pop_satisfaction = pop_satisfaction_extreme_bonus
					remove_pop_allegiance = no_arg
				}
			}
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.6.b
		trigger = {
			scope:target_rebel = { rebel_category = religious }
		}
		
		change_celestial_authority = { value = celestial_authority_very_weak_penalty }
		change_societal_value = { 
			type = spiritualist_vs_humanist 
			value = societal_value_move_to_right
		}
		if = {
			limit = {
				NOT = { has_country_modifier = religious_concessions_modifier }
			}
			add_country_modifier = {
				modifier = religious_concessions_modifier
				mode = add_and_extend
				years = 10
			}
		}
		else = {
			add_country_modifier = {
				modifier = religious_concessions_modifier
				mode = extend
				years = 1
			}
		}
		scope:target_rebel = { add_rebel_progress = -0.25 }
		custom_tooltip = {
			text = pops_supporting_target_rebel_will_gain_30_satisfaction_and_cease_their_support_tt
			scope:target_rebel = {
				every_pops_supporting_rebel = {
					add_pop_satisfaction = pop_satisfaction_extreme_bonus
					remove_pop_allegiance = no_arg
				}
			}
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.6.c

		trigger = {
			scope:target_rebel = { rebel_category = nationalist }
		}

		change_celestial_authority = { value = celestial_authority_very_weak_penalty }
		custom_tooltip = {
			text = locations_with_rebel_pops_lose_20_control_tt
			every_in_list = {
				list = cmd_affected_locations_list
				change_control = control_extreme_penalty
			}
		}
		scope:target_rebel = { add_rebel_progress = -0.25 }
		custom_tooltip = {
			text = pops_supporting_target_rebel_will_gain_30_satisfaction_and_cease_their_support_tt
			scope:target_rebel = {
				every_pops_supporting_rebel = {
					add_pop_satisfaction = pop_satisfaction_extreme_bonus
					remove_pop_allegiance = no_arg
				}
			}
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.6.d

		trigger = {
			scope:target_rebel = {
				NOR = {
					rebel_category = religious
					rebel_category = estate
					rebel_category = nationalist
				}
			}
		}
		change_celestial_authority = { value = celestial_authority_very_weak_penalty }
		scope:target_rebel = { add_rebel_progress = -0.25 }
		custom_tooltip = {
			text = pops_supporting_target_rebel_will_gain_30_satisfaction_and_cease_their_support_tt
			scope:target_rebel = {
				every_pops_supporting_rebel = {
					add_pop_satisfaction = pop_satisfaction_extreme_bonus
					remove_pop_allegiance = no_arg
				}
			}
		}
	}

	option = {
		name = crisis_of_the_chinese_dynasty.6.e

		custom_tooltip = {
			text = refund_the_cost_of_the_action_tt
			add_gold = monthly_income_total
		}
	}
}

crisis_of_the_chinese_dynasty.7 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.7.title
	desc = crisis_of_the_chinese_dynasty.7.desc

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
		set_variable = revised_tax_code_variable
	}

	option = {
		name = crisis_of_the_chinese_dynasty.7.a 

		custom_tooltip = we_can_now_complete_reform_tax_action_tt
		add_country_modifier = {
			modifier = chi_renewed_taxation_system_modifier
			years = 5
			mode = replace
		}
	}
}

crisis_of_the_chinese_dynasty.8 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.8.title
	desc = crisis_of_the_chinese_dynasty.8.desc

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
	}
	option = {
		name = crisis_of_the_chinese_dynasty.8.a
		
		change_celestial_authority = { value = celestial_authority_weak_bonus }
		add_government_power = government_power_mild_bonus
	}
}

crisis_of_the_chinese_dynasty.9 = {
	type = country_event
	category = disaster_event
	image = "gfx/interface/illustrations/disaster/crisis_of_the_chinese_dynasty.dds"
	title = crisis_of_the_chinese_dynasty.9.title
	desc = crisis_of_the_chinese_dynasty.9.desc

	immediate = {
		ruler_or_regent = { save_scope_as = target_character }
	}
	option = {
		name = crisis_of_the_chinese_dynasty.9.a
		
		change_celestial_authority = { value = celestial_authority_weak_bonus }
		add_stability = stability_mild_bonus
	}
}