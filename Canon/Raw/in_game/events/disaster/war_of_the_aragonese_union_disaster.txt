namespace = war_of_the_aragonese_union_disaster

war_of_the_aragonese_union_disaster.1 = { #The Union Reignites
	hide_portraits = yes
	type = country_event
	category = disaster_event
	title = war_of_the_aragonese_union_disaster.1.title
	desc = war_of_the_aragonese_union_disaster.1.desc
	
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	immediate = {
		character:ara_james_i_urgell = {
			save_scope_as = ruler_brother
			change_character_allegiance = scope:union_of_aragon
		}
		character:ara_peter_iv_arago = {
			save_scope_as = aragon_ruler
		}
		character:ara_alfons_iii_arago = {
			save_scope_as = scope_alfons_iii
		}

		location:valencia = {
			save_scope_as = target_location
		}

		every_owned_location = {
			if = {
				limit = {
					OR = {
						this = location:zaragoza
						this = location:tarazona
						this = location:zuera
						this = location:belchite
						this = location:pina_de_ebro
					}
				}
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_ultimate_penalty
					change_pop_allegiance = scope:union_of_aragon
				}
			}
		}
	}

	option = {
		name = war_of_the_aragonese_union_disaster.1.a
		historical_option = yes
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.2
		}
	}
	option = {
		name = war_of_the_aragonese_union_disaster.1.b
		add_legitimacy = legitimacy_weak_bonus
		add_stability = stability_weak_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_weak_bonus }
		trigger_event_non_silently = { id = war_of_the_aragonese_union_disaster.2 days = 5}
	}

}

# The Union expands to two more locations in Aragon or Valencia, except the loyal ones
scripted_effect union_expands = {
	ordered_owned_location = {
		order_by = population
		max = 1
		limit = {
			OR = {
				area = area:aragon_area
				area = area:valencia_area
			}
			not = {
				OR = {
					this = location:teruel
					this = location:calatayud
					this = location:daroca
					this = location:huesca
				}
			}
			any_pop = {
				owner = root
				rebel ?= {
					this != scope:union_of_aragon
				}
			}
		}
		every_pop = {
			limit = {
				owner = root
				rebel ?= {
					this != scope:union_of_aragon
				}
			}
			add_pop_satisfaction = pop_satisfaction_ultimate_penalty
			change_pop_allegiance = scope:union_of_aragon
		}
	}
}

war_of_the_aragonese_union_disaster.2 = { #Old Demands
	hide_portraits = yes
	type = country_event
	category = disaster_event
	title = war_of_the_aragonese_union_disaster.2.title
	desc = war_of_the_aragonese_union_disaster.2.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	immediate = {
		character:ara_james_i_urgell = {
			save_scope_as = ruler_brother
		}
		character:ara_peter_iv_arago = {
			save_scope_as = aragon_ruler
		}
	}

	option = {
		name = war_of_the_aragonese_union_disaster.2.a
		add_prestige = prestige_mild_penalty
		add_stability = stability_severe_penalty
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_penalty }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_severe_penalty }

		custom_tooltip = {
			text = war_of_the_aragonese_union_disaster.4.b.tt #Same text as in 214
			union_expands = yes
		}
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.2
		}
	}

	option = {
		name = war_of_the_aragonese_union_disaster.2.b
		add_legitimacy = legitimacy_severe_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_bonus }
		set_variable = { name = union_privilege_flag value = 1 }
		grant_estate_privilege = estate_privilege:union_privilege
	}
}

war_of_the_aragonese_union_disaster.3 = { #The Humiliated Monarch/To Arms!
	type = country_event
	category = disaster_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = union_privilege_flag
				}
				desc = war_of_the_aragonese_union_disaster.3.title.a
			}
			triggered_desc = {
				trigger = {
					in_civil_war = yes
				}
				desc = war_of_the_aragonese_union_disaster.3.title.b
			}
			triggered_desc = {
				desc = war_of_the_aragonese_union_disaster.3.title.c
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_variable = union_privilege_flag
				}
				desc = war_of_the_aragonese_union_disaster.3.desc.a
			}
			triggered_desc = {
				trigger = {
					in_civil_war = yes
				}
				desc = war_of_the_aragonese_union_disaster.3.desc.b
			}
			triggered_desc = {
				desc = war_of_the_aragonese_union_disaster.3.desc.c
			}
		}
	}
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	immediate = {
		character:ara_peter_iv_arago = {
			save_scope_as = aragon_ruler
		}
	}

	option = {
		name = war_of_the_aragonese_union_disaster.3.a
		trigger = {
			OR = {
				has_variable = union_privilege_flag
				in_civil_war = yes
			}
		}
		add_stability = stability_weak_penalty
		add_legitimacy = legitimacy_severe_penalty
	}

	option = {
		name = war_of_the_aragonese_union_disaster.3.b
		trigger = {
			not = {
				has_variable = union_privilege_flag
				in_civil_war = yes
			}
		}
		add_stability = stability_mild_bonus
		add_legitimacy = legitimacy_extreme_bonus
	}
}

war_of_the_aragonese_union_disaster.4 = { #A Chance for Peace
	type = country_event
	category = disaster_event

	title = war_of_the_aragonese_union_disaster.4.title
	desc = war_of_the_aragonese_union_disaster.4.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	option = {
		name = war_of_the_aragonese_union_disaster.4.a
		add_legitimacy = legitimacy_weak_bonus
		add_stability = stability_weak_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_weak_bonus }
		trigger_event_non_silently = { id = war_of_the_aragonese_union_disaster.2  days = 5 }
	}

	option = {
		name = war_of_the_aragonese_union_disaster.4.b

		custom_tooltip = {
			text = war_of_the_aragonese_union_disaster.4.b.tt
			union_expands = yes
		}
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.2
		}
	}
}

war_of_the_aragonese_union_disaster.5 = { #The Union Expands
	type = country_event
	category = disaster_event
	title = war_of_the_aragonese_union_disaster.5.title
	desc = war_of_the_aragonese_union_disaster.5.desc
	
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	immediate = {
		union_expands = yes
	}

	option = {
		name = war_of_the_aragonese_union_disaster.5.a
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_weak_bonus }
		trigger_event_non_silently = { id = war_of_the_aragonese_union_disaster.2 days = 5 }
	}

	option = {
		name = war_of_the_aragonese_union_disaster.5.b
		add_stability = stability_weak_penalty
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.1
		}
		custom_tooltip = {
			text = war_of_the_aragonese_union_disaster.4.b.tt #Same text as in 214
		}
	}
}

war_of_the_aragonese_union_disaster.6 = { #The Lion's Den
	type = country_event
	category = disaster_event
	title = war_of_the_aragonese_union_disaster.6.title
	desc = war_of_the_aragonese_union_disaster.6.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	option = {
		name = war_of_the_aragonese_union_disaster.6.a
		historical_option = yes
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_weak_bonus }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_weak_bonus }
		trigger_event_non_silently = { id = war_of_the_aragonese_union_disaster.7 days = 5 }

	}

	option = {
		name = war_of_the_aragonese_union_disaster.6.b
		add_stability = stability_weak_penalty

		custom_tooltip = {
			text = war_of_the_aragonese_union_disaster.4.b.tt #Same text as in 214
			union_expands = yes
		}
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.1
		}
	}
}

war_of_the_aragonese_union_disaster.7 = { #A Parliament of Threats
	type = country_event
	category = disaster_event
	title = war_of_the_aragonese_union_disaster.7.title
	desc = war_of_the_aragonese_union_disaster.7.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	option = {
		name = war_of_the_aragonese_union_disaster.7.a
		historical_option = yes
		add_stability = stability_mild_penalty
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_bonus }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_severe_bonus }
		set_variable = { name = union_privilege_flag value = 1 }
		grant_estate_privilege = estate_privilege:union_privilege
	}

	option = {
		name = war_of_the_aragonese_union_disaster.7.b
		add_stability = stability_extreme_penalty
		kill_character = {
			target = ruler
			reason = assassination
		}
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.1
		}
	}

	option = {
		name = war_of_the_aragonese_union_disaster.7.c
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_penalty }
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_severe_penalty }
		custom_tooltip = {
			text = war_of_the_aragonese_union_disaster.4.b.tt #Same text as in 214
			union_expands = yes
		}
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.2
		}
	}
}

war_of_the_aragonese_union_disaster.8 = { #Valencia Rises
	type = country_event
	category = disaster_event
	title = war_of_the_aragonese_union_disaster.8.title
	desc = war_of_the_aragonese_union_disaster.8.desc
	image = "gfx/interface/illustrations/disaster/war_of_the_aragonese_union_disaster.dds"
	immediate = {
		ordered_owned_location = {
			order_by = population
			max = 2
			limit = {
				area = area:valencia_area
				any_pop = {
					rebel != scope:union_of_aragon
				}
			}
			every_pop = {
				limit = {
					owner = root
					rebel != scope:union_of_aragon
				}
				add_pop_satisfaction = pop_satisfaction_ultimate_penalty
				change_pop_allegiance = scope:union_of_aragon
			}
		}
	}

	option = {
		name = war_of_the_aragonese_union_disaster.8.a
		add_stability = stability_weak_penalty
		var:union_of_aragon_rebels_variable ?= {
			add_rebel_progress = 0.1
		}
		custom_tooltip = {
			text = war_of_the_aragonese_union_disaster.4.b.tt #Same text as in 214
		}
	}
}