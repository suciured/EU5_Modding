namespace = pilgrimage_events
pilgrimage_events.1 = { #Landslide #DEVASTATION
	type = country_event
	title = pilgrimage_events.1.title
	desc = pilgrimage_events.1.desc

	trigger = {
		has_ruler = yes
		ruler = {
			has_character_modifier = character_on_pilgrimage
			has_variable = pilgrimage_holy_site
			var:pilgrimage_holy_site.location = { owner = root }
		}
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		ruler ?= {
			save_scope_as = target_ruler
			var:pilgrimage_holy_site = { save_scope_as = target_holy_site }
			scope:target_holy_site.location = { save_scope_as = target_location }
		}
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}

	option = { #Give gold
		name = pilgrimage_events.1.a
		change_gold_effect = { scale = -2 }
		scope:target_location = { change_development = development_weak_penalty }
	}

	option = { #Give men
		name = pilgrimage_events.1.b
		trigger = { monthly_manpower > 0 }
		add_manpower = { value = monthly_manpower multiply = -2 }
		scope:target_location = { change_prosperity = prosperity_weak_penalty }
	}

	option = { #Give nothing
		name = pilgrimage_events.1.c
		trigger = {
			ruler ?= {
				NOT = { has_trait = just }
				NOT = { has_trait = righteous }
				NOT = { has_trait = kind_hearted }
				NOT = { has_trait = benevolent }
			}
		}
		scope:target_location = {
			change_prosperity = prosperity_mild_penalty
			change_development = development_weak_penalty
		}
	}

	option = { #Give all
		name = pilgrimage_events.1.d
		trigger = {
			ruler ?= {
				NOT = { has_trait = greedy }
				NOT = { has_trait = cruel }
			}
		}
		if = {
			limit = { monthly_manpower > 0 }
			change_gold_effect = { scale = -2 }
			add_manpower = { value = monthly_manpower multiply = -2 }
		}
		else = {
			change_gold_effect = { scale = -4 }
		}
		custom_tooltip = {
			text = pilgrimage_events.1.d.tt
			ruler = {
				add_character_modifier = { modifier = character_on_pilgrimage months = 12 mode = extend }
			}
		}
	}
}

pilgrimage_events.2 = { #Wandering Monk
	type = country_event
	title = pilgrimage_events.2.title
	desc = pilgrimage_events.2.desc

	trigger = {
		has_ruler = yes
		ruler = {
			has_character_modifier = character_on_pilgrimage
			has_variable = pilgrimage_holy_site
		}
	}
	illustration_tags = {
		10 = happy
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:peasants_estate }
		ruler ?= {
			save_scope_as = target_ruler
			var:pilgrimage_holy_site = { save_scope_as = target_holy_site }
			scope:target_holy_site.location = { save_scope_as = target_location }
		}
		create_character = {
			birth_location = scope:target_location
			culture = scope:target_location.dominant_culture
			religion = scope:target_location.dominant_religion
			estate = estate_type:clergy_estate
			create_in_limbo = yes
			save_scope_as = target_monk
		}
	}

	option = { #Take him in
		name = pilgrimage_events.2.a
		scope:target_monk = { move_country = root }
		if = {
			limit = {
				scope:target_ruler.religion != scope:target_monk.religion
			}
			scope:target_ruler = { change_character_religion = scope:target_monk.religion }
		}
		if = {
			limit = { religion = { has_purity = yes } }
			add_purity = purity_weak_bonus
		}
	}

	option = { #Our current clergy is fine
		name = pilgrimage_events.2.b
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_weak_bonus }
	}
}

pilgrimage_events.3 = { #Free Rein at Court
	type = country_event
	title = pilgrimage_events.3.title
	desc = pilgrimage_events.3.desc

	trigger = {
		has_ruler = yes
		ruler = {
			has_character_modifier = character_on_pilgrimage
			has_variable = pilgrimage_holy_site
		}
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_government_estate_effect = yes
		ruler ?= {
			save_scope_as = target_ruler
			var:pilgrimage_holy_site = { save_scope_as = target_holy_site }
			scope:target_holy_site.location = { save_scope_as = target_location }
		}
	}

	option = { #Noble power grab
		name = pilgrimage_events.3.a
		add_legitimacy = legitimacy_severe_penalty
		add_prestige = prestige_mild_penalty
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_mild_bonus }
	}

	option = { #Ruler asserts authority
		name = pilgrimage_events.3.b
		trigger = {
			ruler = { total_abilities >= 170 }
		}
		add_legitimacy = legitimacy_mild_bonus
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_penalty }
		add_stability = stability_weak_bonus
	}

	option = { #Kill them all!
		name = pilgrimage_events.3.c
		trigger = {
			ruler = {
				OR = {
					has_trait = cruel
					has_trait = intricate_web_weaver
				}
			}
		}
		capital = {
			every_pop = {
				limit = { pop_type = pop_type:nobles }
				add_pop_size = -0.1
			}
		}
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_extreme_bonus }
		if = {
			limit = {
				religion = { has_purity = yes }
			}
			add_purity = purity_severe_penalty
		}
	}

	option = { #Heir coup
		name = pilgrimage_events.3.d
		trigger = {
			has_heir = yes
			heir = { is_adult = yes }
		}
		add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_severe_bonus }
		set_new_ruler = heir
	}
}

pilgrimage_events.4 = { #Holy Site Overcrowded
	type = country_event
	title = pilgrimage_events.4.title
	desc = pilgrimage_events.4.desc

	trigger = {
		has_ruler = yes
		ruler = {
			has_character_modifier = character_on_pilgrimage
			has_variable = pilgrimage_holy_site
		}
	}

	illustration_tags = {
		10 = happy
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }
		ruler ?= {
			save_scope_as = target_ruler
			var:pilgrimage_holy_site = { save_scope_as = target_holy_site }
			scope:target_holy_site.location = { save_scope_as = target_location }
		}
	}

	option = { #Do some tourism
		name = pilgrimage_events.4.a
		trigger = {
			ruler = {
				NOT = { has_trait = zealot }
			}
		}
		change_gold_effect = { scale = -2 }
		culture = { add_cultural_influence = cultural_influence_weak_bonus }
		change_societal_value = { type = capital_economy_vs_traditional_economy value = societal_value_minor_move_to_left }
	}

	option = { #Blasphemy!
		name = pilgrimage_events.4.b
		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_move_to_left }
		add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_mild_bonus }
		if = {
			limit = { scope:target_location.owner = root }
			scope:target_location = {
				change_prosperity = prosperity_weak_penalty
				custom_tooltip = {
					text = pilgrimage_events.4.b.tt
					every_pop = {
						limit = {
							owner = root
						}
						add_pop_satisfaction = pop_satisfaction_mild_penalty
					}
				}
			}
		}
		else = {
			add_prestige = prestige_mild_penalty
		}
	}

	option = { #Burn it all
		name = pilgrimage_events.4.c
		trigger = {
			ruler = { has_trait = zealot }
			scope:target_location.owner = root
		}
		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_large_move_to_left }
		scope:target_location = {
			change_prosperity = prosperity_mild_penalty
			custom_tooltip = {
				text = pilgrimage_events.4.c.tt
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_severe_penalty
				}
			}
			change_control = control_mild_bonus
		}
		if = {
			limit = {
				religion = { has_purity = yes }
			}
			add_purity = purity_severe_penalty
		}
	}
}

pilgrimage_events.5 = { #Perilous Walk
	type = country_event
	title = pilgrimage_events.5.title
	desc = pilgrimage_events.5.desc

	trigger = {
		has_ruler = yes
		ruler = {
			has_character_modifier = character_on_pilgrimage
			has_variable = pilgrimage_holy_site
			var:pilgrimage_holy_site.location = { topography = mountains }
			NOR = {
				has_character_modifier = injured
				has_character_modifier = severely_injured
				has_character_modifier = gravely_injured
			}
		}
	}

	immediate = {
		ruler ?= {
			save_scope_as = target_ruler
			var:pilgrimage_holy_site = { save_scope_as = target_holy_site }
			scope:target_holy_site.location = { save_scope_as = target_location }
			remove_character_modifier = character_on_pilgrimage
			remove_variable = pilgrimage_holy_site
		}
	}

	option = { #Gather healers
		name = pilgrimage_events.5.a
		trigger = {
			societal_value:spiritualist_vs_humanist < 30
		}

		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_move_to_right }
		change_gold_effect = { scale = -3 }

		custom_tooltip = {
			text = pilgrimage_events.5.a.tt
			if = {
				limit = {
					any_cabinet_character = {
						OR = {
							adm > 80
							has_trait = battlefield_medic
						}
					}
				}
				random_list = {
					10 = {
						ruler = { add_character_modifier = { modifier = injured months = 4 mode = add_and_extend } }
					}
					5 = {
						ruler = { add_character_modifier = { modifier = severely_injured months = 8 mode = add_and_extend } }
					}
					1 = {
						ruler = { add_character_modifier = { modifier = gravely_injured months = 12 mode = add_and_extend } }
					}
				}
			}
			else = {
				random_list = {
					10 = {
						ruler = { add_character_modifier = { modifier = injured months = 5 mode = add_and_extend } }
					}
					8 = {
						ruler = { add_character_modifier = { modifier = severely_injured months = 9 mode = add_and_extend } }
					}
					5 = {
						ruler = { add_character_modifier = { modifier = gravely_injured months = 13 mode = add_and_extend } }
					}
				}
			}
		}
	}

	option = { #Pray
		name = pilgrimage_events.5.b
		trigger = {
			societal_value:spiritualist_vs_humanist < 70
		}

		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_move_to_left }

		custom_tooltip = {
			text = pilgrimage_events.5.b.tt
			random_list = {
				10 = {
					ruler = { add_character_modifier = { modifier = injured months = 6 mode = add_and_extend } }
				}
				10 = {
					ruler = { add_character_modifier = { modifier = severely_injured months = 10 mode = add_and_extend } }
				}
				10 = {
					ruler = { add_character_modifier = { modifier = gravely_injured months = 14 mode = add_and_extend } }
				}
			}
		}
	}
}