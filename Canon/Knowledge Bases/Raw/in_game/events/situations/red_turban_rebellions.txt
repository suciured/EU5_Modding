#########################################################
# Scripted effects for the Red Turban Rebellions events #
#########################################################

#Character-Countries to be released in the following order:
#REBEL FACTION
# HAN Lin'er (actually Song)	-> rtr_release_tag_CSO
# Rogue Red Turban Jurch-Rebels	-> rtr_release_jurchen_culture
# XU Shouhui (actually Tianwan)	-> rtr_release_tag_CTW
# CHEN Yuliang					-> rtr_release_tag_CHE
# ZHANG Shide (actually Wu)		-> rtr_release_tag_WUU
# FANG Guozhen (pirates)		-> rtr_release_tag_CFN
# MAO Gui						-> rtr_release_tag_CMO
# MING Yuzhen (actually Xia)	-> rtr_release_tag_CXI
# GUO Zixing					-> rtr_release_tag_CGU
# ZHU Yuanzhang (later Ming)	-> rtr_release_tag_MNG
#SUPPORTER FACTION
# CHEN Yuting (Yanping)			-> rtr_release_tag_CNP
# HE Zhen						-> rtr_release_tag_CDN
# LI Siqi						-> rtr_release_tag_CSI
# KÖKE Temur (Mongolian)		-> rtr_release_tag_CKO
# NAGHACHU						-> rtr_release_tag_CNA


scripted_effect rtr_cleanup_variables = {
	if = { limit = { has_variable = rtr_historical_countries_to_release } remove_variable = rtr_historical_countries_to_release }
	if = { limit = { has_variable = rtr_release_tag_MNG } remove_variable = rtr_release_tag_MNG }
	if = { limit = { has_variable = rtr_release_tag_CHE } remove_variable = rtr_release_tag_CHE }
	if = { limit = { has_variable = rtr_release_tag_CFN } remove_variable = rtr_release_tag_CFN }
	if = { limit = { has_variable = rtr_release_tag_WUU } remove_variable = rtr_release_tag_WUU }
	if = { limit = { has_variable = rtr_release_tag_CXI } remove_variable = rtr_release_tag_CXI }
	if = { limit = { has_variable = rtr_release_tag_CSO } remove_variable = rtr_release_tag_CSO }
	if = { limit = { has_variable = rtr_release_tag_CMO } remove_variable = rtr_release_tag_CMO }
	if = { limit = { has_variable = rtr_release_tag_CTW } remove_variable = rtr_release_tag_CTW }
	if = { limit = { has_variable = rtr_release_tag_CGU } remove_variable = rtr_release_tag_CGU }
	if = { limit = { has_variable = rtr_release_tag_CNP } remove_variable = rtr_release_tag_CNP }
	if = { limit = { has_variable = rtr_release_tag_CDN } remove_variable = rtr_release_tag_CDN }
	if = { limit = { has_variable = rtr_release_tag_CSI } remove_variable = rtr_release_tag_CSI }
	if = { limit = { has_variable = rtr_release_tag_CKO } remove_variable = rtr_release_tag_CKO }
	if = { limit = { has_variable = rtr_release_tag_CNA } remove_variable = rtr_release_tag_CNA }
	if = { limit = { has_variable = rtr_release_jurchen_culture } remove_variable = rtr_release_jurchen_culture }
	if = { limit = { has_variable = rtr_country_additional_releaser_counter } remove_variable = rtr_country_additional_releaser_counter }
	every_country = { limit = { has_variable = rtr_yuan_allegiance } remove_variable = rtr_yuan_allegiance }
	if = { limit = { has_global_variable_list = rtr_loyal_faction } clear_global_variable_list = rtr_loyal_faction }
	if = { limit = { has_global_variable_list = rtr_neutral_faction } clear_global_variable_list = rtr_neutral_faction }
}
scripted_effect rtr_setup_countries_to_release = {
	rtr_cleanup_variables = yes
	#Define a set of historical tags which should be released FIRST before dynamic cultural tags gets released
	set_variable = { name = rtr_historical_countries_to_release value = 15 }
	set_variable = rtr_release_tag_MNG
	set_variable = rtr_release_tag_CHE
	set_variable = rtr_release_tag_CFN
	set_variable = rtr_release_tag_WUU
	set_variable = rtr_release_tag_CXI
	set_variable = rtr_release_tag_CSO
	set_variable = rtr_release_tag_CMO
	set_variable = rtr_release_tag_CTW
	set_variable = rtr_release_tag_CGU
	set_variable = rtr_release_tag_CNP
	set_variable = rtr_release_tag_CDN
	set_variable = rtr_release_tag_CSI
	set_variable = rtr_release_tag_CKO
	set_variable = rtr_release_tag_CNA
	set_variable = rtr_release_jurchen_culture
	#Determins how many countries China will release later on after the historical ones are done
	set_variable = { name = rtr_country_additional_releaser_counter value = 10 }
}

scripted_effect rtr_released_country_setup_effects = {
	set_variable = { name = rtr_yuan_allegiance value = 0 }
	change_government_type = government_type:monarchy
	add_reform = government_reform:warring_state
	add_to_global_variable_list = {
		name = rtr_faction_list
		target = this
	}

	change_heir_selection = heir_selection:cognatic_primogeniture
	add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_radical_bonus }
	add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_radical_bonus }
	add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_radical_bonus }
	add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_radical_bonus }
	if = {
		limit = {
			OR = {
				religion = religion:mahayana
				religion = religion:sanjiao
			}
		}
		random_international_organization = {
			limit = {
				international_organization_type = international_organization_type:sect
				international_organization_has_policy = policy:confucianism_policy
			}
			add_country_to_international_organization = prev
		}
		random_international_organization = {
			limit = {
				international_organization_type = international_organization_type:sect
				international_organization_has_policy = policy:daoism_policy
			}
			add_country_to_international_organization = prev
		}
	}
	if = {
		limit = { exists = scope:target_location }
		set_capital = scope:target_location
	}
	save_temporary_scope_as = temp_warlord_country
	if = {
		limit = { exists = scope:target_character }
		scope:target_character = {
			move_country = scope:temp_warlord_country
			every_child = {
				limit = { NOT = { owner = scope:temp_warlord_country } }
				move_country = scope:temp_warlord_country
			}
		}
		set_new_ruler = scope:target_character
	}
	every_province = {
		limit = { any_location_in_province = { NOT = { integration_level = core } } }
		change_province_integration = core
		change_province_food_percentage = 1
	}
	trigger_event_silently = {
		id = red_turban_rebellions.22
		days = 35	#It must trigger after the first monthly tick
	}
}

scripted_effect rtr_release_warlord_tag = {
	if = {
		limit = { NOT = { country_exists = c:$tag$ } }
		custom_tooltip = {
			text = rtr_release_warlord_country_tt
			remove_variable = rtr_release_tag_$tag$
			change_variable = {
				name = rtr_historical_countries_to_release
				subtract = 1
			}
			create_country_from_cores_in_our_locations = c:$tag$
			c:$tag$ = {
				save_scope_as = target_country
				change_country_color = map_$tag$
				change_culture = $culture$
				rtr_released_country_setup_effects = yes
				add_accepted_culture = $accepted_culture$
			}
		}
	}
	custom_description = {
		text = rtr_lose_competent_characters
		value = $culture$
		object = c:$tag$
		ordered_character = {
			order_by = total_abilities
			limit = {
				culture = $culture$
				is_ruler = no
				is_heir = no
				is_loyal = yes
				in_cabinet = no
				is_general = no
				is_explorer = no
				is_admiral = no
				is_consort = no
			}
			max = 8
			check_range_bounds = no
			move_country = c:$tag$
		}
	}
}

scripted_effect rtr_prepare_cultural_warlord_tag = {
	culture:$culture$ = { save_scope_as = target_culture }
	remove_variable = rtr_release_$culture$
	ordered_owned_location = {
		limit = {
			NOT = { dominant_culture = root.culture }
			dominant_culture = scope:target_culture
			province != root.capital.province
		}
		order_by = {
			value = population
			if = {
				limit = { location_rank = location_rank:town }
				multiply = 5
			}
			if = {
				limit = { location_rank = location_rank:city }
				multiply = 10
			}
		}
		check_range_bounds = no
		max = 1
		save_scope_as = target_location
		create_dynasty_from_location = random
		last_dynasty_in_location = { save_scope_as = target_dynasty }
		create_country_from_location = {
			save_scope_as = target_country
			rtr_released_country_setup_effects = yes
			set_capital = prev
			create_character = {
				culture = scope:target_culture
				age = 25
				dynasty = scope:target_dynasty
				save_scope_as = target_character
				prev = { set_new_ruler = prev }
			}
		}
	}
}
scripted_effect rtr_release_cultural_warlord_tag = {
	if = {
		limit = {
			exists = scope:target_culture
			exists = scope:target_location
			exists = scope:target_country
		}
		custom_tooltip = {
			text = rtr_release_cultural_warlord_tag_tt
			every_owned_location = {
				limit = {
					NOT = { dominant_culture = root.culture }
					dominant_culture = scope:target_culture
					province != root.capital.province
					NOT = {	#Checks that the location is not owned by a pop based country already
						any_nomad_countries_in_location = {
							count > 0
						}
					}
				}
				change_location_owner = scope:target_country
				add_core = scope:target_country
			}
			#clean up disconnected locations
			#It is done like this because is_connected_to = scope:target_location works not due to the location being no longer part of Yuán once the tag is released
			scope:target_country = {
				every_owned_location = {
					limit = { NOT = { is_connected_to = scope:target_location } }
					if = {
						limit = { is_core_of = scope:target_country }
						remove_core = scope:target_country
					}
					change_location_owner = root
					change_control = control_radical_bonus
				}
				change_culture = scope:target_culture
			}
		}
	}
}

scripted_effect rtr_prepare_biggest_culture_warlord = {
	if = {
		limit = { var:rtr_country_additional_releaser_counter > 0 }
			ordered_pop = {
				limit = {
					NOT = { culture = root.culture }	#Your own pops should stay loyal to you
					culture = { has_culture_group = culture_group:chinese_group }
				}
				max = 1
				order_by = pop_size
				culture = { save_scope_as = target_culture }
			}
			if = {
				limit = { exists = scope:target_culture }
				ordered_owned_location = {
					limit = {
						NOT = { dominant_culture = root.culture }
						dominant_culture = scope:target_culture
						province != root.capital.province
					}
					order_by = {
						value = population
						if = {
							limit = { location_rank = location_rank:town }
							multiply = 5
						}
						if = {
							limit = { location_rank = location_rank:city }
							multiply = 10
						}
					}
					check_range_bounds = no
					max = 1
					save_scope_as = target_location
					create_country_from_location = {
						save_scope_as = target_country
						rtr_released_country_setup_effects = yes
						create_character = {
							min_age = 25
							save_scope_as = target_character
						}
						set_new_ruler = scope:target_character
						set_capital  = scope:target_location
					}
				}
			}
	}
}
scripted_effect rtr_release_biggest_culture_warlord = {
	if = {
		limit = {
			var:rtr_country_additional_releaser_counter > 0
			exists = scope:target_culture
			exists = scope:target_location
			exists = scope:target_country
		}
		custom_tooltip = {
			text = rtr_release_warlord_tag_biggest_pop_culture_release_tt
			every_owned_location = {
				limit = {
					NOT = { dominant_culture = root.culture }
					dominant_culture = scope:target_culture
					province != root.capital.province
				}
				change_location_owner = scope:target_country
				add_core = scope:target_country
			}
			scope:target_country = {
				every_owned_location = {
					limit = { NOT = { is_connected_to = scope:target_location } }
					if = {
						limit = { is_core_of = scope:target_country }
						remove_core = scope:target_country
					}
					change_location_owner = root
					change_control = control_radical_bonus
				}
				change_culture = scope:target_culture
			}
		}
	}
}

scripted_effect rtr_add_cores_to_province = {
	province_definition:$province$ = {
		every_location_in_province_definition = {
			limit = { owner ?= root }
			add_core = c:$tag$
		}
	}
}
scripted_effect rtr_add_cores_to_area = {
	area:$area$ = {
		every_location_in_area = {
			limit = { owner ?= root }
			add_core = c:$tag$
		}
	}
}
scripted_effect rtr_add_core_to_location = {
	if = {
		limit = { owns = location:$location$ }
		location:$location$ = { add_core = c:$tag$ }
	}
}
scripted_effect rtr_create_revolter_capital = {
	c:$tag$ = { save_scope_as = target_country }
	location:$location$ = {
		save_scope_as = target_location
		province = { every_location_in_province = { limit = { owner = root } add_core = c:$tag$ } }
	}
	if = {
		limit = { exists = scope:target_country }
		scope:target_country = { rtr_create_io = yes }
	}
}

scripted_effect rtr_create_io = {
	if = {
		limit = {
			NOT = { exists = international_organization:red_turban_rebels }
		}
		create_international_organization = {
			type = international_organization_type:red_turban_rebels
			hidden_effect = {
				add_country_to_international_organization = prev
				set_leader_country = prev
				set_variable = rtr_empty_rebellion
			}
		}
	}
}

scripted_effect rtr_add_country_to_rebels_and_dow_china = {
	add_stability = stability_severe_penalty
	$country$ = {
		rtr_create_io = yes
		if = {
			limit = { exists = international_organization:red_turban_rebels }
			if = {
				limit = { international_organization:red_turban_rebels = { has_variable = rtr_empty_rebellion } }
				international_organization:red_turban_rebels = {
					remove_variable = rtr_empty_rebellion
					set_leader_country = prev
				}
			}
			else = {
				international_organization:red_turban_rebels = {
					add_country_to_international_organization_no_update = prev
					if = {
						limit = { international_organization_has_leader = no }
						set_leader_country = prev
					}
				}
			}
			hidden_effect = {
				international_organization:red_turban_rebels = {
					every_international_organization_member = {
						add_truce_with = { target = $country$ mutual = yes months = 6 }
					}
				}
			}
		}
		add_opinion = {
			modifier = opinion_rtr_red_turban_rebellions
			target = c:CHI
		}
	}
	declare_war_with_cb = {
		target = $country$
		type = casus_belli:cb_red_turban_rebellions_rein_in_rebels
	}
	$country$ = {
		raise_all_levies = { type = army instant = yes }
	}
}

scripted_effect rtr_create_war_list = {
	every_current_war = {
		limit = {
			OR = {
				casus_belli = casus_belli:cb_red_turban_rebellions
				casus_belli = casus_belli:cb_red_turban_rebellions_rein_in_rebels
			}
			is_a_defender = root
		}
		add_to_list = rtr_red_turban_wars_def
	}
	every_current_war = {
		limit = {
			OR = {
				casus_belli = casus_belli:cb_red_turban_rebellions
				casus_belli = casus_belli:cb_red_turban_rebellions_rein_in_rebels
			}
			is_an_attacker = root
		}
		add_to_list = rtr_red_turban_wars_attack
	}
}
scripted_effect rtr_join_china_in_wars = {
	rtr_change_allegiance_points = { value = 75 }
	add_to_global_variable_list = {
		name = rtr_loyal_faction
		target = this
	}
	custom_tooltip = {
		text = rtr_join_china_in_wars_tt
		every_in_list = {
			list = rtr_red_turban_wars_def
			PREV = { join_war_as_defender = { war = PREV } }
		}
		every_in_list = {
			list = rtr_red_turban_wars_attack
			PREV = { join_war_as_attacker = { war = PREV } }
		}
	}
}

scripted_trigger rtr_can_see_the_situation = {
	OR = {
		tag = CHI
		is_neighbor_of = c:CHI
		is_subject_of = c:CHI
		is_enemy_of = c:CHI
		is_rival_of = c:CHI
		capital ?= {
			sub_continent ?= sub_continent:east_asia
		}
		is_member_of_international_organization = international_organization:red_turban_rebels
	}
}

scripted_effect rtr_become_china_effect = {
	destroy_international_organization = { target = international_organization:red_turban_rebels }
	if = {
		limit = { has_reform = government_reform:warring_state }
		remove_reform = government_reform:warring_state

		remove_list_global_variable = {
			name = rtr_faction_list
			target = this
		}

	}
	if = {
		limit = {
			country_exists = c:CHI
		}
		custom_tooltip = rtr_become_china_effect_tt
		c:CHI = { trigger_event_non_silently = red_turban_rebellions.101 }
	}
	else = {
		rtr_recreate_middle_kingdom = yes
	}
	if = {
		limit = { NOT = { country_rank = country_rank:rank_empire } }
		set_country_rank = country_rank:rank_empire
	}
	add_prestige = prestige_radical_bonus
	add_stability = stability_ultimate_bonus
	add_legitimacy = legitimacy_ultimate_bonus
	set_variable = rtr_is_new_china
}

scripted_effect rtr_resolve_rebellion_effect = {
	if = {
		limit = { exists = scope:target_country }
		custom_tooltip = rtr_annex_all_loyalists_at
	}
	else = {
		custom_tooltip = rtr_annex_all_loyalists_bt
	}
	if = {
		limit = { has_country_modifier = rtr_red_turban_rebellions }
		remove_country_modifier = rtr_red_turban_rebellions
	}
	if = {
		limit = { exists = international_organization:red_turban_rebels }
		destroy_international_organization = { target = international_organization:red_turban_rebels }
	}
	add_prestige = prestige_radical_bonus
	add_stability = stability_ultimate_bonus
	add_legitimacy = legitimacy_ultimate_bonus
	change_celestial_authority = { value = celestial_authority_very_strong_bonus }
}

###########################################################
# Scripted triggerss for the Red Turban Rebellions events #
###########################################################

scripted_trigger rtr_can_release_tag = {
	var:rtr_historical_countries_to_release > 0
	has_variable = rtr_release_tag_$tag$
	NOT = { country_exists = c:$tag$ }
	owns = location:$location$
	location:$location$ = { is_capital = no }
}

scripted_trigger rtr_is_loyal = {
	has_variable = rtr_yuan_allegiance
	var:rtr_yuan_allegiance >= RTR_IS_LOYAL_VALUE
}

scripted_trigger rtr_is_neutral = {
	has_variable = rtr_yuan_allegiance
	var:rtr_yuan_allegiance >= RTR_IS_NEUTRAL_VALUE
	var:rtr_yuan_allegiance < RTR_IS_LOYAL_VALUE
}

scripted_trigger rtr_is_rebellious = {
	has_variable = rtr_yuan_allegiance
	var:rtr_yuan_allegiance < RTR_IS_NEUTRAL_VALUE
}

namespace = red_turban_rebellions

##########################
# Situation start events #
##########################

#The Red Turban Rebellions (China event)
red_turban_rebellions.1 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.1.title
	desc = red_turban_rebellions.1.desc
	image = "gfx/interface/illustrations/situation/red_turban_rebellions.dds"
	immediate = {
		save_scope_as = target_country
		character:yua_togon_temur = { save_scope_as = target_ruler }
		if = {
			limit = { current_year < 1365 }
			create_character = {
				first_name = name_ying2.name_yu4
				last_name = name_peng
				estate = estate_type:clergy_estate
				culture = culture:gan_culture
				religion = religion:mahayana
				birth_date = 1310 #Unknown but starts revolts 1338
				adm = {50 70}
				dip = {50 70}
				mil = {50 70}
				script = chi_yingyu_peng
				add_character_modifier = { modifier = rebel_leader_modifier years = -1 mode = add_and_extend }
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				estate = estate_type:clergy_estate
				culture = culture:gan_culture
				religion = religion:mahayana
				age = 35
				adm = {50 70}
				dip = {50 70}
				mil = {50 70}
				script = chi_yingyu_peng
				add_character_modifier = { modifier = rebel_leader_modifier years = -1 mode = add_and_extend }
				save_scope_as = target_character
			}
		}
		rtr_setup_countries_to_release = yes
	}
	option = {
		name = red_turban_rebellions.1.a
		custom_tooltip = red_turban_rebellions.1.a.tt
		add_stability = stability_extreme_penalty
		add_legitimacy = legitimacy_extreme_penalty
		change_celestial_authority = { value = celestial_authority_extreme_penalty }
		add_country_modifier = {
			modifier = rtr_red_turban_rebellions
			years = -1
			mode = add_and_extend
			size = {
				if = {
					limit = {
						has_variable = chi_rtr_modifier_intensity
						var:chi_rtr_modifier_intensity > 0
					}
					value = var:chi_rtr_modifier_intensity
				}
				else = {
					value = 1
				}
			}
			desc = rtr_red_turban_rebellion_duration
		}
		custom_tooltip = red_turban_rebellions.1.a.at
	}
}

#The Red Turban Rebellions (Info Event)
red_turban_rebellions.2 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.1.title
	desc = red_turban_rebellions.1.desc
	image = "gfx/interface/illustrations/situation/red_turban_rebellions.dds"
	immediate = {
		c:CHI = {
			save_scope_as = target_country
		}
		character:yua_togon_temur = { save_scope_as = target_ruler }
		if = {
			limit = { exists = character:chi_yingyu_peng }
			character:chi_yingyu_peng = { save_scope_as = target_character }
		}
	}
	option = {
		name = red_turban_rebellions.2.a
		if = {
			limit = { is_subject_of = c:CHI }
			add_liberty_desire = liberty_desire_severe_plus
		}
	}
}

##########################
# Country release events #
##########################
#Han Shantong Rebellion (rtr_release_tag_CSO)
red_turban_rebellions.3 = {
	randomlog = yes # Tracking Desync 20251120
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = red_turban_rebellions.3.desc
	trigger = {
		character:cso_shantong_han ?= {
			is_alive = yes
			owner ?= ROOT
			NOT = { has_character_modifier = imprisoned }
			has_dynasty = yes
		}
		rtr_can_release_tag = {
			tag = CSO
			location = qiaoxian
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		if = {
			limit = {
				exists = character:chi_yingyu_peng
				character:chi_yingyu_peng = {
					is_alive = yes
				}
			}
			character:chi_yingyu_peng = { save_scope_as = monk_character }
		}
		character:cso_shantong_han = {
			save_scope_as = target_character
			dynasty = {
				save_scope_as = target_dynasty
			}
		}
		c:CSO = { save_scope_as = target_country }
		location:qiaoxian = {
			save_scope_as = target_location
			province = { every_location_in_province = { limit = { owner = root } add_core = c:CSO } }
		}
		if = {
			limit = { exists = scope:target_country }
			scope:target_country = { rtr_create_io = yes }
		}
		rtr_add_cores_to_province = { province = suzhou_north_province		tag = CSO }
		rtr_add_cores_to_province = { province = xuzhou_province			tag = CSO }
		rtr_add_cores_to_province = { province = guide_province				tag = CSO }
		rtr_add_cores_to_province = { province = shanzhou_shandong_province	tag = CSO }
		rtr_add_cores_to_province = { province = tengzhou_province			tag = CSO }
		rtr_add_cores_to_province = { province = caozhou_province			tag = CSO }
		rtr_add_cores_to_province = { province = yingzhou_province			tag = CSO }
		rtr_add_cores_to_province = { province = chenzhou_henan_province	tag = CSO }
		rtr_add_cores_to_province = { province = suizhou_henan_province		tag = CSO }
		rtr_add_cores_to_province = { province = runing_province			tag = CSO }
		rtr_add_cores_to_province = { province = jining_province			tag = CSO }
		rtr_add_cores_to_province = { province = dongping_province			tag = CSO }
		rtr_add_cores_to_province = { province = puzhou_province			tag = CSO }
		rtr_add_cores_to_province = { province = kaizhou_province			tag = CSO }
		rtr_add_core_to_location = { location = qixian						tag = CSO }
		rtr_add_core_to_location = { location = taikang						tag = CSO }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_fu21.name_tong1
				last_name = name_liu2
				culture = culture:jilu_culture
				religion = religion:sanjiao
				estate = estate_type:burghers_estate
				birth_date = 1321 #Exact date unknown
				adm = { 60 80}
				dip = { 60 80}
				mil = { 60 80}
				script = cso_futong_liu
				save_scope_as = target_character_2
			}
		}
		else = {
			create_character = {
				culture = culture:jilu_culture
				religion = religion:sanjiao
				estate = estate_type:burghers_estate
				age = 33
				adm = { 60 80}
				dip = { 60 80}
				mil = { 60 80}
				script = cso_futong_liu
				save_scope_as = target_character_2
			}
		}
	}
	option = {
		name = red_turban_rebellions.3.a
		rtr_release_warlord_tag = { tag = CSO culture = culture:zhongyuan_culture accepted_culture = culture:jilu_culture }
		scope:target_country = {
			rtr_change_allegiance_points = { value = -100 }
			trigger_event_silently = { id = red_turban_rebellions.30 days = { 20 60 } }
		}
		rtr_add_country_to_rebels_and_dow_china = { country = c:CSO }
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CSO culture = culture:zhongyuan_culture accepted_culture = culture:jilu_culture }
		scope:target_country = {
			rtr_change_allegiance_points = { value = -100 }
			trigger_event_silently = { id = red_turban_rebellions.30 days = { 20 60 } }
		}
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
	after = {
		if = {
			limit = { exists = scope:target_country }
			if = {
				limit = { exists = scope:target_character_2 }
				scope:target_character_2 = {
					move_country = scope:target_country
					every_child = {
						limit = { owner = ROOT }
						move_country = scope:target_country
					}
				}
			}
		}
	}
}

#Han Shantong Rebellion (rtr_release_jurchen_culture)
red_turban_rebellions.4 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_culture.title
	desc = red_turban_rebellions.4.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		has_variable = rtr_release_jurchen_culture
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		rtr_prepare_cultural_warlord_tag = { culture = jurchen_culture }
	}
	option = {
		name = red_turban_rebellions.4.a
		rtr_release_cultural_warlord_tag = yes
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		hidden_effect = {
			scope:target_country = {
				trigger_event_non_silently = { id = red_turban_rebellions.33 days = { 10 30 } }
			}
		}
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_cultural_warlord_tag = yes
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = {
				trigger_event_non_silently = { id = red_turban_rebellions.33 days = { 10 30 } }
				trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 }
			}
		}
	}
	after = {
		set_variable = rtr_manchuria_rebellion_event
	}
}

#Tianwan Rebellion (rtr_release_tag_CTW)
red_turban_rebellions.5 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { exists = scope:monk_character }
				desc = red_turban_rebellions.5.desc.peng
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = red_turban_rebellions.5.desc
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CTW
			location = hanchuan
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		if = {
			limit = {
				exists = character:chi_yingyu_peng
				character:chi_yingyu_peng = {
					is_alive = yes
				}
			}
			character:chi_yingyu_peng = { save_scope_as = monk_character }
		}
		else = {
			if = {
				limit = { current_year < 1375 }
				create_character = {
					first_name = name_pu3.name_sheng
					last_name = name_zou
					birth_date = 1320 #Unknown but active 1351
					culture = culture:jianghuai_culture
					religion = religion:sanjiao
					estate = estate_type:nobles_estate
					adm = 55
					dip = 55
					mil = 80
					script = ctw_pusheng_zou
					save_scope_as = target_character_1
				}
			}
			else = {
				create_character = {
					age = 30
					culture = culture:jianghuai_culture
					religion = religion:sanjiao
					estate = estate_type:nobles_estate
					adm = 55
					dip = 55
					mil = 80
					script = ctw_pusheng_zou
					save_scope_as = target_character_1
				}
			}
		}
		dynasty:rtr_tianwan_xu_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = hanchuan	tag = CTW }
		rtr_add_cores_to_province = { province = dean_province				tag = CTW }
		rtr_add_cores_to_province = { province = huangzhou_province			tag = CTW }
		rtr_add_cores_to_province = { province = luan_nanzhili_province		tag = CTW }
		rtr_add_cores_to_province = { province = guangzhou_henan_province	tag = CTW }
		rtr_add_cores_to_province = { province = xinyang_province			tag = CTW }
		rtr_add_cores_to_province = { province = suizhou_province			tag = CTW }
		rtr_add_cores_to_province = { province = anlu_province				tag = CTW }
		rtr_add_cores_to_province = { province = jingmen_province			tag = CTW }
		rtr_add_cores_to_province = { province = mianyang_province			tag = CTW }
		rtr_add_cores_to_province = { province = jingzhou_province			tag = CTW }
		rtr_add_cores_to_province = { province = lizhou_province			tag = CTW }
		rtr_add_cores_to_province = { province = yiling_province			tag = CTW }
		rtr_add_cores_to_province = { province = xiangyang_province			tag = CTW }
		rtr_add_cores_to_province = { province = fangzhou_province			tag = CTW }
		rtr_add_cores_to_province = { province = guizhou_huguang_province	tag = CTW }
		rtr_add_core_to_location = { location = rongmei						tag = CTW }
		rtr_add_core_to_location = { location = wufeng						tag = CTW }
		rtr_add_core_to_location = { location = huarong						tag = CTW }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_shou.name_hui1
				dynasty = scope:target_dynasty
				birth_date = 1320 #Exact date unknown
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = ctw_shouhui_xu
				save_scope_as = target_character
			}
			create_character = {
				first_name = name_wen.name_jun
				last_name = name_ni
				birth_date = 1320 #Unknown
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 40
				dip = 40
				mil = 75
				script = ctw_wenjun_ni
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 35
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = ctw_shouhui_xu
				save_scope_as = target_character
			}
			create_character = {
				age = 35
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 40
				dip = 40
				mil = 75
				script = ctw_wenjun_ni
			}
		}
		if = {
			limit = { NOT = { exists = scope:target_character_1 } }
			if = {
				limit = { current_year < 1375 }
				create_character = {
					first_name = name_pu3.name_sheng
					last_name = name_zou
					birth_date = 1320 #Unknown but active 1351
					culture = culture:jianghuai_culture
					religion = religion:sanjiao
					estate = estate_type:nobles_estate
					adm = 55
					dip = 55
					mil = 80
					script = ctw_pusheng_zou
					save_scope_as = target_character_1
				}
			}
			else = {
				create_character = {
					age = 30
					culture = culture:jianghuai_culture
					religion = religion:sanjiao
					estate = estate_type:nobles_estate
					adm = 55
					dip = 55
					mil = 80
					script = ctw_pusheng_zou
					save_scope_as = target_character_1
				}
			}
		}
	}
	option = {
		name = red_turban_rebellions.5.a
		rtr_release_warlord_tag = { tag = CTW culture = culture:chu_culture accepted_culture = culture:jianghuai_culture }
		c:CTW = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CTW }
		if = {
			limit = { exists = scope:monk_character }
			scope:monk_character = {
				remove_character_modifier = rebel_leader_modifier
				move_country = scope:target_country
			}
		}
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CTW culture = culture:chu_culture accepted_culture = culture:jianghuai_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		if = {
			limit = { exists = scope:monk_character }
			scope:monk_character = {
				remove_character_modifier = rebel_leader_modifier
				move_country = scope:target_country
			}
		}
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
	after = {
		set_variable = rtr_korea_rebellion_event
		if = {
			limit = { exists = scope:target_country }
			if = {
				limit = { exists = scope:target_character_1 }
				scope:target_character_1 = {
					move_country = scope:target_country
					every_child = {
						limit = { owner = ROOT }
						move_country = scope:target_country
					}
				}
			}
		}
	}
}

#Chen Yuliang's Rebellion (rtr_release_tag_CHE)
red_turban_rebellions.6 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = red_turban_rebellions.6.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CHE
			location = dehua_jiujiang
		}
		exists = character:ctw_shouhui_xu
		exists = character:ctw_pusheng_zou
		exists = character:ctw_wenjun_ni
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_chen_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = dehua_jiujiang	tag = CHE }
		rtr_add_cores_to_province = { province = wuchang_province			tag = CHE }
		rtr_add_cores_to_province = { province = xingguo_province			tag = CHE }
		rtr_add_cores_to_province = { province = ningzhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = nankang_province			tag = CHE }
		rtr_add_cores_to_province = { province = nanchang_province			tag = CHE }
		rtr_add_cores_to_province = { province = fuzhou_jiangxi_province	tag = CHE }
		rtr_add_cores_to_province = { province = linjiang_province			tag = CHE }
		rtr_add_cores_to_province = { province = ruizhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = yuanzhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = yuezhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = raozhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = guangxin_province			tag = CHE }
		rtr_add_cores_to_province = { province = jianchang_province			tag = CHE }
		rtr_add_cores_to_province = { province = huizhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = chizhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = anqing_province			tag = CHE }
		rtr_add_cores_to_province = { province = quzhou_province			tag = CHE }
		rtr_add_cores_to_province = { province = yanzhou_province			tag = CHE }
		rtr_add_core_to_location = { location = yongan_youzhou						tag = CHE }
		rtr_add_core_to_location = { location = liuyang						tag = CHE }
		rtr_add_core_to_location = { location = liling						tag = CHE }
		rtr_add_core_to_location = { location = changsha					tag = CHE }
		rtr_add_core_to_location = { location = xiangyin					tag = CHE }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_you.name_liang4
				dynasty = scope:target_dynasty
				birth_date = 1320 #Exact date unknown
				culture = culture:chu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = che_youliang_chen
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 37
				culture = culture:chu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = che_youliang_chen
				save_scope_as = target_character
			}
		}
		character:ctw_shouhui_xu = { save_scope_as = ctw_shouhui_xu }
		character:ctw_pusheng_zou = { save_scope_as = ctw_pusheng_zou }
		character:ctw_wenjun_ni = { save_scope_as = ctw_wenjun_ni }
		c:CTW = { save_scope_as = target_country_2 }
	}
	option = {
		name = red_turban_rebellions.6.a
		rtr_release_warlord_tag = { tag = CHE culture = culture:chu_culture accepted_culture = culture:gan_culture }
		c:CHE = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CHE }
		if = {
			limit = { country_exists = c:CTW }
			custom_tooltip = {
				text = red_turban_rebellions.34.a.tt
				c:CTW = { trigger_event_silently = { id = red_turban_rebellions.34 days = 2 } }
			}
		}
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CHE culture = culture:chu_culture accepted_culture = culture:gan_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
		if = {
			limit = { country_exists = c:CTW }
			custom_tooltip = {
				text = red_turban_rebellions.34.a.tt
				c:CTW = { trigger_event_silently = { id = red_turban_rebellions.34 days = 2 } }
			}
		}
	}
	after = {
		set_variable = rtr_tibet_rebellion_event
	}
}

#The bandit Zhang Shicheng (rtr_release_tag_WUU)
red_turban_rebellions.7 = {
	randomlog = yes # Tracking Desync 20251120
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = red_turban_rebellions.7.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = WUU
			location = gaoyou
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_wu_zhang_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = gaoyou	tag = WUU }
		rtr_add_cores_to_province = { province = yangzhou_province			tag = WUU }
		rtr_add_cores_to_province = { province = taizhou_nanzhili_province	tag = WUU }
		rtr_add_cores_to_province = { province = tongzhou_province			tag = WUU }
		rtr_add_cores_to_province = { province = suzhou_province			tag = WUU }
		rtr_add_cores_to_province = { province = songjiang_province			tag = WUU }
		rtr_add_cores_to_province = { province = jiaxing_province			tag = WUU }
		rtr_add_cores_to_province = { province = huaian_province			tag = WUU }
		rtr_add_core_to_location = { location = jiangyin					tag = WUU }
		rtr_add_core_to_location = { location = wuxi						tag = WUU }
		rtr_add_core_to_location = { location = tianchang					tag = WUU }
		rtr_add_core_to_location = { location = xuyi						tag = WUU }
		rtr_add_core_to_location = { location = haining						tag = WUU }
		rtr_add_core_to_location = { location = hangzhou					tag = WUU }
		rtr_add_core_to_location = { location = xiaoshan					tag = WUU }
		rtr_add_core_to_location = { location = fuyang_hangzhou				tag = WUU }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_shi4.name_cheng22
				dynasty = scope:target_dynasty
				birth_date = 1321 #Exact date unknown
				culture = culture:wu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = wuu_shicheng_zhang
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 32
				culture = culture:wu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = wuu_shicheng_zhang
				save_scope_as = target_character
			}
		}
	}
	option = {
		name = red_turban_rebellions.7.a
		rtr_release_warlord_tag = { tag = WUU culture = culture:wu_culture accepted_culture = culture:jianghuai_culture }
		c:WUU = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:WUU }
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = WUU culture = culture:wu_culture accepted_culture = culture:jianghuai_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
	after = {
		c:WUU = {
			set_variable = {
				name = character_creator
				value = 18	#His 18 buddies
			}
			while = {
				limit = { var:character_creator > 0 }
				change_variable = {
					name = character_creator
					subtract = 1
				}
				create_character = {
					culture = culture:wu_culture
					religion = religion:sanjiao
					min_age = 27
				}
			}
			remove_variable = character_creator
		}
	}
}

#Fang Guozhen Piracy (rtr_release_tag_CFN)
red_turban_rebellions.8 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = red_turban_rebellions.8.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CFN
			location = yongjia
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_fang_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = yongjia	tag = CFN }
		rtr_add_cores_to_province = { province = taizhou_province			tag = CFN }
		rtr_add_cores_to_province = { province = ningbo_province			tag = CFN }
		rtr_add_cores_to_province = { province = funing_province			tag = CFN }
		rtr_add_cores_to_province = { province = jianning_province			tag = CFN }
		rtr_add_cores_to_province = { province = chuzhou_zhejiang_province	tag = CFN }
		rtr_add_cores_to_province = { province = jinhua_province			tag = CFN }
		rtr_add_cores_to_province = { province = shaoxing_province			tag = CFN }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_guo2.name_zhen12
				dynasty = scope:target_dynasty
				birth_date = 1319 #Exact date unknown
				culture = culture:taizhou_wu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cfn_guozhen_fang
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 34
				culture = culture:taizhou_wu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cfn_guozhen_fang
				save_scope_as = target_character
			}
		}
		c:CFN = {
			change_societal_value = {
				type = land_vs_naval
				value = 75
			}
			change_societal_value = {
				type = individualism_vs_communalism
				value = -80
			}
			change_societal_value = {
				type = centralization_vs_decentralization
				value = 50
			}
			change_societal_value = {
				type = outward_vs_inward
				value = -60
			}
			change_societal_value = {
				type = belligerent_vs_conciliatory
				value = -75
			}
		}
	}
	option = {
		name = red_turban_rebellions.8.a
		rtr_release_warlord_tag = { tag = CFN culture = culture:taizhou_wu_culture accepted_culture = culture:ouhai_culture }
		c:CFN = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CFN }
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CFN culture = culture:taizhou_wu_culture accepted_culture = culture:ouhai_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Mao Gui Rebellion (rtr_release_tag_CMO)
red_turban_rebellions.9 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = red_turban_rebellions.9.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CMO
			location = zichuan
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_mao_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = zichuan	tag = CMO }
		rtr_add_cores_to_province = { province = laizhou_province			tag = CMO }
		rtr_add_cores_to_province = { province = jiaozhou_province			tag = CMO }
		rtr_add_cores_to_province = { province = mizhou_province			tag = CMO }
		rtr_add_cores_to_province = { province = juzhou_province			tag = CMO }
		rtr_add_cores_to_province = { province = jinan_province				tag = CMO }
		rtr_add_cores_to_province = { province = taian_province				tag = CMO }
		rtr_add_cores_to_province = { province = yanzhou_shandong_province	tag = CMO }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_gui
				dynasty = scope:target_dynasty
				birth_date = 1320 #Unknown but active 1357
				culture = culture:jilu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 45
				dip = 45
				mil = 45
				script = cmo_gui_mao
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 30
				culture = culture:jilu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 45
				dip = 45
				mil = 45
				script = cmo_gui_mao
				save_scope_as = target_character
			}
		}
	}
	option = {
		name = red_turban_rebellions.9.a
		rtr_release_warlord_tag = { tag = CMO culture = culture:jiaodong_culture accepted_culture = culture:jilu_culture }
		c:CMO = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CMO }
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CMO culture = culture:jiaodong_culture accepted_culture = culture:jilu_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Ming Xia (rtr_release_tag_CXI)
red_turban_rebellions.10 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { country_exists = c:CHE }
				desc = red_turban_rebellions.10.desc
			}
			triggered_desc = {
				trigger = { NOT = { country_exists = c:CHE } }
				desc = red_turban_rebellions.10.desc.fallback
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CXI
			location = baxian
		}
		exists = character:che_youliang_chen
		exists = character:ctw_shouhui_xu
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_xia_ming_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = baxian	tag = CXI }
		rtr_add_cores_to_province = { province = fuzhou_sichuan_province	tag = CXI }
		rtr_add_cores_to_province = { province = zhongzhou_province			tag = CXI }
		rtr_add_cores_to_province = { province = guangan_province			tag = CXI }
		rtr_add_cores_to_province = { province = shunqing_province			tag = CXI }
		rtr_add_cores_to_province = { province = baoning_province			tag = CXI }
		rtr_add_cores_to_province = { province = guangyuan_province			tag = CXI }
		rtr_add_cores_to_province = { province = jianzhou_province			tag = CXI }
		rtr_add_cores_to_province = { province = tongchuan_province			tag = CXI }
		rtr_add_cores_to_province = { province = suining_province			tag = CXI }
		rtr_add_cores_to_province = { province = hezhou_sichuan_province	tag = CXI }
		rtr_add_cores_to_province = { province = changzhou_sichuan_province	tag = CXI }
		rtr_add_cores_to_province = { province = luzhou_sichuan_province	tag = CXI }
		rtr_add_cores_to_province = { province = xuzhou_sichuan_province	tag = CXI }
		rtr_add_cores_to_province = { province = jiading_province			tag = CXI }
		rtr_add_cores_to_province = { province = jianzhou_west_province		tag = CXI }
		rtr_add_cores_to_province = { province = chengdu_province			tag = CXI }
		rtr_add_cores_to_province = { province = meizhou_province			tag = CXI }
		rtr_add_cores_to_province = { province = qiongzhou_sichuan_province	tag = CXI }
		rtr_add_cores_to_province = { province = pengzhou_province			tag = CXI }
		rtr_add_cores_to_province = { province = hanzhou_province			tag = CXI }
		if = {
			limit = {
				current_year > 1350
				current_year < 1385
			}
			create_character = {
				first_name = name_yu4.name_zhen12
				dynasty = scope:target_dynasty
				birth_date = 1328.10.2
				culture = culture:shu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cxi_yuzhen_ming
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 34
				culture = culture:shu_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cxi_yuzhen_ming
				save_scope_as = target_character
			}
		}
		character:che_youliang_chen = { save_scope_as = che_youliang_chen }
	}
	option = {
		name = red_turban_rebellions.10.a
		trigger = { country_exists = c:CHE }
		rtr_release_warlord_tag = { tag = CXI culture = culture:shu_culture accepted_culture = culture:tujia_culture }
		c:CXI = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CXI }
		hidden_effect = {
			c:CHE = { trigger_event_non_silently = { id = red_turban_rebellions.35 days = 1 } }
		}
	}
	option = {
		name = red_turban_rebellions.10.b
		trigger = { NOT = { country_exists = c:CHE } }
		rtr_release_warlord_tag = { tag = CXI culture = culture:shu_culture accepted_culture = culture:tujia_culture }
		c:CXI = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CXI }
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CXI culture = culture:shu_culture accepted_culture = culture:tujia_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
		if = {
			limit = { country_exists = c:CHE }
			hidden_effect = {
				c:CHE = { trigger_event_non_silently = { id = red_turban_rebellions.35 days = 1 } }
			}
		}
	}
}

#Guo Zixing (rtr_release_tag_CGU)
red_turban_rebellions.11 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_tag.title
	desc = red_turban_rebellions.11.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CGU
			location = zhongli
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_guo_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = zhongli	tag = CGU }
		rtr_add_cores_to_province = { province = chuzhou_province	tag = CGU }
		rtr_add_cores_to_province = { province = luzhou_province	tag = CGU }
		rtr_add_cores_to_province = { province = shouzhou_province	tag = CGU }
		rtr_add_cores_to_province = { province = sizhou_province	tag = CGU }
		rtr_add_cores_to_province = { province = pizhou_province	tag = CGU }
		if = {
			limit = { current_year < 1360 } #Dies in 1355, but given a bit extra time compared to the rest as he is born quite earlier
			create_character = {
				first_name = name_zi.name_xing
				dynasty = scope:target_dynasty
				birth_date = 1302 #Exact date unknown
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cgu_zixing_guo
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 34
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cgu_zixing_guo
				save_scope_as = target_character
			}
		}
	}
	option = {
		name = red_turban_rebellions.11.a
		rtr_release_warlord_tag = { tag = CGU culture = culture:jianghuai_culture accepted_culture = culture:zhongyuan_culture }
		c:CGU = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = c:CGU }
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CGU culture = culture:jianghuai_culture accepted_culture = culture:zhongyuan_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Rise of Ming (rtr_release_tag_MNG)
red_turban_rebellions.12 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.12.title
	desc = red_turban_rebellions.12.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = MNG
			location = shangyuan
		}
		exists = character:cgu_zixing_guo
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_ming_zhu_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = shangyuan	tag = MNG }
		rtr_add_cores_to_province = { province = zhenjiang_province	tag = MNG }
		rtr_add_cores_to_province = { province = changzhou_province	tag = MNG }
		rtr_add_cores_to_province = { province = huzhou_province	tag = MNG }
		rtr_add_cores_to_province = { province = hangzhou_province	tag = MNG }
		rtr_add_cores_to_province = { province = ningguo_province	tag = MNG }
		rtr_add_cores_to_province = { province = guangde_province	tag = MNG }
		rtr_add_cores_to_province = { province = taiping_province	tag = MNG }
		rtr_add_cores_to_province = { province = he_province		tag = MNG }
		if = {
			limit = {
				current_year > 1350
				current_year < 1385
			}
			create_character = {
				first_name = name_yuan2.name_zhang12
				dynasty = scope:target_dynasty
				birth_date = 1328.10.21
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate	#Technically monk, but for the sake or rulership, he will be a noble
				adm = 95
				dip = 95
				mil = 95
				script = mng_yuanzhang_zhu
				save_scope_as = target_character
				add_to_list = characters_to_move
			}
			create_character = {
				first_name = name_xiu.name_ying
				last_name = name_ma
				birth_date = 1332.7.18
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate	#Technically peasant, but for the sake or rulership, she will be a noble
				adm = 80
				dip = 80
				mil = 80
				script = mng_xiuying_ma
				female = yes
				marry_character = scope:target_character
				save_scope_as = mng_xiuying_ma
				add_to_list = characters_to_move
			}
			if = {
				limit = { current_year > 1355 }
				create_character = {
					first_name = name_biao
					dynasty = scope:target_dynasty
					birth_date = 1355.10.10
					culture = culture:jianghuai_culture
					religion = religion:sanjiao
					father = scope:target_character
					mother = scope:mng_xiuying_ma
					add_to_list = characters_to_move
				}
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 25
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 95
				dip = 95
				mil = 95
				script = mng_yuanzhang_zhu
				save_scope_as = target_character
				add_to_list = characters_to_move
			}
			create_character = {
				age = 21
				culture = culture:jianghuai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 80
				dip = 80
				mil = 80
				script = mng_xiuying_ma
				female = yes
				marry_character = scope:target_character
				save_scope_as = mng_xiuying_ma
				add_to_list = characters_to_move
			}
		}
		character:cgu_zixing_guo = { save_scope_as = cgu_zixing_guo }
		c:MNG = {
			change_country_flag = CHI_Ming
			add_army_tradition = army_tradition_ultimate_bonus
		}
	}
	after = {
		every_in_list = {
			list = characters_to_move
			move_country = c:MNG
		}
		c:MNG = {
			set_new_ruler = scope:target_character
		}
		scope:target_character ?= {
			add_character_modifier = {
				mode = add_and_extend
				modifier = rtr_yuanzhangs_leadership
				years = -1
			}
		}
		hidden_effect = {
			c:MNG = { trigger_event_silently = { id = red_turban_rebellions.36 days = { 30 60 } } }	#Additional Loyalists join Ming
			if = {
				limit = { country_exists = c:CGU }
				c:CGU = { trigger_event_silently = { id = red_turban_rebellions.37 days = { 45 90 } } }	#Guo leadership dies and Ming inherits it
			}
		}
	}
	option = {
		name = red_turban_rebellions.12.a
		rtr_release_warlord_tag = { tag = MNG culture = culture:jianghuai_culture accepted_culture = culture:wu_culture }
		c:MNG = {
			rtr_change_allegiance_points = { value = -100 }
			hidden_effect = {
				set_gold = 10000
				set_stability = 50
				set_army_tradition = 50
				capital = {
					create_sub_unit_of_category = sub_unit_category:army_infantry
					create_sub_unit_of_category = sub_unit_category:army_infantry
					create_sub_unit_of_category = sub_unit_category:army_infantry
					create_sub_unit_of_category = sub_unit_category:army_infantry
					create_sub_unit_of_category = sub_unit_category:army_infantry
					create_sub_unit_of_category = sub_unit_category:army_infantry
					create_sub_unit_of_category = sub_unit_category:army_cavalry
					create_sub_unit_of_category = sub_unit_category:army_cavalry
					create_sub_unit_of_category = sub_unit_category:army_cavalry
					create_sub_unit_of_category = sub_unit_category:army_cavalry
					create_sub_unit_of_category = sub_unit_category:army_auxiliary
					create_sub_unit_of_category = sub_unit_category:army_auxiliary
					create_sub_unit_of_category = sub_unit_category:army_auxiliary
					create_sub_unit_of_category = sub_unit_category:army_auxiliary
				}
			}
		}
		rtr_add_country_to_rebels_and_dow_china = { country = c:MNG }
		if = {
			limit = { country_exists = c:CGU }
			c:CGU = {
				if = {
					limit = { has_regent = yes is_ai = yes }
					every_owned_location = { add_core = c:MNG }
					c:MNG = { annex_country = { country = prev } }
				}
				else = {
					create_relation = {
						first = this
						second = c:MNG
						type = relation_type:alliance
					}
				}
			}
		}
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = MNG culture = culture:jianghuai_culture accepted_culture = culture:wu_culture }
		scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
		rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		if = {
			limit = { country_exists = c:CGU }
			c:CGU = {
				if = {
					limit = { has_regent = yes is_ai = yes }
					every_owned_location = { add_core = c:MNG }
					c:MNG = { annex_country = { country = prev } }
				}
				else = {
					create_relation = {
						first = this
						second = c:MNG
						type = relation_type:alliance
					}
				}
			}
		}
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Chen Youding Counter Offensive (rtr_release_tag_CNP)	https://en.wikipedia.org/wiki/Chen_Youding
red_turban_rebellions.13 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_loyalist.title
	desc = red_turban_rebellions.13.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CNP
			location = nanping
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_nanping_chen_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = nanping	tag = CNP }
		rtr_add_cores_to_province = { province = fuzhou_province	tag = CNP }
		rtr_add_cores_to_province = { province = xinghua_province	tag = CNP }
		rtr_add_cores_to_province = { province = quanzhou_province	tag = CNP }
		rtr_add_cores_to_province = { province = zhangzhou_province	tag = CNP }
		rtr_add_cores_to_province = { province = tingzhou_province	tag = CNP }
		rtr_add_cores_to_province = { province = chaozhou_province	tag = CNP }
		if = {
			limit = {
				current_year > 1350
				current_year < 1385
			}
			create_character = {
				first_name = name_you.name_ding4
				dynasty = scope:target_dynasty
				birth_date = 1330 #Exact date unknown
				culture = culture:fuzhou_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cnp_youding_chen
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 23
				culture = culture:fuzhou_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cnp_youding_chen
				save_scope_as = target_character
			}
		}
		if = {
			limit = { has_ruler = yes }
			ruler ?= { save_scope_as = ruler_character }
		}
		else = {
			regent ?= { save_scope_as = ruler_character }
		}
		rtr_create_war_list = yes
	}
	option = {
		name = red_turban_rebellions.13.a
		rtr_release_warlord_tag = { tag = CNP culture = culture:fuzhou_culture accepted_culture = culture:minnan_culture }
		c:CNP = { rtr_join_china_in_wars = yes }
	}
	option = {
		name = red_turban_rebellions.release_loyalist.b
		add_stability = stability_mild_bonus
		remove_variable = rtr_release_tag_CNP
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CNP culture = culture:fuzhou_culture accepted_culture = culture:minnan_culture }
		c:CNP = { rtr_join_china_in_wars = yes }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#He Zhen Counter Attack (rtr_release_tag_CDN)
red_turban_rebellions.14 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_loyalist.title
	desc = red_turban_rebellions.release_loyalist.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CDN
			location = dongguan
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_dongguan_he_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = dongguan	tag = CDN }
		rtr_add_cores_to_province = { province = panyu_province				tag = CDN }
		rtr_add_cores_to_province = { province = guangzhou_province			tag = CDN }
		rtr_add_cores_to_province = { province = huizhou_guangdong_province	tag = CDN }
		rtr_add_cores_to_province = { province = zhaoqing_province			tag = CDN }
		rtr_add_cores_to_province = { province = xinhui_province			tag = CDN }
		rtr_add_cores_to_province = { province = nanen_province				tag = CDN }
		rtr_add_cores_to_province = { province = deqing_province			tag = CDN }
		rtr_add_cores_to_province = { province = gaozhou_province			tag = CDN }
		rtr_add_cores_to_province = { province = huazhou_province			tag = CDN }
		rtr_add_cores_to_province = { province = leizhou_province			tag = CDN }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_zhen
				dynasty = scope:target_dynasty
				birth_date = 1321 #Exact date unknown
				culture = culture:yuehai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cdn_zhen_he
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 34
				culture = culture:yuehai_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cdn_zhen_he
				save_scope_as = target_character
			}
		}
		rtr_create_war_list = yes
	}
	option = {
		name = red_turban_rebellions.release_loyalist.a
		historical_option = yes
		rtr_release_warlord_tag = { tag = CDN culture = culture:yuehai_culture accepted_culture = culture:kejia_culture }
		c:CDN = { rtr_join_china_in_wars = yes }
	}
	option = {
		name = red_turban_rebellions.release_loyalist.b
		add_stability = stability_mild_bonus
		remove_variable = rtr_release_tag_CDN
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CDN culture = culture:yuehai_culture accepted_culture = culture:kejia_culture }
		c:CDN = { rtr_join_china_in_wars = yes }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Li Siqi Counter Attack (rtr_release_tag_CSI)
red_turban_rebellions.15 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_loyalist.title
	desc = red_turban_rebellions.release_loyalist.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CSI
			location = jingzhao
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:rtr_li_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = jingzhao	tag = CSI }
		rtr_add_cores_to_province = { province = qianzhou_province			tag = CSI }
		rtr_add_cores_to_province = { province = fengxiang_province			tag = CSI }
		rtr_add_cores_to_province = { province = fengzhou_province			tag = CSI }
		rtr_add_cores_to_province = { province = hanzhong_province			tag = CSI }
		rtr_add_cores_to_province = { province = yangzhou_shaanxi_province	tag = CSI }
		rtr_add_cores_to_province = { province = xingan_province			tag = CSI }
		rtr_add_cores_to_province = { province = shangzhou_province			tag = CSI }
		rtr_add_cores_to_province = { province = huazhou_shaanxi_province	tag = CSI }
		rtr_add_cores_to_province = { province = junzhou_province			tag = CSI }
		if = {
			limit = { current_year < 1375 }
			create_character = {
				first_name = name_si.name_qi2
				dynasty = scope:target_dynasty
				birth_date = 1323 #Exact date unknown
				culture = culture:zhongyuan_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = csi_siqi_li
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 30
				culture = culture:zhongyuan_culture
				religion = religion:sanjiao
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = csi_siqi_li
				save_scope_as = target_character
			}
		}
		rtr_create_war_list = yes
	}
	option = {
		name = red_turban_rebellions.release_loyalist.a
		historical_option = yes
		rtr_release_warlord_tag = { tag = CSI culture = culture:qin_culture accepted_culture = culture:zhongyuan_culture }
		c:CSI = { rtr_join_china_in_wars = yes }
	}
	option = {
		name = red_turban_rebellions.release_loyalist.b
		add_stability = stability_mild_bonus
		remove_variable = rtr_release_tag_CSI
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CSI culture = culture:qin_culture accepted_culture = culture:zhongyuan_culture }
		c:CSI = { rtr_join_china_in_wars = yes }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Köke Temur Counter Attack (rtr_release_tag_CKO)
red_turban_rebellions.16 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_loyalist.title
	desc = red_turban_rebellions.release_loyalist.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CKO
			location = kaifeng
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		dynasty:bayad_dynasty = { save_scope_as = target_dynasty }
		rtr_create_revolter_capital = { location = kaifeng	tag = CKO }
		rtr_add_cores_to_province = { province = zhengzhou_province			tag = CKO }
		rtr_add_cores_to_province = { province = huaiqing_province			tag = CKO }
		rtr_add_cores_to_province = { province = daming_province			tag = CKO }
		rtr_add_cores_to_province = { province = weihui_province			tag = CKO }
		rtr_add_cores_to_province = { province = zhangde_province			tag = CKO }
		rtr_add_cores_to_province = { province = cizhou_province			tag = CKO }
		rtr_add_cores_to_province = { province = guangping_province			tag = CKO }
		rtr_add_cores_to_province = { province = shunde_province			tag = CKO }
		rtr_add_cores_to_province = { province = zhaozhou_province			tag = CKO }
		rtr_add_cores_to_province = { province = zhending_province			tag = CKO }
		rtr_add_cores_to_province = { province = dingzhou_province			tag = CKO }
		rtr_add_cores_to_province = { province = baoding_province			tag = CKO }
		rtr_add_cores_to_area = { area = shanxi_area						tag = CKO }
		if = {
			limit = {
				current_year > 1350
				current_year < 1385
			}
			create_character = {
				first_name = name_koke.name_temur
				dynasty = scope:target_dynasty
				birth_date = 1330 #Exact date unknown
				culture = culture:mongolian_culture
				religion = religion:tibetan_buddhism
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cko_temur_koke
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 34
				culture = culture:mongolian_culture
				religion = religion:tibetan_buddhism
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cko_temur_koke
				save_scope_as = target_character
			}
		}
		rtr_create_war_list = yes
	}
	option = {
		name = red_turban_rebellions.release_loyalist.a
		historical_option = yes
		rtr_release_warlord_tag = { tag = CKO culture = culture:mongolian_culture accepted_culture = culture:zhongyuan_culture }
		c:CKO = { rtr_join_china_in_wars = yes }
	}
	option = {
		name = red_turban_rebellions.release_loyalist.b
		add_stability = stability_mild_bonus
		remove_variable = rtr_release_tag_CKO
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CKO culture = culture:mongolian_culture accepted_culture = culture:zhongyuan_culture }
		c:CKO = { rtr_join_china_in_wars = yes }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Naghachu (rtr_release_tag_CNA)
red_turban_rebellions.17 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_loyalist.title
	desc = red_turban_rebellions.release_loyalist.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	trigger = {
		rtr_can_release_tag = {
			tag = CNA
			location = liaoyang
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		location:liaoyang = {
			create_dynasty_from_location = random
			last_dynasty_in_location ?= { save_scope_as = target_dynasty }
		}
		rtr_create_revolter_capital = { location = liaoyang	tag = CNA }
		rtr_add_cores_to_province = { province = jinzhou_province			tag = CNA }
		rtr_add_cores_to_province = { province = guangning_province			tag = CNA }
		rtr_add_cores_to_province = { province = yizhou_liaodong_province	tag = CNA }
		if = {
			limit = {
				current_year > 1360
				current_year < 1400
			}
			create_character = {
				first_name = name_naghachu
				dynasty = scope:target_dynasty
				birth_date = 1340 #Unknown
				culture = culture:mongolian_culture
				religion = religion:tibetan_buddhism
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cna_naghachu
				save_scope_as = target_character
			}
		}
		else = {
			create_character = {
				dynasty = scope:target_dynasty
				age = 34
				culture = culture:mongolian_culture
				religion = religion:tibetan_buddhism
				estate = estate_type:nobles_estate
				adm = 60
				dip = 60
				mil = 60
				script = cna_naghachu
				save_scope_as = target_character
			}
		}
		rtr_create_war_list = yes
	}
	option = {
		name = red_turban_rebellions.release_loyalist.a
		historical_option = yes
		rtr_release_warlord_tag = { tag = CNA culture = culture:mongolian_culture accepted_culture = culture:kharchin_culture }
		c:CNA = { rtr_join_china_in_wars = yes }
	}
	option = {
		name = red_turban_rebellions.release_loyalist.b
		add_stability = stability_mild_bonus
		remove_variable = rtr_release_tag_CNA
	}
	option = {
		name = red_turban_rebellions.play_as_tag
		trigger = { hidden_trigger = { is_ai = no } }
		rtr_release_warlord_tag = { tag = CNA culture = culture:mongolian_culture accepted_culture = culture:kharchin_culture }
		c:CNA = { rtr_join_china_in_wars = yes }
		change_player = scope:target_country
		hidden_effect = {
			scope:target_country = { trigger_event_non_silently = { id = red_turban_rebellions.19 days = 1 } }
		}
	}
}

#Generic Culture Release
red_turban_rebellions.18 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.release_culture.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { exists = scope:target_country }
				desc = red_turban_rebellions.18.desc
			}
			triggered_desc = {
				trigger = { always = yes }
				desc = red_turban_rebellions.18.desc.fallback
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	major = yes
	major_trigger = {
		rtr_can_see_the_situation = yes
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		rtr_prepare_biggest_culture_warlord = yes
	}
	option = {
		name = red_turban_rebellions.18.a
		trigger = { exists = scope:target_country }
		rtr_release_biggest_culture_warlord = yes
		change_gold_effect = { scale = -3 }
		scope:target_country = {
			rtr_change_allegiance_points = { value = 40 }
			add_gold = {
				value = root.monthly_income_trade_and_tax
				multiply = 3
			}
		}
	}
	option = {
		name = red_turban_rebellions.18.b
		if = {
			limit = { exists = scope:target_country }
			rtr_release_biggest_culture_warlord = yes
			scope:target_country = { rtr_change_allegiance_points = { value = -100 } }
			rtr_add_country_to_rebels_and_dow_china = { country = scope:target_country }
		}
	}
}

#Player info event for the released warlord
red_turban_rebellions.19 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.19.title
	desc = red_turban_rebellions.19.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.19.a
		custom_tooltip = red_turban_rebellions.19.a.tt
	}
}

###########################
# Generic disaster events #
###########################

#Peasant Revolt
red_turban_rebellions.20 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.20.title
	desc = red_turban_rebellions.20.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		any_rebel = {
			estate_type ?= estate_type:peasants_estate
	    }
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		random_rebel = {
			limit = {
				estate_type ?= estate_type:peasants_estate
			}
			save_scope_as = target_rebel
	    }
	}

	option = {
		name = red_turban_rebellions.20.a
		scope:target_rebel = { add_rebel_progress = 0.1 }
		add_stability = stability_mild_penalty
	}
	option = {
		name = red_turban_rebellions.20.b
		add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_weak_bonus }
		change_gold_effect = { scale = -2 }
		add_prestige = stability_mild_bonus
	}
}

#Mandate Questioned
red_turban_rebellions.21 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.21.title
	desc = red_turban_rebellions.21.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		num_possible_estate_privileges:nobles_estate > 0
		any_rebel = { count > 0 }
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		if = {
			limit = { NOT = { any_rebel = { estate_type ?= estate_type:nobles_estate } } }
			create_rebel = {
				name = noble_enemies_to_the_mandate
				category = estate
				estate = nobles_estate
				save_scope_as = target_rebel
			}
		}
		else = {
			random_rebel = {
				limit = { estate_type ?= estate_type:nobles_estate }
				save_scope_as = target_rebel
			}
		}
	}
	option = {
		name = red_turban_rebellions.21.a
		change_celestial_authority = { value = celestial_authority_weak_bonus }
		scope:target_rebel = {
			add_rebel_progress = 0.1
		}
	}
	option = {
		name = red_turban_rebellions.21.b
		change_celestial_authority = { value = celestial_authority_weak_penalty }
		"estate(estate_type:nobles_estate)" = {
			random_possible_privilege = {
				root = { grant_estate_privilege = prev }
			}
		}
		if = {
			limit = { scope:target_rebel = { rebel_progress <= 0.1 } }
			destroy_rebel = scope:target_rebel
		}
		else = {
			scope:target_rebel = { add_rebel_progress = -0.1 }
		}
	}
}

#Support of [ROOT.GetCountry.GetGovernment.GetRulerOrRegent.GetNameWithNoTooltip]
red_turban_rebellions.22 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.22.title
	desc = red_turban_rebellions.22.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		country_exists = root	#Just to make sure the event only fires if the country is on the map
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		save_scope_as = target_country
		c:CHI = { save_scope_as = from_country }
		ruler_or_regent ?= { save_scope_as = target_character }
	}
	option = {
		name = red_turban_rebellions.22.a
		scope:target_character = {
			add_character_modifier = {
				modifier = rtr_support_of_the_people
				years = -1
				mode = add_and_extend
				size = {
					value = total_abilities
					divide = 100
					min = 1
				}
			}
		}
		add_stability = stability_extreme_bonus
		custom_tooltip = {
			text = red_turban_rebellions.22.a.tt
			every_owned_location = {
				change_control = control_radical_bonus
			}
		}
		custom_tooltip = {
			text = red_turban_rebellions.22.char.tt

			while = {
				count = 10

				create_character = {
					min_age = 20
					adm = { 40 70 }
					dip = { 40 70 }
					mil = { 40 70 }

				}
			}

		}
	}
}

###########################
# Specific Warlord events #
###########################

#The Hunt for Shantong Han
red_turban_rebellions.30 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.30.title
	desc = red_turban_rebellions.30.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		exists = character:cso_shantong_han
		character:cso_shantong_han = {
			is_alive = yes
		}
		exists = character:cso_liner_han
		character:cso_liner_han = {
			is_alive = yes
			is_heir = yes
		}
		exists = character:cso_futong_liu
		character:cso_futong_liu = {
			is_alive = yes
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		capital = {
			save_scope_as = target_location
		}
	}
	option = {
		name = red_turban_rebellions.30.a
		historical_option = yes
		add_prestige = prestige_severe_bonus
		random_list = {
			90 = { trigger_event_non_silently = { id = red_turban_rebellions.31 days = { 3 7 } } }
			10 = { trigger_event_non_silently = { id = red_turban_rebellions.32 days = { 3 7 } } }
		}
	}
	option = {
		name = red_turban_rebellions.30.b
		add_legitimacy = legitimacy_severe_penalty
		random_list = {
			50 = { trigger_event_non_silently = { id = red_turban_rebellions.31 days = { 3 7 } } }
			50 = { trigger_event_non_silently = { id = red_turban_rebellions.32 days = { 3 7 } } }
		}
	}
}

#The Execution of target_character
red_turban_rebellions.31 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.31.title
	desc = red_turban_rebellions.31.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		character:cso_liner_han = { save_scope_as = target_heir }
		character:cso_futong_liu = { save_scope_as = target_advisor }
	}
	option = {
		name = red_turban_rebellions.31.a
		scope:target_location = {
			change_development = development_mild_penalty
			every_pop = {
				add_pop_size = {
					value = pop_size
					multiply = -0.2
				}
			}
		}
		add_stability = stability_severe_penalty
		kill_character = {
			target = scope:target_character
			reason = execution
		}
		set_regent = scope:target_advisor
	}
}

#The Raid of target_location
red_turban_rebellions.32 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.32.title
	desc = red_turban_rebellions.32.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.32.a
		scope:target_location = {
			change_development = development_mild_penalty
			every_pop = {
				add_pop_size = {
					value = pop_size
					multiply = -0.2
				}
			}
		}
	}
}

#The Red Turban Invasion of Goryeo
red_turban_rebellions.33 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.33.title
	desc = red_turban_rebellions.33.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		country_exists = c:KOR
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		c:KOR = {
			save_scope_as = target_country
		}
	}
	option = {
		name = red_turban_rebellions.33.a
		historical_option = yes
		add_casus_belli = {
			target = scope:target_country
			type = casus_belli:cb_insulted_us
		}
	}
	option = {
		name = red_turban_rebellions.33.b
		add_casus_belli = {
			target = scope:target_country
			type = casus_belli:cb_annex
		}
	}
}

#Rise of Chen
red_turban_rebellions.34 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.34.title
	desc = red_turban_rebellions.34.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		exists = scope:ctw_shouhui_xu
		exists = scope:ctw_pusheng_zou
		exists = scope:ctw_wenjun_ni
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		if = {
			limit = { scope:ctw_shouhui_xu = { is_alive = yes } }
			kill_character = {
				target = scope:ctw_shouhui_xu
				reason = battle
			}
		}
		if = {
			limit = { scope:ctw_pusheng_zou = { is_alive = yes } }
			kill_character = {
				target = scope:ctw_pusheng_zou
				reason = execution
				killer = scope:target_character
			}
		}
		if = {
			limit = { scope:ctw_wenjun_ni = { is_alive = yes } }
			kill_character = {
				target = scope:ctw_wenjun_ni
				reason = assassination
				killer = scope:target_character
			}
		}
	}
	option = {
		name = red_turban_rebellions.34.a
		trigger = {
			hidden_trigger = {
				is_ai = yes
			}
		}
		historical_option = yes
		custom_tooltip = {
			text = red_turban_rebellions.34.a.tt
			every_owned_location = {
				if = {
					limit = { is_core_of = scope:target_country_2 }
					add_core = scope:target_country
				}
				change_location_owner = scope:target_country
			}
		}
	}
	option = {
		name = red_turban_rebellions.34.b
		set_new_ruler = scope:target_character
	}
	option = {
		name = red_turban_rebellions.34.c
		declare_war_with_cb = {
			target = scope:target_country
			type = casus_belli:cb_red_turban_rebellions_against_other_rebels
		}
	}
}

#Yuzhen Ming declares war on Chen
red_turban_rebellions.35 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.35.title
	desc = red_turban_rebellions.10.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		exists = scope:che_youliang_chen
		exists = character:cxi_yuzhen_ming
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.35.a
		historical_option = yes
		scope:target_country = {
			declare_war_with_cb = {
				type = casus_belli:cb_red_turban_rebellions_against_other_rebels
				target = root
			}
		}
	}
}

#The Loyalists of Yuanzhang Zhu
red_turban_rebellions.36 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.36.title
	desc = red_turban_rebellions.36.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		has_ruler = yes
		ruler = scope:target_character
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.36.a
		ruler ?= {
			add_character_modifier = {
				modifier = mng_yuanzhang_zhu_command
				years = -1
				mode = add_and_extend
			}
		}
		add_stability = stability_severe_bonus
		add_government_power = government_power_severe_bonus
	}
}

#Zixing Guo's Untimely Demise
red_turban_rebellions.37 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.37.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_heir = no
				}
				desc = red_turban_rebellions.37.desc.heirless
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = red_turban_rebellions.37.desc
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		exists = scope:target_country
		exists = scope:cgu_zixing_guo
		scope:cgu_zixing_guo = {
			is_alive = yes
		}
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		save_scope_as = annex_target_country
	}
	option = {
		name = red_turban_rebellions.37.a
		trigger = {
			hidden_trigger = {
				is_ai = yes
			}
		}
		historical_option = yes
		kill_character = {
			target = scope:cgu_zixing_guo
			reason = battle
		}
		custom_tooltip = rtr_get_annexed_tt
		scope:target_country = {
			trigger_event_silently = red_turban_rebellions.38
		}
	}
	option = {
		name = red_turban_rebellions.37.b
		kill_character = {
			target = scope:cgu_zixing_guo
			reason = battle
		}
	}
}

#The Untimely Demise of
red_turban_rebellions.38 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.37.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:annex_target_country = { has_heir = no }
				}
				desc = red_turban_rebellions.37.desc.heirless
			}
			triggered_desc = {
				trigger = {
					always = yes
				}
				desc = red_turban_rebellions.37.desc
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.38.a
		custom_tooltip = {
			text = rtr_annex_tt
			scope:annex_target_country = {
				every_owned_location = { add_core = root }
				root = { annex_country = { country = prev } }
			}
		}
	}
}


########################
# 	One-time events    #
########################

# Troop Rotation
red_turban_rebellions.40 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.40.title
	desc = red_turban_rebellions.40.desc

	fire_only_once = yes

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	trigger = {
		culture = culture:mongolian_culture
		any_cabinet_character = {
			count >= 1
		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		random_cabinet_character = {
			save_scope_as = target_character
		}
	}

	option = {
		name = red_turban_rebellions.40.a

		add_country_modifier = {
			mode = add_and_extend
			modifier = yua_troop_rotation
			years = 15
		}

		add_stability = stability_mild_bonus
	}

	option = {
		name = red_turban_rebellions.40.b

		add_army_tradition = army_tradition_mild_bonus
	}
}

# Times of Desperation - Print more paper currency
red_turban_rebellions.41 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.41.title
	desc = red_turban_rebellions.41.desc

	fire_only_once = yes

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}

	option = {
		name = red_turban_rebellions.41.a

		add_country_modifier = {
			mode = add_and_extend
			modifier = yua_hyperinflation
			years = 25
		}

		change_gold_effect = { scale = 3 }
	}

	option = {
		name = red_turban_rebellions.41.b

		add_country_modifier = {
			mode = add_and_extend
			modifier = yua_shortages
			years = 25
		}

		add_prestige = prestige_mild_penalty
	}
}

# Loss of Manchurian Control
scripted_trigger rtr_manchu_to_release_trigger = {

}
red_turban_rebellions.42 = {
	randomlog = yes # Tracking Desync 20251120
	type = country_event
	category = situation_event
	title = red_turban_rebellions.42.title
	desc = red_turban_rebellions.42.desc
	fire_only_once = yes
	major = yes
	major_trigger = {
		can_see_situation = situation:red_turban_rebellions
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}

	trigger = {
		has_variable = rtr_manchuria_rebellion_event
		OR = {
			region:manchuria_region = {
				any_location_in_region = {
					is_ownable = yes
					owner ?= {
						OR = {
							this = root
							is_subject_of = root
						}
					}
				}
			}
			any_subject = {
				OR = {
					country_type = pop
					country_type = building
				}
				has_presence_in = region:manchuria_region
			}
		}
	}
	option = {
		name = red_turban_rebellions.42.a
		custom_tooltip = {
			text = red_turban_rebellions.42.a.tt
			region:manchuria_region = {
				every_location_in_region = {
					limit = {
						is_ownable = yes
						owner ?= root
					}
					root = { abandon_location = prev }
				}
			}
		}
		custom_tooltip = {
			text = red_turban_rebellions.42.b.tt
			every_subject = {
				limit = {
					capital ?= { region = region:manchuria_region }
				}
				root = { cancel_subject = prev }
			}
			every_subject = {
				limit = {
					capital ?= { NOT = { region = region:manchuria_region } }
				}
				save_scope_as = target_country
				region:manchuria_region = {
					every_location_in_region = {
						limit = {
							is_ownable = yes
							owner ?= scope:target_country
						}
						scope:target_country = { abandon_location = prev }
					}
				}
			}
		}
	}
	after = {
		remove_variable = rtr_manchuria_rebellion_event
	}
}

# Loss over Korea
red_turban_rebellions.43 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.43.title
	desc = red_turban_rebellions.43.desc
	fire_only_once = yes
	major = yes
	major_trigger = {
		this = scope:target_country
	}
	trigger = {
		has_variable = rtr_korea_rebellion_event
		country_exists = c:KOR
		c:KOR = {
			is_subject_of = root
			any_character = {
				culture = culture:mongolian_culture
				count > 1
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		set_variable = {
			name = num_of_mongolian_generals
			value = 0
		}
		c:KOR = {
			save_scope_as = target_country
			every_character = {
				limit = { culture = culture:mongolian_culture }
				root = { change_variable = { name = num_of_mongolian_generals add = 1 } }
			}
		}
	}
	option = {
		name = red_turban_rebellions.43.a
		custom_tooltip = {
			text = red_turban_rebellions.43.a.at
			scope:target_country = {
				ordered_character = {
					limit = { culture = culture:mongolian_culture }
					order_by = total_abilities
					max = {
						value = root.var:num_of_mongolian_generals
						divide = 2
					}
					check_range_bounds = no
					move_country = root
					root = {
						add_stability = 1
						add_army_tradition = 1
					}
				}
			}
		}
		custom_tooltip = {
			text = red_turban_rebellions.43.a.bt
			scope:target_country = {
				set_variable = {
					name = rtr_kor_will_break_away
					value = yes
					days = 7300
				}
			}
		}
		ai_will_select = {
			value = 20
			add = {
				value = stability
				subtract = 50
				multiply = -1
			}
			add = {
				value = army_tradition
				subtract = 50
				multiply = -1
			}
		}
	}
	option = {
		name = red_turban_rebellions.43.b
		scope:target_country = {
			add_liberty_desire = liberty_desire_mild_minus
		}
		ai_will_select = {
			value = 40
		}
	}
	after = {
		remove_variable = num_of_mongolian_generals
		remove_variable = rtr_korea_rebellion_event
	}
}

# Loss over Tibet
red_turban_rebellions.44 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.44.title
	desc = red_turban_rebellions.44.desc

	fire_only_once = yes
	major = yes
	major_trigger = {
		can_see_situation = situation:red_turban_rebellions
	}

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}

	trigger = {
		has_variable = rtr_tibet_rebellion_event
		region:tibet_region = {
			any_country_with_capital_in_geography = {
				is_subject_of = c:CHI
			}
		}
	}

	option = {
		name = red_turban_rebellions.44.a
		region:tibet_region = {
			every_country_with_capital_in_geography = {
				limit = { is_subject_of = c:CHI }
				c:CHI = { cancel_subject = prev }
			}
		}
	}

	after = {
		remove_variable = rtr_tibet_rebellion_event
	}
}

########################
# Situation end events #
########################

#The Rise of a New Dynasty (Leader of the Red Turban Rebellions becomes China, triggers when all of original China is annexed)
red_turban_rebellions.100 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.100.title
	desc = red_turban_rebellions.100.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		save_scope_as = target_country
		if = {
			limit = { has_ruler = yes }
			ruler ?= { save_scope_as = target_character }
		}
		else_if = {
			limit = { has_regent = yes }
			regent ?= { save_scope_as = target_character }
		}
		c:CHI = {
			save_scope_as = china_country
			if = {
				limit = { has_ruler = yes }
				ruler ?= { save_scope_as = china_character }
			}
			else_if = {
				limit = { has_regent = yes }
				regent ?= { save_scope_as = china_character }
			}
		}
	}
	option = {
		name = red_turban_rebellions.100.a
		custom_tooltip = {
			text = end_situation_red_turban_rebellions_tt
            every_country = {
                limit = {
                    NOT = { this = root }
                    OR = {
                        is_neighbor_of = root
                        is_subject_of = root
                        is_enemy_of = root
                        is_rival_of = root
                        capital.sub_continent = sub_continent:east_asia
                        is_member_of_international_organization = international_organization:red_turban_rebels
                    }
                }
                trigger_event_non_silently = red_turban_rebellions.102
            }
			rtr_cleanup_variables = yes
		}
		rtr_become_china_effect = yes
	}
}

#The Rise of a New Dynasty (Old China chaos event)
red_turban_rebellions.101 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.100.title
	desc = red_turban_rebellions.100.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.101.a
		if = {
			limit = { exists = scope:target_country }
			change_country_tag = YUA
			scope:target_country = {
				rtr_recreate_middle_kingdom = yes
			}
		}
	}
}

#The Rise of a New Dynasty (info event)
red_turban_rebellions.102 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.100.title
	desc = red_turban_rebellions.100.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.102.a
		custom_tooltip = end_situation_red_turban_rebellions_tt
		show_as_tooltip = {
			scope:target_country = {
				rtr_become_china_effect = yes
			}
		}
	}
}

#China Persists! (Either no rebel exists or all existing rebels are loyalists towards China)
red_turban_rebellions.103 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.103.title
	desc = red_turban_rebellions.103.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		save_scope_as = target_country
		if = {
			limit = { has_ruler = yes }
			ruler ?= { save_scope_as = target_character }
		}
		else_if = {
			limit = { has_regent = yes }
			regent ?= { save_scope_as = target_character }
		}
	}
	option = {
		name = red_turban_rebellions.103.a
		custom_tooltip = {
			text = end_situation_red_turban_rebellions_tt
            every_country = {
                limit = {
                    NOT = { tag = CHI }
                    OR = {
                        is_neighbor_of = c:CHI
                        is_subject_of = c:CHI
                        is_enemy_of = c:CHI
                        is_rival_of = c:CHI
                        capital.sub_continent = sub_continent:east_asia
                        is_member_of_international_organization = international_organization:red_turban_rebels
                    }
                }
				if = {
					limit = {
						has_variable = rtr_yuan_allegiance
						var:rtr_yuan_allegiance >= RTR_IS_LOYAL_VALUE
					}
					set_variable = rtr_to_be_annexed
				}
                trigger_event_non_silently = red_turban_rebellions.104
            }
			rtr_cleanup_variables = yes
		}
		rtr_resolve_rebellion_effect = yes
		if = {
			limit = { exists = scope:target_country }
			rtr_core_all_of_china_effect = { country = scope:target_country }
		}
		if = {
			limit = {
				NOT = {
					exists = international_organization:middle_kingdom
				}
			}
			rtr_recreate_middle_kingdom = yes
		}
	}
}

#China Persists! (info event)
red_turban_rebellions.104 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.103.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { NOT = { has_variable = rtr_to_be_annexed } }
				desc = red_turban_rebellions.103.desc
			}
			triggered_desc = {
				trigger = { has_variable = rtr_to_be_annexed }
				desc = red_turban_rebellions.104.desc
			}
		}
	}
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.104.a
		trigger = {
			hidden_trigger = {
				has_variable = rtr_to_be_annexed
				is_ai = yes
			}
		}
		custom_tooltip = end_situation_red_turban_rebellions_tt
		custom_tooltip = {
			text = rtr_get_annexed_tt
			every_owned_location = {
				add_core = scope:target_country
				change_location_owner = scope:target_country
			}
		}
	}
	option = {
		name = red_turban_rebellions.101.a
		trigger = {
			hidden_trigger = {
				OR = {
					NOT = { has_variable = rtr_to_be_annexed }
					is_ai = no
				}
			}
		}
		custom_tooltip = end_situation_red_turban_rebellions_tt
		remove_variable = rtr_to_be_annexed
		show_as_tooltip = {
			scope:target_country = {
				rtr_resolve_rebellion_effect = yes
			}
		}
	}
}

#End of the Mandate (fallback event in case SOMEHOW the Middle Kingdom stops existing)
red_turban_rebellions.105 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.105.title
	desc = red_turban_rebellions.105.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.105.a
		custom_tooltip = end_situation_red_turban_rebellions_tt
		if = {
			limit = {
				scope:new_china ?= root
			}
			rtr_recreate_middle_kingdom = yes
		}
		else = {
			show_as_tooltip = {
				scope:new_china ?= {
					rtr_recreate_middle_kingdom = yes
				}
			}
		}
	}
}

#Rebel Stagnation (fallback in case the Red Turban Rebellions have been going forever...)
red_turban_rebellions.106 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.106.title
	desc = red_turban_rebellions.106.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = red_turban_rebellions.106.a
		custom_tooltip = end_situation_red_turban_rebellions_tt
	}
}

#####################################
# Subject breaking away chain event #
#####################################

#Growing weakness of Yuan
red_turban_rebellions.1000 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.1000.title
	desc = red_turban_rebellions.1000.desc
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	trigger = {
		is_subject_of = c:CHI
		NOT = { has_variable = rtr_had_vassal_break_away_event }
		capital = {
			OR = {
				region = region:tibet_region
				region = region:korea_region
			}
		}
	}
	immediate = {
		set_variable = rtr_had_vassal_break_away_event
		c:CHI = { save_scope_as = target_country }
		save_scope_as = root_country
		capital.region = { save_scope_as = target_region }
	}
	option = {
		name = red_turban_rebellions.1000.a
		historical_option = yes
		custom_tooltip = {
			text = red_turban_rebellions.1000.a.at
			scope:target_country = {
				trigger_event_silently = red_turban_rebellions.1001
			}
		}
		custom_tooltip = red_turban_rebellions.1000.a.bt
		ai_will_select = {
			value = subject_loyalty
			multiply = -1
			add = liberty_desire
			if = {
				limit = { has_variable = rtr_kor_will_break_away }
				add = 1000
			}
		}
	}
	option = {
		name = red_turban_rebellions.1000.b
		add_prestige = prestige_weak_penalty
		scope:target_country = {
			add_opinion = {
				modifier = opinion_rtr_loyal_subject
				target = scope:root_country
			}
		}
		ai_will_select = {
			value = 20
		}
	}
}

#Yuan's reaction
red_turban_rebellions.1001 = {
	type = country_event
	category = situation_event
	title = red_turban_rebellions.1000.title
	desc = red_turban_rebellions.1001.desc
	major = yes
	major_trigger = {
		this = scope:root_country
	}
	option = {
		name = red_turban_rebellions.1001.a
		historical_option = yes
		cancel_subject = scope:root_country
		ai_will_select = {
			value = 10
			every_current_war = {
				add = 20
			}
			add = {
				value = war_exhaustion
				multiply = 5
			}
		}
	}
	option = {
		name = red_turban_rebellions.1001.b
		hidden_effect = {
			scope:root_country = {
				every_current_war = {
					limit = {
						is_on_same_side = {
							country = scope:root_country
							target = scope:target_country
						}
					}
					save_scope_as = target_war
					if = {
						limit = {
							attacker_leader != scope:root_country
							defender_leader != scope:root_country
						}
						scope:root_country = {
							leave_war = {
								war = scope:target_war
								actor = this
							}
						}
					}
					else = {
						scope:target_country = {
							leave_war = {
								war = scope:target_war
								actor = scope:target_country
							}
						}
					}
				}
			}
		}
		scope:root_country = {
			declare_war_with_cb = {
				target = scope:target_country
				type = casus_belli:cb_independence_war
			}
		}
		ai_will_select = {
			value = 100
		}
	}
}