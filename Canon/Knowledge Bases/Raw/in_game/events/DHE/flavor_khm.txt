namespace = flavor_khm

flavor_khm.1000 = { #Maintenance of the Angkor Irrigation
	type = country_event
	title = flavor_khm.1000.title
	desc = flavor_khm.1000.desc
	

	fire_only_once = yes

	dynamic_historical_event = {
		tag = KHM
		from = 1340.1.1 
		to = 1360.1.1
		monthly_chance = 1
	}

	illustration_tags = {
		10 = regular
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		location:angkor = {
			save_scope_as = target_location
		}
		character:khm_trasak_paem ?= {
			save_scope_as = target_old_ruler
		}
	}

	trigger = {
		owns = location:angkor
		location:angkor = {
			has_building = building_type:khmer_baray
		}
	}

	option = {
		name = flavor_khm.1000.a
		historical_option = yes

		location:angkor = {
			change_prosperity = prosperity_mild_penalty
		}
		add_legitimacy = legitimacy_mild_penalty
		set_variable = khm_baray_in_disrepair
	}

	option = {
		name = flavor_khm.1000.b

		change_gold_effect = { scale = -4 }
		add_legitimacy = legitimacy_mild_bonus
	}
}

flavor_khm.1001 = { #Baray of Angkor is destroyed
	type = country_event
	title = flavor_khm.1001.title
	desc = flavor_khm.1001.desc
	

	fire_only_once = yes

	dynamic_historical_event = {
		tag = KHM
		from = 1350.1.1 
		to = 1390.1.1
		monthly_chance = 1
	}

	illustration_tags = {
		10 = angry
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
	}

	trigger = {
		owns = location:angkor
		has_variable = khm_baray_in_disrepair
	}

	option = {
		name = flavor_khm.1001.a

		add_stability = stability_mild_penalty
		location:angkor = {
			destroy_building = "building(building_type:khmer_baray|owner)"
			change_prosperity = prosperity_severe_penalty
		}
	}
}

flavor_khm.1100 = { #The Emerald Buddha under siege
	type = country_event
	title = flavor_khm.1100.title
	desc = flavor_khm.1100.desc
	

	fire_only_once = yes

	dynamic_historical_event = {
		tag = KHM
		from = 1340.1.1 
		to = 1360.1.1
		monthly_chance = 40
	}

	illustration_tags = {
		10 = armed
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		location:angkor = {
			save_scope_as = target_location
		}
		scope:target_location.siege = {
			random_besieging_unit = {
				owner = {
					save_scope_as = siege_leader
				}
			}
		}
		random_work_of_art = {
			limit = { this = work_of_art:emerald_buddha }
			save_scope_as = target_art
		}
	}

	trigger = {
		owns = location:angkor
		location:angkor = {
			has_siege = yes
			siege = {
				any_besieging_unit = {
					owner = {
						is_rebel_country = no
					}
				}
			}
			any_work_of_art_in_location = {
					this = work_of_art:emerald_buddha
			}
		}
	}

	option = {
		name = flavor_khm.1100.a

		scope:target_location = {
			every_work_of_art_in_location = {
				limit = {
					this = work_of_art:emerald_buddha
				}
				move_art = scope:siege_leader.capital
			}
		}
		scope:siege_leader = {
			trigger_event_silently = flavor_khm.1101
		}
	}
}

flavor_khm.1101 = { #Capture of the Emerald Buddha
	hide_portraits = yes
	type = country_event
	title = flavor_khm.1101.title
	desc = flavor_khm.1101.desc

	illustration_tags = {
		10 = happy
		10 = exterior
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }

		location:angkor = {
			save_scope_as = target_location
		}
		scope:target_location.siege = {
			random_besieging_unit = {
				owner = {
					save_scope_as = siege_leader
				}
			}
		}
		random_work_of_art = {
			limit = { this = work_of_art:emerald_buddha }
			save_scope_as = target_art
		}
	}

	option = {
		name = flavor_khm.1101.a

		add_prestige = prestige_mild_bonus
	}
}