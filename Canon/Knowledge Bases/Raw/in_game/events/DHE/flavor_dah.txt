namespace = flavor_dah

flavor_dah.1 = { #Founding of Dahomey
	type = country_event
	title = flavor_dah.1.title
	desc = flavor_dah.1.desc

	fire_only_once = yes
	major = yes
	major_trigger = {
		capital ?= {
			region = region:guinea_region
		}
	}

	trigger = {
		OR = {
			own_entire_province = province_definition:fon_province
			province_definition:fon_province = {
				any_location_in_province_definition = {
					count = all
					has_owner = no
				}
			}
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		if = {
			limit = {
				province_definition:fon_province = {
					any_location_in_province_definition = {
						count = all
						has_owner = no
					}
				}
			}
			set_variable = dah_spawned_from_uncolonized_flag
			province_definition:fon_province = {
				random_location_in_province_definition = {
					save_scope_as = target_dahomey_capital
				}
			}
			scope:target_dahomey_capital = {
				create_country_from_location = {
					save_scope_as = dahomey_country
				}
			}
	
			scope:dahomey_country = {
				form_country = formable_country:DAH_f
				change_country_color = map_dahomey
			}
	
			province_definition:fon_province = {
				every_location_in_province_definition = {
					change_location_owner = scope:dahomey_country
					add_core = scope:dahomey_country
				}
			}
	
			province_definition:fon_province = {
				every_location_in_province_definition = {
					limit = {
						is_ownable = yes
					}
					change_location_owner = c:DAH
					add_core = c:DAH
				}
			}
		}

		

		location:abomey = {
			create_dynasty_from_location = aladaxonou_dynasty
		}

		create_character = {
			dynasty = dynasty:aladaxonou_dynasty
			estate = estate_type:nobles_estate
			culture = culture:fon
			religion = religion:vodun_religion
			age = 20
			save_scope_as = target_character
		}
		scope:target_character = {
			set_to_limited_random_stats = {
				max_adm = 75
				min_adm = 50
				max_dip = 75
				min_dip = 50
				max_mil = 75
				min_mil = 50
			}
		}

		c:DAH = {
			change_government_type = government_type:monarchy
			set_new_ruler = scope:target_character
			every_province = {
				limit = { any_location_in_province = { NOT = { integration_level = core } } }
				change_province_integration = core
			}
			hidden_effect = {
				add_reform = government_reform:autocracy
				setup_societal_values = {
					centralization_vs_decentralization = -10
					traditionalist_vs_innovative = 10
					spiritualist_vs_humanist = 5
					aristocracy_vs_plutocracy = -80
					serfdom_vs_free_subjects = -65
					mercantilism_vs_free_trade = -60
					belligerent_vs_conciliatory = -100
					quality_vs_quantity = -75
					offensive_vs_defensive = -90
					land_vs_naval = -80
					capital_economy_vs_traditional_economy = 100
					individualism_vs_communalism = 60
					outward_vs_inward = -50
				}
				add_legitimacy = legitimacy_severe_bonus
				add_gold = 1000
				add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_radical_bonus }
				add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_radical_bonus }
				add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_radical_bonus }
				add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_radical_bonus }
				every_owned_location = {
					change_control = control_radical_bonus
				}
				ordered_owned_location = {
					order_by = population
					position = 0
					save_scope_as = target_location
				}
				scope:target_location = {
					change_location_rank_effect = { location_rank = location_rank:city }
					change_max_raw_material_workers = 2
					every_pop = {
						split_pop = {
							fraction = 0.15
							type = pop_type:laborers
						}
					}
				}
				every_province = {
					change_province_food = 1000
				}
			}
		}

		region:guinea_region = {
			every_present_country = {
				limit = {
					capital ?= {
						region = region:guinea_region
					}
				}
				trigger_event_silently = flavor_dah.2
			}
		}
	}

	option = {
		name = flavor_dah.1.a

		trigger = {
			NOT = {
				custom_tooltip = {
					text = flavor_dah_variable_tt
					has_variable = dah_spawned_from_uncolonized_flag
				}
			}
		}

		add_casus_belli =  {
			type = casus_belli:cb_annex
			target = c:DAH
		}
	}

	option = {
		name = flavor_dah.1.b

		trigger = {
			NOT = {
				custom_tooltip = {
					text = flavor_dah_variable_tt
					has_variable = dah_spawned_from_uncolonized_flag
				}
			}
		}

		add_casus_belli =  {
			type = casus_belli:cb_annex
			target = c:DAH
		}

		change_player = c:DAH
	}

	option = {
		name = flavor_dah.1.c

		trigger = {
				custom_tooltip = {
					text = flavor_dah_variable_tt
					has_variable = dah_spawned_from_uncolonized_flag
				}
		}

		show_as_tooltip = {
			province_definition:fon_province = {
				every_location_in_province_definition = {
					limit = {
						is_ownable = yes
					}
					change_location_owner = c:DAH
					add_core = c:DAH
				}
			}
		}
	}

	after = {
		remove_variable = dah_spawned_from_uncolonized_flag
	}
}

flavor_dah.2 = { #Founding of Dahomey - Message for Everyone
	type = country_event
	title = flavor_dah.2.title
	desc = flavor_dah.2.desc

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
	}
	
	option = {
		name = flavor_dah.2.a

		show_as_tooltip = {
			province_definition:fon_province = {
				every_location_in_province_definition = {
                    limit = { is_ownable = yes }
					change_location_owner = c:DAH
					add_core = c:DAH
				}
			}
		}
	}
}