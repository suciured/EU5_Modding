namespace = flavor_tim

flavor_tim.1 = { #Death of Timur
	type = country_event
	title = flavor_tim.1.title
	desc = flavor_tim.1.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIM
		from = 1350.1.1
		to = 1450.1.1
		monthly_chance = 2
	}

	trigger = {
		character:chg_timur_lame_borjigin ?= { is_alive = no }
		previous_ruler ?= character:chg_timur_lame_borjigin
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = { save_scope_as = target_timur }
		set_global_variable = had_timur_ruler_variable

		trigger_event_silently = {
			id = flavor_tim.17
			months = {
				50
				100
			}
		}
	}

	option = { #His legacy will remain
		name = flavor_tim.1.a
		add_prestige = prestige_mild_bonus
		hidden_effect = {
			every_neighbor_country = {
				trigger_event_silently = { id = flavor_tim.2 }
			}
		}
	}
}

flavor_tim.2 = { #Death of Timur (neighbor's response)
	type = country_event
	title = flavor_tim.2.title
	desc = flavor_tim.2.desc

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		if = {
			limit = {
				has_ruler = yes
				ruler = {
					has_dynasty = yes
					dynasty = scope:target_timur.dynasty
				}
			}
			ruler = { save_scope_as = target_ruler }
		}
	}

	option = { #[target_ruler.GetNameWithNoTooltip] is [target_timur.GetHerHis] legitimate heir
		name = flavor_tim.2.a
		trigger = {
			has_ruler = yes
			ruler = {
				has_dynasty = yes
				dynasty = scope:target_timur.dynasty
			}
		}
		add_casus_belli = { target = c:TIM type = casus_belli:cb_timurs_conquests }
	}
	option = { #Long may they splinter
		name = flavor_tim.2.b
		trigger = {
			OR = {
				has_ruler = no
				NOT = {
					ruler = {
						has_dynasty = yes
						dynasty = scope:target_timur.dynasty
					}
				}
			}
		}
		add_prestige = prestige_weak_bonus
	}
}

flavor_tim.3 = { #Ulugh Beg's Observatory
	type = country_event
	title = flavor_tim.3.title
	desc = flavor_tim.3.desc

	historical_info = flavor_tim.3.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIM
		from = 1400.1.1
		to = 1500.1.1
		monthly_chance = 2
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	trigger = {
		has_heir = yes
		heir = {
			age_in_years > 15
			OR = {
				has_trait = scholar
				total_abilities >= 250
			}
		}
		OR = {
			AND = {
				owns = location:samarkand
				location:samarkand = {
					NOT = { has_building = building_type:university }
				}
			}
			any_owned_location = {
				is_city = yes
				NOT = { has_building = building_type:university }
			}

		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		heir = { save_scope_as = target_heir }
		if = {
			limit = {
				owns = location:samarkand
				location:samarkand = {
					NOT = { has_building = building_type:university }
				}
			}
			location:samarkand = { save_scope_as = target_location }
		}
		else = {
			random_owned_location = {
				limit = {
					is_city = yes
					NOT = { has_building = building_type:university }
				}
				save_scope_as = target_location
			}
		}
	}

	option = { #Build it!
		name = flavor_tim.3.a
		scope:target_location = { construct_building = { building_type = building_type:university } }
		add_prestige = prestige_weak_bonus
		add_research_progress = research_progress_mild_bonus
	}
	option = { #We have neither the time nor the money for such foolishness!
		name = flavor_tim.3.b
		add_prestige = prestige_weak_penalty
	}
}

flavor_tim.4 = { #Embassy to India
	type = country_event
	title = flavor_tim.4.title
	desc = flavor_tim.4.desc

	historical_info = flavor_tim.4.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIM
		from = 1440.1.1
		to = 1500.1.1
		monthly_chance = 2
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	trigger = {
		any_artist = {
			artist_type = writer
			artist_skill >= 0.6
		}
		location:kozhikode = {
			has_owner = yes
			owner = {
				this != root
				opinion = { target = root value >= 50 }
			}
		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		random_artist = {
			limit = {
				artist_type = writer
				artist_skill >= 0.6
			}
			save_scope_as = target_artist
		}
		location:kozhikode.owner = { save_scope_as = target_country }
	}

	option = { #Send the embassy
		name = flavor_tim.4.a
		change_gold_effect = { scale = -3 }
		capital = {
			create_art = {
				artist = scope:target_artist
				type = work_of_art_type:chronicle
				quality = 60
			}
		}
	}
	option = { #There's no need
		name = flavor_tim.4.b
		add_prestige = prestige_weak_penalty
	}
}

flavor_tim.5 = { #Embassy to China
	type = country_event
	title = flavor_tim.5.title
	desc = flavor_tim.5.desc

	historical_info = flavor_tim.4.historical_info

	fire_only_once = yes

	dynamic_historical_event = {
		tag = TIM
		from = 1400.1.1
		to = 1450.1.1
		monthly_chance = 2
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	trigger = {
		any_artist = {
			artist_type = writer
			artist_skill >= 0.6
		}
		country_exists = c:CHI
		c:CHI = {
			this != root
			opinion = { target = root value > 0 }
		}
	}

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		random_artist = {
			limit = {
				artist_type = writer
				artist_skill >= 0.6
			}
			save_scope_as = target_artist
		}
		c:CHI = { save_scope_as = target_country }
	}

	option = { #Send the embassy
		name = flavor_tim.5.a
		change_gold_effect = { scale = -3 }
		capital = {
			create_art = {
				artist = scope:target_artist
				type = work_of_art_type:chronicle
				quality = 50
			}
		}
	}
	option = { #There's no need
		name = flavor_tim.5.b
		add_prestige = prestige_weak_penalty
	}
}

flavor_tim.6 = { #Timur the Lame
	type = country_event
	title = flavor_tim.6.title
	desc = flavor_tim.6.desc

	fire_only_once = yes
	dynamic_historical_event = {
		tag = CHG
		tag = NGD
		tag = QUN
		tag = BSD
		tag = ART
		tag = APD
		tag = SLD
		tag = BRL
		tag = YSU
		tag = KTT
		tag = JLY
		tag = TIM
		from = 1360.1.1
		to = 1365.1.1
		monthly_chance = 10
	}

	trigger = {
		character:chg_timur_lame_borjigin ?= {
			is_alive = yes
			owner = root
			has_nickname = no
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		character:chg_timur_lame_borjigin = { save_scope_as = target_timur }
	}

	option = {
		name = flavor_tim.6.a
		scope:target_timur = {
			set_nickname = Lang
			add_mil = 15
		}
	}
}

flavor_tim.7 = { #Zafarnama
	type = country_event
	title = flavor_tim.7.title
	desc = flavor_tim.7.desc

	fire_only_once = yes

	historical_info = flavor_tim.7.historical_info

	dynamic_historical_event = {
		tag = CHG
		tag = NGD
		tag = QUN
		tag = BSD
		tag = ART
		tag = APD
		tag = SLD
		tag = BRL
		tag = YSU
		tag = KTT
		tag = JLY
		tag = TIM
		from = 1420.1.1
		to = 1500.1.1
		monthly_chance = 5
	}

	trigger = {
		any_artist = {
			artist_skill >= 0.7
			artist_type = writer
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		random_artist = {
			limit = {
				artist_skill >= 0.7
				artist_type = writer
			}
			save_scope_as = target_artist
		}
	}

	option = {
		name = flavor_tim.7.a
		capital = {
			create_art = {
				artist = scope:target_artist
				quality = 80
				type = work_of_art_type:chronicle
				key = zafarnama
			}
		}
		change_gold_effect = { scale = -5 }
	}
	option = {
		name = flavor_tim.7.b
		add_prestige = prestige_mild_penalty
	}
}

scripted_trigger is_chagatai_or_valid_vassal = {
	OR = {
		tag = CHG
		tag = NGD
		tag = QUN
		tag = BSD
		tag = ART
		tag = APD
		tag = SLD
		tag = BRL
		tag = YSU
		tag = KTT
		tag = JLY
		overlord ?= { tag = CHG }
	}
}
#The Rise of Timur
flavor_tim.8 = {
	hide_portraits = yes
	type = country_event
	title = flavor_tim.8.title
	desc = flavor_tim.8.desc
	fire_only_once = yes
	illustration_tags = {
		10 = armed
		10 = exterior
	}
	dynamic_historical_event = {
		tag = CHG
		tag = NGD
		tag = QUN
		tag = BSD
		tag = ART
		tag = APD
		tag = SLD
		tag = BRL
		tag = YSU
		tag = KTT
		tag = JLY
		from = 1360.1.1
		to = 1400.1.1
		monthly_chance = 60
	}

	major = yes
	major_trigger = {
		is_chagatai_or_valid_vassal = yes
	}

	trigger = {
		character:chg_timur_lame_borjigin = {
			is_alive = yes
			is_adult = yes
		}
		owns = location:samarkand
		NOT = { country_exists = c:TIM }
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = {
			save_scope_as = target_character
		}
		set_global_variable = {
			name = timur_character
			value = character:chg_timur_lame_borjigin
		}
		c:CHG ?= { save_scope_as = target_chagatai }
		c:TIM = { save_scope_as = target_country }
		location:samarkand = {
			save_scope_as = target_location
			area = {
				every_location_in_area = {
					limit = {
						owner ?= {
							OR = {
								this = root
								is_chagatai_or_valid_vassal = yes
							}
						}
					}
					add_core = scope:target_country
				}
			}
		}
		scope:target_location = {
			floodfill_locations = {
				limit = {
					owner ?= {
						OR = {
							this = root
							is_chagatai_or_valid_vassal = yes
						}
					}
					OR = {
						is_core_of = scope:target_country
						AND = {
							exists = scope:target_chagatai
							"this.distance_to(scope:target_chagatai.capital)" > "this.distance_to(scope:target_location)"
						}
					}
				}
				add_core = scope:target_country
			}
			#create an army so that a released army based country does actually think it exists
			while =  {
				count = 12
				create_sub_unit_with_owner = {
					type = a_steppe_horse_archers
					owner = scope:target_country
				}
			}
		}
		create_country_from_cores_in_our_locations = scope:target_country
		scope:target_country = {
			set_capital = scope:target_location
			set_new_ruler = global_var:timur_character
			set_variable = {
				name = tim_founding_father
				value = global_var:timur_character
			}
			change_culture = culture:khorezmian_culture
			change_country_type = army
			change_government_type = government_type:steppe_horde
			add_reform = government_reform:legacy_of_genghis
			change_heir_selection = heir_selection:tribal_oldest_male
			add_policy = policy:mongol_law_policy
			change_country_color = map_TIM
			setup_societal_values = {
				centralization_vs_decentralization = -60
				traditionalist_vs_innovative = 40
				spiritualist_vs_humanist = -50
				aristocracy_vs_plutocracy = -60
				serfdom_vs_free_subjects = 50
				mercantilism_vs_free_trade = 50
				belligerent_vs_conciliatory = -80
				quality_vs_quantity = -50
				offensive_vs_defensive = -90
				land_vs_naval = -80
				capital_economy_vs_traditional_economy = 100
				individualism_vs_communalism = 60
				outward_vs_inward = -20
			}
			if = {
				limit = { country_rank_level < 3 }
				set_country_rank = country_rank:rank_kingdom
			}
			add_horde_unity = horde_unity_extreme_bonus
			add_gold = 3000
			add_estate_satisfaction = { type = estate_type:nobles_estate value = estate_satisfaction_radical_bonus }
			add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_radical_bonus }
			add_estate_satisfaction = { type = estate_type:peasants_estate value = estate_satisfaction_radical_bonus }
			add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_radical_bonus }
			every_owned_location = {
				change_control = control_radical_bonus
			}
			every_province = {
				limit = { any_location_in_province = { NOT = { integration_level = core } } }
				change_province_integration = core
			}
		}
		cancel_subject = scope:target_country
		scope:target_location = {
			if = {
				limit = {
					NOT = { has_building = building_type:kurultai }
				}
				construct_building = {
					building_type = building_type:kurultai
					cost_multiplier = 0
					cost_multiplier_reason = "game_concept_event"
					instant = yes
				}
			}
		}
	}
	option = {
		name = flavor_tim.8.a
		custom_tooltip = flavor_tim.8.a.at
		custom_tooltip = flavor_tim.8.a.bt
		enable_situation_effect = { type = rise_of_timur }
	}
	option = {
		name = flavor_tim.8.b
		trigger = {
			is_ai = no
		}
		custom_tooltip = flavor_tim.8.a.at
		custom_tooltip = flavor_tim.8.a.bt
		change_player = scope:target_country
		enable_situation_effect = { type = rise_of_timur }
	}

	after = {
		activate_situation = situation:rise_of_timur
		scope:target_country = {
			every_neighbor_country = {
				limit = {
					this != scope:target_country
					OR = {
						any_owned_location = {
							is_core_of = scope:target_country
							count = all
						}
						this = c:CHG
					}
				}
				set_variable = { name = had_tim_rise_event value = 1 months = 1 }
				trigger_event_silently = flavor_tim.81
			}
		}
	}
}

flavor_tim.81 = {
	type = country_event
	title = flavor_tim.81.title
	desc = flavor_tim.81.desc

	illustration_tags = {
		10 = armed
		10 = exterior
	}
	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
	}
	option = {
		name = flavor_tim.81.a
		trigger = {
			OR = {
				is_ai = yes
				scope:target_country = { is_ai = yes }
			}
			trigger_if = {
				limit = { this = c:CHG }
				any_owned_location = {
					is_core_of = scope:target_country
					count = all
				}
			}
		}
		scope:target_country = {
			annex_country_diplomatically = { country = root }
			hidden_effect = {
				every_owned_location = {
					change_control = control_ultimate_bonus
				}
			}
		}
		if = {
			limit = {
				is_ai = no
				scope:target_country = { is_ai = yes }
			}
			change_player = scope:target_country
		}
	}
	option = {
		name = flavor_tim.81.b
		add_opinion_mutual_effect = {
			modifier = opinion_tim_refused_joining_horde
			target = scope:target_country
		}
	}

	option = {
		name = flavor_tim.8.b
		trigger = {
			is_ai = no
			scope:target_country = { is_ai = yes }
		}
		change_player = scope:target_country
	}


	after = {
		every_neighbor_country = {
			limit = {
				this != scope:target_country
				NOT = { has_variable = had_tim_rise_event }
				OR = {
					any_owned_location = {
						is_core_of = scope:target_country
						count = all
					}
					this = c:CHG
				}
			}
			set_variable = { name = had_tim_rise_event value = 1 months = 1 }
			trigger_event_silently = flavor_tim.81
		}
	}
}

#Iranization of Society
flavor_tim.9 = {
	type = country_event
	title = flavor_tim.9.title
	desc = flavor_tim.9.desc
	historical_info = flavor_tim.9.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1410.1.1
		to = 1500.1.1
		monthly_chance = 2
	}

	fire_only_once = yes

	trigger = {
		OR = {
			has_ruler = no
			ruler != character:chg_timur_lame_borjigin
		}
		culture_group_percentage_in_country = {
			culture_group = culture_group:iranian_group
			value > 0.1
		}
		NOT = { culture = { has_culture_group = culture_group:iranian_group } }
		government_type = government_type:monarchy
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin ?= {
			save_scope_as = target_character
		}

		ruler_or_regent ?= {
			save_scope_as = target_character2
		}

		ordered_present_culture_in_country = {
			limit = {
				has_culture_group = culture_group:iranian_group
			}
			order_by = {
				save_temporary_scope_as = culture
                value = "root.culture_population_in_country(scope:culture)"
			}
			position = 0
			save_scope_as = target_culture
		}
	}

	option = {
		name = flavor_tim.9.a

		historical_option = yes

		change_culture = scope:target_culture

		unlock_government_reform_effect = {
			type = timurid_diwan_reform
		}
		add_reform = government_reform:timurid_diwan_reform

		add_estate_satisfaction = {
			type = estate_type:nobles_estate
			value = estate_satisfaction_extreme_penalty
		}
	}

	option = {
		name = flavor_tim.9.b

		culture = {
			add_cultural_influence = cultural_influence_extreme_bonus
			add_cultural_tradition = cultural_tradition_extreme_bonus
		}
	}
}

#Timurid Renaissance
flavor_tim.10 = {
	hide_portraits = yes
	type = country_event
	title = flavor_tim.10.title
	desc = flavor_tim.10.desc
	historical_info = flavor_tim.10.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1400.1.1
		to = 1500.1.1
		monthly_chance = 2
	}

	fire_only_once = yes

	trigger = {
		has_embraced_institution = institution:renaissance
		prestige >= 40
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler_or_regent ?= {
			save_scope_as = target_character
		}

		create_character = {
			estate = estate_type:clergy_estate
			artist = painter
			artist_skill = {
				0.5
				0.8
			}
			save_scope_as = target_character2
			create_in_limbo = yes
		}
	}

	option = {
		name = flavor_tim.10.a

		historical_option = yes

		change_gold_effect = { scale = -3 }

		scope:target_character2 = {
			move_country = root
		}

		culture = {
			add_cultural_influence = cultural_influence_mild_bonus
			add_cultural_tradition = cultural_tradition_mild_bonus
		}

		set_variable = tim_allow_timurid_architecture_event
	}

	option = {
		name = flavor_tim.10.b

		scope:target_character2 = {
			move_country = root
		}

		add_prestige = prestige_mild_bonus
	}

	option = {
		name = flavor_tim.10.c

		add_prestige = prestige_mild_penalty

		change_societal_value = {
			type = spiritualist_vs_humanist
			value = societal_value_move_to_left
		}

		change_societal_value = {
			type = belligerent_vs_conciliatory
			value = societal_value_move_to_left
		}

		kill_character_silently = scope:target_character2
	}
}

#Timurid Architecture
flavor_tim.11 = {
	type = country_event
	title = flavor_tim.11.title
	desc = flavor_tim.11.desc
	historical_info = flavor_tim.11.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1400.1.1
		to = 1500.1.1
		monthly_chance = 2
	}

	fire_only_once = yes

	trigger = {
		has_variable = tim_allow_timurid_architecture_event
	}

	illustration_tags = {
        10 = happy
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		remove_variable = tim_allow_timurid_architecture_event
		ruler_or_regent ?= {
			save_scope_as = target_character
		}

		capital ?= {
			save_scope_as = target_location
		}
	}

	option = {
		name = flavor_tim.11.a

		change_gold_effect = { scale = -1.5 }

		scope:target_location = {
			change_development = development_mild_bonus
			change_prosperity = prosperity_mild_bonus
		}

		add_prestige = prestige_extreme_bonus
	}

	option = {
		name = flavor_tim.11.b

		add_prestige = prestige_mild_penalty
	}

	option = {
		name = flavor_tim.11.c

		trigger = {
			scope:target_character ?= {
				has_trait = obsessive_perfectionist
			}
		}

		change_gold_effect = { scale = -4 }

		scope:target_location = {
			change_development = development_extreme_bonus
			change_prosperity = prosperity_extreme_bonus
		}

		scope:target_character = {
			add_adm = 5
		}

		add_prestige = prestige_extreme_bonus
	}
}

#Tamerlane Chess
flavor_tim.12 = {
	type = country_event
	title = flavor_tim.12.title
	desc = flavor_tim.12.desc
	historical_info = flavor_tim.12.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1370.1.1
		to = 1410.1.1
		monthly_chance = 5
	}
	fire_only_once = yes

	trigger = {
		ruler ?= character:chg_timur_lame_borjigin
		has_advance = tamerlane_chess
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler ?= {
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_tim.12.a

		scope:target_character = {
			add_mil = 5
		}
	}

	option = {
		name = flavor_tim.12.b

		add_prestige = prestige_mild_bonus
	}
}

#Abolishment of Mongol law
flavor_tim.13 = {
	type = country_event
	title = flavor_tim.13.title
	desc = flavor_tim.13.desc
	historical_info = flavor_tim.13.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1410.1.1
		to = 1500.1.1
		monthly_chance = 2
	}
	fire_only_once = yes

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	trigger = {
		has_policy = mongol_law_policy
		religion.group = religion_group:muslim
	}

	option = {
		name = flavor_tim.13.a

		add_policy = policy:sharia_law_policy

		add_estate_satisfaction = {
			type = estate_type:clergy_estate
			value = estate_satisfaction_extreme_bonus
		}

	}

	option = {
		name = flavor_tim.13.b

		add_army_tradition = army_tradition_mild_bonus

		add_estate_satisfaction = {
			type = estate_type:nobles_estate
			value = estate_satisfaction_mild_bonus
		}
	}
}

#Herat - the Capital of the Empire
flavor_tim.14 = {
	type = country_event
	title = flavor_tim.14.title
	desc = flavor_tim.14.desc
	historical_info = flavor_tim.14.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1410.1.1
		to = 1500.1.1
		monthly_chance = 2
	}
	fire_only_once = yes

	trigger = {
		religion.group = religion_group:muslim
		location:herat = {
			owner ?= root
			is_capital = no
		}
		government_type = government_type:monarchy
		ruler != character:chg_timur_lame_borjigin
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler_or_regent = {
			save_scope_as = target_character
		}

		location:herat = {
			save_scope_as = target_location
			region = {
				save_scope_as = target_region
			}
		}
	}

	option = {
		name = flavor_tim.14.a

		set_capital = scope:target_location

		scope:target_location = {
			if = {
				limit = {
					has_building = building_type:temple
				}
				owner ?= {
					change_societal_value = { type = mysticism_vs_jurisprudence value = societal_value_tiny_move_to_right }
				}
			}
			else = {
				construct_building = {
					building_type = building_type:temple
					cost_multiplier = 0.5
					cost_multiplier_reason = clergy_cheap_sponsorship
				}
			}
		}
	}

	option = {
		name = flavor_tim.14.b

		capital ?= {
			change_prosperity = prosperity_mild_bonus
		}

		add_prestige = prestige_mild_bonus
	}
}

flavor_tim.15 = {
	type = country_event
	title = flavor_tim.15.title
	desc = flavor_tim.15.desc
	historical_info = flavor_tim.15.historical_info

	dynamic_historical_event = {
		tag = TIM
		from = 1390.1.1
		to = 1420.1.1
		monthly_chance = 5
	}
	fire_only_once = yes

	trigger = {
		ruler_or_heir_if_regent ?= {
			is_legally_male = yes
			character_can_marry_trigger = yes
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ruler_or_heir_if_regent ?= {
			save_scope_as = target_character
		}

		random_owned_location = {
			create_dynasty_from_location = random
			last_dynasty_in_location = { save_scope_as = target_dynasty } #Can't seem to find a proper dynasty for her
		}
		create_character = {
			first_name = name_goar
			last_name = shad
			adm = 87
			dip = 76
			mil = 52
			birth_date = 1370.6.3
			birth_location = location:samarkand
			culture = root.culture
			religion = root.religion
			dynasty = scope:target_dynasty
			female = yes
			estate = estate_type:nobles_estate
			add_trait = trait:intricate_web_weaver
			save_scope_as = target_character2
			create_in_limbo = yes
		}
	}

	option = {
		name = flavor_tim.15.a

		scope:target_character2 = {
			move_country = root
			add_character_modifier = {
				mode = add_and_extend
				modifier = tim_empress_of_the_people
				years = -1
			}
		}
		scope:target_character = {
			marry_character = scope:target_character2
		}
	}

	option = {
		name = flavor_tim.15.b

		add_estate_satisfaction = {
			type = estate_type:nobles_estate
			value = estate_satisfaction_mild_bonus
		}
		scope:target_character = { banish_character = yes }
	}
}

flavor_tim.16 = {
	type = country_event
	title = flavor_tim.16.title
	desc = flavor_tim.16.desc

	dynamic_historical_event = {
		tag = TIM
		from = 1400.1.1
		to = 1450.1.1
		monthly_chance = 2
	}
	fire_only_once = yes

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:burghers_estate }
		create_character = {
			first_name = name_jamshid
			last_name = al_kashi
			estate = estate_type:clergy_estate
			artist = philosopher
			birth_location = location:kashan
			artist_skill = 0.75
			adm = 65
			dip = 70
			mil = 32
			birth_date = 1380.7.3
			culture = root.culture
			religion = religion:sunni
			save_scope_as = target_character
			create_in_limbo = yes
		}
	}

	option = {
		name = flavor_tim.16.a

		add_prestige = prestige_mild_bonus

		scope:target_character = {
			move_country = root
		}

		change_gold_effect = { scale = -2 }

		add_research_progress = research_progress_mild_bonus
	}

	option = {
		name = flavor_tim.16.b

		add_prestige = prestige_mild_penalty

		hidden_effect = { kill_character_silently = scope:target_character }
	}
}

#Gur-e-Amir
flavor_tim.17 = {
	type = country_event
	title = flavor_tim.17.title
	desc = flavor_tim.17.desc

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = {
			save_scope_as = target_character
		}

		ruler_or_regent ?= {
			save_scope_as = target_character2
		}

		capital ?= {
			save_scope_as = target_location
			region = {
				save_scope_as = target_region
			}
		}
	}

	option = {
		name = flavor_tim.17.a

		scope:target_location = {
			create_art = {
				artist = scope:target_character2
				key = gur_e_amir
				quality = 75
				type = work_of_art_type:monument
			}
		}

		change_gold_effect = { scale = -2 }
	}

	option = {
		name = flavor_tim.17.b

		add_prestige = prestige_mild_penalty
	}
}

#Ali-Shir Nava'i
flavor_tim.18 = {
	type = country_event
	title = flavor_tim.18.title
	desc = flavor_tim.18.desc
	historical_info = flavor_tim.18.historical_info

	trigger = {
		religion.group = religion_group:muslim
	}

	dynamic_historical_event = {
		tag = TIM
		from = 1460.1.1
		to = 1530.1.1
		monthly_chance = 2
	}

	fire_only_once = yes

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_ali_shir
			last_name = nava_i
			culture = root.culture
			religion = religion:sunni
			estate = estate_type:clergy_estate
			birth_date = 1441.2.9
			birth_location = location:herat
			artist = writer
			artist_skill = 0.8
			save_scope_as = target_character
			create_in_limbo = yes
		}

		ruler_or_regent ?= {
			save_scope_as = target_character2
		}
	}

	option = {
		name = flavor_tim.18.a
		historical_option = yes

		scope:target_character = {
			move_country = root
		}

		change_societal_value = { type = mysticism_vs_jurisprudence value = societal_value_tiny_move_to_right }

		change_gold_effect = { scale = -1.5 }
	}

	option = {
		name = flavor_tim.18.b

		kill_character_silently = {
			target = scope:target_character
		}
	}
}

flavor_tim.19 = {
	type = country_event
	title = flavor_tim.19.title
	desc = flavor_tim.19.desc

	dynamic_historical_event = {
		tag = TIM
		from = 1420.1.1
		to = 1460.1.1
		monthly_chance = 2
	}

	fire_only_once = yes

	trigger = {
		location:mashhad.owner ?= root

		religion.group = religion_group:muslim

		any_cabinet_character ?= {
			has_character_modifier = tim_empress_of_the_people
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		location:mashhad = {
			save_scope_as = target_location
		}

		random_cabinet_character ?= {
			limit = {
				has_character_modifier = tim_empress_of_the_people
			}
			save_scope_as = target_character
		}

		create_character = {
			first_name = name_ghavameddin
			last_name = shirazi
			estate = estate_type:peasants_estate
			birth_date = 1399.6.4 #Unknown birthdate
			birth_location = root.capital
			artist = architect
			artist_skill = {
				0.6
				0.8
			}
			save_scope_as = target_character2
			create_in_limbo = yes
		}
	}

	option = {
		name = flavor_tim.19.a

		scope:target_character2 = { move_country = root }
		scope:target_location = {
			create_art = {
				artist = scope:target_character2
				key = goharshad_mosque
				quality = 70
				type = work_of_art_type:monument
			}
		}

		change_gold_effect = { scale = -2 }
	}

	option = {
		name = flavor_tim.19.b

		add_prestige = prestige_mild_penalty
   		kill_character_silently = scope:target_character2
	}
}

#Hafiz-i Abru
flavor_tim.20 = {
	type = country_event
	title = flavor_tim.20.title
	desc = flavor_tim.20.desc

	dynamic_historical_event = {
		tag = TIM
		from = 1380.1.1
		to = 1440.1.1
		monthly_chance = 2
	}
	fire_only_once = yes

	trigger = {
		religion.group = religion_group:muslim
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_hafiz
			last_name = abru
			estate = estate_type:clergy_estate
			religion = root.religion
			culture = culture:afghan_culture
			birth_date = 1359.6.3 #Unknown birth date
			birth_location = location:herat
			artist = writer #Historian
			artist_skill = 0.6
			save_scope_as = target_character
			create_in_limbo = yes
		}

		ruler_or_regent ?= {
			save_scope_as = target_character2
		}
	}

	option = {
		name = flavor_tim.20.a

		change_gold_effect = { scale = -2 }

		scope:target_character = { move_country = root }
		capital ?= {
			create_art = {
				artist = scope:target_character
				key = majma_al_tawarikh
				quality = 75
				type = work_of_art_type:chronicle
			}
		}
	}

	option = {
		name = flavor_tim.20.b

		add_prestige = prestige_mild_penalty

		scope:target_character = {
			banish_character = yes
		}
	}
}

flavor_tim.1000 = { #A Problematic Individual
	type = country_event
	title = flavor_tim.1000.title
	desc = flavor_tim.1000.desc

	fire_only_once = yes

	dynamic_historical_event = {
		tag = CHG
		tag = NGD
		tag = QUN
		tag = BSD
		tag = ART
		tag = APD
		tag = SLD
		tag = BRL
		tag = YSU
		tag = KTT
		tag = JLY
		from = 1345.1.1
		to = 1350.1.1
		monthly_chance = 5
	}

	trigger = {
		character:chg_timur_lame_borjigin ?= {
			is_alive = yes
			owner = root
		}
		character:chg_taraghai_noyan_borjigin ?= {
			is_alive = yes
			owner = root
		}
		any_owned_location = {
			OR = {
				raw_material = goods:livestock
				raw_material = goods:wool
			}
			prosperity >= 0.2
		}
	}

	illustration_tags = {
        10 = angry
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		character:chg_timur_lame_borjigin = { save_scope_as = target_timur }
		character:chg_taraghai_noyan_borjigin = { save_scope_as = target_father }
		random_owned_location = {
			limit = {
				OR = {
					raw_material = goods:livestock
					raw_material = goods:wool
				}
				prosperity >= -0.8
			}
			save_scope_as = target_location
		}
	}

	option = { #Chastise him
		name = flavor_tim.1000.a
		add_prestige = prestige_mild_penalty
		hidden_effect = {
			random_list = {
				10 = { trigger_event_silently = { id = flavor_tim.1001 months = { 4 8 } } }
				20 = { trigger_event_silently = { id = flavor_tim.1002 months = { 4 8 } } }
			}
		}
	}
	option = { #He is only learning the path of the raider
		name = flavor_tim.1000.b
		scope:target_location = { change_prosperity = prosperity_severe_penalty }
		trigger_event_silently = { id = flavor_tim.1003 months = { 4 8 } }
	}
	option = { #These things happen, just compensate the shepherd
		name = flavor_tim.1000.c
		change_gold_effect = { scale = -2 }
		trigger_event_silently = { id = flavor_tim.1003 months = { 4 8 } }
	}
}

flavor_tim.1001 = { #Timur Calms Down
	type = country_event
	title = flavor_tim.1001.title
	desc = flavor_tim.1001.desc

	trigger = {
		character:chg_timur_lame_borjigin ?= {
			is_alive = yes
			owner = root
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = { save_scope_as = target_timur }
		if = {
			limit = { exists = scope:target_father }
			clear_saved_scope = target_father
		}
	}

	option = { #Restrain is the key
		name = flavor_tim.1001.a
		character:chg_timur_lame_borjigin = {
			if = {
				limit = { has_trait = child_rowdy }
				remove_trait = trait:child_rowdy
			}
			add_mil = -10
		}
		trigger_event_silently = { id = flavor_tim.1004 months = { 4 8 } }
	}

	option = { #As long as he has learned his lesson
		name = flavor_tim.1001.b
		character:chg_timur_lame_borjigin = {
			add_mil = -5
		}
		add_prestige = prestige_weak_bonus
	}
}

flavor_tim.1002 = { #Timur Rebels
	type = country_event
	title = flavor_tim.1002.title
	desc = flavor_tim.1002.desc

	trigger = {
		character:chg_timur_lame_borjigin ?= {
			is_alive = yes
			owner = root
		}
	}

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = {
			save_scope_as = target_timur
			if = {
				limit = {
					is_adult = no
					NOT = { has_trait = child_ambitious }
				}
				add_trait = trait:child_ambitious
			}
		}
		if = {
			limit = { exists = scope:target_father }
			clear_saved_scope = target_father
		}
	}

	option = { #Enough of this!
		name = flavor_tim.1002.a
		character:chg_timur_lame_borjigin = {
			if = {
				limit = { has_trait = child_rowdy }
				remove_trait = trait:child_rowdy
			}
			add_mil = -30
		}
		add_prestige = prestige_mild_penalty
	}

	option = { #There is actually nothing we can do
		name = flavor_tim.1002.b
		character:chg_timur_lame_borjigin = {
			if = {
				limit = { has_trait = child_rowdy }
				remove_trait = trait:child_rowdy
			}
			add_mil = 5
		}
		add_prestige = stability_weak_penalty
		trigger_event_silently = { id = flavor_tim.1003 months = { 4 8 } }
	}
}

flavor_tim.1003 = { #Timur Continues Rampaging
	type = country_event
	title = flavor_tim.1003.title
	desc = flavor_tim.1003.desc

	trigger = {
		character:chg_timur_lame_borjigin ?= {
			is_alive = yes
			owner = root
		}
	}

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = { save_scope_as = target_timur }
		if = {
			limit = { exists = scope:target_father }
			clear_saved_scope = target_father
		}
	}

	option = { #Chastise him
		name = flavor_tim.1003.a
		add_prestige = prestige_mild_penalty
		hidden_effect = {
			random_list = {
				10 = { trigger_event_silently = { id = flavor_tim.1001 months = { 4 8 } } }
				20 = { trigger_event_silently = { id = flavor_tim.1002 months = { 4 8 } } }
			}
		}
	}

	option = { #It is just some bad-mannered kid
		name = flavor_tim.1003.b
		add_stability = stability_mild_penalty
		trigger_event_silently = { id = flavor_tim.1003 months = { 4 8 } }
	}
}

flavor_tim.1004 = { #Timur Learns Proper Manners
	type = country_event
	title = flavor_tim.1004.title
	desc = flavor_tim.1004.desc

	trigger = {
		character:chg_timur_lame_borjigin ?= {
			is_alive = yes
			owner = root
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		character:chg_timur_lame_borjigin = { save_scope_as = target_timur }
	}

	option = {
		name = flavor_tim.1004.a
		character:chg_timur_lame_borjigin = {
			random_list = {
				10 = { add_adm = 5 }
				10 = { add_dip = 5 }
			}
		}
		add_stability = stability_weak_bonus
	}
}

flavor_tim.1100 = { #Rise of Astrarabadi Fazlallah
	type = country_event
	title = flavor_tim.1100.title
	desc = flavor_tim.1100.desc

	dynamic_historical_event = {
		tag = TIM
		from = 1370.1.1
		to = 1410.1.1
		monthly_chance = 2
	}
	fire_only_once = yes

	trigger = {
		ruler_or_heir_if_regent ?= {
			is_legally_male = yes
			character_can_marry_trigger = yes
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		create_character = {
			first_name = name_fazlallah
			last_name = Astarabadi
			adm = 52
			dip = 87
			mil = 34
			birth_date = 1340.6.3
			birth_location = location:gorgan
			culture = location:gorgan.owner.culture
			religion = religion:sunni
			estate = estate_type:peasants_estate
			add_trait = trait:zealot
			save_scope_as = target_character
			create_in_limbo = yes
		}

		clear_saved_scope = target_country

		ordered_neighbor_country = {
			limit = {
				NOT = { has_variable = tim_fazlallah_been_to_court }
			}
			order_by = prestige
			max = 1
			save_scope_as = target_country
		}
	}

	option = {
		name = flavor_tim.1100.a

		scope:target_character = {
			move_country = root
			add_character_modifier = {
				mode = add_and_extend
				modifier = tim_reincarnation_of_allah
				years = -1
			}
		}

		trigger_event_silently = {
			id = flavor_tim.1102
			years = {
				1
				10
			}
		}
	}

	option = {
		name = flavor_tim.1100.b

		trigger = {
			exists = scope:target_country
		}

		custom_tooltip = {
			text = tim_banish_character_tt
			set_variable = {
				name = tim_fazlallah_been_to_court
				value = yes
				months = 120
			}
			scope:target_character = {
				move_country = root
				move_country = scope:target_country
			}
			save_scope_as = target_country2
			scope:target_country = {
				trigger_event_silently = flavor_tim.1101
			}
		}
	}

	option = {
		name = flavor_tim.1100.c

		kill_character = {
			target = scope:target_character
		}

		create_rebel = {
			category = religious
			religion = religion:sunni
			name = hurufism_followers
			save_scope_as = target_rebel
		}

		capital ?= {
			random_pop = {
				limit = {
					pop_type = pop_type:peasants
				}
				change_pop_allegiance = scope:target_rebel
			}
		}
	}
}

flavor_tim.1101 = { #Rise of...
	type = country_event
	title = flavor_tim.1101.title
	desc = flavor_tim.1101.desc

	trigger = {
		scope:target_character = {
			is_alive = yes
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		clear_saved_scope = target_country
		ordered_neighbor_country = {
			limit = {
				NOT = { has_variable = tim_fazlallah_been_to_court }
			}
			order_by = prestige
			max = 1
			save_scope_as = target_country
		}
	}

	option = {
		name = flavor_tim.1101.a

		scope:target_character = {
			add_character_modifier = {
				mode = add_and_extend
				modifier = tim_reincarnation_of_allah
				years = -1
			}
		}

		hidden_effect = {
			every_country = {
				limit = {
					has_variable = tim_fazlallah_been_to_court
				}
				remove_variable = tim_fazlallah_been_to_court
			}
		}

		trigger_event_silently = {
			id = flavor_tim.1102
			years = {
				1
				10
			}
		}
	}

	option = {
		name = flavor_tim.1101.b

		kill_character_silently = {
			target = scope:target_character
		}

		add_stability = stability_mild_penalty
	}

	option = {
		name = flavor_tim.1101.c

		kill_character = {
			target = scope:target_character
		}

		add_stability = stability_mild_bonus

		create_rebel = {
			category = religious
			religion = religion:sunni
			name = hurufism_followers
			save_scope_as = target_rebel
		}

		capital ?= {
			every_pop = {
				limit = {
					pop_size >= 0.4
					pop_type = pop_type:peasants
				}
				change_pop_allegiance = scope:target_rebel
			}
		}
	}
}

flavor_tim.1102 = { #Rise of..
	type = country_event
	title = flavor_tim.1102.title
	desc = flavor_tim.1102.desc

	trigger = {
		any_character = { 
			has_character_modifier = tim_reincarnation_of_allah
			is_alive = yes
		}
		legitimacy <= 50
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		ordered_owned_location = {
			order_by = population
			position = 1
			area = {
				save_scope_as = target_area
			}
		}

		ruler_or_regent ?= {
			save_scope_as = target_character2
		}

		random_character = {
			limit = {
				has_character_modifier = tim_reincarnation_of_allah
			}
			save_scope_as = target_character
		}
	}

	option = {
		name = flavor_tim.1102.a

		kill_character = {
			target = scope:target_character
		}

		create_rebel = {
			category = religious
			religion = religion:sunni
			name = hurufism_followers
			save_scope_as = target_rebel
		}

		scope:target_area = {
			every_location_in_area = {
				every_pop = {
					limit = {
						pop_size >= 0.4
						pop_type = pop_type:peasants
					}
					change_pop_allegiance = scope:target_rebel
				}
			}
		}
	}

	option = {
		name = flavor_tim.1102.b

		change_government_type = government_type:theocracy
		set_new_ruler = scope:target_character

		if = {
			limit = {
				religion.group != religion_group:muslim
			}
			change_religion = religion:sunni
			change_religion_for_ruler_and_family = { country = ROOT religion = religion:sunni }
			add_estate_satisfaction = {
				type = estate_type:clergy_estate
				value = estate_satisfaction_extreme_penalty
			}
		}
		add_estate_satisfaction = {
			type = estate_type:nobles_estate
			value = estate_satisfaction_extreme_penalty
		}
	}
}