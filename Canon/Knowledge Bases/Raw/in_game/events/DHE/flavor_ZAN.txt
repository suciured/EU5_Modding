namespace = flavor_zan

flavor_zan.1 = {
	hide_portraits = yes
	type = country_event
	title = flavor_zan.1.title
	desc = flavor_zan.1.desc
	historical_info = flavor_zan.1.historical_info
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1337.1.1
		to = 1444.6.1
		monthly_chance = 2
	}
	trigger = {
		at_war = no
		is_during_bankruptcy = no
		location:kilwa_kisiwani = {
			is_capital = yes
			owner = root
		}
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		location:kilwa_kisiwani = { save_scope_as = target_location }
		ruler_or_regent = { save_scope_as = target_character }
		set_variable = unlocked_husuni_kubwa_variable
	}

	option = {
		name = flavor_zan.1.a
		historical_option = yes

		scope:target_location = {
			construct_building = { building_type = building_type:husuni_kubwa }
		}
	}
	option = {
		name = flavor_zan.1.b
		
		add_government_power = government_power_mild_penalty
		custom_tooltip = construct_the_building_at_another_time_tt
	}
}

#The Coinage of [previous ruler]
flavor_zan.2 = {
	type = country_event
	title = flavor_zan.2.title
	desc = flavor_zan.2.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1339.1.1
		to = 1345.1.1
		monthly_chance = 3
	}
	trigger = {
		at_war = no
		is_during_bankruptcy = no
		ruler ?= character:zan_daud_mahdali
		NOT = { has_estate_privilege = estate_privilege:control_over_the_coinage }
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:nobles_estate }
		ruler_or_regent = { save_scope_as = target_character }
		character:zan_abu_al_mawahib_al_hasan_ibn_suleiman = { save_scope_as = target_character2 }
		capital = { save_scope_as = target_location }
	}

	option = {
		name = flavor_zan.2.a

		trigger = {
			NOT = { has_estate_privilege = estate_privilege:control_over_the_coinage }
		}
		
		scope:target_location.market = { 
			add_temporary_demand = { 
				type = demand:zan_gold_coinage 
				months = 240 
			} 
		}
		if = {
			limit = { 
				NOT = { has_reform = government_reform:control_of_the_mahdali_coinage_reform }
			}
			add_reform = government_reform:control_of_the_mahdali_coinage_reform 
		}
		add_estate_satisfaction = { type = estate_type:burghers_estate value = estate_satisfaction_extreme_penalty }
	}

	option = {
		name = flavor_zan.2.b

		add_government_power = government_power_mild_penalty
	}

	option = {
		name = flavor_zan.2.c

		trigger = {
			NOT = { has_estate_privilege = estate_privilege:control_over_the_coinage }
		}

		grant_estate_privilege = estate_privilege:control_over_the_coinage
		add_stability = stability_extreme_bonus
		if = {
			limit = { has_reform = government_reform:control_of_the_mahdali_coinage_reform }
			remove_reform = government_reform:control_of_the_mahdali_coinage_reform
		}
		
	}
}

#The Passing of the Previous Ruler
flavor_zan.3 = {
	type = country_event
	title = flavor_zan.3.title
	desc = flavor_zan.3.desc
	fire_only_once = yes
	historical_info = flavor_zan.3.historical_info
	dynamic_historical_event = {
		tag = ZAN
		from = 1337.1.1
		to = 1400.1.1
		monthly_chance = 5
	}
	trigger = {
		has_ruler = yes
		ruler = character:zan_daud_mahdali
		ruler = {
			has_trait = greedy
		}
	}

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:nobles_estate }
		ruler_or_regent = { save_scope_as = target_character }
		character:zan_abu_al_mawahib_al_hasan_ibn_suleiman = { save_scope_as = target_character2 }
	}

	option = {
		name = flavor_zan.3.a
		
		scope:target_character = {
			remove_trait = trait:greedy
		}

		change_gold_effect = { scale = -2 }
		if = {
			limit = {
				religion.group = religion_group:muslim
				NOT = { has_estate_privilege = estate_privilege:waqf_payments }
			}
			grant_estate_privilege = estate_privilege:waqf_payments
		}
		else = {
			add_estate_satisfaction = { type = estate_type:clergy_estate value = estate_satisfaction_extreme_bonus }
		}
		capital.province = {
			every_location_in_province = { change_prosperity = prosperity_weak_bonus }
		}
	}

	option = {
		name = flavor_zan.3.b
		
		trigger = {
			is_active_parliament = yes
		}

		change_gold_effect = { scale = -2 }
		change_parliament_issue_support = 0.25
		add_government_power = government_power_weak_bonus
	}
}

#Another cultural aspect of the Swahili is their use of arts and crafts, which they find to be significant. When creating art, 
#they express themselves through creativity as well as through shape and function. Swahili art, furniture, and architecture reflect multicultural influences.[18] 
#They usually refrain from the use of designs with images of living beings due to their Muslim heritage. Instead, Swahili designs are primarily geometric. 

flavor_zan.4 = {
	hide_portraits = yes
	type = country_event
	title = flavor_zan.4.title
	desc = flavor_zan.4.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1337.1.1
		to = 1380.1.1
		monthly_chance = 1
	}
	trigger = {
		at_war = no
		is_during_bankruptcy = no
		stability > 40
		prestige > 20
	}

	illustration_tags = {
        10 = happy
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:burghers_estate background = estate_type:clergy_estate }
		ruler_or_regent = { save_scope_as = target_character }
		capital = { save_scope_as = target_location }
	}

	option = {	#Literacy
		name = flavor_zan.4.a

		trigger = {
			capital = {
				OR = {
					NOT = { has_institution = institution:renaissance }
					NOT = { has_institution = institution:banking }
					NOT = { has_institution = institution:professional_armies }
				}
			}
		}

		change_gold_effect = { scale = -18 }
		
		scope:target_location = {
			if = {
				limit = {
					NOT = { has_institution = institution:renaissance }
				}
				change_institution_progress = { type = institution:renaissance value = institution_progress_mild_bonus }
			}
			if = {
				limit = {
					NOT = { has_institution = institution:banking }
				}
				change_institution_progress = { type = institution:banking value = institution_progress_mild_bonus }
			}
			if = {
				limit = {
					NOT = { has_institution = institution:professional_armies }
				}
				change_institution_progress = { type = institution:professional_armies value = institution_progress_mild_bonus }
			}
		}
		
		add_research_progress = research_progress_extreme_bonus
	}
	option = {	#Culture
		name = flavor_zan.4.b
		
		change_gold_effect = { scale = -10 }

		culture = {
			add_cultural_tradition = cultural_tradition_extreme_bonus
			add_cultural_influence = cultural_influence_extreme_bonus
		}

		add_prestige = prestige_extreme_bonus
	}
	option = {	#Urban Planning
		name = flavor_zan.4.c
		
		trigger = {
			scope:target_location = {
				NOT = { location_rank = location_rank:city }
			}
		}
		
		change_gold_effect = { scale = -24 }
		scope:target_location = {
			if = {
				limit = { 
					location_rank = location_rank:rural_settlement 
					population > 5
				}
				change_location_rank = location_rank:town
			}
			else_if = {
				limit = {
					location_rank = location_rank:town 
					population > 20
				}
				change_location_rank = location_rank:city
			}
			else = {
				province = {
					every_location_in_province = {
						change_prosperity = prosperity_extreme_bonus
					}
				}
			}
			add_stability = stability_extreme_bonus
		}
	}
	option = {	#Nothing
		name = flavor_zan.4.d
		

	}
}


flavor_zan.5 = {
	hide_portraits = yes
	type = country_event
	title = flavor_zan.5.title
	desc = flavor_zan.5.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1340.1.1
		to = 1400.1.1
		monthly_chance = 1
	}
	trigger = {
		at_war = no
	}

	illustration_tags = {
        10 = angry
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:nobles_estate }
		capital = { save_scope_as = target_location }
		ruler_or_regent = { save_scope_as = target_character }
	}

	option = {
		name = flavor_zan.5.a
		
		culture = { 
			add_cultural_tradition = cultural_tradition_extreme_penalty
			add_cultural_influence = cultural_influence_extreme_penalty
		}
		change_societal_value = { type = spiritualist_vs_humanist value = societal_value_huge_move_to_right }
	}
	option = {
		name = flavor_zan.5.b
		
		scope:target_location = {
			every_pop = {
				limit = {
					owner = root
					culture != root.culture
				}
				add_pop_satisfaction = pop_satisfaction_ultimate_penalty
			}
		}
		culture = { 
			add_cultural_tradition = cultural_tradition_mild_bonus
			add_cultural_influence = cultural_influence_mild_bonus
		}
		add_stability = stability_mild_penalty
	}
}

#https://en.wikipedia.org/wiki/Engaruka

flavor_zan.6 = {
	hide_portraits = yes
	type = country_event
	title = flavor_zan.6.title
	desc = flavor_zan.6.desc
	historical_info = flavor_zan.6.historical_info
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1400.1.1
		to = 1500.1.1
		monthly_chance = 2
	}
	trigger = {
		location:engeruka = {
			has_owner = no
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:peasants_estate background = estate_type:peasants_estate }
		ruler_or_regent = { save_scope_as = target_character1 }
		location:engeruka = {
			change_location_owner = root
			save_scope_as = target_location
			create_country_from_location = {
				save_scope_as = target_country
			}
			change_control = control_radical_bonus
		}
		scope:target_country = {
			add_stability = stability_extreme_bonus
			add_gold = 500
			change_societal_value = {
				type = capital_economy_vs_traditional_economy
				value = 200		#Must be at 100, they were farmers and shepherds.
			}
			ruler_or_regent = { save_scope_as = target_character2 }
		}
		scope:target_location = {
			scope:target_location = {
				change_prosperity = prosperity_ultimate_bonus
				every_pop = {
					limit = {
						owner = root
					}
					add_pop_satisfaction = pop_satisfaction_radical_bonus
				}
				construct_building = {  
					building_type = building_type:irrigation_systems  
					cost_multiplier = 0 
					instant = yes
					cost_multiplier_reason = palace_cheap_sponsorship
				}
				#
				construct_building = {  
					building_type = building_type:market_village  
					cost_multiplier = 0  
					instant = yes
					cost_multiplier_reason = palace_cheap_sponsorship
				}
				construct_building = {  
					building_type = building_type:forest_village  
					cost_multiplier = 0 
					instant = yes
					cost_multiplier_reason = palace_cheap_sponsorship
				}
				construct_building = {  
					building_type = building_type:forest_village  
					cost_multiplier = 0 
					instant = yes
					cost_multiplier_reason = palace_cheap_sponsorship
				}
			}
		}
	}

	option = {
		name = flavor_zan.6.a
		
		custom_tooltip = engaruka_people_interesting_tt
	}
}

flavor_zan.7 = {
	type = country_event
	title = flavor_zan.7.title
	desc = flavor_zan.7.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1400.1.1
		to = 1500.1.1
		monthly_chance = 2
	}
	trigger = {
		location:bandire = {
			has_owner = no
		}
		location:sofala = {
			top_owner = root
		}
	}
	
	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:burghers }
		location:bandire = { 
			save_scope_as = target_location
			
		}
		location:matendere = {
			province = { save_scope_as = target_province }
		}
	}

	option = {
		name = flavor_zan.7.a
		
		scope:target_location = { 
			add_road_to = {
				target = location:sofala
				type = gravel_road
			}
		}
		scope:target_location = {
			if = {
				limit = {
					c:SFA = {
						owns = location:sofala
						is_subject_of = root
						location:sofala = {
							is_capital = yes
						}
					}
				}
				change_location_owner = c:SFA
			}
			else = {
				change_location_owner = root
			}
		}
		if = {
			limit = {
				province_definition:upper_save_province = {
					any_location_in_province_definition = {
						NOT = { top_owner = root }
					}
				}
			}
			every_country = {
				limit = { 
					NOT = { tag = ZAN }
					NOT = { top_overlord ?= c:ZAN }
					any_owned_location = {
						this.province_definition = province_definition:upper_save_province
					}
				}
				c:ZAN = {
					add_casus_belli = {
						type = casus_belli:cb_conquer_province 
						province = location:matendere.province
						target = prev
					}
				}
			}
			
		}
	}
}

flavor_zan.8 = {	#Shirazi Islam and the Patricians of Kilwa
	hide_portraits = yes
	type = country_event
	title = flavor_zan.8.title
	desc = flavor_zan.8.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1350.1.1
		to = 1480.1.1
		monthly_chance = 1
	}
	trigger = {
		religion = religion:sunni
		societal_value:mysticism_vs_jurisprudence < -5
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:clergy_estate background = estate_type:clergy_estate }
		ruler_or_regent = { save_scope_as = target_character }
		ordered_known_country = {
			limit = {
				religion.group = religion_group:muslim
				societal_value:mysticism_vs_jurisprudence > 0
				has_ports = yes
				within_diplomatic_range = root
				NOT = { is_subject_of = root }
				NOT = { tag = ZAN }
			}
			order_by = societal_value:mysticism_vs_jurisprudence
			max = 1
			check_range_bounds = no
			save_scope_as = target_country
		}
		save_scope_as = target_country2
	}

	option = {
		name = flavor_zan.8.a
		
		if = {
			limit = {
				any_known_country = {
					religion.group = religion_group:muslim
					societal_value:mysticism_vs_jurisprudence > 0
					has_ports = yes
					within_diplomatic_range = root
					NOT = { is_subject_of = root }
					NOT = { tag = ZAN }
				}
			}
			custom_tooltip = {
				text = countries_with_positive_piety_reduced_relations_tt
				every_known_country = {
					limit = {
						religion.group = religion_group:muslim
						societal_value:mysticism_vs_jurisprudence > 0
						has_ports = yes
						within_diplomatic_range = root
						NOT = { is_subject_of = root }
						NOT = { tag = ZAN }
					}
					add_opinion = {
						target = root
						modifier = opinion_shirazi_islam
					} 
				}
			}
		}

		add_government_power = government_power_extreme_bonus
		change_societal_value = { type = mysticism_vs_jurisprudence value = societal_value_move_to_left }
		hidden_effect = { set_variable = followed_ways_of_ancestors_variable }
		

	}
	option = {
		name = flavor_zan.8.b
		
		if = {
			limit = {
				any_known_country = {
					religion.group = religion_group:muslim
					societal_value:mysticism_vs_jurisprudence > 0
					has_ports = yes
					within_diplomatic_range = root
					NOT = { is_subject_of = root }
				}
			}
			custom_tooltip = {
				text = countries_with_positive_piety_increased_relations_tt
				every_known_country = {
					limit = {
						religion.group = religion_group:muslim
						societal_value:mysticism_vs_jurisprudence > 0
						has_ports = yes
						within_diplomatic_range = root
						NOT = { is_subject_of = root }
					}
					add_opinion = {
						target = root
						modifier = opinion_adopted_our_religious_views
					} 
				}
			}
		}

		add_government_power = government_power_extreme_penalty
		change_societal_value = { type = mysticism_vs_jurisprudence value = societal_value_move_to_right }
		add_stability = stability_mild_penalty
	}
}

flavor_zan.9 = {	#The Kilwa Chronicle
	hide_portraits = yes
	type = country_event
	title = flavor_zan.9.title
	desc = flavor_zan.9.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1380.6.1
		to = 1520.6.1
		monthly_chance = 1
	}
	trigger = {
		at_war = no
		societal_value:mysticism_vs_jurisprudence < 0
		has_ruler = yes
		has_variable = followed_ways_of_ancestors_variable
	}

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
		save_scope_as = target_country
		ruler_or_regent = { save_scope_as = target_character }

		remove_variable = followed_ways_of_ancestors_variable
	}

	option = {
		name = flavor_zan.9.a
		
		capital = {
			create_art = {
				artist = root.ruler
				quality = 80
				type = work_of_art_type:chronicle
				key = kilwa_chronicle
			}
		}
		change_gold_effect = { scale = -6 }
	}
	option = {
		name = flavor_zan.9.b
		
		culture = {
			add_cultural_tradition = cultural_tradition_extreme_penalty
		}
	}
}

flavor_zan.10 = {
	hide_portraits = yes
	type = country_event
	title = flavor_zan.10.title
	desc = flavor_zan.10.desc
	fire_only_once = yes
	dynamic_historical_event = {
		tag = ZAN
		from = 1450.1.1
		to = 1650.1.1
		monthly_chance = 2
	}
	trigger = {
		c:POR ?= {
			has_presence_in = region:swahili_coast_region
			NOR = {
				is_subject_of = root
				has_mutual_scripted_relation = {
					type = relation_type:alliance
					target = root
				}
				root = { is_subject_of = prev }
			}
			relative_strength = {
				target = root
				value > 0.35
			}
		}
	}

	illustration_tags = {
        10 = regular
        10 = exterior
    }

	immediate = {
		event_illustration_poptype_effect = { foreground = pop_type:soldiers background = pop_type:soldiers }
		c:POR = {
			save_scope_as = target_country
			ruler_or_regent = { save_scope_as = target_character }
		}
		save_scope_as = target_country2
		ruler_or_regent = { save_scope_as = target_character2 }
	}

	option = {
		name = flavor_zan.10.a
		
		add_stability = stability_ultimate_penalty
		c:POR = {
			trigger_event_non_silently = flavor_zan.11
		}
	}
}

flavor_zan.11 = {
	type = country_event
	title = flavor_zan.11.title
	desc = flavor_zan.11.desc
	fire_only_once = yes

	illustration_tags = {
        10 = regular
        10 = interior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:burghers_estate }
	}

	option = {
		name = flavor_zan.11.a

		historical_option = yes
		
		add_casus_belli = {
			type = casus_belli:cb_conquer_province 
			province = scope:target_country2.capital.province
			target = scope:target_country2
		}
	}

	option = {
		name = flavor_zan.11.b
		
		add_opinion_mutual_effect = {
			modifier = opinion_peaceful_trade_relations
			target = scope:target_country2
		}

		scope:target_country2 = { 
			trigger_event_non_silently = flavor_zan.12
		}
	}

	option = {
		name = flavor_zan.11.c
		
		add_opinion_mutual_effect = {
			modifier = opinion_peaceful_trade_relations
			target = scope:target_country2
		}
	}
}

flavor_zan.12 = {
	type = country_event
	title = flavor_zan.12.title
	desc = flavor_zan.12.desc
	fire_only_once = yes
	
	illustration_tags = {
        10 = happy
        10 = exterior
    }

	immediate = {
		event_illustration_estate_effect = { foreground = estate_type:nobles_estate background = estate_type:nobles_estate }
	}

	option = {
		name = flavor_zan.12.a
		
		show_as_tooltip = {
			add_opinion_mutual_effect = {
				modifier = opinion_peaceful_trade_relations
				target = scope:target_country
			}
		}

		add_stability = stability_extreme_bonus
	}
}




