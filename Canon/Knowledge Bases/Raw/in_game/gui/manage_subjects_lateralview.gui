lateralview = {
	name = "manage_subjects_lateralview"

	# SOUND - Manage Subjects (Left Panel)
	blockoverride "snd_panel_identifier" { soundeffect = "UI_panelAux_diplomacy_manageSubjects_show" }
	blockoverride "panel_header" {
		window_header_alt = {

			blockoverride "header_text" {
				text = "[ManageSubjectsLateralView.GetTitle]"
			}
		}
	}
	
	blockoverride "panel_content" {
		vbox = {
			using = layoutpolicy_expanding
			using = bg_main_inner_alt
			using = window_main_tabs_margin_alt


			hbox = {
				visible = "[EqualTo_string(ManageSubjectsLateralView.GetTitle, Localize('MANAGE_SUBJECTS_HEADER'))]"
				layoutpolicy_horizontal = expanding
				maximumsize = {-1 135}
				margin = {5 5}
				spacing = 2

				datamodel = "[GetMilitaryStances]"
				item = {
					card_header_button_01 = {
						layoutpolicy_horizontal = expanding
						size = { -1 30 }
	
						using = bg_paper_card
						blockoverride "card_color" {
							modify_texture = {
								using = color_mid_red_texture
							}
						}
	
						tooltipwidget = {
							ContextualTooltipType = {
								blockoverride "title_icon" {
									icon = {
										using = tooltip_title_icon_size
										texture = "[GetMilitaryStanceIcon(SubjectMilitaryStance.Self)]"
									}
								}
								blockoverride "title_text" {
									raw_text = "[Localize('SELECT')] [SubjectMilitaryStance.GetName]"
								}

								blockoverride "concept_link" {
									text = "[subject_military_stance|e]"
								}
								
								blockoverride "tooltip_content" {
									TooltipFlavorTextBlock = {
										blockoverride "text" {
											text = "[SubjectMilitaryStance.GetDescAll]"
										}
									}
								}
							}
						}

						action_tooltip = {
							click_type = left
							click_mode = confirm
							title = "APPLY_MILITARY_STANCE_TO_ALL"
							on_action = "[ApplyMilitaryStanceToSubjects(SubjectMilitaryStance.Self)]"
						}
	
						hbox = {
							spacing = 3
							margin = {5 0}
							icon = {
								size = { 25 25 }
								texture = "[GetMilitaryStanceIcon(SubjectMilitaryStance.Self)]"
							}
						}
					}
				}
			}
			
			filtered_sorted_list = {
				datacontext = "[ManageSubjectsLateralView.GetSubjectRelationsSortSearch]"
				

				blockoverride "scroll_list_is_empty" {
					visible = "[IsDataModelEmpty(ManageSubjectsLateralView.GetSubjectRelations)]"
				}

				blockoverride "scroll_list_is_empty_text" {
					text = "SUBJECTS_LIST_EMPTY"
				}

				blockoverride "sort_buttons_filtered_list" {
						spacing = 5

						sort_by_key_button = {
							name = "name"
							using = layoutpolicy_expanding
						}

						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "their_opinion"
							using = layoutpolicy_expanding
						}

						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "loyalty"
							using = layoutpolicy_expanding
						}

						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "liberty_desire"
							using = layoutpolicy_expanding
						}
						
						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "profit"
							using = layoutpolicy_expanding
						}
						
						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "subject_name"
							using = layoutpolicy_expanding
						}

						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "taxation"
							using = layoutpolicy_expanding
						}
						
						sort_by_key_button = {
							visible = "[ManageSubjectsLateralView.IsSubjectType('current_subject')]"
							name = "strength"
							using = layoutpolicy_expanding
						}
					}

				blockoverride "scroll_list_layout" {
					vbox = {
						vbox = {
							layoutpolicy_horizontal = expanding
							datamodel = "[ManageSubjectsLateralView.GetSubjectRelations]"
							item = {
								vbox = {
									layoutpolicy_horizontal = expanding

									subject_type_large = {
										visible = "[And(SubjectCategoryItem.HasSubjects, Not(SubjectCategoryItem.ContainsProvinceOrLocationItems))]"
									}

									subject_type_small = {
										visible = "[And(SubjectCategoryItem.HasSubjects, SubjectCategoryItem.ContainsProvinceOrLocationItems)]"
									}
								}
							}
						}
						expand = {}
					}
				}
			}
		}
	}
}

types Subject_Types {
	type subject_type_large = fixedgridbox {
		addcolumn = 100%
		addrow = 75
		datamodel = "[SubjectCategoryItem.GetSubjects]"
		item = {
			widget = {
				allow_outside = yes
				size = { 100% 75 }
				widget = {
					size = { 97% 70 }
					parentanchor = center
					using = bg_paper_card
					using = bg_cabinet_card_frame

					vbox = {
						margin = { 0 2 }
						margin_top = 4
						# HEADER
						widget = {
							layoutpolicy_horizontal = expanding
							size = { -1 30}
							
							hbox = {
								visible = "[SubjectItem.IsCountry]"
								spacing = 2
								margin = { 4 0 }
								widget = {
									size = { 45 30 }
									using = bg_card_header_01
									country_flag_small_plus = {
										datacontext = "[SubjectItem.GetCountry]"
										size = { 45 30 }
									}
								}
								

								card_header_button_04 = {
									layoutpolicy_horizontal = expanding
									size = { -1 30}

									datacontext = "[SubjectItem.GetCountry.GetDiplomacy.GetSubjectType]"
									datacontext = "[SubjectItem.GetCountry]"
									tooltipwidget = {
										BasicFunctionalTooltip = {}
									}

									action_tooltip = {
										click_type = left
										click_mode = single
										title = "OPEN_DIPLOMACY"
										on_action = "[ShowDiploMacrobuilderWithCountryAndFilter(SubjectItem.GetCountry.Self, 'subject_category', '(bool)yes')]"
									}

									action_tooltip = {
										click_type = right
										click_mode = single
										cursor = "country_menu"
										title = "CLICK_ACTION_COUNTRY_CONTEXT_MENU"
										on_action = "[PdxGuiWidget.ToggleContextMenu]"
									}
									contextmenu_enabled = "[Country.IsValid]"
									contextmenu_widget = {
										CountryContextMenu = {}
									}


									using = bg_card_header_01
									blockoverride "header_color" {
										texture = "gfx/interface/colors/white.dds"
										tintcolor = "[SubjectItem.GetCountry.GetDiplomacy.GetSubjectType.GetColor]"
										alpha = 0.5
									}
									blockoverride "header_pattern" {
										texture = "gfx/interface/cards/headers/header_pattern_07.dds"
										alpha = 0.7
									}
					
									hbox = {
										margin = { 3 0 }
										margin_left = 8
										spacing = 5
										
										icon = {
											size = { 25 25 }
											texture = "gfx/interface/icons/flat_icons/balance/diplomacy.dds"
										}

										text_single = {
											layoutpolicy_horizontal = expanding
											size = { -1 17 }
											autoresize = no
											align = left|nobaseline
											text = "[SubjectItem.GetCountry.GetLongNameWithNoTooltip]"
											sort_by_highlight = {
												name = "name"
											}
										}
									}
								}
								card_header_button_04 = {
									size = { 150 30}

									datacontext = "[SubjectItem.GetCountry.GetDiplomacy.GetSubjectType]"
									tooltipwidget = {
										using = SubjectType_tooltip
									}

									action_tooltip = {
										click_type = left
										click_mode = single
										title = "[SubjectItem.GetTooltip]"
										on_action = "[SubjectItem.OnClick]"
										enabled = "[SubjectItem.GetEnabled]"
									}

									using = bg_card_header_01
									blockoverride "header_color" {
										texture = "gfx/interface/colors/white.dds"
										tintcolor = "[SubjectItem.GetCountry.GetDiplomacy.GetSubjectType.GetColor]"
										alpha = 0.5
									}
									blockoverride "header_pattern" {
										texture = "gfx/interface/cards/headers/header_pattern_07.dds"
										alpha = 0.7
									}
					
									hbox = {
										margin = { 3 0 }
										margin_left = 8
										spacing = 5
										
										icon = {
											size = { 25 25 }
											visible = "[And(SubjectItem.IsCountry, Not(SubjectItem.IsCountryAndDoesNotExist))]"
											texture = "[GetSubjectTypeIcon(SubjectItem.GetCountry.GetDiplomacy.GetSubjectType)]"
										}
										text_single = {
											sort_by_highlight = {
												name = "subject_name"
											}
											maximumsize = {100 -1}
											text = "[SubjectItem.GetCountry.GetDiplomacy.GetSubjectType.GetNameWithNoTooltip]"
										}
										expand = {}
									}
								}
								card_header_action_button_04 = {
									size = { 80 30}

									actor = "[Player]"
									title = "[SubjectItem.GetCountry.GetMilitaryStance.GetNameWithNoTooltip]"
									parameter = {
										parameter_name = "subject"
										parameter_value = "[SubjectItem.GetCountry]"
									}
									left_action = { action_name = "change_military_stance" }

									tooltipwidget = { 
										using = action_tooltip_pop_out

										blockoverride "title_icon_texture" {
											texture = "[GetMilitaryStanceIcon(SubjectItem.GetCountry.GetMilitaryStance)]"
										}
									}

									background = {
										texture = "gfx/interface/colors/black.dds"
										margin = { 1 1 }
										margin_bottom = 2
										texture_density = 2
										alpha = 0.4
									}
									background = {
										using = bg_card_header_01_default
										alpha = 0.3
										blockoverride "header_color" {
											texture = "gfx/interface/colors/white.dds"
											tintcolor = "[SubjectItem.GetCountry.GetDiplomacy.GetSubjectType.GetColor]"
											alpha = 0.5
										}
										blockoverride "header_pattern" {
											texture = "gfx/interface/cards/headers/header_pattern_07.dds"
											alpha = 0.7
										}
									}

									hbox = {
										margin = { 3 0 }
										margin_left = 8
										spacing = 5

										icon = {
											size = { 25 25 }
											texture = "[GetMilitaryStanceIcon(SubjectItem.GetCountry.GetMilitaryStance)]"
										}
									}
								}
							}
						}

						# BOTTOM
						hbox = {
							using = layoutpolicy_expanding
							hbox = {
								using = layoutpolicy_expanding
				
								# using = bg_corner_flavor
								# blockoverride "corner_flavor_texture" {
								# 	texture = "gfx/interface/component_decoration/bg_corner_flavor_06.dds"
								# 	texture_density = 2
								# 	spriteType = Corneredstretched
								# 	spriteborder = { 35 35 }
								# 	alpha = 0.7
								# }
								# blockoverride "corner_flavor_color" {
								# 	modify_texture = {
								# 		using = color_bg_blue_texture
								# 		blend_mode = multiply
								# 	}
								# }
				
								hbox = {
									using = layoutpolicy_expanding
									margin = { 6 0 }
									widget = {
										allow_outside = yes
										using = layoutpolicy_expanding
										hbox = {
											spacing = 0
											# OPINION OF THEM
											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												text = "[SubjectItem.GetTheirOpinion|+=0] [opinion_icon]"
												sort_by_highlight = {
													name = "their_opinion"
												}
												tooltipwidget = {
													SimpleContextualStringPairTooltipType = {
														blockoverride "title_icon" {
															icon = {
																using = tooltip_title_icon_size
																texture = "gfx/interface/icons/flat_icons/foreigncountry/opinion.dds"
															}
														}
														blockoverride "concept_link" {
															text = "[opinion|e]"
														}
														lowpriotextcontext = "[SubjectItem.GetTheirOpinionTooltip]"
													}
												}
											}
											divider_flavor_01 = {
												size = { 15 -1 }
											}
											
											# LOYALTY
											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												raw_text = "[SelectLocalization(GreaterThan_CFixedPoint(SubjectItem.GetLoyalty, '(CFixedPoint)49.999'), 'MANAGE_SUBJECTS_LATERAL_VIEW_LOYALTY_POSITIVE', 'MANAGE_SUBJECTS_LATERAL_VIEW_LOYALTY_NEGATIVE')][subject_loyalty_icon]"
												datacontext = "[SubjectItem.GetCountry]"
												tooltipwidget = {
													using = SubjectLoyalty_tooltip
												}
												sort_by_highlight = {
													name = "loyalty"
												}
											}
		
											divider_flavor_01 = {
												size = { 15 -1 }
											}
											
											# LIBERTY DESIRE
											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												text = "[SubjectItem.GetCountry.GetDiplomacy.GetLibertyDesire|-=][liberty_desire_icon]"
												tagtooltip_enabled = yes
												tooltip = "[liberty_desire|e]"
												sort_by_highlight = {
													name = "liberty_desire"
												}
											}
		
											divider_flavor_01 = {
												size = { 15 -1 }
											}
											
											# TAXATION
											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												text = "[SubjectItem.GetSubjectTaxation]"
												visible = "[GreaterThan_CFixedPoint(SubjectItem.GetSubjectTaxationAmount, '(CFixedPoint)0')]"
												sort_by_highlight = {
													name = "profit"
												}
											}

											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												raw_text = "0.00 @gold!"
												visible = "[Not(GreaterThan_CFixedPoint(SubjectItem.GetSubjectTaxationAmount, '(CFixedPoint)0'))]"
												sort_by_highlight = {
													name = "profit"
												}
											}
		
											divider_flavor_01 = {
												size = { 15 -1 }
											}
																						
											# TAX BASE
											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												text = "[SubjectItem.GetCountry.GetTotalTaxBase][tax_base_icon]"
												sort_by_highlight = {
													name = "taxation"
												}
											}
		
											divider_flavor_01 = {
												size = { 15 -1 }
											}
																																	
											# ARMY POWER
											text_single = {
												layoutpolicy_horizontal = expanding
												size = {-1 30}
												autoresize = no
												align = center
												#raw_text = "[Multiply_CFixedPoint(Country.GetMilitaryStrength, '(CFixedPoint)1000')|L0] @army_strength!"
												raw_text = "[Country.GetTotalArmyStrengthAndPotentialLevies|L0] @army_strength!"
												datacontext = "[SubjectItem.GetCountry]"
												tooltipwidget = {
													using = Army_size_tooltip
												}
												sort_by_highlight = {
													name = "strength"
												}
											}
											expand = {}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	
	type subject_type_small = fixedgridbox {
		addcolumn = 100%
		addrow = 45
		datamodel = "[SubjectCategoryItem.GetSubjects]"
		item = {
			widget = {
				allow_outside = yes
				size = { 100% 45 }
				clickable_header_card = {
					parentanchor = center
					size = { 95% 35 }

					blockoverride "header_color" {
						using = color_diplomacy_texture
					}

					blockoverride "card_bg" {
						using = bg_card_header_01_diplomacy
					}
					
					blockoverride "header_button" {
						card_header_button_01 = {
							size = { 100% 100% }
							visible = "[SubjectItem.IsCountry]"
							datacontext = "[SubjectItem.GetCountry]"
							tooltipwidget = {
								using = ReleaseCountryTooltip 
							}
	
							using = subjects_header_content
						}

						card_header_button_01 = {
							size = { 100% 100% }
							visible = "[Not(SubjectItem.IsCountry)]"
							tooltipwidget = {
								BasicFunctionalTooltip = {}
							}

							using = subjects_header_content
						}
					}
				}
			}
		}
	}
}

template subjects_header_content {
	size = { 100% 100% }
	onclick = "[SubjectItem.OnClick]"

	action_tooltip = {
		click_type = left
		click_mode = single
		title = "[Select_CString(SubjectItem.GetEnabled, SubjectItem.GetTooltip, Localize('NO_POSSIBLE_SUBJECT_TYPES_ACTION_TT_TITLE'))]"
		conditions = "[MakeItFailIf(Not(SubjectItem.GetEnabled), SubjectItem.GetTooltip)]"
		on_action = "[SubjectItem.OnClick]"
		enabled = "[SubjectItem.GetEnabled]"
	}					
	enabled = "[SubjectItem.GetEnabled]"
	onmousehierarchyenter = "[SubjectItem.HighlightOnMap(PdxGuiWidget.AccessSelf)]"			
	hbox = {
		
		margin = { 15 0 }
		alwaystransparent = yes

		widget = {
			visible = "[SubjectItem.IsCountry]"
			datacontext = "[SubjectItem.GetCountry]"
			alwaystransparent = yes
			size = { 40 30 }
			country_flag_small_plus = {
				size = { 45 30 }
				parentanchor = center

				blockoverride "contextmenu" {
					contextmenu_enabled = no
				}

				blockoverride "click" {}
				blockoverride "double_click" {}
				blockoverride "rightclick" {}
			}
		}

		icon = {
			visible = "[And(SubjectItem.IsCountry, Not(Player.HasModifier('force_convert_created_subjects')))]"
			align = left|nobaseline
			size = { 30 30 }
			texture = "[GetReligionIcon(Country.GetReligion)]"
		}

		icon = {
			visible = "[And(SubjectItem.IsCountry, Player.HasModifier('force_convert_created_subjects'))]"
			align = left|nobaseline
			size = { 30 30 }
			texture = "[GetReligionIcon(Player.GetReligion)]"
		}

		text_single = {
			visible = "[SubjectItem.IsCountry]"
			using = Font_Size_Medium
			using = Font_Type_Headers
			align = left|nobaseline
			layoutstretchfactor_horizontal = 5
			layoutpolicy_horizontal = expanding
			alwaystransparent = yes
			
			size = { -1 30 }
			autoresize = no
			fontsize_min = 10
			text = "[SubjectItem.GetCountry.GetLongNameWithNoTooltip|L]"
		}

		text_single = {
			visible = "[SubjectItem.IsProvince]"
			align = left|nobaseline
			layoutstretchfactor_horizontal = 5
			layoutpolicy_horizontal = expanding
			alwaystransparent = yes
			size = {-1 30}
			autoresize = no
			using = Font_Size_Medium
			using = Font_Type_Headers

			text = "[SubjectItem.GetProvince.GetName]"
		}

		text_single = {
			visible = "[SubjectItem.IsRegion]"
			align = left|nobaseline
			layoutstretchfactor_horizontal = 5
			layoutpolicy_horizontal = expanding
			alwaystransparent = yes
			size = {-1 30}
			autoresize = no
			using = Font_Size_Medium
			using = Font_Type_Headers

			text = "[SubjectItem.GetRegion.GetName]"
		}

		expand = {}

		text_single = {
			visible = "[SubjectItem.IsRegion]"
			layoutstretchfactor_horizontal = 3
			layoutpolicy_horizontal = expanding
			size = {-1 30}
			autoresize = no
			align = right|nobaseline

			text = "MANAGE_SUBJECTS_LATERAL_VIEW_REGION_SUB_CONTINENT"
		}

		text_single = {
			visible = "[SubjectItem.IsCountryAndDoesNotExist]"
			layoutstretchfactor_horizontal = 2
			layoutpolicy_horizontal = expanding
			size = {-1 30}
			autoresize = no
			align = right|nobaseline
			raw_text = "[SubjectItem.GetCountry.GetCulture.GetName|L]  @culture!"
		}

		text_single = {
			visible = "[SubjectItem.IsProvince]"
			layoutstretchfactor_horizontal = 2
			layoutpolicy_horizontal = expanding
			size = {-1 30}
			autoresize = no
			align = right|nobaseline

			text = "MANAGE_SUBJECTS_LATERAL_VIEW_PROVINCE_REGION"
		}
	}
}