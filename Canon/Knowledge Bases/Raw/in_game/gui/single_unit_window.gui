
types SingleUnitWindowTypes
{
	# type SubUnitCategorySingleButton = button {
	# 	size = { 32 32 }
	# 	texture = "[GetSubUnitCategoryIcon(SubUnitCategory.Self)]"

	# 	onclick = "[DetachCategory(SingleUnitWindow.GetSelectedUnit.Self,SubUnitCategory.Self)]"
	# 	enabled = "[CanDetachCategory(SingleUnitWindow.GetSelectedUnit.Self,SubUnitCategory.Self)]"

	# 	datacontext = "[SingleUnitWindow.GetDetachAction(SubUnitCategory.Self)]"
	# 	tooltipwidget = {
	# 			using = UnitAction_tooltip
	# 	}

	# 	texture_density = 2
	# }

	# type SubUnitCategoryIcon = hbox {
		
	# 	tooltip = "[SubUnitCategory.GetCategoryTooltip(SingleUnitWindow.GetSelectedUnit.Self)]"
	# 	icon = {
	# 		size = { 32 32 }
	# 		texture = "[GetSubUnitCategoryFlatIcon(SubUnitCategory.Self)]"
	# 		texture_density = 2
	# 		modify_texture = {
	# 			visible = "[GreaterThan_int32(SubUnitCategory.GetCount(SingleUnitWindow.GetSelectedUnit.Self), '(int32)0')]"
				
	# 			blend_mode = overlay
	# 		}
	# 	}
	# }

	# type SubUnitCategoryItem = hbox {
	# 	using = layoutpolicy_expanding
	# 	margin = { 10 10 }
	# 	spacing = 5

	# 	tooltip = "[SubUnitCategory.GetCategoryTooltip(SingleUnitWindow.GetSelectedUnit.Self)]"

	# 	button = {
	# 		size = { 32 32 }

	# 		block "composition_type_icon"
	# 		{
	# 			texture = "[GetSubUnitCategoryFlatIcon(SubUnitCategory.Self)]"
	# 		}

	# 		onrightclick = "[DetachCategory(SingleUnitWindow.GetSelectedUnit.Self,SubUnitCategory.Self)]"
	# 		tooltip = "[GetDetachCategoryInfo(SingleUnitWindow.GetSelectedUnit.Self,SubUnitCategory.Self,'(bool)no')]"
	# 		enabled = "[CanDetachCategory(SingleUnitWindow.GetSelectedUnit.Self,SubUnitCategory.Self)]"

	# 		texture_density = 2
			
	# 	}

	# 	vbox = {
	# 		using = layoutpolicy_expanding

	# 		hbox = {
	# 			using = layoutpolicy_expanding
	# 			spacing = 5

	# 			icon = {
	# 				size = { 24 24 }

	# 				block "regimen_icon"
	# 				{
	# 					using = unit_formation_texture
	# 				}

	# 				texture_density = 2
	# 				using = overlay_color_bone
	# 			}

	# 			text_single = {
	# 				using = layoutpolicy_expanding
	# 				align = nobaseline
	# 				autoresize = no

	# 				block "regimen_text"
	# 				{
	# 					text = "[SubUnitCategory.GetCount(SingleUnitWindow.GetSelectedUnit.Self)]"
	# 				}
	# 			}
	# 		}

	# 		hbox = {
	# 			using = layoutpolicy_expanding
	# 			spacing = 5

	# 			visible = "[SingleUnitWindow.GetSelectedUnit.IsArmy]"

	# 			icon = {
	# 				size = { 24 24 }

	# 				block "count_icon"
	# 				{
	# 					using = army_strength_texture
	# 				}

	# 			}

	# 			text_single = {
	# 				using = layoutpolicy_expanding
	# 				align = nobaseline
	# 				autoresize = no

	# 				block "count_text"
	# 				{
	# 					text = "[SubUnitCategory.GetTotalStrength(SingleUnitWindow.GetSelectedUnit.Self)]"
	# 				}
	# 			}
	# 		}
	# 	}
	# }

	type UnitFlankInfo = widget {
		layoutpolicy_horizontal = expanding
		block "flank_size" {
			size = {-1 40}
		}

		vbox = {
			margin = {0 5}
			using = bg_square_tile_shadow

			tooltipwidget = {
				using = SubUnitArray_tooltip
			}
			
			blockoverride "shadow_tile_margin" {
				margin = { 9 7 }
				margin_bottom = 10
				margin_right = 10
			}
			using = bg_combat_map_unit
			blockoverride "texture_color" {
				modify_texture = {
					using = color_dark_brown_texture
					blend_mode = multiply
					alpha = 1
				}
				modify_texture = {
					using = overlay_striped_texture
					blend_mode = overlay
					alpha = 0.8
				}
			}
			
			# frontage
			widget = {
				visible = "[Not(SubUnitArray.IsReserves)]"
				layoutpolicy_horizontal = expanding
				size = { -1 5 }
				
				hbox = {
					widget = {
						layoutpolicy_horizontal = expanding
						size = { -1 5 }
						progressbar = {
							parentanchor = bottom|hcenter
							size = { 100% 5 }
							using = progress_bar_blue_grey_alt
							mirror = horizontal
							min = 0
							max = 100
							value = "[SubUnitArray.GetUsedFrontagePercentage]"
						}
					}

					widget = {
						layoutpolicy_horizontal = expanding
						size = { -1 5 }
						progressbar = {
							parentanchor = bottom|hcenter
							size = { 100% 5 }
							using = progress_bar_blue_grey_alt
							min = 0
							max = 100
							value = "[SubUnitArray.GetUsedFrontagePercentage]"
						}
					}
				}
			}
			
			# morale text
			widget = {
				using = layoutpolicy_expanding
				
				text_single = {
					size = { 100% 100% }
					visible = "[SubUnitArray.IsShip]"
					autoresize = no
					align = center

					text = "[SubUnitArray.GetSize]"
					using = bg_text_mask_container_dark_brown
				}

				text_single = {
					size = { 100% 100% }
					visible = "[Not(SubUnitArray.IsShip)]"
					autoresize = no
					align = center
					using = Font_Size_Small
					block "unit_text_alpha" {
						alpha = 1
					}

					raw_text = "[SubUnitArray.GetStrength]@army_strength! ([SubUnitArray.GetSize]@regiment!)"
					using = bg_text_mask_container_dark_brown
				}
			}

			expand = {}

			# morale
			widget = {
				layoutpolicy_horizontal = expanding
				size = { -1 5 }
				hbox = {
					widget = {
						visible = "[Not(GreaterThan_int32(SubUnitArray.GetSize, '(int32)0'))]"
						layoutpolicy_horizontal = expanding
						size = { -1 5 }
						progressbar = {
							parentanchor = bottom|hcenter
							size = { 100% 5 }
							using = progress_bar_blue_grey_alt
							value = 0
						}
					}

					widget = {
						visible = "[GreaterThan_int32(SubUnitArray.GetSize, '(int32)0')]"
						layoutpolicy_horizontal = expanding
						size = { -1 5 }
						progressbar = {
							parentanchor = bottom|hcenter
							size = { 100% 5 }
							using = progress_bar_green_red_alt
							value = "[SubUnitArray.GetMoralePercent]"
						}
						tooltipwidget = {
							SimpleContextualTooltipType = {
								lowpriotextcontext = "[SubUnitArray.GetMoraleTooltip]"
								tooltipmeta = {
									texture = "[GetConceptTexture('morale')]"
									game_concept = "[morale|E]"
									title = "MAX_MORALE_IN_TT"
								}
								blockoverride "concept_link" {
									text = "[morale|e]"
								}
								blockoverride "title_icon" {
									icon = {
										using = tooltip_title_icon_size
										texture = "[GetConceptTexture('morale')]"												
									}
								}
							}
						}
					}
				}
			}
		}
		widget = {
			size = {100% 100%}
			ignore_layout = yes
			alwaystransparent = yes
			using = bg_cabinet_card_frame
		}
	}

	# type UnitBoxInfo = vbox {
	# 	using = layoutpolicy_expanding
	# 	using = SubUnitContainerSetup

	# 	widget = {
	# 		layoutpolicy_horizontal = expanding
	# 		size = { -1 32 }
	# 		hbox = {
	# 			margin = { 5 0 }
	# 			ui_direction_button = {
	# 				size = { 22 22 }

	# 				blockoverride "button_texture"
	# 				{
	# 					texture = "gfx/interface/buttons/flats/open_button.dds"
	# 				}

	# 				block "unitBoxInfo_left_directionButton_tooltip"
	# 				{
	# 					tooltip_enabled = no
	# 				}

	# 				using = bg_circle

	# 				# block "left_button" {}
	# 			}

	# 			text_single = {
	# 				using = layoutpolicy_expanding
	# 				align = center
	# 				autoresize = no

	# 				text = "[SubUnitArray.GetBoxName]"
	# 			}

	# 			ui_direction_button = {
	# 				size = { 22 22 }

	# 				blockoverride "button_texture"
	# 				{
	# 					texture = "gfx/interface/buttons/flats/open_button.dds"
	# 					mirror = horizontal

	# 				}

	# 				# block "unitBoxInfo_right_directionButton_tooltip" {
	# 					tooltip_enabled = no
	# 				# }

	# 				using = bg_circle

	# 				block "right_button" {}
	# 			}
	# 		}
	# 	}

	# 	widget = {
	# 		layoutpolicy_horizontal = expanding
	# 		size = { -1 12 }

	# 		flowcontainer = {
	# 			parentanchor = center
	# 			spacing = 5

	# 			block "position_marker" {}
	# 		}
	# 	}

	# 	widget = {
	# 		using = SubUnitArraySize

	# 		tooltipwidget = {
	# 			using = SubUnitArray_tooltip
	# 		}
	# 	}

	# 	widget = {
	# 		visible = "[SingleUnitWindow.GetSelectedUnit.IsArmy]"
	# 		using = SubUnitArrayStrength

	# 		tooltipwidget = {
	# 			using = SubUnitArray_tooltip
	# 		}
	# 	}

	# 	widget = {
	# 		using = SubUnitArrayStrengthPercent
	# 	}

	# 	widget = {
	# 		using = SubUnitArrayMorale
	# 	}

	# 	widget = {
	# 		using = SubUnitArrayExperience
	# 	}

	# 	expand = {}

	# 	ui_direction_button = {
	# 		size = { 22 22 }

	# 		blockoverride "button_texture"
	# 		{
	# 			texture = "gfx/interface/buttons/flats/down.dds"
	# 		}

	# 		using = bg_circle

	# 		block "down_button" {}

	# 		block "unitBoxInfo_down_directionButton_tooltip"
	# 		{
	# 			tooltip_enabled = no
	# 		}
	# 	}
	# }

	# type PositionMarkerContainer = widget
	# {
	# 	layoutpolicy_horizontal = expanding
	# 	size = { -1 12 }

	# 	flowcontainer = {
	# 		parentanchor = center
	# 		spacing = 5

	# 		block "content" {}
	# 	}
	# }

	type CombatProgress = widget {
		size = { 90 90 }
		using = bg_circle_piechart
		blockoverride "inside_color" {
			modify_texture = {
				using = color_dark_red_texture
				blend_mode = multiply
			}
		}

		# Player is Attacker
		piechart = {
			visible = "[Combat.GetAttacker.IsPlayerInCombat]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles

			# DEFENDER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetDefender.GetMoralePercent)]"
				color = { 0.3 0.35 0.4 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetDefender.GetMoralePercent]"
				color = { 0.8 0.3 0.3 1 }
				alwaystransparent = yes
			}

			# ATTACKER SIDE

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetAttacker.GetMoralePercent]"
				color = { 0.3 0.8 0.3 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetAttacker.GetMoralePercent)]"
				color = { 0.45 0.35 0.35 1 }
				alwaystransparent = yes
			}
		}

		# Player is Defender
		piechart = {
			visible = "[Combat.GetDefender.IsPlayerInCombat]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles

			# DEFENDER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetDefender.GetMoralePercent)]"
				color = { 0.3 0.35 0.4 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetDefender.GetMoralePercent]"
				color = { 0.3 0.8 0.3 1 }
				alwaystransparent = yes
			}

			# ATTACKER SIDE

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetAttacker.GetMoralePercent]"
				color = { 0.8 0.3 0.3 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetAttacker.GetMoralePercent)]"
				color = { 0.45 0.35 0.35 1 }
				alwaystransparent = yes
			}
		}

		# Player not in war
		piechart = {
			visible = "[Not(Combat.GetWar.IsPlayerInWar)]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles

			# DEFENDER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetDefender.GetMoralePercent)]"
				color = { 0.3 0.35 0.4 1 }
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetDefender.GetMoralePercent]"
				color = { 0.2 0.5 0.9 1 }
			}

			# ATTACKER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetAttacker.GetMoralePercent]"
				color = { 0.8 0.3 0.3 1 }
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetAttacker.GetMoralePercent)]"
				color = { 0.45 0.35 0.35 1 }
			}
		}

		# Ally is Attacker
		piechart = {
			visible = "[And(Combat.GetWar.IsPlayerInWar,
				And(Combat.GetAttacker.GetLeadingUnit.GetCountry.IsAllied, Not(Combat.GetAttacker.IsPlayerInCombat)))]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles

			# DEFENDER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetDefender.GetMoralePercent)]"
				color = { 0.3 0.35 0.4 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetDefender.GetMoralePercent]"
				color = { 0.8 0.3 0.3 1 }
				alwaystransparent = yes
			}

			# ATTACKER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetAttacker.GetMoralePercent]"
				color = { 0.2 0.5 0.9 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetAttacker.GetMoralePercent)]"
				color = { 0.45 0.35 0.35 1 }
				alwaystransparent = yes
			}
		}

		# Ally is Defender
		piechart = {
			visible = "[And(Combat.GetWar.IsPlayerInWar,
				And(Combat.GetDefender.GetLeadingUnit.GetCountry.IsAllied, Not(Combat.GetDefender.IsPlayerInCombat)))]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles

			# DEFENDER SIDE
			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetDefender.GetMoralePercent)]"
				color = { 0.3 0.35 0.4 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetDefender.GetMoralePercent]"
				color = { 0.2 0.5 0.9 1 }
				alwaystransparent = yes
			}

			# ATTACKER SIDE

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Combat.GetAttacker.GetMoralePercent]"
				color = { 0.8 0.3 0.3 1 }
				alwaystransparent = yes
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Combat.GetAttacker.GetMoralePercent)]"
				color = { 0.45 0.35 0.35 1 }
				alwaystransparent = yes
			}
		}

		icon = {
			size = { 60% 60% }
			parentanchor = center
			texture = "[GetConceptTexture('battle')]"

			modify_texture = {
				using = overlay_window_texture
				blend_mode = overlay
				alpha = 0.7
			}

			glow = {
				name = "drop_shadow"
				glow_radius = 3
				color = {0.0 0.0 0.0 1.0}
				alpha = 0.8
			}
		}
	}

	type SiegeProgress = widget {
		size = { 30 30 }
		background = {
			texture = "gfx/interface/component_tiles/hud_corners/circle_background.dds"
			texture_density = 2
			alpha = 1
	
			using = marker_siege_side_color
	
			modify_texture = {
				using = overlay_striped_texture
				blend_mode = overlay
				alpha = 0.2
			}
		}
	
		background = {
			texture = "gfx/interface/component_tiles/hud_corners/circle_shadow.dds"
			texture_density = 2
			alpha = 0.5
		}
		
		piechart = {
			visible = "[Not(Siege.GetLocation.HasCombat)]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles
			block "siegetooltip" {
				tooltipwidget = {
					using = SiegePhase_tooltip
				}
			}

			icon = {
				size = { 70% 70% }
				parentanchor = center
				tooltipwidget = {
					using = SiegeOutcome_tooltip
				}

				block "siege_progress_icon" {
					siege_icon = {}
				}
	
				icon = {
					size = {100% 100%}
					visible = "[Siege.IsTooFewMen]"
					texture = "gfx/interface/icons/flat_icons/disable_icon.dds"
					using = color_red
				}
				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.7
				}
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Siege.GetSiegePhaseProgress]"
				color = { 0.01 0.6 0.9 1 }
				alpha = 1
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Siege.GetSiegePhaseProgress)]"
				color = { 0.0 0.1 0.1 1 }
				alpha = 1
			}
		}

		piechart = {
			visible = "[Siege.GetLocation.HasCombat]"
			parentanchor = center
			size = { 90% 90% }
			using = piechart_angles
			block "siegetooltip" {
				tooltipwidget = {
					using = SiegePhase_tooltip
				}
			}

			icon = {
				size = { 70% 70% }
				parentanchor = center
				tooltipwidget = {
					using = SiegeOutcome_tooltip
				}

				block "siege_progress_icon" {
					siege_icon = {}
				}
	
				icon = {
					size = {100% 100%}
					visible = "[Siege.IsTooFewMen]"
					texture = "gfx/interface/icons/flat_icons/disable_icon.dds"
					using = color_red
				}
				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.7
				}
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Siege.GetSiegePhaseProgress]"
				color = { 0.5 0.5 0.5 1 }
				alpha = 1
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)100.0', Siege.GetSiegePhaseProgress)]"
				color = { 0.0 0.1 0.1 1 }
				alpha = 1
			}
		}

		widget = {
			size = {100% 100%}
			ignore_layout = yes
			alwaystransparent = yes
			using = circular_wood_frame
		}
	}

	# type SiegeProgressBig = widget
	# {
	# 	size = { 90 90 }

	# 	background = {
	# 		texture = "gfx/interface/component_tiles/hud_corners/circle_background.dds"
	# 		texture_density = 2
	# 		alpha = 1
	# 		margin = { 2 2 }
	
	# 		using = marker_siege_side_color
	
	# 		modify_texture = {
	# 			texture = "gfx/interface/component_overlay/gold_overlay_circle.dds"
	# 			texture_density = 2
	# 			spriteType = stretched
	# 			spriteborder = { 250 250 }
	# 			blend_mode = overlay
	# 			alpha = 0.7
	# 		}
	# 	}
	
	# 	background = {
	# 		texture = "gfx/interface/component_tiles/hud_corners/circle_shadow.dds"
	# 		texture_density = 2
	# 		margin = { 5 5 }
	# 		alpha = 0.5
	# 	}
	
	# 	background = {
	# 		texture = "gfx/interface/component_tiles/hud_corners/circle_frame.dds"
	# 		texture_density = 2
	# 		alpha = 1
	# 		modify_texture = {
	# 			using = color_gold_texture
	# 		}
	
	# 		using = overlay_gold
	# 	}
		
	# 	piechart = {
	# 		parentanchor = center
	# 		size = { 90% 90% }
	# 		using = piechart_angles
	# 		# tooltipwidget = {
	# 		# 	container = {
	# 		# 		container = {
	# 		# 			using = SiegePhase_tooltip
	# 		# 			visible = "[Siege.IsSiege]"
	# 		# 		}

	# 		# 		container = {
	# 		# 			using = Occupation_tooltip
	# 		# 			visible = "[Not(Siege.IsSiege)]"
	# 		# 		}
	# 		# 	}
	# 		# }
	# 		tooltipwidget = {
	# 			using = Occupation_Siege_Tooltip
	# 		}
			
	# 		icon = {
	# 			size = { 70% 70% }
	# 			parentanchor = center
	# 			tooltipwidget = {
	# 				using = SiegeOutcome_tooltip
	# 			}

	# 			siege_icon = {}
	
	# 			icon = {
	# 				size = {100% 100%}
	# 				visible = "[Siege.IsTooFewMen]"
	# 				texture = "gfx/interface/icons/flat_icons/disable_icon.dds"
	# 				using = color_red
	# 			}
	# 		}

	# 		pieslice_no_highlight = {
	# 			texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
	# 			value = "[Siege.GetSiegePhaseProgress]"
	# 			color = { 0.01 0.6 0.9 1 }
	# 			alpha = 1
	# 		}

	# 		pieslice_no_highlight = {
	# 			texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
	# 			value = "[Subtract_float('(float)100.0', Siege.GetSiegePhaseProgress)]"
	# 			color = { 0.0 0.1 0.1 1 }
	# 			alpha = 1
	# 		}
	# 	}
	# }

	# type combat_participating_flags = scrollarea
	# {
	# 	using = layoutpolicy_expanding
	# 	size = {54 -1}

	# 	# block "combat_participants_max_size" {
	# 		maximumsize = { -1 440 }
	# 	# }
	# 	scrollbarpolicy_horizontal = always_off

	# 	autoresizescrollarea = yes

	# 	scrollbar_vertical = {
	# 		using = Scrollbar_Vertical
	# 	}
	# 	scrollwidget = {
	# 		vbox = {
	# 			layoutpolicy_vertical = expanding
	# 			vbox = {
	# 				margin_top = 5
	# 				# block "combat_participants_content" {
	# 					datamodel = "[Combat.GetDefender.GetParticipatingCountries]"
	# 					item = {
	# 						country_flag_small_plus = {
	# 							visible = "[Not(ObjectsEqual(Country.Self, Combat.GetDefender.GetCountry))]"
	# 						}
	# 					}
	# 				# }
	# 			}
	# 			expand = {}
	# 		}
	# 	}
	# }

	type occupation_block = hbox {
		visible = "[Not(Siege.IsSiege)]"
		tooltipwidget = {
			using = Occupation_tooltip
		}
		layoutpolicy_horizontal = expanding
		using = bg_paper_card

		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 82 }
			
			hbox = {
				layoutpolicy_horizontal = expanding
			
				hbox = {
					layoutpolicy_horizontal = expanding
					
					vbox = {
						layoutpolicy_horizontal = expanding
			
						background = {
							texture = "gfx/interface/component_tiles/rough_tile_edge.dds"
							texture_density = 2
							spriteType = Corneredstretched
							spriteborder = { 20 20 }
							alpha = 0.3
			
							using = marker_siege_side_color
							blockoverride "enemy_siege_alpha"{
								alpha = 0.4
							}
							blockoverride "blocked_neutral_siege_alpha"{
								alpha = 0.7
							}
						}
			
						widget = {
							layoutpolicy_horizontal = expanding
							size = { -1 40 }
			
							hbox = {
								margin_left = 70
								spacing = 10
								
								using = bg_card_header_01_military
			
								background = {
									using = marker_siege_side_color
									blockoverride "enemy_siege_alpha"{
										alpha = 0.3
									}
									blockoverride "blocked_neutral_siege_alpha"{
										alpha = 0.5
									}
			
									modify_texture = {
										using = bg_fade_vertical_up_mask_texture
										alpha = 1
										blend_mode = alphamultiply
									}
								}
			
								using = bg_cabinet_card_frame
			
								vbox = {
									layoutpolicy_horizontal = expanding
									text_single = {
										layoutpolicy_horizontal = expanding
										size = { -1 18}
										autoresize = no
										text = "[Siege.GetName]"
										align = left|nobaseline
									}
									text_single = {
										layoutpolicy_horizontal = expanding
										size = { -1 18}
										autoresize = no
										text = "[Siege.GetOccupationDaysLeft]"
										alpha = 0.8
										align = left|nobaseline
									}
								}
			
								expand = {}
							}
						}
			
						hbox = {
							layoutpolicy_horizontal = expanding
							margin = { 10 8 }
							margin_left = 70
							
							hbox = {
								spacing = 6
								datamodel = "[DataModelFirst(Siege.GetUnits,'(int32)4')]"
								item = {
									widget = {
										tooltipwidget = {
											using = Unit_tooltip
										}
										size = {94 25}
										hbox = {
											country_flag_small = {
												datacontext = "[Unit.GetCountry]"
											}
			
											hbox = {
												margin = { 2 0 }
												using = bg_unit_block
												blockoverride "unit_block_color" {
													using = marker_siege_side_color
													
													modify_texture = {
														using = color_dark_blue_texture
														blend_mode = multiply
														alpha = 0.5
													}
												}
												blockoverride "marker_siege_color_blend" {
													blend_mode = multiply
													alpha = 1
												}
			
												text_single = {
													size = {35 20}
													fontsize = 13
													autoresize = no
													align = nobaseline
													text = "[Unit.GetVisualStrength]"
												}
			
												icon = {
													size = {20 20}
													using = army_strength_texture
												}
											}
										}
									}
								}
							}
			
							expand = {}
			
							text_single = {
								margin = {5 5}
								using = Font_Type_Headers
								raw_text = "+[Subtract_int32(GetDataModelSize(Siege.GetUnits), '(int32)4')]"
								align = nobaseline
								visible = "[GreaterThan_int32(GetDataModelSize(Siege.GetUnits), '(int32)4')]"
								using = bg_number_container_bckg
								tooltipwidget = {
									ContextualTooltipType = {
										blockoverride "title_text" {
											text = "[Siege.GetName]"
										}
								
										blockoverride "concept_link" {
											text = "[units|e]"
										}
										
										blockoverride "title_icon" {
											icon = {
												using = tooltip_title_icon_size
												texture = "gfx/interface/icons/outliner/categories/sieges.dds"
												glow = {
													name = "drop_shadow"
													glow_radius = 3
													color = {0.0 0.0 0.0 1.0}
													alpha = 0.4
												}
											}
										}
										
										blockoverride "tooltip_content" {
											TooltipListScrollArea = {
												blockoverride "block_scrollarea" {
													maximumsize = { -1 400 }
												}
									
												blockoverride "scrollarea_content" {
													vbox = {
														set_parent_dimension_to_minimum = height
														layoutpolicy_horizontal = expanding
									
														datamodel = "[DataModelSkipFirst(Siege.GetUnits, '(int32)4')]"
														item = {
															widget = {
																tooltipwidget = {
																	using = Unit_tooltip
																}
																size = {94 25}
																hbox = {
																	country_flag_small = {
																		datacontext = "[Unit.GetCountry]"
																	}
									
																	hbox = {
																		margin = { 2 0 }
																		using = bg_unit_block
																		blockoverride "unit_block_color" {
																			using = marker_siege_side_color
																			
																			modify_texture = {
																				using = color_dark_blue_texture
																				blend_mode = multiply
																				alpha = 0.5
																			}
																		}
																		blockoverride "marker_siege_color_blend" {
																			blend_mode = multiply
																			alpha = 1
																		}
									
																		text_single = {
																			size = {35 20}
																			fontsize = 13
																			autoresize = no
																			align = nobaseline
																			text = "[Unit.GetVisualStrength]"
																		}
									
																		icon = {
																			size = {20 20}
																			using = army_strength_texture
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
								blockoverride "number_container_alpha" {
									alpha = 0.5
								}
								blockoverride "number_container_color" {
									modify_texture = {
										using = color_bg_blue_texture
										blend_mode = multiply
									}
								}
							}
						}
					}
				}
			}

			widget = {
				ignore_layout = yes
				size = { 100% 100% }
				using = bg_cabinet_card_frame
			}
			SiegeProgress = {
				ignore_layout = yes
				parentanchor = left|vcenter
				size = { 65 65 }
				blockoverride "siegetooltip" {}
			}
		}
	}

	type siege_modifier = vbox {
		spacing = 2

		block "siege_modifier_tooltip" {
			tooltipwidget = {
				SimpleContextualTooltipType = {
					blockoverride "title_icon" {
						icon = {
							using = tooltip_title_icon_size
							using = icon_chance
						}
					}
					blockoverride "concept_link" {
						text = "[dice|E]"
					}
					lowpriotextcontext =  "SIEGE_LAST_DICE_ROLL"
				}
			}
		}

		icon = {
			size = { 31 31 }
			block "siege_modifier_icon" {
				using = icon_chance
			}
			texture_density = 2
		}

		text_single = {
			maximumsize = { 30 20}
			align = center|nobaseline
			block "siege_modifier_text" {
				text = "[Siege.GetLastSiegeDiceRoll]"
			}
		}
	}

	type siege_block = vbox {
		visible = "[Siege.IsSiege]"
		layoutpolicy_horizontal = expanding
		using = bg_paper_card
		using = bg_cabinet_card_frame
		margin = { 5 5 }
		spacing = 1

		#TITLE
		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 30 }
			using = bg_card_header_01_military

			background = {
				texture = "gfx/interface/component_decoration/declare_war_header.dds"
				texture_density = 2
				spriteType = corneredstretched
				spriteborder = { 25 0 }
				frame_grid = {3 1}
				margin = {0 9}
				margin_right = 17
				frame = 3

				modify_texture = {
					using = overlay_cloth_texture
					blend_mode = overlay
					alpha = 0.2
				}
			}

			hbox = {
				margin = { 8 5 }
				margin_right = 15
				spacing = 5
				text_single = {
					visible = "[Not(Siege.GetLocation.HasCombat)]"
					layoutpolicy_horizontal = expanding
					size = { -1 20 }
					autoresize = no
					raw_text = "[siege_icon] [Siege.GetName]"
					align = left|nobaseline
				}

				text_single = {
					visible = "[Siege.GetLocation.HasCombat]"
					maximumsize = { 290 20 }
					text = "[Siege.GetName]"
					align = left|nobaseline
				}

				text_single = {
					visible = "[Siege.GetLocation.HasCombat]"
					align = nobaseline
					maximumsize = { 80 -1 }
					text = "SIEGE_INTERRUPTED"
					default_format = "#color_red"
				}
				expand = {}
				text_single = {
					text = "SIEGE_STARTED_DATE"
					align = nobaseline
					maximumsize = { 200 -1 }
				}
			}
		}

		# ATTACKER
		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 65 }
			allow_outside = yes
			hbox = {
				allow_outside = yes
				widget = {
					size = { 90 65 }
					allow_outside = yes
					country_flag_mid = {
						size = { 100 67 }
						parentanchor = center
						visible = "[Siege.GetBesieger.IsValid]"
						datacontext = "[Siege.GetBesieger]"
					}
				}

				vbox = {
					using = layoutpolicy_expanding

					hbox = {
						using = layoutpolicy_expanding
						spacing = 5
						margin = { 5 2 }
						background = {
							using = color_black_texture
							alpha = 0.3
							margin_right = 1
						}

						#mirar primer si jhi ha una moral general i sino pillar la de la unitat del commander i sino la primera unitat
						text_single = {
							visible = "[Siege.GetCommander.IsValid]"
							text = "[general_icon] [Siege.GetCommander.GetShortName]"
							layoutpolicy_horizontal = expanding
							size = { -1 20 }
							autoresize = no
							align = left|nobaseline
						}

						text_single = {
							visible = "[Not(Siege.GetCommander.IsValid)]"
							text = "ATTACKER"
							layoutpolicy_horizontal = expanding
							size = { -1 20 }
							autoresize = no
							align = left|nobaseline
						}
						
						ui_direction_button = {
							visible = "[And( IsInSameWarAsSiegeOwner(Siege.Self),And(Not(ObjectsEqual(Siege.GetBesieger.GetCountry, Player.Self)), Not(ObjectsEqual(Siege.GetLocation.GetOwner, Player.Self))))]"
							size = { 25 25 }
							enabled = "[CanAssumeControlSiege(Siege.Self)]"
							using = bg_circle
			
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/flat_icons/military/assume_siege.dds"
											texture_density = 2
											alpha = 1
										}
									}
									lowpriotextcontext =  "[GetAssumeControlSiegeTooltip(Siege.Self)]"
								}
							}
							action_tooltip = {
								click_type = left
								click_mode = single
								title = "ASSUME_CONTROL_TT"
								on_action = "[AssumeControlSiege(Siege.Self)]"
								enabled = "[CanAssumeControlSiege(Siege.Self)]"
							}
						}
						
						header_button_left = {
							# visible = "[And(Not(IsInSameWarAsSiegeOwner(Siege.Self)), And(Not(ObjectsEqual(Siege.GetBesieger.GetCountry, Player.Self)), Not(ObjectsEqual(Siege.GetLocation.GetOwner, Player.Self))))]"
							size = { 25 25 }
							enabled = "[CanTakeOverSiege(Siege.Self)]"
							action_tooltip = {
								click_type = left
								click_mode = single
								title = "ASSUME_CONTROL_TT"
								conditions = "[GetTakeOverSiegeTooltip(Siege.Self)]"
								on_action = "[TakeOverSiege(Siege.Self)]"
								enabled = no
							}
							tooltipwidget = {
								ContextualTooltipType = {
									blockoverride "title_text" {
										text = "TAKE_OVER_TT"
									}
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											using = icon_fortification
											texture_density = 2
											alpha = 1
										}
									}
									blockoverride "concept_link" {
										text = "[siege|e]"
									}
		
									blockoverride "tooltip_content" {
										TooltipTextBlock = {
											blockoverride "text" {
												text = "TAKE_OVER_DRO"
											}
										} 
									}
								}
							}
							blockoverride "icon_texture" {
								texture = "gfx/interface/icons/flat_icons/military/assume_siege.dds"
							}
							blockoverride "button_icon_stretch_sprite" {}
							blockoverride "header_button_frame_inner" {visible = no}
							blockoverride "header_button_icon_size" { 
								size = { 25 25 }
							}
							blockoverride "icon_overlay" {}
							blockoverride "header_button_text_layout" {}
							blockoverride "icon_overlay" {}
						}
		
						header_button_left = {
							visible = "[ObjectsEqual(Siege.GetBesieger.GetCountry, Player.Self)]"
							size = {25 25}
							enabled = "[CanAssaultSiege(Siege.Self)]"
							action_tooltip = {
								click_type = left
								click_mode = single
								title = "ASSAULT_ORDER_TT"
								on_action = "[AssaultSiege(Siege.Self)]"
								enabled = "[CanAssaultSiege(Siege.Self)]"
							}
							tooltipwidget = {
								ContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											using = icon_fortification
											texture_density = 2
											alpha = 1
										}
									}
		
									blockoverride "title_text" {
										text = "ASSAULT_ORDER_TT"
									}
		
									blockoverride "concept_link" {
										text = "[assault|e]"
									}
		
									blockoverride "tooltip_content" {
		
										TooltipTextBlock = {
											textcontext = "[Siege.GetAssaultOddsInfo]"
										}
		
										TooltipFlavorTextBlock = {
											blockoverride "text" {
												text = "ASSAULT_ORDER"
											}
										}
									}
								}
							}
							blockoverride "icon_texture" {
								texture = "gfx/interface/buttons/flats/order_assault.dds"
							}
							blockoverride "button_icon_stretch_sprite" {}
							blockoverride "header_button_frame_inner" {visible = no}
							blockoverride "header_button_icon_size" { size = { 25 25 } }
							blockoverride "header_button_text_layout" {}
						}
					}

					widget = {
						layoutpolicy_horizontal = expanding
						size = { -1 35 }
						
						hbox = {
							margin = { 7 0 }
							spacing = 5

							piechart = {
								size = { 26 26 }
								using = piechart_angles
								using = bg_circle_piechart
								tooltipwidget = {
									SimpleContextualTooltipType = {
										blockoverride "title_icon" {
											icon = {
												using = tooltip_title_icon_size
												texture = "gfx/interface/icons/flat_icons/military/army_morale.dds"
											}
										}

										blockoverride "concept_link" {
											text = "[morale|e]"
										}

										lowpriotextcontext = "[Siege.GetMoraleTooltip]"
									}
								}
								icon = {
									texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
									size = { 97% 97% }
									parentanchor = center
									color = { 0 0 0 1 }
								}
	
								pieslice_no_highlight = {
									texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
									value = "[Siege.GetMoralePercent]"
									color = { 0.3 0.8 0.3 1 }
								}
	
								pieslice_no_highlight = {
									texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
									value = "[Subtract_float('(float)100.0', Siege.GetMoralePercent)]"
									color = { 0.3 0.3 0.3 1 }
								}
	
								icon = {
									size = { 68% 68% }
									parentanchor = center
									texture = "gfx/interface/icons/unit_view/morale.dds"
									texture_density = 2
								}
							}

							hbox = {
								margin_right = 6
								spacing = 3
								tooltipwidget = {
									SimpleContextualTooltipType = {									
										blockoverride "title_icon" {
											icon = {
												using = tooltip_title_icon_size
												using = army_strength_texture
												texture_density = 2
												alpha = 1
											}
										}
										
										blockoverride "concept_link" {
											text = "[siege|e]"
										}
				
										lowpriotextcontext =  "[Siege.GetBesiegerStrengthTooltip]"
				
										blockoverride "tooltip_extra_content" {
											TooltipTextBlock = {
												blockoverride "text" {
													text = "[Siege.GetCommanderTooltip]"
												}
											}
										}
									}
								}
				
								text_single = {
									maximumsize = { 40 15 }
									text = "[Siege.GetBesiegerVisualStrength]"
									align = right|nobaseline
									fontsize = 14
								}
				
								icon = {
									size = {20 20}
									using = army_strength_texture
								}
							}
				
							hbox = {
								spacing = 10
								datamodel = "[DataModelFirst(Siege.GetUnits,'(int32)2')]"
								item = {
									widget = {
										tooltipwidget = {
											using = Unit_tooltip
										}
										size = {81 30}
										hbox = {
											margin = {3 3}
											using = bg_text_mask_container_brown
											country_flag_small = {
												datacontext = "[Unit.GetCountry]"
											}
				
											hbox = {
												margin = { 0 2 }
												margin_left = 4
												using = bg_unit_block
												blockoverride "unit_block_color" {
													using = marker_siege_side_color
													
													modify_texture = {
														using = color_dark_blue_texture
														blend_mode = multiply
														alpha = 0.5
													}
												}
												blockoverride "marker_siege_color_blend" {
													blend_mode = multiply
													alpha = 1
												}
				
												text_single = {
													size = {35 20}
													margin_left = 2
													fontsize = 13
													autoresize = no
													align = nobaseline
													text = "[Unit.GetVisualStrength]"
												}
											}
										}
									}
								}
							}
				
							expand = {}
				
							text_single = {
								margin = {5 3}
								using = Font_Type_Headers
								raw_text = "+[Subtract_int32(GetDataModelSize(Siege.GetUnits), '(int32)2')]"
								align = nobaseline
								visible = "[GreaterThan_int32(GetDataModelSize(Siege.GetUnits), '(int32)2')]"
								using = bg_text_mask_container_brown
								tooltipwidget = {
									ContextualTooltipType = {
										blockoverride "title_text" {
											text = "[Siege.GetName]"
										}
								
										blockoverride "concept_link" {
											text = "[units|e]"
										}
										
										blockoverride "title_icon" {
											icon = {
												using = tooltip_title_icon_size
												texture = "gfx/interface/icons/outliner/categories/sieges.dds"
												glow = {
													name = "drop_shadow"
													glow_radius = 3
													color = {0.0 0.0 0.0 1.0}
													alpha = 0.4
												}
											}
										}
										
										blockoverride "tooltip_content" {
											TooltipListScrollArea = {
												blockoverride "block_scrollarea" {
													maximumsize = { -1 400 }
												}
									
												blockoverride "scrollarea_content" {
													vbox = {
														set_parent_dimension_to_minimum = height
														layoutpolicy_horizontal = expanding
									
														datamodel = "[DataModelSkipFirst(Siege.GetUnits, '(int32)3')]"
														item = {
															widget = {
																tooltipwidget = {
																	using = Unit_tooltip
																}
																size = {94 25}
																hbox = {
																	country_flag_small = {
																		datacontext = "[Unit.GetCountry]"
																	}
									
																	hbox = {
																		margin = { 2 0 }
																		using = bg_unit_block
																		blockoverride "unit_block_color" {
																			using = marker_siege_side_color
																			
																			modify_texture = {
																				using = color_dark_blue_texture
																				blend_mode = multiply
																				alpha = 0.5
																			}
																		}
																		blockoverride "marker_siege_color_blend" {
																			blend_mode = multiply
																			alpha = 1
																		}
									
																		text_single = {
																			size = {35 20}
																			fontsize = 13
																			autoresize = no
																			align = nobaseline
																			text = "[Unit.GetVisualStrength]"
																		}
									
																		icon = {
																			size = {20 20}
																			using = army_strength_texture
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
								blockoverride "number_container_alpha" {
									alpha = 0.5
								}
								blockoverride "number_container_color" {
									modify_texture = {
										using = color_bg_blue_texture
										blend_mode = multiply
									}
								}
							}

							# ATTRITION
							hbox = {
								spacing = 2
								tooltipwidget = {
									SimpleContextualStringPairTooltipType = {
										blockoverride "title_icon" {
											icon = {
												using = tooltip_title_icon_size
												texture = "gfx/interface/icons/location_icons/attrition.dds"
											}
										}
										blockoverride "concept_link" {
											text = "[attrition|e]"
										}
										lowpriotextcontext =  "[Location.GetAttritionDescription]"
									}
								}
								text_single = {
									maximumsize = { 40 20 }
									text = "[Location.GetAppliedAttrition(Player.Self)|=-1/%]"
									align = right|nobaseline
									fontsize = 14
								}

								icon = {
									size = { 20 20 }
									texture = "gfx/interface/icons/location_icons/attrition.dds"
								}
							}
						}
					}
				}
			}
		}

		#MIDDLE INFO
		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 90 }
			using = bg_card_header_01_military

			hbox = {
				margin = { 5 0 }
				margin_right = 8

				hbox = {
					SiegeProgress = {
						size = { 80 80 }
						blockoverride "siege_progress_icon"{
							siege_icon = {
								parentanchor = center
							}
						}
					}

					text_single = {
						text = "[Siege.GetFallChance|2%]"
						maximumsize = { 80 -1 }
						align = left|nobaseline
						tooltipwidget = {
							using = SiegeOutcome_tooltip
						}
						using = bg_text_mask_container_dark_brown
						using = bg_cabinet_card_frame
						margin = { 7 7 }
						fontsize = 18
					}
				}

				expand = {}

				# MODIFIERS INFO
				hbox = {
					tooltipmeta = {
						texture = "gfx/interface/icons/flat_icons/siege_occupation/siege.dds"
						game_concept = "[siege|e]"
					}
					spacing = 11
					margin = {10 10}
					margin_left = 25

					
					background = {
						texture = "gfx/interface/component_tiles/military_modifiers_container.dds"
						texture_density = 2
						spriteType = Corneredstretched
						spriteborder = { 25 0 }
					}
					
					# DICE
					siege_modifier = {
						blockoverride "siege_modifier_icon" {
							using = icon_chance
						}
						blockoverride "siege_modifier_text" {
							text = "[Siege.GetLastSiegeDiceRoll]"
						}
						blockoverride "siege_modifier_tooltip" {
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											using = icon_chance
										}
									}
									blockoverride "concept_link" {
										text = "[dice|E]"
									}
									lowpriotextcontext =  "SIEGE_LAST_DICE_ROLL"
								}
							}
						}
					}

					# ACCUMULATION
					siege_modifier = {
						blockoverride "siege_modifier_icon" {
							texture = "gfx/interface/icons/flat_icons/siege_occupation/siege_accumulation.dds"
						}
						blockoverride "siege_modifier_text" {
							text = "[Siege.GetSiegeMemory|Y]"
						}
						blockoverride "siege_modifier_tooltip" {
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/flat_icons/siege_occupation/siege_accumulation.dds"
										}
									}
									blockoverride "concept_link" {
										text = "[siege|E]"
									}
									lowpriotextcontext =  "SIEGE_MEMORY"
								}
							}
						}
					}

					# FORT IMPACT
					siege_modifier = {
						blockoverride "siege_modifier_icon" {
							using = icon_fortification
						}
						blockoverride "siege_modifier_text" {
							text = "[Siege.GetFortLevelImpact|=-+]"
						}
						blockoverride "siege_modifier_tooltip" {
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											using = icon_fortification
											texture_density = 2
										}
									}
									blockoverride "concept_link" {
										text = "[siege|E]"
									}
									lowpriotextcontext =  "SIEGE_FORT_IMPACT"
								}
							}
						}
					}

					# ARTILLERY IMPACT
					siege_modifier = {
						blockoverride "siege_modifier_icon" {
							texture = "gfx/interface/icons/flat_icons/siege_occupation/artillery_2.dds"
						}
						blockoverride "siege_modifier_text" {
							text = "[Siege.GetArtilleryImpact|=+]"
						}
						blockoverride "siege_modifier_tooltip" {
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_text" {
										text = "game_concept_artillery_bonus"
									}
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/flat_icons/siege_occupation/artillery_2.dds"
										}
									}
									blockoverride "concept_link" {
										text = "[artillery_bonus|E]"
									}
									lowpriotextcontext =  "[Siege.GetArtilleryImpactInfo]"
								}
							}
						}
					}

					# NUM OF BREACH
					siege_modifier = {
						blockoverride "siege_modifier_icon" {
							texture = "gfx/interface/icons/flat_icons/siege_occupation/brokenwalls.dds"
						}
						blockoverride "siege_modifier_text" {
							text = "[Siege.GetNumOfBreach|=+]"
						}
						blockoverride "siege_modifier_tooltip" {
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/flat_icons/siege_occupation/brokenwalls.dds"
										}
									}
									blockoverride "concept_link" {
										text = "[siege|E]"
									}
									lowpriotextcontext =  "SIEGE_BREACH"
								}
							}
						}
					}

					# PORT BLOCKADED
					siege_modifier = {
						visible = "[Siege.GetLocation.HasPort]"
						blockoverride "siege_modifier_icon" {
							texture = "gfx/interface/icons/flat_icons/siege_occupation/blockade_2.dds"
						}
						blockoverride "siege_modifier_text" {
							text = "[Siege.GetBlockadeImpact|=+]"
						}
						blockoverride "siege_modifier_tooltip" {
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/flat_icons/siege_occupation/blockade_2.dds"
										}
									}
									lowpriotextcontext =  "SIEGE_BLOCKADE"
								}
							}
						}
					}
				}

				vbox = {
					layoutpolicy_vertical = expanding
					margin = { 0 15 }
					margin_left = 10

					tooltipwidget = {
						using = SiegePhase_tooltip
					}

					hbox = {
						spacing = 2
						margin = {2 2}
						icon = {
							size = { 20 20 }
							texture = "gfx/interface/icons/diplomatic_actions/ongoing_diplomatic_actions.dds"
						}

						text_single = {
							text = "SIEGE_PHASE_SIZE_SHORT"
							size = { 50 20 }
							autoresize = no
							align = left|nobaseline
						}
						using = bg_text_mask_container_brown
					}

					expand = {}

					hbox = {
						spacing = 2
						margin = {2 2}
						using = bg_text_mask_container_brown
						icon = {
							size = { 20 20 }
							texture = "gfx/interface/icons/military_army/fort_defense.dds"
						}

						text_single = {
							text = "[Siege.GetSiegeFortDefenseDifference|=0%]"
							size = { 50 20 }
							autoresize = no
							align = left|nobaseline
						}
					}
				}
			}
		}

		# DEFENDER
		widget = {
			layoutpolicy_horizontal = expanding
			size = { -1 65 }
			allow_outside = yes
			hbox = {
				allow_outside = yes
				widget = {
					size = { 90 65 }
					allow_outside = yes
					country_flag_mid = {
						size = { 100 67 }
						parentanchor = center
						visible = "[Siege.GetSiegeDefender.IsValid]"
						datacontext = "[Siege.GetSiegeDefender]"
					}
				}

				vbox = {
					using = layoutpolicy_expanding
					widget = {
						layoutpolicy_horizontal = expanding
						size = { -1 35 }
						
						hbox = {
							spacing = 5
							margin = { 7 0 }
							datacontext = "[Siege.GetLocation]"
							tooltipwidget = {
								using = Garrison_tooltip
							}
	
							piechart = {
								size = { 26 26 }
								using = piechart_angles
								using = bg_circle_piechart
								icon = {
									texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
									size = { 97% 97% }
									parentanchor = center
									color = { 0 0 0 1 }
								}
	
								pieslice_no_highlight = {
									texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
									value = "[FixedPointToFloat(Siege.GetDefenderMoralePercent)]"
									color = { 0.3 0.8 0.3 1 }
								}
	
								pieslice_no_highlight = {
									texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
									value = "[Subtract_float('(float)1.0', FixedPointToFloat(Siege.GetDefenderMoralePercent))]"
									color = { 0.3 0.3 0.3 1 }
								}
	
								icon = {
									size = { 68% 68% }
									parentanchor = center
									texture = "gfx/interface/icons/unit_view/morale.dds"
									texture_density = 2
								}
							}
							
							text_single = {
								maximumsize = { 50 20 }
								raw_text = "[Location.GetGarrison]/[Location.GetMaxGarrison]"
								align = right|nobaseline
								fontsize = 14
							}
	
							icon = {
								size = {20 20}
								using = army_strength_texture
							}
	
							expand = {}
	
							hbox = {
	
								text_single = {
									visible = "[GreaterThan_int32(Location.GetFortLevel, '(int32)0' )]"
									text = "[Location.GetRomanFortLevel]"
									size = { 20 20 }
									autoresize = no
									align = center
								}
							
								icon = {
									size = { 20 20 }
									texture = "[GetConceptTexture('fort')]"
									texture_density = 2
								}
							}
						}
					}

					hbox = {
						using = layoutpolicy_expanding
						spacing = 5
						margin = { 5 2 }

						background = {
							using = color_black_texture
							alpha = 0.3
							margin_right = 1
						}

						text_single = {
							text = "DEFENDER"
							layoutpolicy_horizontal = expanding
							size = { -1 20 }
							autoresize = no
							align = left|nobaseline
						}
						
						garrison_sortie_button = {
							tooltipwidget = {
								ContextualTooltipType = {
									blockoverride "title_text" {
										text = "GARRISON_SORTIE_TT"
									}
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/flat_icons/sortie_garrison.dds"												
										}
									}
									blockoverride "concept_link" {
										text = "[siege|e]"
									}
		
									blockoverride "tooltip_content" {
										TooltipTextBlock = {
											blockoverride "text" {
												text = "garrison_sortie_desc"
											}
										} 
									}
								}
							}
							visible = "[Siege.GetSiegeDefender.IsPlayer]"
							size = {25 25}
						}
					}
				}
			}
		}
	}

	type unit_category_secondary_icon = widget {
		block "unit_category_secondary_icon_size" {
			size = {18 18}
		}
		block "unit_category_secondary_icon_position" {
			position = { 0 5 }
		}
		block "unit_category_secondary_icon_parentanchor" {
			parentanchor = bottom|right
		}
		widget = {
			visible = "[And(SubUnit.IsLevy, SubUnit.IsShip)]"
			tooltip = "[navy_levy|e]"
			tagtooltip_enabled = yes
			block "unit_category_secondary_icon_size" {
				size = {18 18}
			}
			icon = {
				size = { 100% 100% }
				
				texture = "[GetConceptTexture('navy_levies')]"

				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}
		}

		widget = {
			block "unit_category_secondary_icon_size" {
				size = {18 18}
			}
			visible = "[And(Not(Or(SubUnit.IsLevy, SubUnit.IsMercenary)),SubUnit.IsShip)]"
			tooltip = "[regular_ship|e]"
			tagtooltip_enabled = yes

			icon = {
				size = { 100% 100% }
				
				texture = "[GetConceptTexture('regular_ship')]"

				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}
		}

		# mercenary contract
		piechart = {
			visible = "[And3(SubUnit.IsMercenary, SubUnit.IsShip, SubUnit.GetMercenary.IsEmployed)]"
			block "unit_category_secondary_icon_size" {
				size = { 18 18 }
			}
			using = piechart_angles

			tooltipwidget = {
				ContextualTooltipType = {
					blockoverride "title_icon" {
						icon = {
							using = tooltip_title_icon_size
							texture = "gfx/interface/icons/alerts_icons/mercenary_contract_expiring.dds"
						}
					}

					blockoverride "title_text" {
						text = "MERCENARY_LENGTH_2"
					}

					blockoverride "concept_link" {
						text = "[mercenary|e]"
					}

					blockoverride "tooltip_content" {
						TooltipTextBlock = {
							blockoverride "text" {
								text = "[SubUnit.GetMercenary.GetContractTooltip]"
							}
						} 
					}
				}
			}

			icon = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				size = { 97% 97% }
				parentanchor = center
				color = { 0 0 0 1 }
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[Subtract_float('(float)1.0', SubUnit.GetMercenary.GetPercentLeftOnContract)]"
				color = { 0.3 0.8 0.3 1 }
				alpha = 0.8
			}

			pieslice_no_highlight = {
				texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
				value = "[SubUnit.GetMercenary.GetPercentLeftOnContract]"
				color = { 0.3 0.3 0.3 1 }
				alpha = 0.8
			}

			icon = {
				parentanchor = center
				size = { 70% 70% }
				texture = "gfx/interface/icons/unit_category/mercenary_navy.dds"

				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}
		}
		icon = {
			visible = "[And3(SubUnit.IsMercenary, SubUnit.IsShip, Not(SubUnit.GetMercenary.IsEmployed))]"
			block "unit_category_secondary_icon_size" {
				size = { 18 18 }
			}
			texture = "gfx/interface/icons/unit_category/mercenary_navy.dds"
			glow = {
				name = "drop_shadow"
				glow_radius = 3
				color = {0.0 0.0 0.0 1.0}
				alpha = 0.3
			}

			tooltipwidget = {
				ContextualTooltipType = {
					blockoverride "title_icon" {
						icon = {
							using = tooltip_title_icon_size
							texture = "gfx/interface/icons/alerts_icons/mercenary_contract_expiring.dds"
						}
					}

					blockoverride "title_text" {
						text = "MERCENARY_LENGTH_2"
					}

					blockoverride "concept_link" {
						text = "[mercenary|e]"
					}

					blockoverride "tooltip_content" {
						TooltipTextBlock = {
							blockoverride "text" {
								text = "[SubUnit.GetMercenary.GetContractTooltip]"
							}
						} 
					}
				}
			}
		}
			
		widget = {
			block "unit_category_secondary_icon_size" {
				size = {18 18}
			}
			visible = "[And(Not(Or(SubUnit.IsMercenary, SubUnit.IsLevy)), Not(SubUnit.IsShip))]"
			tooltip = "[regulars|e]"
			tagtooltip_enabled = yes

			icon = {
				size = { 100% 100% }
				
				texture = "[GetConceptTexture('regulars')]"

				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}
		}

		block "unit_category_secondary_icon_mercenary_contract" {
			# mercenary contract
			piechart = {
				visible = "[And3(SubUnit.IsMercenary, Not(SubUnit.IsShip), SubUnit.GetMercenary.IsEmployed)]"
				block "unit_category_secondary_icon_size" {
					size = { 20 20 }
				}
				using = piechart_angles
				tooltipwidget = {
					ContextualTooltipType = {
						blockoverride "title_icon" {
							icon = {
								using = tooltip_title_icon_size
								texture = "gfx/interface/icons/alerts_icons/mercenary_contract_expiring.dds"
							}
						}

						blockoverride "title_text" {
							text = "MERCENARY_LENGTH_2"
						}

						blockoverride "concept_link" {
							text = "[mercenary|e]"
						}

						blockoverride "tooltip_content" {
							TooltipTextBlock = {
								blockoverride "text" {
									text = "[SubUnit.GetMercenary.GetContractTooltip]"
								}
							} 
						}
					}
				}

				icon = {
					texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
					size = { 97% 97% }
					parentanchor = center
					color = { 0 0 0 1 }
				}

				pieslice_no_highlight = {
					texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
					value = "[Subtract_float('(float)1.0', SubUnit.GetMercenary.GetPercentLeftOnContract)]"
					color = { 0.3 0.8 0.3 1 }
					alpha = 0.8
				}

				pieslice_no_highlight = {
					texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
					value = "[SubUnit.GetMercenary.GetPercentLeftOnContract]"
					color = { 0.3 0.3 0.3 1 }
					alpha = 0.8
				}

				icon = {
					parentanchor = center
					size = { 65% 65% }
					texture = "gfx/interface/icons/unit_category/mercenary.dds"

					glow = {
						name = "drop_shadow"
						glow_radius = 3
						color = {0.0 0.0 0.0 1.0}
						alpha = 0.3
					}
				}
			}

			icon = {
				visible = "[And3(SubUnit.IsMercenary, Not(SubUnit.IsShip), Not(SubUnit.GetMercenary.IsEmployed))]"
				block "unit_category_secondary_icon_size" {
					size = { 20 20 }
				}
				texture = "gfx/interface/icons/unit_category/mercenary.dds"
				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}

				tooltipwidget = {
					ContextualTooltipType = {
						blockoverride "title_icon" {
							icon = {
								using = tooltip_title_icon_size
								texture = "gfx/interface/icons/alerts_icons/mercenary_contract_expiring.dds"
							}
						}

						blockoverride "title_text" {
							text = "MERCENARY_LENGTH_2"
						}

						blockoverride "concept_link" {
							text = "[mercenary|e]"
						}

						blockoverride "tooltip_content" {
							TooltipTextBlock = {
								blockoverride "text" {
									text = "[SubUnit.GetMercenary.GetContractTooltip]"
								}
							} 
						}
					}
				}
			}
		}

		widget = {
			block "unit_category_secondary_icon_size" {
				size = {18 18}
			}
			visible = "[And(SubUnit.IsLevy, Not(SubUnit.IsShip))]"
			tooltip = "[army_levy|e]"
			tagtooltip_enabled = yes

			icon = {
				size = { 100% 100% }
				
				texture = "[GetConceptTexture('army_levy')]"

				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}
		}
	}

	# type create_new_unit_button = vbox {
	# 	layoutpolicy_horizontal = expanding
	# 	using = bg_paper_card

	# 	widget = {
	# 		layoutpolicy_horizontal = expanding
	# 		size = { -1 35 }
	# 		datacontext = "[SingleUnitWindow.GetCreateUnitAction]"

	# 		using = bg_card_header_01_military

	# 		# UNIT CREATION VIEW CLOSED
	# 		card_header_button_01 = {
	# 			size = { 100% 100% }
				
	# 			input_action = "[UnitActionItem.GetShortcut]"
	# 			use_global_input_instance = yes
				
	# 			datacontext = "[SingleUnitWindow.GetCreateUnitAction]"
	# 			action_tooltip = {
	# 				click_type = left
	# 				click_mode = single
	# 				visible = "[Not(SingleUnitWindow.IsAddToCreatingUnitVisible)]"
	# 				title = "[UnitActionItem.GetName]"
	# 				enabled = "[UnitActionItem.CanSingleLeftClick]"
	# 				on_action = "[UnitActionItem.SingleLeftClick]"
	# 			}

	# 			action_tooltip = {
	# 				click_type = left
	# 				click_mode = single
	# 				visible = "[SingleUnitWindow.IsAddToCreatingUnitVisible]"
	# 				title = "[UnitActionItem.GetName]"
	# 				on_action = "[SingleUnitWindow.HideCreateNewUnit]"
	# 			}
				
	# 			tooltipwidget = {
	# 				using = UnitAction_tooltip
	# 			}
				
	# 			hbox = {
	# 				ignoreinvisible = yes
	# 				widget = {
	# 					layoutpolicy_horizontal = expanding
	# 					size = { -1 30 }
						
	# 					hbox = {
	# 						hbox = {
	# 							spacing = 5
	# 							text_single = {
	# 								align = nobaseline
	# 								text = "[UnitActionItem.GetName]"
	# 								maximumsize = { 150 -1 }
	# 							}
	# 						}
	# 					}
	# 				}
	# 			}
	# 		}
	# 	}
	# }

	type unit_action_category = vbox {
		layoutpolicy_horizontal = expanding
		# block "unit_action_category_content_expand" {}
		using = bg_paper_card

		widget = {
			layoutpolicy_horizontal = expanding
			# block "unit_action_category_content_expand" {}
			block "unit_action_category_content_size" {
				size = { -1 210 }
			}
			scrollarea = {
				size = {97% 100%}
				scrollbarpolicy_horizontal = always_off
				# autoresizescrollarea = yes
				scrollbar_vertical = {
					using = Scrollbar_Vertical
				}

				scrollwidget = {
					# block "unit_action_category_block_widget" {
						flowcontainer = {
							position = { 5 0 }
							# block "unit_action_category_block_count" {
								wrap_count = 2
							# }
							ignoreinvisible = yes
							datacontext = "[Pin('unit_actions')]"
							datamodel = "[SingleUnitWindow.GetAllActionItems]"
							item = {
								widget = {
									block "unit_action_category_block_visible" {}
									size = { 41 41 }
									onmousehierarchyenter = "[PdxGuiWidget.FindChild('button_pin').InterruptThenTriggerAnimation('hide_pin','show_pin')]"
									onmousehierarchyleave = "[PdxGuiWidget.FindChild('button_pin').InterruptThenTriggerAnimation('show_pin','hide_pin')]"

									vbox = {
										layoutpolicy_horizontal = expanding
										
										widget = {
											allow_outside = yes
											size = { 41 41 }

											#Needed to perform single action when the keyboard shortcut is pressed
											button = {
												size = { 0 1 }
												tooltip_enabled = no
												alwaystransparent = yes
												visible = "[Not(UnitActionItem.IsToggleAction)]"
												enabled = "[And(UnitActionItem.HasSingleLeftAction, UnitActionItem.CanSingleLeftClick)]"
												onclick = "[UnitActionItem.SingleLeftClick]"
												input_action = "[UnitActionItem.GetShortcut]"
												use_global_input_instance = yes
											}

											# navigational_button_alt = {
											# 	visible = "[Not(UnitActionItem.IsToggleAction)]"
											# 	parentanchor = bottom|left
											# 	size = { 36 36 }
											# 	using = bg_circle_alt_brown
											# 	blockoverride "icon_texture" {
											# 		texture = "[UnitActionItem.GetTexture]"
											# 		size = {70% 70%}
											# 	}
											# 	action_tooltip = {
											# 		click_type = left
											# 		click_mode = confirm
											# 		title = "[UnitActionItem.GetName]"
											# 		visible = "[UnitActionItem.HasHoldLeftAction]"
											# 		on_action = "[UnitActionItem.HoldLeftClick]"
											# 		enabled = "[UnitActionItem.CanHoldLeftClick]"
											# 		description = "[UnitActionItem.GetLeftClickDescription]"
											# 	}

											# 	action_tooltip = {
											# 		click_type = right
											# 		click_mode = confirm
								
											# 		visible = "[UnitActionItem.HasHoldRightAction]"
											# 		title = "[UnitActionItem.GetSecondaryName]"
											# 		on_action = "[UnitActionItem.HoldRightClick]"
											# 		enabled = "[UnitActionItem.CanHoldRightClick]"
											# 		description = "[UnitActionItem.GetRightClickDescription]"
											# 	}

											# 	action_tooltip = {
											# 		visible = "[UnitActionItem.HasSingleLeftAction]"
											# 		title = "[UnitActionItem.GetName]"
											# 		on_action = "[UnitActionItem.SingleLeftClick]"
											# 		conditions = "[MakeItFailIf(Not(UnitActionItem.CanSingleLeftClick), UnitActionItem.GetTooltip)]"
											# 		enabled = "[UnitActionItem.CanSingleLeftClick]"
											# 		description = "[UnitActionItem.GetLeftClickDescription]"
											# 	}

											# 	action_tooltip = {
											# 		visible = "[UnitActionItem.HasShiftLeftClick]"
											# 		title = "[UnitActionItem.GetShiftLeftName]"
											# 		click_mode = single
											# 		click_type = left
											# 		click_modifier = shift
											# 		on_action = "[UnitActionItem.SingleLeftClick]"
											# 		conditions = "[MakeItFailIf(Not(UnitActionItem.CanSingleLeftClick), UnitActionItem.GetTooltip)]"
											# 		enabled = "[UnitActionItem.CanSingleLeftClick]"
											# 		description = "[UnitActionItem.GetLeftClickDescription]"
											# 	}

											# 	enabled = "[Or3(And(UnitActionItem.HasSingleLeftAction, UnitActionItem.CanSingleLeftClick),
											# 	And(UnitActionItem.HasHoldRightAction, UnitActionItem.CanHoldRightClick),
											# 	And(UnitActionItem.HasHoldLeftAction, UnitActionItem.CanHoldLeftClick))]"
												
											# 	input_action = "[UnitActionItem.GetShortcut]"
											# 	datacontext = "[UnitActionItem]"
											# 	tooltipwidget = {
											# 		using = UnitAction_tooltip
											# 		# blockoverride "left_click_text_multi" {
											# 		# 	text_multi = {
											# 		# 		visible = "[UnitActionItem.HasHoldLeftAction]"
											# 		# 		min_width = 330
											# 		# 		max_width = 330
									
											# 		# 		align = left|nobaseline
											# 		# 		multiline = yes
											# 		# 		autoresize = yes
									
											# 		# 		default_format = "#Color_Yellow"
											# 		# 		text = "[UnitActionItem.GetName]"
											# 		# 	}

											# 		# 	scrollarea = {
											# 		# 		visible = "[UnitActionItem.HasSingleLeftAction]"
											# 		# 		minimumsize = { -1 0 }
											# 		# 		maximumsize = { -1 300 }
											# 		# 		autoresizescrollarea = yes
											# 		# 		scrollbarpolicy_horizontal = always_off
													
											# 		# 		scrollbar_vertical = {
											# 		# 			using = Scrollbar_Vertical
											# 		# 		}
													
											# 		# 		scrollwidget = {
											# 		# 			text_multi = {
											# 		# 				min_width = 340
											# 		# 				max_width = 340
																	
											# 		# 				align = left|nobaseline
											# 		# 				multiline = yes
											# 		# 				autoresize = yes
													
											# 		# 				default_format = "#Color_Yellow"
													
											# 		# 				text = "[UnitActionItem.GetTooltip]"
											# 		# 			}
											# 		# 		}
											# 		# 	}
											# 		# }
											# 	}
											# }

											header_button_left = {
												visible = "[Not(UnitActionItem.IsToggleAction)]"
												parentanchor = bottom|left
												size = { 36 36 }
												blockoverride "button_icon_stretch_sprite" {}
												blockoverride "header_button_frame_inner" {visible = no}
												# blockoverride "header_button_icon_size" { size = { 100% 100% } }
												blockoverride "header_button_text_layout" {}
												blockoverride "icon_overlay" {}
												blockoverride "icon_texture" {
													size = { 100% 100% }
													texture = "[UnitActionItem.GetTexture]"
													position = { -2 -2 }
												}
												action_tooltip = {
													click_type = left
													click_mode = confirm
													title = "[UnitActionItem.GetName]"
													visible = "[UnitActionItem.HasHoldLeftAction]"
													on_action = "[UnitActionItem.HoldLeftClick]"
													enabled = "[UnitActionItem.CanHoldLeftClick]"
													description = "[UnitActionItem.GetLeftClickDescription]"
												}

												action_tooltip = {
													click_type = right
													click_mode = confirm
								
													visible = "[UnitActionItem.HasHoldRightAction]"
													title = "[UnitActionItem.GetSecondaryName]"
													on_action = "[UnitActionItem.HoldRightClick]"
													enabled = "[UnitActionItem.CanHoldRightClick]"
													description = "[UnitActionItem.GetRightClickDescription]"
												}

												action_tooltip = {
													visible = "[UnitActionItem.HasSingleLeftAction]"
													title = "[UnitActionItem.GetName]"
													on_action = "[UnitActionItem.SingleLeftClick]"
													conditions = "[MakeItFailIf(Not(UnitActionItem.CanSingleLeftClick), UnitActionItem.GetTooltip)]"
													enabled = "[UnitActionItem.CanSingleLeftClick]"
													description = "[UnitActionItem.GetLeftClickDescription]"
												}

												action_tooltip = {
													visible = "[UnitActionItem.HasShiftLeftClick]"
													title = "[UnitActionItem.GetShiftLeftName]"
													click_mode = single
													click_type = left
													click_modifier = shift
													on_action = "[UnitActionItem.SingleLeftClick]"
													conditions = "[MakeItFailIf(Not(UnitActionItem.CanSingleLeftClick), UnitActionItem.GetTooltip)]"
													enabled = "[UnitActionItem.CanSingleLeftClick]"
													description = "[UnitActionItem.GetLeftClickDescription]"
												}

												enabled = "[UnitActionItem.IsEnabled]"
												
												input_action = "[UnitActionItem.GetShortcut]"
												datacontext = "[UnitActionItem]"
												tooltipwidget = {
													using = UnitAction_tooltip
												}
											}

											UnitAbilitCheckbox = {
												visible = "[UnitActionItem.IsToggleAction]"
												parentanchor = bottom|left
												size = { 36 36 }

												blockoverride "icon_replace" {
													using = toggle_unit_action_icon
												}
												blockoverride "header_button_left_extra_texture" {
													background = {
														texture = "gfx/interface/component_tiles/square_glow.dds"
														margin = {5 5}
														visible = "[UnitActionItem.IsActive]"
														modify_texture = {
															using = color_bone_texture
														}
														modify_texture = {
															using = color_white_texture
															blend_mode = overlay
															alpha = 0.2
														}
													}
												}
												blockoverride "header_button_modify_visible" {
													visible = "[UnitActionItem.IsActive]"
												}
												
		
												enabled = "[UnitActionItem.CanSingleLeftClick]"
												input_action = "[UnitActionItem.GetShortcut]"
												use_global_input_instance = yes
												down = "[UnitActionItem.IsActive]"												
		
												datacontext = "[UnitActionItem]"
												action_tooltip = {
													visible = "[UnitActionItem.HasSingleLeftAction]"
													title = "[UnitActionItem.GetName]"
													on_action = "[UnitActionItem.SingleLeftClick]"													
													conditions = "[UnitActionItem.GetTooltip]"
													enabled = "[UnitActionItem.CanSingleLeftClick]"
													description = "[UnitActionItem.GetLeftClickDescription]"
												}
												tooltipwidget = {
													using = UnitAction_tooltip
												}
											}
										}
									}

									button_pin = {
										size = { 18 18 }
										parentanchor = right|top
										alpha = 0

										state = {
											name = show_pin
											position_y = -3
											duration = 0.25
											alpha = 1
											using = Animation_Curve_Default
											next = show_pin_2
										}
										state = {
											name = show_pin_2
											position_y = 0
											duration = 0.12
											using = Animation_Curve_Default
										}
										state = {
											name = hide_pin
											position_y = -3
											duration = 0.25
											alpha = 0
											using = Animation_Curve_Default
										}
										
										name = "button_pin"
								
										onclick = "[PinCollection.Toggle( UnitActionItem.GetKey )]"
										checked = "[PinCollection.IsPinnedWithDefaultValue( UnitActionItem.GetKey, UnitActionItem.IsPinnedByDefault )]"
										tooltipwidget = { 
											LeftClickButtonTooltip = {
												blockoverride "onclick_text" { 
													text = "[SelectLocalization(PinCollection.IsPinnedWithDefaultValue( UnitActionItem.GetKey, UnitActionItem.IsPinnedByDefault ), 'UNPIN_ACTION', 'PIN_ACTION')]"
												}
											}
										}
									}
								}
							}
						}
					# }
				}
			}
		}
	}

	type unit_mercenary_contracts_ongoing = hbox {
		widget = {
			size = {28 28}
			visible = "[GreaterThan_int32(GetDataModelSize(SingleUnitWindow.GetMercenaries), '(int32)4')]"
			button = {
				parentanchor = center
				size = {100% 100%}
				texture = "gfx/interface/icons/sort/mercenary_length.dds"
				datacontext = "[SingleUnitWindow.GetMercenariesAction]"
				using = button_action

				modify_texture = {
					using = color_gold_texture
					alpha = 0.5
				}

				modify_texture = {
					using = color_bone_texture
					alpha = 0.5
				}

				glow = {
					name = "drop_shadow"
					glow_radius = 2
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}
		}

		hbox = {
			spacing = 5
			visible = "[Not(GreaterThan_int32(GetDataModelSize(SingleUnitWindow.GetMercenaries), '(int32)4'))]"
			datamodel = "[SingleUnitWindow.GetMercenaries]"
			item = {
				widget = {
					size = {37 37}

					header_button_left = {
						size = { 37 37 }
						datacontext = "[MercenaryTypeItem.GetUIAction]"
						enabled = "[Or(UIActionProvider.IsLeftClickAndConfirmEnabled, CanDelistMercenary(MercenaryTypeItem.GetMercenary.Self))]"

						action_tooltip = {
							click_type = left
							click_mode = confirm
							visible = "[UIActionProvider.IsLeftClickAndConfirmVisible]"
							enabled = "[UIActionProvider.IsLeftClickAndConfirmEnabled]"
							title = "EXTEND_MERCENARY"
							cost = "[UIActionProvider.GetLeftClickAndConfirmCost]"
							description = "[UIActionProvider.GetLeftClickAndConfirmDescription]"
							acceptance = "[UIActionProvider.GetLeftClickAndConfirmAcceptance]"
							confirmation = "[UIActionProvider.GetConfirmation]"
							conditions = "[UIActionProvider.GetLeftClickAndConfirmConditions]"
							on_action = "[UIActionProvider.OnLeftClickAndConfirm]"
						}

						action_tooltip = {
							click_type = right
							click_mode = confirm
							visible = "[ShowDelistMercenary(MercenaryTypeItem.GetMercenary.Self)]"
							enabled = "[CanDelistMercenary(MercenaryTypeItem.GetMercenary.Self)]"
							title = "DELIST_MERCENARY"
							description = "[GetDelistMercenaryTooltip(MercenaryTypeItem.GetMercenary.Self)]"
							on_action = "[DelistMercenary(MercenaryTypeItem.GetMercenary.Self)]"
						}

						tooltipwidget = {
							BasicFunctionalTooltip = {}
						}

						blockoverride "header_button_full_content" {
							widget = {
								size = { 33 33 }
								alwaystransparent = yes
								piechart = {
									parentanchor = center
									size = { 27 27 }
									using = piechart_angles
									alwaystransparent = yes
	
									icon = {
										texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
										size = { 97% 97% }
										parentanchor = center
										color = { 0 0 0 1 }
										alwaystransparent = yes
									}
	
									pieslice_no_highlight = {
										texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
										value = "[Subtract_float('(float)1.0', MercenaryTypeItem.GetMercenary.GetPercentLeftOnContract)]"
										color = { 0.3 0.8 0.3 1 }
										alpha = 0.8
										alwaystransparent = yes
									}
	
									pieslice_no_highlight = {
										texture = "gfx/interface/pie_charts/pie_chart_alpha_80.dds"
										value = "[MercenaryTypeItem.GetMercenary.GetPercentLeftOnContract]"
										color = { 0.3 0.3 0.3 1 }
										alpha = 0.8
										alwaystransparent = yes
									}
								}
								
								icon = {
									size = { 20 20 }
									parentanchor = center
									alwaystransparent = yes
									texture = "gfx/interface/icons/alerts_icons/mercenary_contract_expiring.dds"
									texture_density = 2
								}
							}
						}
					}
				}
			}
		}

		expand = {}
	}
}

template toggle_unit_action_icon {
	icon = {
		parentanchor = center
		visible = "[UnitActionItem.IsActive]"
		texture = "[UnitActionItem.GetTexture]"
		size = { 65% 65% }
		position = { -2 -2 }

		texture_density = 2
		block "icon_overlay" {
			modify_texture = {
				using = color_new_gold_texture
			}
			modify_texture = {
				using = overlay_stone_texture
				blend_mode = overlay
				alpha = 0.2
			}
			modify_texture = {
				using = overlay_window_texture
				blend_mode = overlay
				alpha = 0.2
			}
		}
	}

	icon = {
		parentanchor = center
		visible = "[Not(UnitActionItem.IsActive)]"
		texture = "[UnitActionItem.GetNotTexture]"
		size = { 65% 65% }
		position = { -2 -2 }

		texture_density = 2
		block "icon_overlay" {
			modify_texture = {
				using = color_new_gold_texture
			}
			modify_texture = {
				using = overlay_stone_texture
				blend_mode = overlay
				alpha = 0.2
			}
			modify_texture = {
				using = overlay_window_texture
				blend_mode = overlay
				alpha = 0.2
			}
		}
	}
}

# template combat_side_box_status_defender {
# 	#using = combat_side_box_status_size

# 	onmousehierarchyenter = "[SingleUnitWindow.OnMouseEnterDefenderBox(CombatSubUnitArray.GetBoxId)]"
# 	onmousehierarchyleave = "[SingleUnitWindow.OnMouseLeaveDefenderBox]"
# }

# template combat_side_box_status_attacker {
# 	#using = combat_side_box_status_size

# 	onmousehierarchyenter = "[SingleUnitWindow.OnMouseEnterAttackerBox(CombatSubUnitArray.GetBoxId)]"
# 	onmousehierarchyleave = "[SingleUnitWindow.OnMouseLeaveAttackerBox]"
# }

template unit_formation_texture {
	texture = "gfx/interface/icons/unit_view/formation_flat.dds"
}

template army_strength_texture {
	texture = "gfx/interface/icons/unit_category/total_strength.dds"
}

template navy_strength_texture {
	texture = "gfx/interface/icons/text_icons/navy.dds"
}

# template box_position_marker_enabled {
# 	using = status_position_marker_size
# 	background = { using = color_bone_texture }
# }

# template box_position_marker_disabled {
# 	using = status_position_marker_size
# 	background = { using = bg_square_light_blue_texture }
# }

# template subunit_array_card {
# 	margin_widget = {
# 		size = { 380 40 }
# 		margin = { 8 8 }
# 		background = {
# 			texture = "gfx/interface_old/from_sulla/list_slot_corner_tiles.dds"
# 			spriteType = Corneredtiled
# 			spriteborder = { 10 10 }
# 			shaderfile = "gfx/FX/pdxgui_default.shader"
# 		}

# 		tooltipwidget = {
# 			using = SubUnitArray_tooltip
# 		}

# 		text_single = {
# 			position = { 6 0 }
# 			size = { 64 30 }
# 			text = "[SubUnitArray.GetBoxName]"
# 			alwaystransparent = yes
# 		}

# 		text_single = {
# 			position = { 206 0 }
# 			size = { 64 30 }
# 			visible = "[SingleUnitWindow.GetSelectedUnit.IsArmy]"
# 			text = "[SubUnitArray.GetStrength]"
# 			alwaystransparent = yes
# 		}

# 		text_single = {
# 			position = { 280 0 }
# 			size = { 64 30 }
# 			text = "[SubUnitArray.GetSize]"
# 			alwaystransparent = yes
# 		}
# 	}
# }

# template SubUnitContainerSetup
# {
# 	background = { using = bg_container_framed_texture }
# 	margin = { 5 15 }
# 	spacing = 5
# }

# template SubUnitArrayStrength
# {
# 	layoutpolicy_horizontal = expanding
# 	size = { -1 36 }

# 	hbox = {
# 		using = layoutpolicy_expanding
# 		using = bg_card_container
# 		margin = { 10 0 }
		
# 		visible = "[SingleUnitWindow.GetSelectedUnit.IsArmy]"

# 		icon = {
# 			size = { 22 22 }

# 			# block "composition_type_icon" {
# 				using = army_strength_texture
# 			# }

# 			texture_density = 2
# 			using = overlay_color_bone
# 			alpha = 1
# 		}

# 		text_single = {
# 			using = layoutpolicy_expanding
# 			align = right
# 			autoresize = no
# 			alwaystransparent = yes

# 			text = "[SubUnitArray.GetStrength]"
# 		}
# 	}
# }

# template SubUnitArraySize
# {
# 	layoutpolicy_horizontal = expanding
# 	size = { -1 36 }

# 	hbox = {
# 		using = layoutpolicy_expanding
# 		using = bg_card_container
# 		margin = { 10 0 }

# 		icon = {
# 			size = { 22 22 }

# 			# block "composition_type_icon" {
# 				using = unit_formation_texture
# 			# }

# 			texture_density = 2
# 			using = overlay_color_bone
# 			alpha = 1
# 		}

# 		text_single = {
# 			using = layoutpolicy_expanding
# 			align = right
# 			autoresize = no
# 			alwaystransparent = yes

# 			text = "[SubUnitArray.GetSize]"

# 		}
# 	}
# }

# template SubUnitArrayMorale
# {
# 	layoutpolicy_horizontal = expanding
# 	size = { -1 22 }

# 	tooltip = "[SubUnitArray.GetMoraleTooltip]"
	
# 	hbox = {
# 		using = layoutpolicy_expanding
# 		margin = { 5 0 }
# 		spacing = 10

# 		icon = {
# 			size = { 28 28 }

# 			# block "composition_type_icon" {
# 				texture = "gfx/interface/icons/unit_view/morale.dds"
# 			# }

# 			texture_density = 2
# 			using = overlay_color_light_blue
# 			alpha = 1
# 		}

# 		progressbar = {
# 			layoutpolicy_horizontal = expanding

# 			size = { -1 10 }
# 			using = morale_progressbar_bar
# 			value = "[SubUnitArray.GetMoralePercent]"
# 		}
# 	}
# }

# template SubUnitArrayStrengthPercent
# {
# 	layoutpolicy_horizontal = expanding
# 	size = { -1 22 }

# 	tooltip = "[SubUnitArray.GetStrengthTooltip]"

# 	hbox = {
# 		using = layoutpolicy_expanding
# 		margin = { 5 0 }
# 		spacing = 10

# 		icon = {
# 			size = { 28 28 }

# 			# block "composition_type_icon" {
# 				texture = "gfx/interface/icons/flat_icons/navy_army_health.dds"	#TODO strength
# 			# }

# 			texture_density = 2
# 			using = overlay_color_light_blue
# 			alpha = 1
# 		}

# 		progressbar = {
# 			layoutpolicy_horizontal = expanding

# 			size = { -1 10 }
# 			using = morale_progressbar_bar
# 			value = "[SubUnitArray.GetStrengthPercent]"
# 		}
# 	}
# }

# template SubUnitArrayExperience
# {
# 	layoutpolicy_horizontal = expanding
# 	size = { -1 28 }

# 	tooltip = "[SubUnitArray.GetExperienceTooltip]"

# 	hbox = {
# 		using = layoutpolicy_expanding
# 		margin = { 5 0 }
# 		spacing = 10

# 		icon = {
# 			size = { 28 28 }

# 			# block "composition_type_icon" {
# 				texture = "gfx/interface/icons/unit_view/experience.dds"
# 			# }

# 			texture_density = 2
# 			using = overlay_color_light_blue
# 			alpha = 1
# 		}

# 		progressbar = {
# 			layoutpolicy_horizontal = expanding

# 			size = { -1 10 }
# 			using = morale_progressbar_bar
# 			value = "[SubUnitArray.GetExperience]"
# 		}
# 	}
# }

# template unit_action_item {
# 	button = {
# 		texture = "gfx/interface_old/from_sulla/button_square_40.dds"
# 		onclick = "[UnitActionItem.SingleLeftClick]"
# 		datacontext = "[UnitActionItem]"
# 		tooltipwidget = {
# 			using = UnitAction_tooltip
# 		}

# 		input_action = "[UnitActionItem.GetShortcut]"
# 		use_global_input_instance = yes
# 		icon = {
# 			position = { -0 0 }
# 			size = { 40 40 }
# 			texture = "[UnitActionItem.GetTexture]"
# 		}
# 	}
# }

# template unit_action_item_round {
# 	button = {
# 		gfxtype = togglepushbuttongfx

# 		texture = "gfx/interface_old/from_sulla/button_circle_40_toggle.dds"
# 		onclick = "[UnitActionItem.SingleLeftClick]"
# 		enabled = "[UnitActionItem.CanSingleLeftClick]"
# 		datacontext = "[UnitActionItem]"
# 		tooltipwidget = {
# 			using = UnitAction_tooltip
# 		}
# 		down = "[UnitActionItem.IsActive]"
# 		input_action = "[UnitActionItem.GetShortcut]"
# 		use_global_input_instance = yes

# 		shaderfile = "gfx/FX/pdxgui_pushbutton.shader"

# 		framesize = { 40 40 }
# 		upframe = 1
# 		uphoverframe = 1
# 		uppressedframe = 1
# 		downframe = 2
# 		downhoverframe = 2
# 		disableframe = 1

# 		icon = {
# 			position = { -0 0 }
# 			size = { 40 40 }
# 			texture = "[UnitActionItem.GetTexture]"
# 		}
# 	}
# }

# template unit_action_item_diamond {
# 	button = {
# 		texture = "gfx/interface_old/from_sulla/button_diamond_40.dds"
# 		onclick = "[UnitActionItem.SingleLeftClick]"
# 		enabled = "[UnitActionItem.CanSingleLeftClick]"
# 		datacontext = "[UnitActionItem]"
# 		tooltipwidget = {
# 			using = UnitAction_tooltip
# 		}

# 		input_action = "[UnitActionItem.GetShortcut]"
# 		use_global_input_instance = yes
# 		icon = {
# 			position = { 5 5 }
# 			size = { 30 30 }
# 			texture = "[UnitActionItem.GetTexture]"
# 		}
# 	}
# }

lateralview = {
	name = "single_unit_window"
	widgetid = "single_unit_window"

	blockoverride "panel_header" {
		window_header_alt = {
			using = bg_main_inner_alt
			blockoverride "window_header_alt_color_texture"{
				using = color_default_brown_texture
			}
			
			blockoverride "header_text_object" {
				hbox = {
					button = {
						using = layoutpolicy_expanding
						enabled = "[SingleUnitWindow.CanRenameUnit]"
						onclick = "[SingleUnitWindow.Vars.Toggle('edit_name')]"
						tooltipwidget = {
							ContextualTooltipType = {
								blockoverride "title_icon" {
									country_flag_mid = {
										blockoverride "tooltip" {}
										datacontext = "[SingleUnitWindow.GetSelectedUnit.GetCountry]"
									}
								}

								blockoverride "title_text" {
									text = "[SingleUnitWindow.GetSelectedUnit.GetNameWithNoTooltip]"
								}

								blockoverride "concept_link" {
									text = "[unit|e]"
								}

								blockoverride "tooltip_content" {
									TooltipTextBlock = {
										blockoverride "text" {
											text = "UNIT_NAME_TT"
										}
									}
									TooltipFunctionalBlock = {
										using = tooltip_left_click_template

										blockoverride "action_left_text" {
											text = "RENAME_UNIT"
										}
									}
								}
							}
						}
					}
				}

				hbox = {
					visible = "[Not(SingleUnitWindow.Vars.Exists('edit_name'))]"
					spacing = 5
					expand = {}

					country_flag_small = {
						datacontext = "[SingleUnitWindow.GetSelectedUnit.GetCountry]"
						blockoverride "tooltip" {}
						
						blockoverride "contextmenu" {}
					}

					header_title = {
						layoutpolicy_horizontal = fixed
						autoresize = yes
						maximumsize = { 250 -1 }
						text = "[SingleUnitWindow.GetSelectedUnit.GetNameWithNoTooltip]"
						alwaystransparent = yes
					}

					tooltipwidget = {
						ContextualTooltipType = {
							blockoverride "title_icon" {
								country_flag_mid = {
									blockoverride "tooltip" {}
									datacontext = "[SingleUnitWindow.GetSelectedUnit.GetCountry]"
								}
							}

							blockoverride "title_text" {
								text = "[SingleUnitWindow.GetSelectedUnit.GetNameWithNoTooltip]"
							}

							blockoverride "concept_link" {
								text = "[unit|e]"
							}

							blockoverride "tooltip_content" {
								TooltipTextBlock = {
									blockoverride "text" {
										text = "UNIT_NAME_TT"
									}
								}
								TooltipFunctionalBlock = {
									using = tooltip_left_click_template

									blockoverride "action_left_text" {
										text = "RENAME_UNIT"
									}
								}
							}
						}
					}

					expand = {}
				}

				hbox = {
					editbox = {
						name = "unit_name"
						using = layoutpolicy_expanding
						default_format = "#high"
						using = Font_Size_Medium
						align = center|nobaseline

						text = "[SingleUnitWindow.GetSelectedUnit.GetNameWithNoTooltip]"

						ontextedited = "[SingleUnitWindow.OnUnitNameEdited]"
						oneditingfinished = "[SingleUnitWindow.RenameUnit]"
						oneditingfinished = "[SingleUnitWindow.Vars.Clear('edit_name')]"
						onfocusout = "[SingleUnitWindow.Vars.Clear('edit_name')]"

						focus_on_visible = yes
						focuspolicy = all
						alwaystransparent = no

						maxcharacters = 25

						visible = "[And(SingleUnitWindow.CanRenameUnit, SingleUnitWindow.Vars.Exists('edit_name'))]"
						multiline = no
					}
				}
			}
		}
	}

	blockoverride "panel_content" {
		vbox = {
			using = layoutpolicy_expanding
			using = bg_main_inner_notabs_alt
			using = window_main_tabs_margin_alt

			# UNIT CARD
			vbox = {
				layoutpolicy_horizontal = expanding
				margin = { 0 5 }
				widget = {
					layoutpolicy_horizontal = expanding
					size = { -1 78 }
					name = "single_unit_main_content"

					hbox = {
						datacontext = "[SingleUnitWindow.AccessSelectedUnit]"
						datacontext = "[SingleUnitWindow.AccessSelectedUnit.GetLocation]"
						
						using = bg_market_card
						using = bg_cabinet_card_frame

						unit_card = {
							blockoverride "unit_card_margins" {
								margin = {0 5}
							}
						}

						unit_card_right_buttons = {
							blockoverride "unit_filter_buttons" {
								filter_button_alt = {
									size = { 19 19 }
									blockoverride "filter_button_action" {
										action_tooltip = {
											click_type = left
											click_mode = single
											title = "TOGGLE_UNITS_SELECTION"
											on_action = "[SingleUnitWindow.ToggleSingleUnitSelectUnit(PdxGuiWidget.FindParent('single_unit_main_content').Self)]"
										}
									}
									tooltipwidget = { BasicFunctionalTooltip = {} }
									
									blockoverride "glow_visible" {
										visible = "[SingleUnitWindow.IsSingleUnitSelectUnitOpened(PdxGuiWidget.FindParent('single_unit_main_content').Self)]"
									}
								}
							}
						}
					}
				}
			}

			widget = {
				layoutpolicy_horizontal = expanding
				size = { -1 220 }

				masked_threecolor_icon = {
					size = { 100% 100% }
					alpha = 1
					texture = "[GetSubunitIllustration(SingleUnitWindow.GetSelectedUnit.GetVisualSubunit)]"
					mask =  "[GetSubunitIllustrationMask(SingleUnitWindow.GetSelectedUnit.GetVisualSubunit)]"
					primary_color = "[GetCountryUnitPrimaryColor(SingleUnitWindow.GetPlayer, SingleUnitWindow.GetSelectedUnit.GetVisualSubunit.GetDefinition)]"
					secondary_color = "[GetCountryUnitSecondaryColor(SingleUnitWindow.GetPlayer, SingleUnitWindow.GetSelectedUnit.GetVisualSubunit.GetDefinition)]"
					tertiary_color = "[GetCountryUnitTertiaryColor(SingleUnitWindow.GetPlayer, SingleUnitWindow.GetSelectedUnit.GetVisualSubunit.GetDefinition)]"
				}

				using = bg_age_event_frame

				# Unit status stuff near center top of background image
				vbox = {
					margin_top = 3

					hbox = {
						spacing = 7
						margin = {10 5}
						using = bg_paper_card
						using = bg_cabinet_card_frame

						widget = {
							size = { 50 20 }
							datacontext = "[SingleUnitWindow.GetSelectedUnit.GetTimedModifierOwner]"
							visible = "[GreaterThan_int32(GetDataModelSize(TimedModifierOwner.GetModifiers), '(int32)0')]"
							OneOrSeveralTimedModifiers = {}
						}
						
						icon = {
							size = { 24 24 }
							texture = "gfx/interface/icons/military_objectives/transport_troops.dds"
							alpha = 1
							visible = "[SingleUnitWindow.GetSelectedUnit.IsInTransport]"
							
							tooltipwidget = {
								SimpleContextualTooltipType = {
									lowpriotextcontext =  "UNIT_IN_TRANSPORT_TT"
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/military_objectives/transport_troops.dds"

											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
									}
									blockoverride "concept_link" {
										text = "[unit|e]"
									}
								}
							}
						}

						icon = {
							size = { 26 26 }

							texture = "gfx/interface/icons/unit_view/army_hidden_icon.dds"
							alpha = 1
							visible = "[Not(SingleUnitWindow.GetSelectedUnit.IsVisibleToAi)]"
							
							tooltipwidget = {
								SimpleContextualTooltipType = {
									lowpriotextcontext = "[SingleUnitWindow.GetSelectedUnit.GetIsVisibleToAiTooltip]"
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/unit_view/army_hidden_icon.dds"

											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
									}
									blockoverride "concept_link" {
										text = "[fog_of_war|e]"
									}
								}
							}

							glow = {
								name = "drop_shadow"
								glow_radius = 3
								color = {0.0 0.0 0.0 1.0}
								alpha = 0.3
							}
						}

						icon = {
							size = { 26 26 }

							texture = "gfx/interface/icons/unit_view/army_visible_icon.dds"
							alpha = 1
							visible = "[SingleUnitWindow.GetSelectedUnit.IsVisibleToAi]"
							
							tooltipwidget = {
								SimpleContextualTooltipType = {
									lowpriotextcontext =   "[SingleUnitWindow.GetSelectedUnit.GetIsVisibleToAiTooltip]"
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/unit_view/army_visible_icon.dds"

											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
									}
									blockoverride "concept_link" {
										text = "[fog_of_war|e]"
									}
								}
							}

							glow = {
								name = "drop_shadow"
								glow_radius = 3
								color = {0.0 0.0 0.0 1.0}
								alpha = 0.3
							}
						}

						icon = {
							size = { 30 30 }

							texture = "gfx/interface/mapitems/exiles.dds"
							alpha = 1
							visible = "[SingleUnitWindow.GetSelectedUnit.IsExiled]"
							
							tooltipwidget = {
								SimpleContextualTooltipType = {
									lowpriotextcontext =   "[SingleUnitWindow.GetSelectedUnit.GetExileTooltip]"
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/unit_view/exiles.dds"

											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
									}
									blockoverride "concept_link" {
										text = "[exile|e]"
									}
								}
							}
						}

						icon = {
							size = { 30 30 }

							texture = "gfx/interface/buttons/flats/retreating.dds"
							alpha = 1
							visible = "[SingleUnitWindow.GetSelectedUnit.IsRetreating]"
							
							tooltipwidget = {
								SimpleContextualTooltipType = {
									lowpriotextcontext =   "[SingleUnitWindow.GetRetreatTooltip]"
								}
							}

							glow = {
								name = "drop_shadow"
								glow_radius = 3
								color = {0.0 0.0 0.0 1.0}
								alpha = 0.3
							}
						}

						icon = {
							size = { 24 24 }

							texture = "gfx/interface/icons/unit_view/artillery_barrage.dds"
							alpha = 1
							visible = "[SingleUnitWindow.GetSelectedUnit.IsArmy]"
							tooltipwidget = {
								SimpleContextualTooltipType = {
									blockoverride "title_text" {
										text = "game_concept_artillery_barrage"
									}
									blockoverride "title_icon" {
										icon = {
											using = tooltip_title_icon_size
											texture = "gfx/interface/icons/unit_view/artillery_barrage.dds"

											glow = {
												name = "drop_shadow"
												glow_radius = 3
												color = {0.0 0.0 0.0 1.0}
												alpha = 0.3
											}
										}
									}
									blockoverride "concept_link" {
										text = "[artillery_barrage|e]"
									}
									blockoverride "tooltip_content" {
										TooltipScrolledStringPairList = {
											blockoverride "block_scrollarea" { maximumsize = { -1 300 } minimumsize = { -1 30 } }
											blockoverride "block_title" {
												text = "TOTAL_ARTILLERY_BONUS"
											}
											textcontext = "[SingleUnitWindow.GetSelectedUnit.GetArtilleryBonusTooltip]"
										}
									}
								}
							}

							glow = {
								name = "drop_shadow"
								glow_radius = 3
								color = {0.0 0.0 0.0 1.0}
								alpha = 0.3
							}
						}
					}

					expand = {}
				}

				vbox = {
					margin_top = 3
					spacing = 5

					hbox = {
						margin = { 0 5 }
						margin_left = 5
						margin_bottom = 2
						layoutpolicy_horizontal = expanding

						vbox = {
							layoutpolicy_horizontal = expanding
							
							# COMMANDER/ALMIRAL
							hbox = {
								layoutpolicy_horizontal = expanding
								datacontext = "[SingleUnitWindow.GetSelectedUnit.GetCommander]"
								vbox = {
									layoutpolicy_vertical = expanding
									widget = {
										size = { 200 95 }
										vbox = {
											unit_mercenary_contracts_ongoing = {
												layoutpolicy_horizontal = expanding
											}
											expand = {}
										}
									}
									expand = {}
								}
								expand = {}
								widget = {
									visible = "[Character.IsValid]"
									size = { 250 210  }
									
									character_frame_medium_with_labels_and_abilities = {
										enabled = "[Character.CanGiveUnitBonus]"
										blockoverride "portrait_datacontext" {
											datacontext = "[SingleUnitWindow.GetSelectedUnit.GetCommander]"
										}
										block "character_right_visible" {
											visible = yes
										}
										blockoverride "character_portrait_ani_visible" {
											visible = yes
										}
										blockoverride "character_portrait_visible" {
											visible = no
										}
										blockoverride "abilities_tooltip" {
											tagtooltip_enabled = yes
											tooltip = "[AddTextIf(SingleUnitWindow.GetSelectedUnit.IsArmy, Character.GetAbilityTooltipAsGeneral)][AddTextIf(SingleUnitWindow.GetSelectedUnit.IsNavy, Character.GetAbilityTooltipAsAdmiral)]"
										}
										size = { 230 210 }
										parentanchor = top|right
									}
									header_button_left = {
										parentanchor = center
										position = {11 15}
										size = { 25 25 }
										datacontext = "[SingleUnitWindow.GetSelectedUnit]"
										enabled = "[Unit.CanReplaceLeader]"
										visible = "[Unit.HasLeader]"

										blockoverride "button_icon_stretch_sprite" {}
										blockoverride "header_button_frame_inner" {visible = no}
										blockoverride "header_button_icon_size" { size = { 25 25 } }
										blockoverride "icon_size" { size = {100% 100%} }
										blockoverride "header_button_text_layout" {}

										blockoverride "icon_texture" {
											texture = "gfx/interface/buttons/flats/clean_text.dds"
											modify_texture = {
												using = color_new_gold_texture
											}
											modify_texture = {
												using = color_black_texture
												blend_mode = overlay
												alpha = 0.3
											}
											modify_texture = {
												using = overlay_stone_texture
												blend_mode = overlay
												alpha = 0.5
											}
											texture_density = 2
										}

										tooltipwidget = { BasicFunctionalTooltip = {} }

										action_tooltip = {
											click_type = left
											click_mode = confirm
											title = "REMOVE_COMMANDER_TT" 
											enabled = "[Unit.CanReplaceLeader]"
											description = "[Unit.CanReplaceLeaderInfo]"
											on_action = "[Unit.RemoveCommander]"
										}
										action_tooltip = {
											visible = "[Not(Unit.IsArmy)]"
											click_type = left
											click_mode = confirm
											title = "REMOVE_ALMIRANT_TT" 
											enabled = "[Unit.CanReplaceLeader]"
											description = "[Unit.CanReplaceLeaderInfo]"
											on_action = "[Unit.RemoveCommander]"
										}
									}
								}
							}
							expand = {}				
						}
					}

					expand = {}
				}
			}

			header_secondary_tabs = {
				blockoverride "content" {
					button_secondary_tab_alt = {
						widget = {
							name = "actions_tab"
							size = { 100% 100% }
							visible = "[Not(SingleUnitWindow.Vars.NotExistOrHasValue( 'tab', 'actions' ))]"
						}
						using = layoutpolicy_expanding
						blockoverride "tab_text"{
							text = "ACTIONS"
						}
						tooltipwidget = {
							using = "TabArmyActionsTooltip"
						}

						onclick = "[SingleUnitWindow.Vars.Set( 'tab', 'actions' )]"
						down = "[SingleUnitWindow.Vars.NotExistOrHasValue( 'tab', 'actions' )]"
					}
					button_secondary_tab_alt = {
						using = layoutpolicy_expanding
						blockoverride "tab_text"{
							text = "FORMATION_TAB"
						}
						tooltipwidget = {
							using = "TabArmyRegimentsTooltip"
						}

						onclick = "[SingleUnitWindow.Vars.Set( 'tab', 'formation' )]"
						down = "[SingleUnitWindow.Vars.HasValue( 'tab', 'formation' )]"
					}
				}
			}

			vbox = {
				using = layoutpolicy_expanding
				using = bg_secondary_inner_alt

				### ACTIONS CONTENT
				vbox = {
					using = layoutpolicy_expanding
					margin = {5 5}
					spacing = 5

					visible = "[SingleUnitWindow.Vars.NotExistOrHasValue( 'tab', 'actions' )]"

					hbox = {
						layoutpolicy_horizontal = expanding
						datacontext = "[SingleUnitWindow.GetSelectedUnit]"
						hbox = {
							layoutpolicy_horizontal = expanding
							layoutstretchfactor_horizontal = 2
							subheader_unified_icon = {
								margin = { 0 0 }
								tooltipwidget = {
									using = UnitMaintenance_tooltip
								}
								blockoverride "subheader_unified_icon_texture" {
									texture = "gfx/interface/icons/flat_icons/balance/cost_of_army.dds"
								}
								blockoverride "subheader_unified_top_text" {
									text = "UNIT_MAINTENANCE_COST"
									align = nobaseline
								}
								blockoverride "subheader_unified_bottom_text" {
									raw_text = "[SingleUnitWindow.GetMaintenanceCost|-=2]@gold"
									align = nobaseline
								}
							}
							expand = {}
						}

						# OBJECTIVES
						# hbox = {
						# 	layoutpolicy_horizontal = expanding
						# 	layoutstretchfactor_horizontal = 3
						# 	create_new_unit_button = {}
						# }

						# header_button_left = {
						# 	datacontext = "[SingleUnitWindow.GetCreateUnitAction]"
						# 	size = { 36 36 }
						# 	blockoverride "button_icon_stretch_sprite" {}
						# 	blockoverride "header_button_frame_inner" {visible = no}
						# 	# blockoverride "header_button_icon_size" { size = { 100% 100% } }
						# 	blockoverride "header_button_text_layout" {}
						# 	blockoverride "icon_overlay" {}
						# 	blockoverride "icon_texture" {
						# 		size = { 100% 100% }

						# 		texture = "[UnitActionItem.GetTexture]"
						# 		position = { -2 -2 }
						# 	}
						# 	input_action = "[UnitActionItem.GetShortcut]"
						# 	use_global_input_instance = yes
							
						# 	datacontext = "[SingleUnitWindow.GetCreateUnitAction]"
						# 	action_tooltip = {
						# 		click_type = left
						# 		click_mode = single
						# 		visible = "[Not(SingleUnitWindow.IsAddToCreatingUnitVisible)]"
						# 		title = "[UnitActionItem.GetName]"
						# 		enabled = "[UnitActionItem.CanSingleLeftClick]"
						# 		on_action = "[UnitActionItem.SingleLeftClick]"
						# 	}

						# 	action_tooltip = {
						# 		click_type = left
						# 		click_mode = single
						# 		visible = "[SingleUnitWindow.IsAddToCreatingUnitVisible]"
						# 		title = "[UnitActionItem.GetName]"
						# 		on_action = "[SingleUnitWindow.HideCreateNewUnit]"
						# 	}
							
						# 	tooltipwidget = {
						# 		using = UnitAction_tooltip
						# 	}
						# }

						UnitAbilitCheckbox = {
							size = { 36 36 }
							datacontext = "[SingleUnitWindow.GetCreateUnitAction]"

							blockoverride "icon_texture" {
								texture = "[UnitActionItem.GetTexture]"
								size = { 100% 100% }
								position = { -2 -2 }
							}
							blockoverride "header_button_left_extra_texture" {
								background = {
									texture = "gfx/interface/component_tiles/square_glow.dds"
									margin = {5 5}
									visible = "[UnitActionItem.IsActive]"
									modify_texture = {
										using = color_bone_texture
									}
									modify_texture = {
										using = color_white_texture
										blend_mode = overlay
										alpha = 0.1
									}
								}
							}
							blockoverride "header_button_modify_visible" {
								visible = "[SingleUnitWindow.IsAddToCreatingUnitVisible]"
							}
							
							input_action = "[UnitActionItem.GetShortcut]"
							use_global_input_instance = yes
							
							datacontext = "[SingleUnitWindow.GetCreateUnitAction]"
							action_tooltip = {
								click_type = left
								click_mode = single
								visible = "[Not(SingleUnitWindow.IsAddToCreatingUnitVisible)]"
								title = "[UnitActionItem.GetName]"
								enabled = "[UnitActionItem.CanSingleLeftClick]"
								on_action = "[UnitActionItem.SingleLeftClick]"
							}

							action_tooltip = {
								click_type = left
								click_mode = single
								visible = "[SingleUnitWindow.IsAddToCreatingUnitVisible]"
								title = "[UnitActionItem.GetName]"
								on_action = "[SingleUnitWindow.HideCreateNewUnit]"
							}
							
							tooltipwidget = {
								using = UnitAction_tooltip
							}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							layoutstretchfactor_horizontal = 2
							expand = {}
							subheader_unified_icon = {
								blockoverride "mirror_layout" { righttoleft = yes }
								margin = { 0 0 }
								tooltipwidget = {
									using = UnitNeededSupply_tooltip
								}
								blockoverride "subheader_unified_icon" {
									mapmode_tooltip_button = {
										datacontext = "[GetMapMode('supply')]"
									}
								}
								blockoverride "subheader_unified_top_text" {
									text = "game_concept_unit_weight"
									align = right|nobaseline
								}
								blockoverride "subheader_unified_bottom_text" {
									raw_text = "[Unit.GetTotalAttritionWeight|-=2]@supply_limit"
									align = right|nobaseline				
								}
							}
						}
					}

					hbox = {
						using = layoutpolicy_expanding
						spacing = 5
						# ACTIONS
						scrollarea = {
							using = layoutpolicy_expanding
							layoutstretchfactor_horizontal = 1
							scrollbarpolicy_horizontal = always_off
							scrollbarpolicy_vertical = as_needed
	
							autoresizeviewport = yes
							viewportwidget = {
								widget = {
									scissor = yes
								}
							}
	
							scrollbar_vertical = {
								using = Scrollbar_Vertical
							}
	
							scrollwidget = {
								vbox = {
									name = "actions_and_objectives"
									spacing = 7

									# ARMY MAIN ACTIONS
									unit_action_category = {
										visible = "[Not(SingleUnitWindow.GetSelectedUnit.IsNavy)]"
										# blockoverride "unit_action_category_block_amount" {
										# 	text = "[SingleUnitWindow.CategoryActionsAmount('main_actions')]"
										# }
										# blockoverride "unit_action_category_block_text" {
										# 	text = "MAIN_ACTIONS"
										# }
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('main_actions')]"
										}
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('main_actions')]"
										}
									}

									# ARMY DEATTACH & BUILDER ACTIONS
									unit_action_category = {
										visible = "[Not(SingleUnitWindow.GetSelectedUnit.IsNavy)]"
										blockoverride "unit_action_category_content_size" {
											size = { -1 170 }
										}
										# blockoverride "unit_action_category_block_amount" {
										# 	text = "[SingleUnitWindow.CategoryActionsAmount('deattach_builder_actions')]"
										# }
										# blockoverride "unit_action_category_block_text" {
										# 	text = "DEATTACH_ACTIONS"
										# }
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('deattach_builder_actions')]"
										}
									}

									# NAVY MAIN ACTIONS
									unit_action_category = {
										visible = "[SingleUnitWindow.GetSelectedUnit.IsNavy]"
										blockoverride "unit_action_category_content_size" {
											size = { -1 169 }
										}
										# blockoverride "unit_action_category_block_amount" {
										# 	text = "[SingleUnitWindow.CategoryActionsAmount('main_actions')]"
										# }
										# blockoverride "unit_action_category_block_text" {
										# 	text = "MAIN_ACTIONS"
										# }
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('main_actions')]"
										}
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('main_actions')]"
										}
									}

									# NAVY DEATTACH & BUILDER ACTIONS
									unit_action_category = {
										visible = "[SingleUnitWindow.GetSelectedUnit.IsNavy]"
										blockoverride "unit_action_category_content_size" {
											size = { -1 128 }
										}
										# blockoverride "unit_action_category_block_amount" {
										# 	text = "[SingleUnitWindow.CategoryActionsAmount('deattach_builder_actions')]"
										# }
										# blockoverride "unit_action_category_block_text" {
										# 	text = "DEATTACH_ACTIONS"
										# }
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('deattach_builder_actions')]"
										}
									}

									# TEMPORARY ACTIONS
									unit_action_category = {
										blockoverride "unit_action_category_content_size" {
											size = { -1 86 }
										}
										# blockoverride "unit_action_category_block_amount" {
										# 	text = "[SingleUnitWindow.CategoryActionsAmount('temporary_actions')]"
										# }
										# blockoverride "unit_action_category_block_text" {
										# 	text = "TEMPORARY_ACTIONS"
										# }
										blockoverride "unit_action_category_block_visible" {
											visible = "[UnitActionItem.IsCategory('temporary_actions')]"
										}
									}
									expand = {}
								}
							}
						}

						# REGIMENTS FLANKS COMBATS
						scrollarea = {
							using = layoutpolicy_expanding
							layoutstretchfactor_horizontal = 5
							scrollbarpolicy_horizontal = always_off
							scrollbarpolicy_vertical = as_needed
	
							autoresizeviewport = yes
							viewportwidget = {
								widget = {
									scissor = yes
								}
							}
	
							scrollbar_vertical = {
								using = Scrollbar_Vertical
							}
	
							scrollwidget = {
								vbox = {
									spacing = 5
									# COMBAT
									battle_goto_widget = {
										visible = "[SingleUnitWindow.GetSelectedUnit.InCombat]"
										datacontext = "[SingleUnitWindow.GetSelectedUnit.GetCombat]"
										blockoverride "battle_goto_action" {
											action_tooltip = {
												click_type = left
												click_mode = single
												title = "SHOW_BATTLE"
												on_action = "[ShowUnitCombat(Combat.Self, SingleUnitWindow.GetSelectedUnit.Self)]"
											}
										}
									}
									
									# OCCUPATION/SIEGE
									vbox = {
										visible = "[SingleUnitWindow.GetSelectedUnit.InSiege]"
										layoutpolicy_horizontal = expanding

										# SIEGE
										widget = {
											using = bg_card_header_01_military
											layoutpolicy_horizontal = expanding
											size = { -1 35 }
											datacontext = "[SingleUnitWindow.GetSelectedUnit.GetSiege]"
											card_header_button_04 = {
												size = { 100% 100% }
												action_tooltip = {
													click_type = left
													click_mode = single
													title = "GO_TO_SIEGE"
													on_action = "[SelectLocation(Siege.GetLocation)]"
												}
												tooltipwidget = {
													using = SiegePhase_tooltip
												}
												
												hbox = {
													margin = { 7 0 }
													spacing = 5
													country_flag_small = {
														datacontext = "[Siege.GetSiegeDefender]"
													}
													text_single = {
														align = left|nobaseline
														autoresize = no
														layoutpolicy_horizontal = expanding
														text = "[Siege.GetNameWithNoTooltip]"
														size = { -1 30 }
													}
	
													hbox = {
														using = siege_fall_chance_info
													}
												}
											}
										}
									}
	
									# FLANKS
									vbox = {
										layoutpolicy_horizontal = expanding
										using = bg_paper_card
										vbox = {
											layoutpolicy_horizontal = expanding
											margin = {5 5}
											spacing = 5
											hbox = {
												spacing = 5
												layoutpolicy_horizontal = expanding
												datacontext = "[SingleUnitWindow.GetSelectedUnit]"

												UnitFlankInfo = {
													datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('left')]"
												}

												UnitFlankInfo = {
													datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('center')]"
												}

												UnitFlankInfo = {
													datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('right')]"
												}

												# UnitFlankInfo = {
												# 	datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('captured')]"
												# }
											}
											hbox = {
												margin = { 50 0 }
												layoutpolicy_horizontal = expanding
												UnitFlankInfo = {
													datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('reserves')]"
													blockoverride "flank_size" {
														size = {-1 35}
													}
													blockoverride "unit_text_alpha" {
														alpha = 0.6
													}
												}
											}
										}
									}

									### REGIMENTS & NEW UNIT
									vbox = {
										using = layoutpolicy_expanding

										filtered_sorted_list = {
											datacontext = "[SingleUnitWindow.GetSubUnitsSortSearch]"
								
											blockoverride "scroll_list_is_empty" {
												visible = "[IsDataModelEmpty(SingleUnitWindow.GetSubUnits)]"
											}
								
											blockoverride "scroll_list_is_empty_text" {
												text = "SUBUNITS_SCROLL_LIST_EMPTY"
											}

											blockoverride "sort_buttons_filtered_list" {					
												sort_by_key_button = {
													name = "name"
													using = layoutpolicy_expanding
												}
						
												sort_by_key_button = {
													name = "experience"
													using = layoutpolicy_expanding
												}
						
												sort_by_key_button = {
													name = "morale"
													using = layoutpolicy_expanding
												}

												sort_by_key_button = {
													name = "strength"
													using = layoutpolicy_expanding
												}
											}
								
											blockoverride "scroll_list_content" {
												addcolumn = 100%
												addrow = 55

												datamodel = "[SingleUnitWindow.GetSubUnits]"
												item = {
													widget = {
														using = bg_paper_card
														tooltipwidget = {
															using = SubUnit_tooltip
														}
														parentanchor = hcenter
														size = { 97% 50 }

														hbox = {
															margin = { 2 2 }
															hbox = {
																layoutpolicy_horizontal = expanding
																layoutpolicy_vertical = expanding
																spacing = 7
																datacontext = "[SubUnit.GetDefinition]"
																
																# illustration
																widget = {
																	layoutpolicy_vertical = expanding
																	size = {37 -1}

																	using = subunit_illustration

																	card_header_button_04 = {
																		visible = "[CanUpgradeSubUnit(SubUnit.Self)]"
																		parentanchor = bottom|hcenter
																		size = { 18 18 }
																		using = bg_circle_alt_brown
																		icon = {
																			texture = "gfx/interface/icons/unit_actions/upgrade_army.dds"
																			size = {75% 75%}
																			parentanchor = center
																		}
																		action_tooltip = {
																			click_type = left
																			click_mode = confirm
																			title = "UPGRADE_SUBUNIT"
																			on_action = "[UpgradeSubUnit(SubUnit.Self)]"
																			enabled = "[CanUpgradeSubUnit(SubUnit.Self)]"
																			description = "[CanUpgradeSubUnitTooltip(SubUnit.Self)]"
																		}

																		enabled = "[CanUpgradeSubUnit(SubUnit.Self)]"
																		tooltipwidget = { BasicFunctionalTooltip = {} }
																	}
																	
																	# icon = {
																	# 	parentanchor = center
																	# 	ignore_layout = yes
																	# 	size = {92% 94%}
																		
																	# 	using = bg_age_event_frame
																	# }
																}

																hbox = {
																	layoutpolicy_horizontal = expanding
																	spacing = 2

																	vbox = {
																		layoutpolicy_horizontal = expanding
																		layoutpolicy_vertical = expanding
																		text_single = {
																			layoutpolicy_horizontal = expanding
																			align = left|nobaseline
																			autoresize = no
																			size = { -1 15 }
																			text = "[SubUnit.GetDefinition.GetNameWithNoTooltip]"
																			default_format = "#yellow_titles"
																		}
																		text_single = {
																			layoutpolicy_horizontal = expanding
																			align = left|nobaseline
																			size = { -1 15 }
																			maximumsize = {-1 15}
																			fontsize = 12
																			text = "[SubUnit.GetNameWithNoTooltip]"
																			default_format = "#medium"
																		}
																	}
																}

																unit_category_secondary_icon = {
																	blockoverride "unit_category_secondary_icon_position" {}
																	blockoverride "unit_category_secondary_icon_parentanchor" {}
																	blockoverride "unit_category_secondary_icon_size"{
																		size = {35 35}
																	}
																}

																icon = {
																	size = {35 35}
																	texture = "[SubUnit.GetSubunitFlankIcon]"
																	
																	datacontext = "[SubUnit.GetUnitBox]"
																	tooltipwidget = {
																		using = SubUnitArray_tooltip
																	}
											
																	glow = {
																		name = "drop_shadow"
																		glow_radius = 3
																		color = {0.0 0.0 0.0 1.0}
																		alpha = 0.2
																	}
																}
																
																hbox = {
																	spacing = 1
																	margin = {1 0}

																	# EXPERIENCE
																	widget = {
																		size = {15 35}
												
																		progressbar = {
																			parentanchor = center
																			size = { 5 35 }
																			using = progress_bar_green_alt
																			value = "[FixedPointToFloat(SubUnit.GetExperience)]"
																			min = 0
																			max = 100
																			direction = vertical
																		}
																		
																		tooltipwidget = {
																			using = SubUnitExperience_tooltip
																			
																		}
												
																		sort_by_highlight = {
																			name = "experience"
																		}
																	}

																	# MORALE
																	widget = {
																		size = {10 35}
												
																		progressbar = {
																			parentanchor = left
																			size = { 5 35 }
																			using = progress_bar_green_alt
																			value = "[FixedPointToFloat(SubUnit.GetMoralePercent)]"
																			min = 0
																			max = 100
																			direction = vertical
																		}
																		
																		tooltipwidget = {
																			using = subunit_morale_tooltip
																		}
												
																		sort_by_highlight = {
																			name = "morale"
																		}
																	}
																}
																
																# strength
																hbox = {
																	margin = {0 5}
																	layoutpolicy_vertical = expanding
																	hbox = {
																		spacing = 2
																		margin = {5 0}
																		layoutpolicy_vertical = expanding
																		using = bg_text_mask_container_brown
																		using = bg_frame_squared_brown
																		blockoverride "text_mask_extra" {
																			alpha = 0.4
																		}
																		blockoverride "frame_squared_extra" {
																			alpha = 0.7
																		}
																		text_single = {
																			visible = "[And(SubUnit.IsRegiment, Or(SubUnit.IsLevy, EqualTo_CFixedPoint(SubUnit.GetMissingStrength, '(CFixedPoint)0')))]"
																			align = right|nobaseline
																			autoresize = no
																			size = {60 15}
																			raw_text = "[SubUnit.GetStrength]@army_strength!"

																			tooltipwidget = {
																				using = Reinforce_tooltip
																			}

																			sort_by_highlight = {
																				name = "strength"
																			}
																		}

																		text_single = {
																			visible = "[And3(SubUnit.IsRegiment, Not(SubUnit.IsLevy), Not(EqualTo_CFixedPoint(SubUnit.GetMissingStrength, '(CFixedPoint)0')))]"
																			align = right|nobaseline
																			autoresize = no
																			size = {60 15}
																			raw_text = "[SubUnit.GetStrength]@army_strength!"
																			default_format = "#R"

																			tooltipwidget = {
																				using = Reinforce_tooltip
																			}

																			sort_by_highlight = {
																				name = "strength"
																			}
																		}

																		text_single = {
																			visible = "[And(SubUnit.IsShip, Or(SubUnit.IsLevy, EqualTo_CFixedPoint(SubUnit.GetMissingStrength, '(CFixedPoint)0')))]"
																			align = right|nobaseline
																			autoresize = no
																			size = {60 15}
																			raw_text = "[SubUnit.GetStrength]@navy_strength!"

																			tooltipwidget = {
																				using = Repair_tooltip
																			}

																			sort_by_highlight = {
																				name = "strength"
																			}
																		}
																		
																		text_single = {
																			visible = "[And3(SubUnit.IsShip, Not(SubUnit.IsLevy), Not(EqualTo_CFixedPoint(SubUnit.GetMissingStrength, '(CFixedPoint)0')))]"
																			align = right|nobaseline
																			autoresize = no
																			size = {60 15}
																			raw_text = "[SubUnit.GetStrength]@navy_strength!"
																			default_format = "#R"

																			tooltipwidget = {
																				using = Repair_tooltip
																			}

																			sort_by_highlight = {
																				name = "strength"
																			}
																		}
																	}

																	hbox = {
																		margin = {4 0}
																		visible = "[SingleUnitWindow.IsAddToCreatingUnitVisible]"
																		widget = {
																			datacontext = "[SubUnit]"
																			size = { 24 36 }
	
																			header_button_left = {
																				size = { 100% 100% }

																				action_tooltip = {
																					click_type = left
																					click_mode = single
																					enabled = "[SingleUnitWindow.CanAddToCreatingUnit(SubUnit.Self)]"
																					title = "TRANSFER_SUBUNIT_TT"
																					on_action = "[SingleUnitWindow.AddSubunitToNewUnit(SubUnit.Self)]"
																				}
																				action_tooltip = {
																					click_type = left
																					click_mode = single
																					click_modifier = shift
																					enabled = "[SingleUnitWindow.CanAddToCreatingUnit(SubUnit.Self)]"
																					title = "TRANSFER_SUBUNIT_CATEGORY_TT"
																					on_action = "[SingleUnitWindow.AddSubunitCategoryToNewUnit(SubUnit.Self)]"
																				}			
																				action_tooltip = {
																					click_type = left
																					click_mode = single
																					click_modifier = ctrl
																					enabled = "[SingleUnitWindow.CanAddToCreatingUnit(SubUnit.Self)]"
																					title = "TRANSFER_SUBUNIT_TYPE_TT"
																					on_action = "[SingleUnitWindow.AddSubunitTypeToNewUnit(SubUnit.Self)]"
																				}

																				enabled = "[SingleUnitWindow.CanAddToCreatingUnit(SubUnit.Self)]"
																				tooltipwidget = { BasicFunctionalTooltip = {}}
	
																				blockoverride "button_icon_stretch_sprite" {}
																				blockoverride "header_button_frame_inner" {visible = no}
																				blockoverride "header_button_icon_size" { size = { 24 24 } }
																				blockoverride "header_button_text_layout" {}
																				blockoverride "icon_texture" {
																					texture = "gfx/interface/buttons/flats/button_simple_right.dds"
																				}
																			}
																		}
																	}
																}
															}
														}

														# widget = {
														# 	size = {100% 100%}
														# 	ignore_layout = yes
														# 	using = bg_cabinet_card_frame
														# }
													}
												}
											}
										}
									}
	
									expand = {}
								}
							}
						}
					}

					expand = {}
				}

				### FORMATION CONTENT
				vbox = {
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					spacing = 8

					visible = "[SingleUnitWindow.Vars.HasValue( 'tab', 'formation' )]"
					scrollarea = {
						using = layoutpolicy_expanding
						scrollbarpolicy_horizontal = always_off
						autoresizescrollarea = no

						scrollbar_vertical = {
							using = Scrollbar_Vertical
						}
						
						scrollwidget = {
							vbox = {
								datacontext = "[SingleUnitWindow.GetSelectedUnit]"
								hbox = {
									using = layoutpolicy_expanding
									layoutstretchfactor_vertical = 2
									widget = {
										datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('left')]"
										using = layoutpolicy_expanding
										using = BoxUnit
									}
						
									widget = {
										using = divider_vertical_template
										layoutpolicy_vertical = expanding
										size = { 1 -1 }
									}
						
									widget = {
										datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('center')]"
										using = layoutpolicy_expanding
										using = BoxUnit
									}
						
									widget = {
										using = divider_vertical_template
										layoutpolicy_vertical = expanding
										size = { 1 -1 }
									}
						
									widget = {
										datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('right')]"
						
										using = layoutpolicy_expanding
										using = BoxUnit
									}
								}
						
								# divider_solid_blue = {}
						
								hbox = {
									using = layoutpolicy_expanding
									layoutstretchfactor_vertical = 1
						
									widget = {
										datacontext = "[SingleUnitWindow.GetSelectedUnit.GetUnitBox('reserves')]"
										using = layoutpolicy_expanding
										using = BoxUnit
										blockoverride "box_unit_scroll_list"{
											scroll_list = {
												using = layoutpolicy_expanding
												alwaystransparent = yes
						
												blockoverride "scroll_list_is_empty" {
													visible = "[IsDataModelEmpty(SubUnitArray.GetSubUnits)]"
												}
						
												blockoverride "scroll_list_content"  {
													addcolumn = 33.33%
													addrow = 75
													datamodel_wrap = 3
													flipdirection = yes
													setitemsizefromcell = yes
													datamodel = "[SubUnitArray.GetSubUnits]"
													item = {
														widget = {
															size = { 100% 75 }
															alwaystransparent = no
						
															scroll_sub_unit_banner = {
																parentanchor = center
																blockoverride "size" {
																	size = { 95% 70 }
																}
						
																# blockoverride "regularbackground" {
																# 	visible = no
																# }
						
																# blockoverride "dragdropbackground" {
																# 	visible = yes
																# }
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}

					expand = {}
				}
			}
		}
	}
}

template reinforcement_rate_tootlip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "gfx/interface/icons/unit_actions/reinforcement_rate.dds"
			}
		}
	
		blockoverride "title_text" {			
			text = "REINFORCE_UI_TITLE"
		}
							
		blockoverride "concept_link" {
			text = "[reinforcement|e]"
		}
	
		blockoverride "tooltip_content" {
			
			TooltipScrolledStringPairList = {
				
				blockoverride "block_scrollarea" { maximumsize = { -1 220 }}
				textcontext = "[Unit.GetReinforcementRateTooltip]"
			}
			
			TooltipScrolledStringPairList = {
				blockoverride "block_title" {
					text = "CURRENTLY_REINFORCE_PER_MONTH"
				}

				visible = "[Unit.ShowReinforceDetails]"

				blockoverride "block_scrollarea" { maximumsize = { -1 420 }}
				textcontext = "[Unit.GetUnitReinforceDetails]"
			}
		}
	}
}

template subunit_illustration { 
	masked_threecolor_icon = {
		visible = "[Not(SubUnitType.GetCategory.IsArmy)]"
		texture = "[GetSubunitTypeIllustration(SubUnitType.Self, SubUnit.GetCulture)]"
		size = { 100% 100% }
		texture_density = 2
		spriteborder = { 0 0 }
		frame_grid = {3 1}
		frame = 2
		mask =  "[GetSubunitTypeIllustrationMask(SubUnitType.Self, SubUnit.GetCulture)]"
		primary_color = "[GetCountryUnitPrimaryColor(SubUnit.GetOwner, SubUnitType.Self)]"
		secondary_color = "[GetCountryUnitSecondaryColor(SubUnit.GetOwner, SubUnitType.Self)]"
		tertiary_color = "[GetCountryUnitTertiaryColor(SubUnit.GetOwner, SubUnitType.Self)]"
	}
	masked_threecolor_icon = {
		visible = "[SubUnitType.GetCategory.IsArmy]"
		texture = "[GetSubunitTypeIllustration(SubUnitType.Self, SubUnit.GetCulture)]"
		size = { 100% 100% }
		texture_density = 2
		spriteborder = { 0 0 }
		frame_grid = {3 1}
		frame = 1
		mask =  "[GetSubunitTypeIllustrationMask(SubUnitType.Self, SubUnit.GetCulture)]"
		primary_color = "[GetCountryUnitPrimaryColor(SubUnit.GetOwner, SubUnitType.Self)]"
		secondary_color = "[GetCountryUnitSecondaryColor(SubUnit.GetOwner, SubUnitType.Self)]"
		tertiary_color = "[GetCountryUnitTertiaryColor(SubUnit.GetOwner, SubUnitType.Self)]"
	}
}
select_menu_left = {
	blockoverride "menu_setup" {
		name = "single_unit_select_unit"
	}

	blockoverride "close_button" {
		onclick = "[SingleUnitSelectUnit.OnClose]"
	}

	blockoverride "select_content" {
		select_menu_header = {
			blockoverride "select_menu_header_extra" {
				text_single = {
					using = Font_Type_Headers
					using = Font_Size_Small
					align = nobaseline
					text = "OWNED_UNITS_TT"
				}
			}
		}

		vbox = {
			layoutpolicy_horizontal = expanding
			spacing = 10

			datamodel = "[AccessPlayerUnits]"
			item = {
				widget = {
					size = { 485 70 }
					visible = "[Or(And(SingleUnitSelectUnit.Parent.GetSelectedUnit.IsArmy, Unit.IsArmy), And(SingleUnitSelectUnit.Parent.GetSelectedUnit.IsNavy, Unit.IsNavy))]"
					
					hbox = {
						datacontext = "[Unit.GetLocation]"
						
						using = bg_market_card
						using = bg_cabinet_card_frame
	
						unit_card = {}
					}
				}
			}
		}
	}
}