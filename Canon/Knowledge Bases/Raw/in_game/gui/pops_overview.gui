template ledger_tabs_template {
	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "POPULATION_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('pops_overview')]"
		down = "[IsLateralViewOpened('pops_overview')]"
	}

	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "COUNTRIES_TAB"
		}

		enabled = "[Not(HasGameRuleFlag('limit_ledger'))]"
		tooltip_enabled = "[HasGameRuleFlag('limit_ledger')]"
		tooltipwidget = {
			using = LimitLedgersTooltip
		}

		onclick = "[OpenLateralView('country_list')]"
		down = "[IsLateralViewOpened('country_list')]"
	}
	
	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "SCORE_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('score_view')]"
		down = "[IsLateralViewOpened('score_view')]"
	}

	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "WARS_L_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('wars_ledger')]"
		down = "[IsLateralViewOpened('wars_ledger')]"
	}
	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "DYNASTIES_L_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('dynasties_ledger')]"
		down = "[IsLateralViewOpened('dynasties_ledger')]"
	}
	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "CULTURES_L_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('cultures_ledger')]"
		down = "[IsLateralViewOpened('cultures_ledger')]"
	}
	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "RELIGIONS_L_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('religions_ledger')]"
		down = "[IsLateralViewOpened('religions_ledger')]"
	}

	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "LOCATIONS_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('locations_list')]"
		down = "[IsLateralViewOpened('locations_list')]"
	}
	
	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "MARKETS_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('markets_overview')]"
		down = "[IsLateralViewOpened('markets_overview')]"
	}

	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "GOODS_TAB"
		}

		enabled = "[Not(HasGameRuleFlag('limit_ledger'))]"
		tooltip_enabled = "[HasGameRuleFlag('limit_ledger')]"
		tooltipwidget = {
			using = LimitLedgersTooltip
		}

		onclick = "[OpenLateralView('goods_overview')]"
		down = "[IsLateralViewOpened('goods_overview')]"
	}

	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "ART_TAB"
		}
		tooltip_enabled = no
		onclick = "[OpenLateralView('arts_overview')]"
		down = "[IsLateralViewOpened('arts_overview')]"
	}

	button_main_tab_alt = {
		using = layoutpolicy_expanding
		blockoverride "tab_text"{
			text = "MODIFIERS_TEXT"
		}
		tooltipwidget = {
			using = TabModifiersTooltip
		}
		onclick = "[OpenLateralView('player_modifiers')]"
		down = "[IsLateralViewOpened('player_modifiers')]"
	}
}

template ledger_item_template {
	widget = {
		size = {100% 100%}
		hbox = {
			margin = { 10 5 }
			margin_right = 20

			widget = {
				using = layoutpolicy_expanding
				using = bg_scroll_card

				hbox = {
					block "ledger_item_content" {}
				}
			}
		}
	}
}

lateralview_full = {	
	name = "pops_overview"
	
	blockoverride "panel_header" {
		window_header_alt = {
			blockoverride "header_text" {
				text = "LEDGER_TAB"
			}
			blockoverride "window_header_alt_color_texture"{
				using = color_default_brown_texture
			}
		}
	}

	blockoverride "panel_content" {
		vbox = { 
			background = {
				using = pattern_vertical_bis_graphical_culture_texture
				alpha = 0.4
			}

			header_main_tabs = { #
				blockoverride "content" {
					using = ledger_tabs_template
				}
			}

			hbox = {
				using = layoutpolicy_expanding
                using = bg_main_inner_alt
                using = window_main_tabs_margin_alt

				hbox = {
					using = layoutpolicy_expanding
					margin_top = 20
					maximumsize = {350 -1 }

					scrollarea = {
						size = { 340 -1 }
						layoutpolicy_vertical = expanding
						scrollbarpolicy_horizontal = always_off

						scrollbar_vertical = {
							using = Scrollbar_Vertical
						}

						using = bg_paper_card


						scrollwidget = {
							dynamicgridbox = {
								size = { 100% -1 }
								datamodel = "[PopsOverview.GetCountries]"
								item = {
									widget = {
										parentanchor = right
										vbox = {
											margin_bottom = 0
											margin_top = 10
											margin_left = 10
											set_parent_size_to_minimum = yes
											button_regular = {
												background = {
																	texture = "gfx/interface/buttons/flavors/bg_button_flavor_1.dds"
																	texture_density = 2
																	spriteType = Corneredstretched
																	spriteborder = { 15 15 }
																	margin = {1 1}
																}
												using = bg_button_flavor_1
												size = { 320 37 }
												onclick = "[PopsCountryItem.OnClick]"

												blockoverride "header_color" {
													texture = "gfx/interface/colors/dark_turquoise.dds"
												}

												blockoverride "header_pattern" {
													texture = "gfx/interface/cards/headers/header_pattern_04.dds"
													spriteborder = { 0 12 }
													alpha = 0.7
												}
												
												datacontext = "[PopsCountryItem.GetCountry]"
												tooltipwidget = {
													using = CountryTooltip
												}

												hbox = {
													margin = { 12 0 }
													spacing = 3
													
													country_flag_small = {
														datacontext = "[PopsCountryItem.GetCountry]"
													}
				
													text_single = {
														using = layoutpolicy_expanding
														autoresize = no
														text = "[PopsCountryItem.GetCountry.GetNameWithNoTooltip]"
														default_format = "#yellow_titles"
														align = nobaseline
													}
													
													text_single = {
														text = "[PopsCountryItem.GetCountry.GetTotalPopulationNoLink]"
														align = nobaseline
													}

													container = {
														ui_direction_button = {
															size = { 22 22 }
															
															visible = "[Not(PopsCountryItem.IsToggled)]"
															onclick = "[PopsCountryItem.Toggle]"
															tooltipwidget = { LeftClickButtonTooltip = { blockoverride "onclick_text" { text = "EXPAND_COUNTRY_PROV_POPS_OVERVIEW" } } }
															
															texture = "gfx/interface/buttons/flats/button_simple_right.dds"
															modify_texture = {
																using = color_new_gold_texture
																alpha = 0.4
															}
														}
														ui_direction_button = {
															size = { 22 22 }
															visible = "[PopsCountryItem.IsToggled]"
															onclick = "[PopsCountryItem.Toggle]"
															tooltipwidget = { LeftClickButtonTooltip = { blockoverride "onclick_text" { text = "CONTRACT_COUNTRY_PROV_POPS_OVERVIEW" } } }
						
															texture = "gfx/interface/buttons/flats/button_simple_down.dds"
															modify_texture = {
																using = color_new_gold_texture
																alpha = 0.4
															}
														}
													}
												}
											}
											
											dynamicgridbox = {
												layoutpolicy_horizontal = expanding
												visible = "[PopsCountryItem.IsToggled]"
												datamodel = "[PopsCountryItem.GetProvinces]"
												item = {
													widget = {
														parentanchor = right
														vbox = {
															margin_bottom = 3
															margin_top = 5
															set_parent_size_to_minimum = yes
															button_regular = {
																background = {
																	texture = "gfx/interface/buttons/flavors/bg_button_flavor_1.dds"
																	texture_density = 2
																	spriteType = Corneredstretched
																	spriteborder = { 15 15 }
																	margin = {1 1}
																}
																using = bg_button_flavor_1
																size = { 310 37 }
																onclick = "[PopsProvinceItem.OnClick]"

																blockoverride "header_color" {
																	texture = "gfx/interface/colors/dark_turquoise.dds"
																}

																blockoverride "header_pattern" {
																	texture = "gfx/interface/cards/headers/header_pattern_04.dds"
																	spriteborder = { 0 12 }
																	alpha = 0.7
																}
																
																datacontext = "[PopsProvinceItem.GetProvince]"
																tooltipwidget = {
																	using = province_tooltip
																}
						
																hbox = {
																	margin = { 12 0 }
																	spacing = 5

																	icon = {
																		size = { 20 20 }
																		texture = "gfx/interface/icons/map_subdivisons/province.dds"	
																	}
																	
																	text_single = {
																		using = layoutpolicy_expanding
																		autoresize = no
																		text = "[PopsProvinceItem.GetProvince.GetNameWithNoTooltip]"
																		default_format = "#high"
																		align = nobaseline
																	}
																	
																	text_single = {
																		raw_text = "[PopsProvinceItem.GetProvince.GetTotalPopulation]@population!"
																		align = nobaseline
																	}
																	
																	container = {
																		ui_direction_button = {
																			size = { 22 22 }
																			visible = "[Not(PopsProvinceItem.IsToggled)]"
																			onclick = "[PopsProvinceItem.Toggle]"
																			tooltipwidget = { LeftClickButtonTooltip = { blockoverride "onclick_text" { text = "EXPAND_COUNTRY_LOCATIONS_POPS_OVERVIEW" } } }
						
																			texture = "gfx/interface/buttons/flats/button_simple_right.dds"
																			modify_texture = {
																				using = color_new_gold_texture
																				alpha = 0.4
																			}
																		}
						
																		ui_direction_button = {
																			size = { 22 22 }
																			visible = "[PopsProvinceItem.IsToggled]"
																			onclick = "[PopsProvinceItem.Toggle]"
																			tooltipwidget = { LeftClickButtonTooltip = { blockoverride "onclick_text" { text = "CONTRACT_COUNTRY_LOCATIONS_POPS_OVERVIEW" } } }
						
																			texture = "gfx/interface/buttons/flats/button_simple_down.dds"
																			modify_texture = {
																				using = color_new_gold_texture
																				alpha = 0.4
																			}
																		}
																	}
																}
															}

															dynamicgridbox = {
																layoutpolicy_horizontal = expanding
																visible = "[PopsProvinceItem.IsToggled]"
																datamodel = "[PopsProvinceItem.GetLocations]"
																item = {
																	widget = {
																		size = { 100% 41 }
																		layoutpolicy_horizontal = expanding
																		
																		button_regular = {
																			parentanchor = right|bottom
																			size = { 300 35 }
																			onclick = "[PopsLocationItem.OnClick]"

																			datacontext = "[PopsLocationItem.GetLocation]"
																			tooltipwidget = {
																				using = location_simple_tooltip
																			}

																			hbox = {
																				margin = { 10 0 }
																				spacing = 10

																				icon = {
																					size = { 16 16 }
																					texture = "[Location.GetRankIcon]"	
																				}
																				
																				text_single = {
																					using = layoutpolicy_expanding
																					raw_text = "[PopsLocationItem.GetLocation.GetNameWithNoTooltip]"
																					default_format = "#subtle_name"
																					align = nobaseline
																				}
						
																				text_single = {
																					raw_text = "[PopsLocationItem.GetLocation.GetTotalPopulation]@population!"
																					align = nobaseline
																				}
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}

				vbox = {
					using = layoutpolicy_expanding
					margin = {5 0}
					
					hbox = {
						layoutpolicy_horizontal = expanding
						margin = { 0 20 }

						icon_pie = {
							blockoverride "PieSize" { size = { 120 120 } }
							blockoverride "pie_datamodel" {	datamodel = "[PopsOverview.GetCultures]" }

							###Slices and Icon
							blockoverride "SliceTooltip" { tooltip = "[PopCultureItem.GetName]" tagtooltip_enabled = yes }
							blockoverride "SliceValue" { value = "[PopCultureItem.GetPercentage]" }
							blockoverride "SliceColor" { color = "[PopCultureItem.GetColor]" }
							blockoverride "Icon" {
								texture = "gfx/interface/icons/flat_icons/culture/main_culture.dds"
								texture_density = 2
							}
							blockoverride "datamodel" {	datamodel = "[PopsOverview.GetCultures]" }
							blockoverride "color" { color = "[PopCultureItem.GetColor]" }
							blockoverride "leftside_info" {text = "[PopCultureItem.GetName]"}
							blockoverride "rightside_info" {raw_text = "[PopCultureItem.GetPercentage|%2] ([PopCultureItem.GetAbsoluteSize])"}
						}
								
						
						icon_pie = {
							blockoverride "PieSize" { size = { 120 120 } }
							blockoverride "pie_datamodel" {	datamodel = "[PopsOverview.GetReligions]" }

							###Slices and Icon
							blockoverride "SliceTooltip" { tooltip = "[PopReligionItem.GetName]" tagtooltip_enabled = yes }
							blockoverride "SliceValue" { value = "[PopReligionItem.GetPercentage]" }
							blockoverride "SliceColor" { color = "[PopReligionItem.GetColor]" }
							blockoverride "Icon" {
								texture = "gfx/interface/icons/religion/_default.dds"
								position = { 0 0 }

								texture_density = 2

							}
							blockoverride "datamodel" {	datamodel = "[PopsOverview.GetReligions]" }
							blockoverride "color" { color = "[PopReligionItem.GetColor]" }
							blockoverride "leftside_info" {text = "[PopReligionItem.GetName]"}
							blockoverride "rightside_info" {raw_text = "[PopReligionItem.GetPercentage|%2] ([PopReligionItem.GetAbsoluteSize])"}
						}						

						icon_pie = {
							blockoverride "pie_datamodel" {	datamodel = "[PopsOverview.GetPopTypes]" }
							blockoverride "PieSize" { size = { 120 120 } }

							###Slices and Icon
							blockoverride "SliceTooltip" { tooltip = "[PopTypeItem.GetName]" tagtooltip_enabled = yes }
							blockoverride "SliceValue" { value = "[PopTypeItem.GetPercentage]" }
							blockoverride "SliceColor" { color = "[PopTypeItem.GetColor]" }
							blockoverride "Icon" {
								texture = "gfx/interface/icons/flat_icons/estates/estates.dds"
								position = { 0 0 }
								texture_density = 2

							}
							blockoverride "datamodel" {	datamodel = "[PopsOverview.GetPopTypes]" }
							blockoverride "color" { color = "[PopTypeItem.GetColor]" }
							blockoverride "leftside_info" {text = "[PopTypeItem.GetName]"}
							blockoverride "rightside_info" {raw_text = "[PopTypeItem.GetPercentage|%2] ([PopTypeItem.GetAbsoluteSize])"}
						}
					}

					filtered_sorted_list = {
						margin_top = 10
						datacontext = "[PopsOverview.GetPopsSortSearch]"

						blockoverride "sort_buttons_filtered_list" {
							sort_by_key_button = {
								name = "size"
								using = layoutpolicy_expanding
							}

							sort_by_key_button = {
								name = "type"
								using = layoutpolicy_expanding
							}

							sort_by_key_button = {
								name = "religion"
								using = layoutpolicy_expanding
							}

							sort_by_key_button = {
								name = "culture"
								using = layoutpolicy_expanding
							}

							sort_by_key_button = {
								name = "location"
								using = layoutpolicy_expanding
							}
							sort_by_key_button = {
								name = "literacy"
								layoutpolicy_vertical = expanding
								size = { 80 -1 }
							}
							sort_by_key_button = {
								name = "goods_access"
								layoutpolicy_vertical = expanding
								size = { 105 -1 }
							}
							sort_by_key_button = {
								name = "satisfaction"
								layoutpolicy_vertical = expanding
								size = { 105 -1 }
							}
							sort_by_key_button = {
								name = "rebel"
								layoutpolicy_vertical = expanding
								size = { 295 -1 }
							}
							sort_by_key_button = {
								name = "country"
								size = { 60 -1 }
								layoutpolicy_vertical = expanding
							}
							widget = { size = { 20 -1 } layoutpolicy_vertical = expanding }
						}
						
						blockoverride "scroll_list_content" {
							addcolumn = 100%
							addrow = 30
							
							datamodel = "[PopsOverview.GetPops]"
							item = {
								widget = {
									size = { 100% 35 }
									scroll_card = {
										size = { 99% 30 }
										parentanchor = center

										hbox = {
											margin = { 20 0 }
											ignoreinvisible = no

											widget = {
												using = layoutpolicy_expanding
												text_single = {
													autoresize = no
													size = { 100% 100% }
													text = "[Pop.GetSize]"
													# default_format = "#important_number"
													align = nobaseline

													sort_by_small_highlight = {
														name = "size"
														position = { -15 0 }
													}
												}
											}

											widget = {
												using = layoutpolicy_expanding
												hbox = {
													spacing = 5
													icon = {
														size = { 20 20 }
														texture = "[GetGraphicalCultureTextureForPop(Pop.Self)]"
														datacontext = "[Pop.GetType]"
														tooltipwidget = {
															using = PopType_tooltip
														}
													}
		
													text_single = {
														using = layoutpolicy_expanding
														text = "[Pop.GetType.GetNameWithNoTooltip]"
														datacontext = "[Pop.GetType]"
														tooltipwidget = {
															using = PopType_tooltip
														}
														align = nobaseline
		
														default_format = "#subtle_name"
													}

													sort_by_small_highlight = {
														name = "type"
														position = { -15 0 }
														ignore_layout = yes
													}
												}
											}
											
											widget = {
												using = layoutpolicy_expanding
												hbox = {
													spacing = 5
													icon = {
														size = { 20 20 }
														texture = "[GetReligionIcon(Pop.GetReligion.Self)]"
														datacontext = "[Pop.GetReligion]"
														tooltipwidget = { using = religion_tooltip	}
													}

													text_single = {
														using = layoutpolicy_expanding
														text = "[Pop.GetReligion.GetAdjectiveWithNoTooltip]"
														datacontext = "[Pop.GetReligion]"
														default_format = "#subtle_name"
														tooltipwidget = { using = religion_tooltip	}
														align = nobaseline
													}

													sort_by_small_highlight = {
														name = "religion"
														position = { -15 0 }
														ignore_layout = yes
													}
												}
											}

											widget = {
												using = layoutpolicy_expanding
												text_single = {
													autoresize = no
													size = { 100% 100% }
													text = "[Pop.GetCulture.GetNameWithNoTooltip]"
													datacontext = "[Pop.GetCulture]"
													tooltipwidget = {
														using = culture_tooltip
													}
													align = nobaseline

													sort_by_small_highlight = {
														name = "culture"
														position = { -15 0 }
													}
												}
											}

											widget = {
												using = layoutpolicy_expanding
												text_single = {
													autoresize = no
													size = { 100% 100% }
													text = "[Pop.GetLocation.GetNameWithNoTooltip]"
													default_format = "#subtle_name"
					
													datacontext = "[Pop.GetLocation]"
													tooltipwidget = {
														using = location_simple_tooltip
													}
													align = nobaseline

													sort_by_small_highlight = {
														name = "location"
														position = { -15 0 }
													}
												}
											}

											widget = {
												layoutpolicy_vertical = expanding
												size = { 80 -1 }
												text_single = {
													autoresize = no
													size = { 100% 100% }
													text = "[Pop.GetLiteracy|2/%Y]"
													align = nobaseline

													sort_by_small_highlight = {
														name = "literacy"
														position = { -15 0 }
													}	
												}
												datacontext = "[Pop]"
												tooltipwidget = {
													using = PopLiteracy_tooltip
												}
											}

											widget = {
												size = { 100 7 }

												progressbar = {
													size = { 90% 100% }
													using = morale_progressbar_bar
													using = progress_bar_blue_alt
													value = "[Multiply_float( FixedPointToFloat(Pop.GetGoodsAccess), '(float)100')]"
												}
												tooltipwidget = {
													using = PopNeeds_tooltip
												}

												sort_by_highlight = {
													name = "goods_access"
													position = { -6 0 }
												}
											}

											widget = {
												size = { 100 7 }
												
												tooltipwidget = {
													using = PopSatisfaction_tooltip
												}

												progressbar = {
													size = { 90% 100% }
													using = morale_progressbar_bar
													using = progress_bar_blue_alt
													value = "[Multiply_float( FixedPointToFloat(Pop.GetSatisfaction), '(float)100')]"
												}

												sort_by_highlight = {
													name = "satisfaction"
													position = { -3 0 }
												}
											}

											widget = {
												using = layoutpolicy_expanding
												hbox = {
													spacing = 5
													visible = "[Pop.HasRebel]"
													datacontext = "[Pop.GetRebel]"
													tooltipwidget = {
														using = Rebel_tooltip
													}

													expand = {}
													
													icon = {
														size = { 20 20 }
														texture = "[GetRebelsIcon(Pop.GetRebel.Self)]"
													}
													
													text_single = {
														autoresize = yes
														text = "[Pop.GetRebel.GetNameWithNoTooltip]"
														default_format = "#subtle_name"
														align = center|nobaseline
													}

													expand = {}
												}

												text_single = {
													autoresize = no
													size = { 100% 100% }
													text = "LOYAL_POP"
													visible = "[Not(Pop.HasRebel)]"
													default_format = "#color_green"
													align = center|nobaseline

													sort_by_small_highlight = {
														name = "rebel"
														position = { 0 0 }
													}
												}
											}
											
											container = {
												ignoreinvisible = no
												country_flag_small = {
													visible = "[Pop.HasOwnerOrLocationOwner]"
													datacontext = "[Pop.GetOwnerOrLocationOwner]"
												}

												sort_by_small_highlight = {
													name = "country"
													position = { 0 0 }
												}
											}
										}
									}
								}
							}	
						}
					}
				}
			}
		}
	}
}