@tooltip_ability_wide = 64

template abilities_text_props {
	layoutpolicy_vertical = expanding
	size = { 20 -1 }
	autoresize = no
	align = center|nobaseline
	using = Font_Size_Small
	default_format = "#important_number"
}

types TooltipCharacterTypes
{
	type artist_abilities = hbox {
		# visible = "[Character.IsArtist]"
		
		block "abilities_bg" {
			background = {
				using = bg_round_corners
				alpha = 0.9
			}
		}

		block "abilities_format" {
			margin = { 7 0 }
			spacing = 10
		}

		hbox = {
			name = "skill"
			tagtooltip_enabled = yes
			tooltip = "[artistic_skill|e]"

			widget = {
				size = { 25 25 }
				using = icon_art_skill_alt
			}

			# icon = {
			# 	block "ability_icon_size"
			# 	{
			# 		size = { 25 25 }
			# 	}

			# 	using = icon_art_skill_alt
			# }

			text_single = {
				using = abilities_text_props
				raw_text = "[Multiply_CFixedPoint(Character.GetArtistSkill, '(CFixedPoint)100')|0]"
			}

			using = bg_sort_by_highlight
		}

		hbox = {
			name = "works"
			layoutpolicy_vertical = expanding
			tooltipwidget = {
				using = CharacterWorksOfArt_tooltip
			}

			icon = {
				block "ability_icon_size" {
					size = { 25 25 }
				}

				texture = "gfx/interface/icons/flat_icons/art_works.dds"

				glow = {
					name = "drop_shadow"
					glow_radius = 3
					color = {0.0 0.0 0.0 1.0}
					alpha = 0.3
				}
			}

			text_single = {
				using = abilities_text_props
				text = "[GetDataModelSize(Character.GetWorksOfArt)]"
			}

			using = bg_sort_by_highlight
		}


		hbox = {
			visible = "[Character.IsArtist]"
			name = "works_progress"
			layoutpolicy_vertical = expanding

			widget = {
				block "ability_icon_size" {
					size = { 25 25 }
				}

				icon = {
					visible = "[Not(Character.HasArtInProgress)]"
					parentanchor = center
					size = { 100% 100% }
		
					texture = "gfx/interface/icons/flat_icons/available_artist.dds"

					glow = {
						name = "drop_shadow"
						glow_radius = 3
						color = {0.0 0.0 0.0 1.0}
						alpha = 0.3
					}
					tooltipwidget = {
						SimpleContextualTooltipType = {
							blockoverride "concept_link" {
								text = "[artist|e]"
							}
							blockoverride "title_icon" {
								icon = {
									using = tooltip_title_icon_size
									texture = "gfx/interface/icons/flat_icons/available_artist.dds"
								}
							}
							textcontext = "ARTIST_AVAILABLE"
						}
					}					
				}

				piechart = {
					visible = "[Character.HasArtInProgress]"
					parentanchor = center
					size = { 100% 100% }
		
					using = piechart_angles
		
					pieslice = {
						texture = "gfx/interface/pie_charts/pie_chart_blue_progress.dds"
						value = "[Character.GetArtProgressForUI]"
						color = { 1 1 1 1 }
						alwaystransparent = yes
					}
		
					pieslice = {
						texture = "gfx/interface/pie_charts/pie_chart_blue_progress.dds"
						value = "[Subtract_float('(float)1.0', Character.GetArtProgressForUI)]"
						color = { 1 1 1 0.3 }
						alwaystransparent = yes
					}

					icon = {
						parentanchor = center
						size = { 50% 50% }
			
						texture = "gfx/interface/icons/flat_icons/work_of_art_in_progress.dds"
			
						modify_texture = {
						}
					}
					tooltipwidget = {
						ContextualTooltipType = {						
							blockoverride "concept_link" {
								text = "[artist|e]"
							}
							blockoverride "title_icon" {
								widget = {
									block "ability_icon_size" {
										using = tooltip_title_icon_size
									}

									icon = {
										visible = "[Not(Character.HasArtInProgress)]"
										parentanchor = center
										size = { 100% 100% }
							
										texture = "gfx/interface/icons/flat_icons/available_artist.dds"

										glow = {
											name = "drop_shadow"
											glow_radius = 3
											color = {0.0 0.0 0.0 1.0}
											alpha = 0.3
										}
									}
									piechart = {
										visible = "[Character.HasArtInProgress]"
										parentanchor = center
										size = { 100% 100% }
							
										using = piechart_angles
							
										pieslice = {
											texture = "gfx/interface/pie_charts/pie_chart_blue_progress.dds"
											value = "[Character.GetArtProgressForUI]"
											color = { 1 1 1 1 }
											alwaystransparent = yes
										}
							
										pieslice = {
											texture = "gfx/interface/pie_charts/pie_chart_blue_progress.dds"
											value = "[Subtract_float('(float)1.0', Character.GetArtProgressForUI)]"
											color = { 1 1 1 0.3 }
											alwaystransparent = yes
										}

										icon = {
											parentanchor = center
											size = { 50% 50% }
								
											texture = "gfx/interface/icons/flat_icons/work_of_art_in_progress.dds"
								
											modify_texture = {
											}
										}
									}
								}
							}
							blockoverride "title_text" {
								text = "artist_started"
							}
							blockoverride "tooltip_content" {
								TooltipTextBlock = {
									blockoverride "text" {
										text = "[Character.GetArtProgressInfo]"
									}
								}
							}
						}
					}
				}
			}

			text_single = {
				using = abilities_text_props
				visible = "[Not(Character.HasArtInProgress)]"
				raw_text = "-"
				tooltipwidget = {
					SimpleContextualTooltipType = {						
						blockoverride "concept_link" {
							text = "[artist|e]"
						}
						blockoverride "title_icon" {
							icon = {
								using = tooltip_title_icon_size
								texture = "gfx/interface/icons/flat_icons/available_artist.dds"
							}
						}
						textcontext = "ARTIST_AVAILABLE"
					}
				}				
			}

			text_single = {
				using = abilities_text_props
				visible = "[Character.HasArtInProgress]"
				raw_text = "[Character.GetArtProgressForUI|0]%"
				tooltipwidget = {
					ContextualTooltipType = {						
						blockoverride "concept_link" {
							text = "[artist|e]"
						}
						blockoverride "title_icon" {
							widget = {
								block "ability_icon_size" {
									using = tooltip_title_icon_size
								}

								icon = {
									visible = "[Not(Character.HasArtInProgress)]"
									parentanchor = center
									size = { 100% 100% }
							
									texture = "gfx/interface/icons/flat_icons/available_artist.dds"

									glow = {
										name = "drop_shadow"
										glow_radius = 3
										color = {0.0 0.0 0.0 1.0}
										alpha = 0.3
									}
								}
								piechart = {
									visible = "[Character.HasArtInProgress]"
									parentanchor = center
									size = { 100% 100% }
							
									using = piechart_angles
							
									pieslice = {
										texture = "gfx/interface/pie_charts/pie_chart_blue_progress.dds"
										value = "[Character.GetArtProgressForUI]"
										color = { 1 1 1 1 }
										alwaystransparent = yes
									}
							
									pieslice = {
										texture = "gfx/interface/pie_charts/pie_chart_blue_progress.dds"
										value = "[Subtract_float('(float)1.0', Character.GetArtProgressForUI)]"
										color = { 1 1 1 0.3 }
										alwaystransparent = yes
									}

									icon = {
										parentanchor = center
										size = { 50% 50% }
								
										texture = "gfx/interface/icons/flat_icons/work_of_art_in_progress.dds"
							
										modify_texture = {
										}
									}
								}
							}
						}
						blockoverride "title_text" {
							text = "artist_started"
						}
						blockoverride "tooltip_content" {
							TooltipTextBlock = {
								blockoverride "text" {
									text = "[Character.GetArtProgressInfo]"
								}
							}
						}
					}
				}
			}

			using = bg_sort_by_highlight
		}
	}

	type character_abilities = hbox {
		alwaystransparent = no

		block "abilities_tooltip" {
			tagtooltip_enabled = yes
			tooltip = "[Character.GetAbilityTooltip]"
		}

		block "abilities_bg" {
			background = {
				# block "abilities_bg_texture" {
					texture = "gfx/interface/component_tiles/number_container.dds"
					texture_density = 2
					spriteType = corneredstretched
					spriteborder = { 25 25 }
				# }
				# block "abilities_bg_alpha" {
					alpha = 0.7
				# }
				block "abilities_bg_extra" {
					margin = {0 4}
				}
				
				# block "abilities_bg_color" {
					modify_texture = {
						using = color_dark_blue_texture
						blend_mode = multiply
					}
				# }
		
				modify_texture = {
					using = overlay_cloth_texture
					blend_mode = overlay
					alpha = 0.1
				}
			}
			background = {
				using = tile_frame_squared_texture
				block "abilities_bg_frame_extra" {
					margin = {1 1}
				}
				modify_texture = {
					using = color_dark_brown_texture
				}
			}
		}

		block "abilities_inbetween" {}
		
		block "abilities_format" {
			margin = { 7 0 }
			spacing = 10
		}

		hbox = {
			name = "adm"

			widget = {
				block "abilities_icon_size" {
					size = { 25 25 }
				}
				using = icon_adm_alt
			}

			text_single = {
				using = abilities_text_props
				text = "[Character.GetAbility('adm')]"
			}

			using = bg_sort_by_highlight
		}

		block "abilities_inbetween" {}

		hbox = {
			name = "dip"

			widget = {
				block "abilities_icon_size" {
					size = { 25 25 }
				}
				using = icon_dip_alt
			}

			text_single = {
				using = abilities_text_props
				text = "[Character.GetAbility('dip')]"
			}

			using = bg_sort_by_highlight
		}

		block "abilities_inbetween" {}

		hbox = {
			name = "mil"

			widget = {
				block "abilities_icon_size" {
					size = { 25 25 }
				}
				using = icon_mil_alt
			}

			text_single = {
				using = abilities_text_props
				text = "[Character.GetAbility('mil')]"
			}

			using = bg_sort_by_highlight
		}

		block "abilities_inbetween" {}
	}

	type ListOfCharactersItem = widget {
		allow_outside = yes
		tagtooltip_enabled = yes
		tooltip = "[Character.GetNameToFit('(int32)22', '(bool)yes')]"
		tooltip_enabled = "[Character.IsValid]"

		portrait_standard_head_button = {
			parentanchor = center
			size = { 100% 120% }
			blockoverride "character_tooltip" {}
		}
	}

	type TooltipListOfCharacters = TooltipListBase {
		TooltipListScrollArea = {
			blockoverride "block_scrollarea" {
				maximumsize = { -1 500 }
			}

			blockoverride "scrollarea_content" {
				fixedgridbox = {
					addcolumn = 50
					addrow = 50
					datamodel_wrap = 8
					flipdirection = yes

					block "datamodel_list" {}
					item = {
						ListOfCharactersItem = {
							size = { 50 50 }
						}
					}
				}
			}
		}
	}

	type TooltipAbilityValueArtistSkill = widget {
		size = { @tooltip_ability_wide 22 }
		parentanchor = right|vcenter

		hbox = {
			margin = { 10 0 }
			spacing = 5

			icon = {
				using = icon_art_skill_alt
				size = { 22 22 }
			}

			text_single = {
				using = Font_Size_Small
				autoresize = yes
				align = nobaseline
				text = "[Character.GetArtistSkill|%2]"
				default_format = "#important_number"
			}
		}
	}

	type TooltipAbilityValueAdm = widget {
		size = { @tooltip_ability_wide 22 }
		parentanchor = right|vcenter

		hbox = {
			margin = { 10 0 }
			spacing = 5

			widget = {
				name = "adm"
				size = { 22 22 }
				using = icon_adm_alt
			}

			text_single = {
				using = Font_Size_Small
				autoresize = yes
				align = nobaseline
				text = "[Character.GetAbility('adm')]"
				default_format = "#important_number"
			}
		}
	}

	type TooltipAbilityValueDip = widget {
		size = { @tooltip_ability_wide 22 }
		parentanchor = right|vcenter

		hbox = {
			margin = { 10 0 }
			spacing = 5

			widget = {
				name = "dip"
				size = { 22 22 }
				using = icon_dip_alt
			}

			text_single = {
				using = Font_Size_Small
				autoresize = yes
				align = nobaseline
				text = "[Character.GetAbility('dip')]"
				default_format = "#important_number"
			}
		}
	}

	type TooltipAbilityValueMil = widget {
		size = { @tooltip_ability_wide 22 }
		parentanchor = right|vcenter

		hbox = {
			margin = { 10 0 }
			spacing = 5

			widget = {
				name = "mil"
				size = { 22 22 }
				using = icon_mil_alt
			}

			text_single = {
				using = Font_Size_Small
				autoresize = yes
				align = nobaseline
				text = "[Character.GetAbility('mil')]"
				default_format = "#important_number"
			}
		}
	}

	type TooltipAbilityEducationBlock = TooltipStringPairList {
		visible = no # Deprecated 
		# visible = "[Character.HasEducationAbilityInfo]"
		textcontext = "[Character.GetEducation.GetEffect]"
		blockoverride "block_title" {
			text =  "[Character.GetEducationAbilityInfo]"
		}
	}

	type TooltipExtraInfoRuler = TooltipExtraInfoField {
		blockoverride "field_content_pre" {
			expand = {}

			icon = {
				size = { 22 22 }
				visible = "[Character.IsRuler]"
				texture = "gfx/interface/icons/character_roles/ruler.dds"
			}

			icon = {
				size = { 22 22 }
				visible = "[Not(Character.IsRuler)]"
				texture = "gfx/interface/icons/character_roles/advisor.dds"
			}
		}

		blockoverride "field_tooltip" { tooltip = "[Character.GetAbilityTooltipAsRuler]" }
		blockoverride "field_text" { text = "[Character.GetAbilityTooltipAsRuler]" }
	}

	type TooltipExtraInfoGeneral = TooltipExtraInfoField {
		blockoverride "info_icon" { texture = "gfx/interface/icons/character_roles/general.dds" }
		blockoverride "field_tooltip" { tooltip = "[Character.GetAbilityTooltipAsGeneral]" }
		blockoverride "field_text" { text = "[Character.GetAbilityTooltipAsGeneral]" }
	}

	type TooltipExtraInfoAdmiral = TooltipExtraInfoField {
		blockoverride "info_icon" { texture = "gfx/interface/icons/character_roles/admiral.dds" }
		blockoverride "field_tooltip" { tooltip = "[Character.GetAbilityTooltipAsAdmiral]" }
		blockoverride "field_text" { text = "[Character.GetAbilityTooltipAsAdmiral]" }
	}

	type TooltipExtraInfoExplorer = TooltipExtraInfoField {
		blockoverride "info_icon" { texture = "gfx/interface/icons/character_roles/explorer.dds" }
		blockoverride "field_tooltip" { tooltip = "[Character.GetAbilityTooltipAsExplorer]" }
		blockoverride "field_text" { text = "[Character.GetAbilityTooltipAsExplorer]" }
	}

	type character_role_icon = hbox {
		widget = {
			visible = "[Not(Character.IsAlive)]"
			block "icon_size" {
				size = { 32 32 }
			}
			
			icon = {
				parentanchor = center
				size = { 100% 100% }
				
				texture = "gfx/interface/icons/character_roles/death.dds"
				

				tooltipwidget = {
					using = dead_character_tooltip
				}
			}
		}
		
		hbox = {
			visible = "[Character.IsAlive]"
			ignoreinvisible = yes
			spacing = 5

			widget = {
				visible = "[Not(CharacterRoleMask.HasAnyRole)]"
				block "icon_size" {
					size = { 32 32 }
				}

				tagtooltip_enabled = yes
				tooltip = "CHARACTER_ROLE_IDLE"

				icon = {
					size = { 100% 100% }
					# TODO COURTIER ICON MISSING
					texture = "gfx/interface/icons/character_roles/adult.dds"

					glow = {
						name = "drop_shadow"
						glow_radius = 3
						color = {0.0 0.0 0.0 1.0}
						alpha = 0.3
					}
				}
			}

			datamodel = "[DataModelRepeatedItem(CharacterRoleMask.GetRolesCount)]"
			item = {
				widget = {
					block "icon_size" {
						size = { 32 32 }
					}

					block "icon_visible" {
						visible = "[CharacterRoleMask.HasRole(PdxGuiWidget.GetIndexInDataModel)]"
					}

					block "icon_tooltip" {
						tagtooltip_enabled = yes
						tooltip = "[CharacterRoleMask.GetRoleName(PdxGuiWidget.GetIndexInDataModel)]"
					}

					icon = {
						size = { 100% 100% }
						texture = "[CharacterRoleMask.GetRoleIcon(PdxGuiWidget.GetIndexInDataModel)]"
						glow = {
							name = "drop_shadow"
							glow_radius = 3
							color = {0.0 0.0 0.0 1.0}
							alpha = 0.5
						}
					}
				}
			}
		}	
	}

	type TooltipCharacterHeader = hbox {
		layoutpolicy_horizontal = expanding
		using = bg_paper_card

		margin = { 5 5 }
		spacing = 5

		datacontext = "[Character.GetRoleMask]"
		datacontext = "[Character.GetCourtCountry]"

		vbox = {
			layoutpolicy_vertical = expanding
		
			character_frame_medium = {
				blockoverride "portrait_datacontext" {
					datacontext = "[Character]"
				}
				blockoverride "character_frame_texture" {
					texture = "gfx/interface/component_decoration/character_frames/character_non_stretchable_frame_2.dds"
				}

				blockoverride "portrait_position" {position = { 4 -1 }}
				blockoverride "portrait_size" { size = { 85% 90% } }
				blockoverride "character_tooltip" {}
				blockoverride "character_contextmenu" {}
				blockoverride "portrait_click" {}
				blockoverride "rightclick" {}
				blockoverride "hover" {}
				blockoverride "character_portrait_visible" {
					visible = no
				}

				blockoverride "character_portrait_ani_visible" {
					visible = yes								
				}
				blockoverride "character_portrait_ani_size" {
					size = { 85 125 }
				}
				blockoverride "character_ribbon" {
					character_ribbon_3 = {
						visible = "[And(Not(Character.IsAlive), Character.WasRuler)]"
						blockoverride "ribbon color" {
							modify_texture = {
								using = color_black_texture
								blend_mode = overlay
								alpha = 0.2
							}
						}
						blockoverride "stretchable" {}
					}

					character_ribbon_3 = {
						visible = "[And(Character.IsAlive, Character.IsRuler)]"					
						blockoverride "stretchable" {}
					}
				}
				blockoverride "dynasty_shield" {
					dynasty_shield_mid = {
						visible = "[Character.HasDynasty]"
						datacontext = "[Character.GetDynasty]"
						parentanchor = bottom|left
					}
				}

				blockoverride "lowborn_coat_of_arms" {
					lowborn_coat_of_arms = {
						visible = no
						size = { 30% 28% }
						parentanchor = bottom|left
					}
				}
	
				icon = {
					visible = "[Character.HasCourtCountry]"
					parentanchor = bottom|right
					size = { 35% 30% }
					texture = "[GetEstateIcon(Character.GetEstateType)]"
					datacontext = "[Character.GetCourtCountry.GetGovernment.GetEstate(Character.GetEstateType)]"
					tooltipwidget = {
						using = Estate_tooltip
					}
				}
			}
		}

		vbox = {
			using = layoutpolicy_expanding

			hbox = {
				using = layoutpolicy_expanding
				spacing = 5
				margin = { 0 5 }

				vbox = {
					using = layoutpolicy_expanding
					spacing = 5

					vbox = {
						using = layoutpolicy_expanding
						margin = { 7 0 }

						background = {
							using = tile_background_squared_texture
							alpha = 0.3
							modify_texture = {
								using = color_tool_blue_texture
							}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 5
		
							allow_outside = yes
							tagtooltip_enabled = yes
							tooltip = "[Character.GetCulture.GetName]"

							icon = {
								size = { 25 25 }
	
								texture = "gfx/interface/icons/character_interactions/culture.dds"
								texture_density = 2
							}
		
							text_single = {
								align = nobaseline|right
								autoresize = yes
								text = "[Character.GetCulture.GetName]"
							}

							expand = {}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 5

							allow_outside = yes
							tagtooltip_enabled = yes
							tooltip = "[Character.GetReligion.GetAdjective]"

							icon = {
								size = { 25 25 }
								texture = "[GetReligionIcon(Character.GetReligion)]"
							}

							text_single = {
								align = right|nobaseline
								autoresize = yes
								text = "[Character.GetReligion.GetAdjective]"
							}

							expand = {}
						}
					}

					widget = {
						layoutpolicy_horizontal = expanding
						size = { -1 30 }

						background = {
							using = tile_background_squared_texture
							alpha = 0.3
							modify_texture = {
								using = color_tool_blue_texture
							}
						}

						character_abilities = {
							visible = "[Not(Character.IsArtist)]"
							blockoverride "ability_icon_size" {
								size = { 25 25 }
							}
						}

						artist_abilities = {
							visible = "[Character.IsArtist]"
							blockoverride "ability_icon_size" {
								size = { 25 25 }
							}
						}
					}
				}

				vbox = {
					layoutpolicy_vertical = expanding
					spacing = 5

					vbox = {
						using = layoutpolicy_expanding
						margin = { 7 0 }

						background = {
							using = tile_background_squared_texture
							alpha = 0.3
							modify_texture = {
								using = color_tool_blue_texture
							}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							minimumsize = { -1 40 }
							
							character_role_icon = {}

							expand = {}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							minimumsize = { -1 40 }

							spacing = 5
		
							text_single = {
								autoresize = yes
								align = center|nobaseline
								using = Font_Size_Medium
								raw_text = " [Character.GetAge|Y]"
								tooltipwidget = {
									using = AgeAndSex_tooltip
								}
							}
		
							gender_icon = {
								tooltipwidget = {
									using = AgeAndSex_tooltip
								}
								blockoverride "tooltip_override" {}
							}

							expand = {}
						}
					}

					widget = {
						allow_outside = yes
						size = { 120 30 }

						background = {
							using = tile_background_squared_texture
							alpha = 0.3
							modify_texture = {
								using = color_tool_blue_texture
							}
						}

						widget = {
							visible = "[And(Character.HasEducationAbilityInfo, GreaterThan_int32(Character.GetAge, '(int32)2'))]"

							parentanchor = right|vcenter
							size = { 40 25 }

							datacontext = "[Character.GetEducation]"
							tooltipwidget = {
								using = ChildEducation_tooltip
							}

							icon = {
								parentanchor = center
								size = { 40 40 }
								
								texture = "gfx/interface/icons/traits/background/education_background.dds"

								icon = {
									parentanchor = center
									size = { 40 40 }
									
									texture = "[GetEducationIcon(Character.GetEducation)]"
								}
								glow = {
									name = "drop_shadow"
									glow_radius = 3
									color = {0.0 0.0 0.0 1.0}
									alpha = 0.4
								}
							}
						}

						overlappingitembox = {
							datamodel = "[Character.GetTraits]"
							max_width = 120
							autoresize = yes
							item = {
								widget = {
									size = { 40 25 }
									icon = {
										size = { 100% 100% }
										using = trait_item
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

template dead_character_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "CHARACTER_IS_DEAD"
		}
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "gfx/interface/icons/character_roles/death.dds"
			}
		}
		blockoverride "concept_link" {
			text = [role|e]
		}
		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				blockoverride "text" {
					text = "[Character.GetFullDeathInfo]"
				}
			}
			TooltipFlavorTextBlock = {
				blockoverride "text" {
					text = "DEAD_CHARACTER_TT_FLAVOR"
				}
			}
		}
	}
}

template CharacterAbilityRuler_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "[SelectLocalization(Character.IsRuler, 'ABILITY_TOOLTIP_AS_RULER_TITLE' , 'ABILITY_TOOLTIP_AS_CABINET_TITLE' )]"
		}

		blockoverride "title_icon" {
			ContextualTooltipDefaultIcon = {
				visible = "[Character.IsRuler]"
				texture = "gfx/interface/icons/character_roles/ruler.dds"
			}

			ContextualTooltipDefaultIcon = {
				visible = "[Not(Character.IsRuler)]"
				texture = "gfx/interface/icons/character_roles/advisor.dds"
			}
		}

		blockoverride "concept_link" {
			text = "[abilities|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				visible = "[Character.IsRuler]"
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_RULER_HEADER"
				}
			}

			TooltipTextBlock = {
				visible = "[Not(Character.IsRuler)]"
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_CABINET_HEADER"
				}
			}

			TooltipAbilityEducationBlock = {}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[adm|e]"
					TooltipAbilityValueAdm = {}
				}

				textcontext = "[Character.GetRulerAbilityInfo('adm')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[dip|e]"
					TooltipAbilityValueDip = {}
				}

				textcontext = "[Character.GetRulerAbilityInfo('dip')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[mil|e]"
					TooltipAbilityValueMil = {}
				}

				textcontext = "[Character.GetRulerAbilityInfo('mil')]"
			}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipExtraInfoGeneral = {}
					TooltipExtraInfoAdmiral = {}
					TooltipExtraInfoExplorer = {}
				}
			}
		}
	}
}

template CharacterAbilityGeneral_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "ABILITY_TOOLTIP_AS_GENERAL_TITLE"
		}

		blockoverride "title_icon_texture" {
			texture = "gfx/interface/icons/character_roles/general.dds"
		}

		blockoverride "concept_link" {
			text = "[abilities|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				visible = "[And3(Not(Character.CanGiveUnitBonus), Character.HasUnit,Character.CanSelectUnit)]"
				datacontext = "[Character]"
				blockoverride "text" {
					text = "CHARACTER_NO_BONUS_UNTIL"
				}
			}

			
			TooltipTextBlock = {
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_GENERAL_HEADER"
				}
			}

			TooltipAbilityEducationBlock = {}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[adm|e]"
					TooltipAbilityValueAdm = {}
				}

				textcontext = "[Character.GetGeneralAbilityInfo('adm')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[dip|e]"
					TooltipAbilityValueDip = {}
				}

				textcontext = "[Character.GetGeneralAbilityInfo('dip')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[mil|e]"
					TooltipAbilityValueMil = {}
				}

				textcontext = "[Character.GetGeneralAbilityInfo('mil')]"
			}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipExtraInfoRuler = {}
					TooltipExtraInfoAdmiral = {}
					TooltipExtraInfoExplorer = {}
				}
			}
		}
	}
}

template CharacterAbilityAdmiral_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "ABILITY_TOOLTIP_AS_ADMIRAL_TITLE"
		}

		blockoverride "title_icon_texture" {
			texture = "gfx/interface/icons/character_roles/admiral.dds"
		}

		blockoverride "concept_link" {
			text = "[abilities|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				visible = "[And3(Not(Character.CanGiveUnitBonus), Character.HasUnit, Character.CanSelectUnit)]"
				datacontext = "[Character]"
				blockoverride "text" {
					text = "CHARACTER_NO_BONUS_UNTIL"
				}
			}

			
			TooltipTextBlock = {
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_ADMIRAL_HEADER"
				}
			}

			TooltipAbilityEducationBlock = {}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[adm|e]"
					TooltipAbilityValueAdm = {}
				}

				textcontext = "[Character.GetAdmiralAbilityInfo('adm')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[dip|e]"
					TooltipAbilityValueDip = {}
				}

				textcontext = "[Character.GetAdmiralAbilityInfo('dip')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[mil|e]"
					TooltipAbilityValueMil = {}
				}

				textcontext = "[Character.GetAdmiralAbilityInfo('mil')]"
			}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipExtraInfoRuler = {}
					TooltipExtraInfoGeneral = {}
					TooltipExtraInfoExplorer = {}
				}
			}
		}
	}
}

template CharacterAbilityExplorer_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "ABILITY_TOOLTIP_AS_EXPLORER_TITLE"
		}

		blockoverride "title_icon_texture" {
			texture = "gfx/interface/icons/character_roles/explorer.dds"
		}

		blockoverride "concept_link" {
			text = "[abilities|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_EXPLORER_HEADER"
				}
			}

			TooltipAbilityEducationBlock = {}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[adm|e]"
					TooltipAbilityValueAdm = {}
				}

				textcontext = "[Character.GetExplorerAbilityInfo('adm')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[dip|e]"
					TooltipAbilityValueDip = {}
				}

				blockoverride "table_header_extra" {  }
				textcontext = "[Character.GetExplorerAbilityInfo('dip')]"
			}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[mil|e]"
					TooltipAbilityValueMil = {}
				}

				textcontext = "[Character.GetExplorerAbilityInfo('mil')]"
			}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipExtraInfoRuler = {}
					TooltipExtraInfoGeneral = {}
					TooltipExtraInfoAdmiral = {}
				}
			}
		}
	}
}

template CharacterAbilityArtist_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "ABILITY_TOOLTIP_AS_ARTIST_TITLE"
		}

		blockoverride "title_icon_texture" {
			texture = "gfx/interface/icons/character_roles/artist.dds"
		}

		blockoverride "concept_link" {
			text = "[abilities|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_ARTIST_HEADER"
				}
			}

			TooltipAbilityEducationBlock = {}

			TooltipStringPairList = {
				blockoverride "block_title" {
					text = "[artistic_skill|e]"
					TooltipAbilityValueArtistSkill = {}
				}

				textcontext = "[Character.GetArtistAbilityInfo]"
			}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipExtraInfoRuler = {}
					TooltipExtraInfoGeneral = {}
					TooltipExtraInfoAdmiral = {}
				}
			}
		}
	}
}

template CharacterAbilityNoRole_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "ABILITY_TOOLTIP_AS_NO_ROLE_TITLE"
		}

		blockoverride "title_icon_texture" {
			texture = "gfx/interface/icons/character_roles/abilities.dds"
			glow = {
				name = "drop_shadow"
				glow_radius = 3
				color = {0.0 0.0 0.0 1.0}
				alpha = 0.5
			}
		}

		blockoverride "concept_link" {
			text = "[abilities|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				blockoverride "text" {
					text =  "ABILITY_TOOLTIP_AS_NO_ROLE_HEADER"
				}
			}

			TooltipAbilityEducationBlock = {}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipExtraInfoRuler = {}
					TooltipExtraInfoGeneral = {}
					TooltipExtraInfoAdmiral = {}
					TooltipExtraInfoExplorer = {}
				}
			}
		}
	}
}

template CharacterInteraction_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "[CharacterInteraction.GetNameWithNoTooltip]"
		}

		blockoverride "concept_link" {
			text = [character_interaction|E]
		}
		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				blockoverride "text" {
					text = "[CharacterInteraction.GetTooltip]"
				}
			}
		}
	}
}

template Character_tooltip {
	ContextualTooltipType = {
		datacontext = "[Character.GetRoleMask]"

		blockoverride "title_icon" {
			widget = {
				using = tooltip_title_icon_size

				character_role_icon = {
					blockoverride "icon_size" {
						using = tooltip_title_icon_size
					}

					blockoverride "icon_visible" {
						visible = "[EqualTo_int32(CharacterRoleMask.GetFirstRoleIndex, PdxGuiWidget.GetIndexInDataModel)]"
					}
				}
			}
		}

		blockoverride "title_text" {
			text = "[Character.GetNameToFitWithNoTooltip('(int32)-1', '(bool)yes')]"
		}

		blockoverride "concept_link" {
			text = "[character|E]"
		}

		blockoverride "tooltip_content" {
			TooltipScrolledDebugTextBlock = {
				blockoverride "block_scrollarea" { maximumsize = { -1 250 }}
				textcontext = "[Character.GetDebugTooltip]"
			}

			TooltipCharacterHeader = {}

			TooltipListBase = {
				visible = "[Not(StringIsEmpty(Character.GetRelationTooltip))]"
				TooltipListRowContent = {
					TooltipManualTableField = {
						visible = "[And(Not(StringIsEmpty(Character.GetRelationToCountryInfo)),Character.HasCourtCountry)]"
						blockoverride "field_content" {
							margin = { 10 0 }
							spacing = 10

							character_role_icon = {
								blockoverride "icon_size" {
									size = { 25 25 }
								}
				
								blockoverride "icon_visible" {
									visible = "[EqualTo_int32(CharacterRoleMask.GetFirstRoleIndex, PdxGuiWidget.GetIndexInDataModel)]"
								}
							}

							textbox = {
								align = nobaseline
								autoresize = yes
								using = text_multi_template
								elide = right
								using = tooltip_max_width_title_wide
								text = "[Character.GetRelationToCountryInfo]"
							}

							expand = {}
						}
					}

					TooltipManualTableField = {
						visible = "[Not(StringIsEmpty(Character.GetDeathAndAgeInfo))]"
						blockoverride "field_content" {
							margin = { 10 0 }
							spacing = 10

							character_role_icon = {
								blockoverride "icon_size" {
									size = { 25 25 }
								}
				
								blockoverride "icon_visible" {
									visible = "[EqualTo_int32(CharacterRoleMask.GetFirstRoleIndex, PdxGuiWidget.GetIndexInDataModel)]"
								}
							}

							textbox = {
								align = nobaseline
								autoresize = yes
								using = text_multi_template
								elide = right
								using = tooltip_max_width_title_wide
								text = "[Character.GetDeathAndAgeInfo]"
							}

							expand = {}
						}
					}

					TooltipManualTableField = {
						visible = "[Not(StringIsEmpty(Character.GetRelationToRulerInfo))]"
						blockoverride "field_content" {
							margin = { 10 0 }
							spacing = 10

							icon = {
								size = { 25 25 }
								texture = "gfx/interface/icons/character_roles/blood_related.dds"
							}

							textbox = {
								align = nobaseline
								autoresize = yes
								using = text_multi_template
								elide = right
								using = tooltip_max_width_title_wide
								text = "[Character.GetRelationToRulerInfo]"
							}

							expand = {}
						}
					}
				}
			}

			TooltipScrolledRowList = {
				visible = "[And(Character.IsAlive, Not(StringIsEmpty(Character.GetRulerTermsTooltip)))]"
				textcontext = "[Character.GetActiveRulerTermsTooltip][Localize('NEWLINE_BREAK')][Character.GetActiveRegenciesTooltip]"
				blockoverride "block_scrollarea" { maximumsize = { -1 300 }}
				blockoverride "block_title" {
					text = "RULER_ACTIVE_TITLES_HEADER"
				}
			}

			TooltipScrolledRowList = {
				visible = "[And(Character.IsAlive, Not(StringIsEmpty(Character.GetPreviousRulerTermsTooltip)))]"
				textcontext = "[Character.GetPreviousRulerTermsTooltip]"
				blockoverride "block_scrollarea" { maximumsize = { -1 300 }}
				blockoverride "block_title" {
					text = "RULER_TITLE_HISTORY_HEADER"
				}
			}

			TooltipRowList = {
				visible = "[And(Not(Character.IsAlive), DataModelHasItems(Character.GetAllTitles))]"
				
				textcontext =  "[Character.GetRulerTermsTooltip]"
				
				
				blockoverride "block_title" {
					text = "RULER_TITLE_HISTORY_HEADER"
				}
			}
			
			
			TooltipTextBlock = {
				visible = "[And3(Not(Character.CanGiveUnitBonus), Character.HasUnit, Character.CanSelectUnit)]"
				datacontext = "[Character]"
				blockoverride "text" {
					text = "CHARACTER_NO_BONUS_UNTIL"
				}
			}

			TooltipTextBlock = {
				visible = "[And(Character.IsArtist, Character.HasArtInProgress)]"
				blockoverride "text" {
					text = "[Character.GetArtProgressInfo]"
				}
			}

			TooltipRowList = {
				visible = "[And(Character.IsArtist, DataModelHasItems(Character.GetWorksOfArt))]"
				blockoverride "block_title" { text = "CHAR_WORK_OF_ART_HEADER" }
				blockoverride "rowlist_datamodel_is_empty" { visible = "[IsDataModelEmpty(Character.GetWorksOfArt)]"}
				blockoverride "rowlist_datamodel_has_items" { visible = "[DataModelHasItems(Character.GetWorksOfArt)]"}
				blockoverride "rowlist_datamodel" { datamodel = "[Character.GetWorksOfArt]" }
				blockoverride "rowlist_item" { text = "[WorkOfArt.GetName]" }
			}

			TooltipListBase = {
				TooltipListRowContent = {
					TooltipManualTableField = {
						# don't show this unless they're yours or you can use it to cheat
						visible = "[And(Character.HasCourtCountry, Character.CanSelectUnit)]"
						blockoverride "field_content" {
							text_single = {
								raw_text = "[location|e]"
							}

							expand = {}

							text_single = {
								text = "[Character.GetLocation.GetName]"
							}
						}
					}

					TooltipManualTableField = {
						visible = "[DataModelHasItems(Character.GetSpouses)]"

						blockoverride "field_content" {
							text_single = {
								raw_text = "[spouses|e]"
							}

							expand = {}

							hbox = {
								datamodel = "[DataModelSubSpan(Character.GetSpouses, '(int32)0', '(int32)10')]"
								item = {
									ListOfCharactersItem = {
										visible = "[Character.IsValid]"
										size = { 25 25 }
									}
								}
							}

							text_single = {
								margin = { 10 0 }
								visible = "[GreaterThan_int32(GetDataModelSize(Character.GetSpouses), '(int32)10')]"
								text = "[GetDataModelSize(Character.GetSpouses)|L]"

								tooltipwidget = {
									using = CharacterSpousesList_tooltip
								}
							}
						}
					}

					TooltipManualTableField = {
						visible = "[DataModelHasItems(Character.GetChildren)]"

						blockoverride "field_content" {
							text_single = {
								raw_text = "[children|e]"
							}

							expand = {}

							hbox = {
								datamodel = "[DataModelSubSpan(Character.GetChildren, '(int32)0', '(int32)10')]"
								item = {
									ListOfCharactersItem = {
										size = { 25 25 }
									}
								}
							}

							text_single = {
								margin = { 10 0 }
								visible = "[GreaterThan_int32(GetDataModelSize(Character.GetChildren), '(int32)10')]"
								text = "[GetDataModelSize(Character.GetChildren)|L]"

								tooltipwidget = {
									using = CharacterChildrenList_tooltip 
								}
							}
						}
					}

					TooltipManualTableField = {
						visible = "[Character.HasRebel]"
						blockoverride "field_content" {
							text_single = {
								raw_text = "[rebel|e]"
							}

							expand = {}

							text_single = {
								text = "[Character.GetRebel.GetName]"
							}
						}
					}

					TooltipManualTableField = {
						visible = "[And(Character.IsAlive, DataModelHasItems(Character.GetAllTitles))]"
						blockoverride "field_content" {
							text_single = {
								raw_text = "[title_history|e]"
							}

							expand = {}

							text_single = {
								text = "[GetDataModelSize(Character.GetAllTitles)|L]"
								tooltipwidget = {
									using = CharacterRulingHistory_tooltip
								}
							}
						}
					}
				}
			}

			TooltipIconRow = {
				visible =  "[Not(IsDataModelEmpty(Character.GetTimedModifiers))]"
				blockoverride "icon" {
					icon = {
						size = { 27 27 }
						texture = "[GetConceptTexture('character_modifier')]"
					}
					tooltip = "[character_modifiers|e]"
					tagtooltip_enabled = yes
				}

				blockoverride "items" {
					datamodel = "[Character.GetTimedModifiers]"
					item = {
						timed_modifier_icon = {
							size = { 27 27 }
							datacontext = "[TimedModifier]"
							tooltipwidget = {
								using = timed_modifier_tooltip
								blockoverride "concept_link" {
									text = "[character_modifier|e]"
								}
							}
						}
					}
				}
			}
		}
	}
}

template CharacterRulingHistory_tooltip {
	ContextualTooltipType = {
		
		blockoverride "title_text" {
			text = "RULER_TITLE_HISTORY_HEADER"
		}

		blockoverride "concept_link" {
			text = "[title_history|E]"
		}

		blockoverride "tooltip_content" {
			TooltipRowList = {
				visible = "[DataModelHasItems(Character.GetAllTitles)]"
				blockoverride "block_title" { visible = no }
				blockoverride "rowlist_datamodel_is_empty" { visible = "[IsDataModelEmpty(Character.GetAllTitles)]"}
				blockoverride "rowlist_datamodel_has_items" { visible = "[DataModelHasItems(Character.GetAllTitles)]"}
				blockoverride "rowlist_datamodel" { datamodel = "[Character.GetAllTitles]" }
				blockoverride "rowlist_item" { 
					text = "[RulerTerm.GetTitleInfoForCharacter(Character.Self)]"
				}
			}
		}
	}
}

template CharacterWorksOfArt_tooltip {
	ContextualTooltipType = {
		
		blockoverride "title_text" {
			text = "CHAR_WORK_OF_ART_HEADER_P"
		}
		blockoverride "concept_link" {
			text = "CHAR_WORK_OF_ART_HEADER"
		}
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "gfx/interface/icons/flat_icons/art_works.dds"
			}
		}
		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				visible = "[Character.HasArtInProgress]"
				blockoverride "text" {
					text = "[Character.GetArtProgressInfo]"
				}
			}
			
			TooltipRowList = {
				blockoverride "block_title" { text = "CHAR_WORK_OF_ART_HEADER" }
				blockoverride "rowlist_datamodel_is_empty" { visible = "[IsDataModelEmpty(Character.GetWorksOfArt)]"}
				blockoverride "rowlist_datamodel_has_items" { visible = "[DataModelHasItems(Character.GetWorksOfArt)]"}
				blockoverride "rowlist_datamodel" { datamodel = "[Character.GetWorksOfArt]" }
				blockoverride "rowlist_item" { text = "[WorkOfArt.GetName]" }
			}
		}
	}
}

template CharacterChildrenList_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "CHILDREN_LIST_HEADER"
		}

		blockoverride "concept_link" {
			text = "[children|e]"
		}

		blockoverride "tooltip_content" {
			TooltipListOfCharacters = {
				blockoverride "datamodel_list" { 
					datamodel = "[Character.GetChildren]"
				}
			}
		}
	}
}

template CharacterSpousesList_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "SPOUSES_LIST_HEADER"
		}

		blockoverride "concept_link" {
			text = "[spouses|e]"
		}

		blockoverride "tooltip_content" {
			TooltipListOfCharacters = {
				blockoverride "datamodel_list" { 
					datamodel = "[Character.GetSpouses]"
				}
			}
		}
	}
}

template Trait_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "[Trait.GetNameWithNoTooltip]"
		}
		
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "[GetTraitBackground(Trait.Self)]"

				icon = {
					size = { 100% 100% }
					texture = "[GetTraitIcon(Trait.Self)]"
				}
			}
		}

		blockoverride "concept_link" {
			text = "[Trait.GetCategoryTag]"
		}

		blockoverride "tooltip_content" {
			TooltipStringPairList = {
				datacontext = "[StringToStringPairList(Trait.GetTooltip)]"
			}

			TooltipFlavorTextBlock = {
				blockoverride "text" {
					text = "[Trait.GetDesc]"
				}
			}
		}
	}
}

template ChildEducation_tooltip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "gfx/interface/icons/traits/background/education_background.dds"

				icon = {
					size = { 100% 100% }
					texture = "[GetEducationIcon(ChildEducation.Self)]"
				}
			}
		}

		blockoverride "title_text" {
			text = "[Select_CString(Character.HasEducation, ChildEducation.GetNameWithNoTooltip, Localize('NO_EDUCATION'))]"
		}

		blockoverride "concept_link" {
			text = [child_education|E]
		}

		blockoverride "tooltip_content" {
			TooltipStringPairList = {
				textcontext = "[ChildEducation.GetEffect]"
			}

			TooltipFlavorTextBlock = {
				blockoverride "text" {
					text = "[ChildEducation.GetDescription]"
				}
			}
		}
	}
}

template AgeAndSex_tooltip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			gender_icon = {}
		}

		blockoverride "title_text" {
			text = "AGE_AND_SEX_TOOLTIP_T"
		}

		blockoverride "concept_link" {
			text = "[character|e]"
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				visible = "[Character.IsFemale]"
				blockoverride "text" {
					text = "SEX_FEMALE_TT_TEXT"
				}
			}
			TooltipTextBlock = {
				visible = "[Not(Character.IsFemale)]"
				blockoverride "text" {
					text = "SEX_MALE_TT_TEXT"
				}
			}
			TooltipTextBlock = {
				visible = "[StringIsEmpty(Character.GetDeathAndAgeInfo)]"
				blockoverride "text" {
					text = "AGE_ALIVE_TT_TEXT"
				}
			}
			TooltipTextBlock = {
				visible = "[Not(StringIsEmpty(Character.GetDeathAndAgeInfo))]"
				blockoverride "text" {
					text = "AGE_DEAD_TT_TEXT"
				}
			}
		}
	}
}

types DynastyTooltipTypes
{
	type TooltipDynastyHeader = hbox {
		visible = "[Dynasty.HasDynastyHead]"
		layoutpolicy_horizontal = expanding

		margin = { 10 5 }
		spacing = 5
		using = bg_paper_card

		character_frame_medium = {
			name = "player_portrait"

			blockoverride "portrait_datacontext" {
				datacontext = "[Dynasty.GetDynastyHead]"
			}

			blockoverride "character_frame_texture" {
				texture = "gfx/interface/component_decoration/character_frames/character_non_stretchable_frame_2.dds"
			}

			blockoverride "portrait_position" {position = { 4 -1 }}
			blockoverride "character_tooltip" {}
			blockoverride "character_contextmenu" {}
			blockoverride "portrait_click" {}
			blockoverride "rightclick" {}
			blockoverride "hover" {}
			blockoverride "character_portrait_visible" {
				visible = no
			}

			blockoverride "character_portrait_ani_visible" {
				visible = yes								
			}
			blockoverride "character_portrait_ani_size" {
				size = { 85 132 }
			}

			
			blockoverride "dynasty_shield" {
				dynasty_shield_mid = {
					visible = "[Character.HasDynasty]"
					datacontext = "[Character.GetDynasty]"
					parentanchor = bottom|left
				}
			}
			
			blockoverride "lowborn_coat_of_arms" {
				lowborn_coat_of_arms = {
					visible = no
					size = { 30% 28% }
					parentanchor = bottom|left
				}
			}
			
			blockoverride "character_ribbon" {
				character_ribbon_3 = {
					visible = "[Character.IsRuler]"
					blockoverride "stretchable" {}
				}
			}

			icon = {
				visible = "[Character.HasCourtCountry]"
				parentanchor = bottom|right
				size = { 35% 30% }
				texture = "[GetEstateIcon(Character.GetEstateType)]"
				datacontext = "[Character.GetCourtCountry.GetGovernment.GetEstate(Character.GetEstateType)]"
				tooltipwidget = {
					using = Estate_tooltip
				}
			}
			
		}

		vbox = {
			layoutpolicy_horizontal = expanding
			spacing = 5
			margin = { 10 5 }

			background = {
				using = tile_background_squared_texture
				alpha = 0.3
				modify_texture = {
					using = color_tool_blue_texture
				}
			}

			text_single = {
				layoutpolicy_horizontal = expanding
				align = left|nobaseline
				text = "[dynasty_head|e]"
			}

			hbox = {
				layoutpolicy_horizontal = expanding
				country_flag_very_small = {
					datacontext = "[Dynasty.GetDynastyHead.GetCourtCountry]"
				}

				text_single = {
					layoutpolicy_horizontal = expanding
					align = left|nobaseline
					fontsize = 16
					text = "[Dynasty.GetDynastyHead.GetNameToFit('(int32)15', '(bool)yes')]"
				}
			}
		}

		expand = {}
	}
}

template DynastyMembers_Tooltip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "gfx/interface/icons/flat_icons/dynasty/living_members.dds"
			}
		}

		blockoverride "title_text" {
			text = "DYNASTY_VIEW_LIVING_MEMBERS_TOOLTIP_TITLE"
		}

		blockoverride "concept_link" {
			text = [dynasty|E]
		}

		blockoverride "tooltip_content" {
			TooltipTextBlock = {
				blockoverride "text" {
					text = "DYNASTY_VIEW_LIVING_MEMBERS_TOOLTIP"
				}
			}
			
			TooltipListOfCountries = {
				blockoverride "datamodel" { 
					datamodel = "[Dynasty.GetLivingCharacters]"
				}

				blockoverride "row_content" {
					country_flag_small = {
						visible = "[Character.HasCourtCountry]"
						datacontext = "[Character.GetCourtCountry]"
					}

					ListOfCharactersItem = {
						size = { 25 25 }
					}

					text_single = {
						text = "[Character.GetNameToFitWithoutThisDynasty('(int32)-1', '(bool)yes', Dynasty.Self)]"
					}

					expand = {}
				}
			}
		}
	}
	# ContextualTooltipType = {
	# 	blockoverride "title_text" {
	# 		text = "DYNASTY_TT_LIVING_MEMBERS"
	# 	}

	# 	blockoverride "concept_link" {
	# 		text = "[characters|e]"
	# 	}

	# 	blockoverride "tooltip_content" {
	# 		TooltipListOfCountries = {
	# 			blockoverride "datamodel" { 
	# 				datamodel = "[Dynasty.GetLivingCharacters]"
	# 			}

	# 			blockoverride "row_content" {
	# 				country_flag_small = {
	# 					visible = "[Character.HasCourtCountry]"
	# 					datacontext = "[Character.GetCourtCountry]"
	# 				}

	# 				ListOfCharactersItem = {
	# 					size = { 25 25 }
	# 				}

	# 				text_single = {
	# 					text = "[Character.GetNameToFitWithoutThisDynasty('(int32)-1', '(bool)yes', Dynasty.Self)]"
	# 				}

	# 				expand = {}
	# 			}
	# 		}
	# 	}
	# }
	
}

template Dynasty_tooltip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			dynasty_shield_mid = {
				blockoverride "show_as_button" { visible = no }
				blockoverride "show_as_icon" { visible = yes }
			}
		}

		blockoverride "title_text" {
			text = "[Dynasty.GetNameWithNoTooltip|U]"
		}

		blockoverride "concept_link" {
			text = [dynasty|E]
		}

		blockoverride "tooltip_content" {
			TooltipDebugTextBlock = {
				blockoverride "text" {
					debug_text = "[Dynasty.GetDebugText]"
				}
			}

			TooltipDynastyHeader = {}

			TooltipListBase = {
				visible = "[Dynasty.HasDynastyHead]"
				
				blockoverride "block_title" {
					text = "DYNASTY_TT_LIST_COUNTRIES"
				}

				hbox = {
					layoutpolicy_horizontal = expanding
					margin = { 10 10 }
					hbox = {
						datamodel = "[DataModelFirst(Dynasty.GetCountries, '(int32)10')]"
						item = {
							country_flag_small = {}
						}
					}

					expand = {}

					text_single = {
						visible = "[GreaterThan_int32(GetDataModelSize(Dynasty.GetCountries), '(int32)10')]"
						raw_text = "#L +[GetDataModelSize(Dynasty.GetCountries)]#!"

						tooltipwidget = {
							SimpleContextualRowTooltipType = {
								blockoverride "title_icon" {
									dynasty_shield_mid = {
										blockoverride "show_as_button" { visible = no }
										blockoverride "show_as_icon" { visible = yes }
									}
								}
								blockoverride "title_text" {
									text = "[Dynasty.GetNameWithNoTooltip|U]"
								}
								blockoverride "concept_link" {
									text = [dynasty|E]
								}
								blockoverride "tooltip_content" {
									TooltipListOfCountries = {
										blockoverride "datamodel" { datamodel = "[Dynasty.GetCountries]" }
									}
								}
							}
						}
					}
				}
			}

			TooltipListBase = {
				vbox = {
					layoutpolicy_horizontal = expanding
					ignoreinvisible = yes

					TooltipManualTableField = {
						text_single = {
							text = "DYNASTY_TT_LIVING_MEMBERS"
						}

						expand = {}

						text_single = {
							text = "[GetDataModelSize(Dynasty.GetLivingCharacters)|L]"
							tooltipwidget = {
								using = DynastyMembers_Tooltip
							}
						}
					}

					TooltipManualTableField = {
						text_single = {
							text = "[ShowModifier('dynasty_seat')]"
						}

						expand = {}

						text_single = {
							text = "[location_icon][Dynasty.GetHome.GetName]"
						}
					}
				}
			}

			# TooltipFastScrolledStringPairList = {
			# 	blockoverride "block_scrollarea" { maximumsize = { -1 210 }}
			# 	ontextcontextchanged = "[SetRowListWithTitleFromTextContext(PdxGuiWidget.AccessSelf)]"
			# 	textcontext = "[Dynasty.GetRulerHistoryInfo]"
			# }
		}
	}
}

template CharacterModifier_tooltip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "[CharacterModifierWrap.GetIcon]"
			}
		}

		blockoverride "title_text" {
			text = "[CharacterModifierWrap.GetName]"
		}

		blockoverride "concept_link" {
			text = "[character_modifier|e]"
		}
		
		blockoverride "tooltip_content" {
			TooltipStringPairList = {
				datacontext = "[StringToStringPairList(CharacterModifierWrap.GetTooltip)]"
			}
		}
	}
}

template ColonialCharter_tooltip {
	ContextualTooltipType = {
		blockoverride "title_text" {
			text = "[ColonialCharter.GetNameWithNoTooltip]"
		}
		
		blockoverride "title_icon" {
			icon = {
				using = tooltip_title_icon_size
				texture = "gfx/interface/icons/flat_icons/geopolitics/available_colonies.dds"
			}
		}


		blockoverride "concept_link" {
			text = [colonial_charter|E]
		}
		blockoverride "tooltip_content" {

			TooltipListBase = {
				TooltipManualTableField = {
					text_single = {
						layoutpolicy_horizontal = expanding
						text = "COLONY_ORIGIN_LOCATION"
						default_format = "#explanation_link"
					}
					text_single = {
						text = "[ColonialCharter.GetOriginName]"
					}
				}

				TooltipManualTableField = {
					text_single = {
						layoutpolicy_horizontal = expanding
						text = "game_concept_colonial_maintenance"
						default_format = "#explanation_link"
					}
					text_single = {
						raw_text = "[ColonialCharter.GetMonthlyMaintenance|2]@gold!"
					}
					tooltipwidget = {
						using = colonial_charter_maintenance_tooltip
					}
				}

				TooltipManualTableField = {
					text_single = {
						layoutpolicy_horizontal = expanding
						text = "game_concept_colonial_migration"
						default_format = "#explanation_link"
					}
					text_single = {
						text = "[ColonialCharter.GetMonthlyMigration]"
					}
					tooltipwidget = {
						using = colonial_charter_migration_tooltip
					}
				}

				TooltipManualTableField = {
					text_single = {
						layoutpolicy_horizontal = expanding
						text = "COLONIAL_PROGRESS"
						default_format = "#explanation_link"
					}
					text_single = {
						raw_text = "[ColonialCharter.GetProgress|1]%"
					}
					tooltipwidget = {
						using = colonial_charter_progress_tooltip
					}
				}
			}	
		
			TooltipScrolledRowList = {
				visible = "[Not(StringIsEmpty( ColonialCharter.GetOriginInformation ))]"
				blockoverride "block_scrollarea" { maximumsize = { -1 210 }}
			}
		}
	}
}

template ruling_history_tooltip {
	ContextualTooltipType = {
		blockoverride "title_icon" {
			dynasty_shield_mid = {
				blockoverride "show_as_button" {
					visible = no
				}

				blockoverride "show_as_icon" {
					visible = yes
				}

				# block "dynasty_tooltip" {}
			}
		}

		blockoverride "title_text" {
			text = "RULING_HISTORY"
		}

		blockoverride "concept_link" {
			text = [dynasty|E]
		}

		blockoverride "tooltip_content" {
			TooltipScrolledRowList = {
				blockoverride "block_scrollarea" { maximumsize = { -1 210 }}
				textcontext = "[Dynasty.GetRulerHistoryInfo]"
			}
		}
	}
}

