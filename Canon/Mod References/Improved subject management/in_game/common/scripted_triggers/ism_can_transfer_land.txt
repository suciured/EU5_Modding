# Can a location be transferred from one country to another
# ROOT: location
# ARGS: $giver$:country, $receiver$:country
can_transfer_location = {
    owner ?= $giver$
    OR = {
        # Can always take land from colonial nations
        AND = {
            $giver$ = { is_subject_type = colonial_nation }
            $receiver$ = { is_human = yes }
        }
        OR = {
            any_coast_border_location = {
                owner ?= $receiver$
            }
            sub_continent = $receiver$.capital.sub_continent
        }
    }
}

# Can a province be transferred from one country to another
# ROOT: province
# ARGS: $giver$:country, $receiver$:country
can_transfer_province = {
    any_location_in_province = {
        can_transfer_location = {
            giver = $giver$
            receiver = $receiver$
        }
    }
}

# Can a area be transferred from one country to another
# ROOT: area
# ARGS: $giver$:country, $receiver$:country
can_transfer_area = {
    any_location_in_area = {
        can_transfer_location = {
            giver = $giver$
            receiver = $receiver$
        }
    }
}

# Can a region be transferred from one country to another
# ROOT: region
# ARGS: $giver$:country, $receiver$:country
can_transfer_region = {
    any_location_in_region = {
        can_transfer_location = {
            giver = $giver$
            receiver = $receiver$
        }
    }
}

# Can the $giver$ transfer any land to the $receiver$
# ROOT: country interaction
# ARGS: $giver$:country, $receiver$:country
can_transfer_land = {
    NOT = { $receiver$ = $giver$ }
    $receiver$ = {
        NOR = {
            country_type = building
            country_type = pop
        }
    }
    $giver$ = {
        NOR = {
            country_type = building
            country_type = pop
        }
    }
    $giver$ = {
        any_owned_location = {
            can_transfer_location = {
                giver = $giver$
                receiver = $receiver$
            }
        }
    }
}

# Decides if the $giver$ is allowed to transfer land to the $receiver$
# Differs from can_transfer_land which only checks if a land transfer is possible.
# This goes in the `enabled` vs `visible` check.
# ROOT: country interaction
# ARGS: $giver$:country, $receiver$:country
allow_transfer_land = {
    # Cannot take land from non-colonial subjects
    OR = {
        NOT = { scope:actor = $receiver$ }
        $giver$ = { is_subject_type = colonial_nation }
    }
    OR = {
        # Can always transfer from colonial nations
        $giver$ = { is_subject_type = colonial_nation }
        # Can always transfer land to colonial nation from yourself
        AND = {
            $receiver$ = { is_subject_type = colonial_nation }
            scope:actor = $giver$
        }
        # Cannot transfer land from a nation to a nation if they are not in the same war
        custom_tooltip = {
            text = "is_in_same_war"
            OR = {
                $giver$ = { at_war = no }
                AND = {
                    $giver$ = { at_war = yes }
                    $receiver$ = { at_war = yes }
                }
            }
        }
    }
}