EU5 Authority Ledger — V-System Spec (MOD CANON)
=====================================================
[DATE] 2025-12-30
[SCOPE] MOD (Authority Ledger) — V1–V5 math + subject rules + variable key standard
[STATUS] Design locked for Codex reference

CODEX RULES (applies to this document)
--------------------------------------
- This document is MOD canon for the Authority Ledger system.
- If any implementation detail (file path, hook, GUI binding, scripted effect) is not explicitly present in repo sources,
  it must be treated as: NOT DEFINED IN REPO SOURCES.
- This spec defines *math* and *variable key expectations* only. Engine wiring may be TBD.

=====================================================
TERMS (MOD CANON)
=====================================================
- "Central Base"  = V3.7 (country total)
- "Local Base"    = V3.8 (country total)
- "Net Authority" = V4.3 (per-tick flow added into Title Authority)
- "Title Authority" (TA) = v4_ta (persistent accumulator)
- "T-rank" = v5_t_rank (integer T0–T15 derived from TA thresholds; subject/independence gates apply)

IMPORTANT: T-rank (UI structure) ≠ any legacy TR system.
This mod uses T-rank as the *rank tier* derived from Title Authority.

=====================================================
LAYER OVERVIEW
=====================================================
V1 : Raw inputs (location & country primitives; no aggregation; no scaling)
V2 : Province aggregation & scalar construction (no routing outputs; no ready outputs; no governance composite)
V3 : Routing + governance composite + province ready outputs + base construction (country totals)
V4 : Net authority + persistence (role-aware for subjects; no export to overlords)
V5 : T-rank determination (threshold table + independence gate)

=====================================================
V1 — RAW INPUTS (NO AGGREGATION; NO SCALING)
=====================================================
All V1 variables are read-only inputs.

V1.1(l) : is_capital_location(l)  (bool)
V1.2(l) : control(l) ∈ [0,100]
V1.3(l) : population(l)
V1.4(l) : development(l)
V1.6(C) : stability ∈ [-100,100]
V1.7(C) : government_power ∈ [0,100]

=====================================================
V2 — AGGREGATION & SCALARS (NO ROUTING OUTPUTS)
=====================================================
Let province P contain locations l = 1..N.

V2.1(P) — Province control average
  V2.1(P) = ( Σ V1.2(l) ) / N

V2.2(P) — Province population sum
  V2.2(P) = Σ V1.3(l)

V2.3(P) — Province development sum
  V2.3(P) = Σ V1.4(l)

V2.4(P) — Control scalar curve (value only; routing applied in V3)
  V2.4(P) = 2.0 - ( V2.1(P) / 100 × 1.5 )
  Endpoints: control=0 → 2.0 ; control=100 → 0.5

V2.5(C) — Stability scalar
  V2.5(C) = 0.25 + ( (V1.6(C) + 100) / 200 × 3.75 )
  Endpoints: stability=-100 → 0.25 ; stability=+100 → 4.0

V2.6(C) — Government power scalar
  V2.6(C) = 0.25 + ( V1.7(C) / 100 × 3.75 )
  Endpoints: gov_power=0 → 0.25 ; gov_power=100 → 4.0

=====================================================
V3 — ROUTING, GOVERNANCE, READY OUTPUTS, BASES
=====================================================
V3.1(P) — Province routing (computed here; not stored in V2)
- Central if any location in province has V1.1(l)=true
- Local otherwise

V3.2(C) — Governance composite (average)
  V3.2(C) = ( V2.5(C) + V2.6(C) ) / 2

V3.3(P) — Province READY LOCAL outputs (control applies only to Local)
If V3.1(P)=Local:
  LocalPop(P) = V2.2(P) × V2.4(P)
  LocalDev(P) = V2.3(P) × V2.4(P)
If V3.1(P)=Central:
  LocalPop(P) = 0
  LocalDev(P) = 0

V3.4(P) — Province READY CENTRAL outputs (governance applies only to Central)
If V3.1(P)=Central:
  CentralPop(P) = V2.2(P) × V3.2(C)
  CentralDev(P) = V2.3(P) × V3.2(C)
If V3.1(P)=Local:
  CentralPop(P) = 0
  CentralDev(P) = 0

V3.5(P) — Province central base
  V3.5(P) = CentralPop(P) × CentralDev(P)

V3.6(P) — Province local base
  V3.6(P) = LocalPop(P) × LocalDev(P)

V3.7 — Country central base
  V3.7 = Σ V3.5(P)

V3.8 — Country local base
  V3.8 = Σ V3.6(P)

=====================================================
V4 — NET AUTHORITY + PERSISTENCE (ROLE-AWARE)
=====================================================
Roles:
- Independent
- Overlord
- Subject

Subject reward rules (MOD CANON):
- Subject capital provinces generate central base for the SUBJECT only.
- Subject central and local contributions are both halved for the SUBJECT.
- NO authority (central/local/net/TA) is exported to the overlord by this system.

V4.1 — Central flow (role-aware)
Independent/Overlord: V4.1 = V3.7
Subject:              V4.1 = 0.5 × V3.7

V4.2 — Local flow (role-aware)
Independent/Overlord: V4.2 = V3.8
Subject:              V4.2 = 0.5 × V3.8

V4.3 — Net Authority flow (per tick)
  V4.3 = V4.1 + V4.2

V4.4 — Title Authority update (persistent)
Let TA(t) be stored Title Authority at tick start.
  TA(t+1) = TA(t) + V4.3

=====================================================
V5 — T-RANK DETERMINATION
=====================================================
V5 reads Title Authority and assigns integer T-rank.

V5.1 — Determine integer T-rank
- Threshold table defines minimum TA required for each Tn.
- Highest Tn such that TA >= threshold[Tn].

Independence Gate (MOD CANON):
- If NOT independent: clamp resulting T-rank to at most T10.
- T11+ requires Independence.

Subranks (.1–.6):
- UI structure only; not thresholded here.
- Slot keys exist for UI mapping and future subtype logic.

=====================================================
VARIABLE KEY STANDARD (MOD CANON)
=====================================================
Use V-system keys for stored/displayed values.
(Do NOT keep duplicate legacy aliases in parallel.)

Core:
- v3_7       : country central base (V3.7)
- v3_8       : country local base   (V3.8)
- v4_3       : net authority flow   (V4.3)
- v4_ta      : title authority      (persistent)
- v4_tick    : tick counter (optional)
- v5_t_rank  : integer T-rank (T0–T15)

Chart slot keys (preserve layout positions):
- v5_tN_type_K  where N=0..15 and K=1..6
- Define only used slots; remove empty slot buttons without reflow.

=====================================================
NOT DEFINED IN REPO SOURCES (Codex must not assume)
=====================================================
- Engine update hook / on_action cadence for running V3/V4
- Storage scope declarations / exact scripting mechanism
- GUI binding file paths and widget IDs
- Any base-game variable names beyond the V1 inputs listed above
