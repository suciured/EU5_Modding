EU5 Authority Ledger — Index (Codex Fast Find)
[DATE] 2025-12-30
[SCOPE] Knowledge Base > Explainers (Authority / T-Rank)

PURPOSE
- Quick lookup map for Codex agent to find the right file fast.
- Navigation only. No mechanics are defined here.

CANON / TRUST ORDER
1) Knowledge Base (this folder)
2) Mod output files
3) Raw reference

============================================================
KEY TERMS (SEARCH TOKENS)
============================================================
TA = Title Authority (hidden accumulator; formerly RScore)
TR = Title Rank (tier derived from TA; formerly RRank)
CA = Central Authority
LA = Local Authority
NA = Net Authority (= CA - LA)
T-rank = UI/selection tree nodes (Tn.m where m=slot 1..6)
Thresholds = TA breakpoints for TR tiers
Hysteresis = demotion buffer rule for TR

============================================================
PRIMARY FILES (WHAT TO OPEN FOR WHAT)
============================================================

(1) Core math (authoritative formulas)
- File: Explainers/Formulas/Formulas_Only.txt
  - Contains: derived variables + formulas for CA/LA/NA/TA and TR derivation note
  - Keywords: BaseLoc, CapitalBase, LocalBase, StabNorm, StateMult, TRMult, TA = TA + NA

(2) Balance knobs (editable constants)
- File: Explainers/Formulas/Variables.txt
  - Contains: POP_CAP_K, CA_STATE_MIN, CA_TR_COEFF, TR_MAX

(3) TR tier thresholds (data table)
- File: Explainers/Formulas/TR_Thresholds.txt
  - Contains: TA thresholds for TR0..TR15, hysteresis buffer rule, independence gate TR10->TR11

(4) T-rank node template (UI tree structure; NOT TR thresholds)
- File: Explainers/T-Rank/EU5_T-RANK_TEMPLATE.txt
  - Contains: T0..T15 and Tn.1..Tn.6 blocks
  - Slot mapping: .1.. .6 correspond to UI slots 1..6
  - Includes: EMPTY placeholders, upgrade paths (T0->T1), TBD elsewhere

(5) T-rank / TR system handoff (continuation doc)
- File: Explainers/T-Rank/T_Rank_System_Handoff.txt
  - Contains: updated system summary (TA/TR naming, Build B formulas, thresholds references, UI tree notes)

(6) Repo-wide guardrails for Codex agent (must follow)
- File: CODEX_INSTRUCTIONS.txt
  - Contains: SOURCE-ONLY rules, stop conditions, logging rules, sync rules


- "R-rank UI chart" nodes are now "T-ranks" (Tn.m), where:
  - n = row (tier band)
  - m = slot (1..6) mapped directly to UI columns

IMPORTANT: TR (Title Rank) is NOT the same as T-rank (UI node tree).
- TR is computed from TA via thresholds (TR_Thresholds.txt).
- T-rank is a player-facing selection/tree layout (EU5_T-RANK_TEMPLATE.txt).

============================================================
CORE IDEA
============================================================
TR is an INTERNAL, HIDDEN tier system that represents the degree of structural centralization of a state.
- Not shown directly to player
- Never directly set
- Always derived from Authority math (CA/LA/NA -> TA -> TR)

TR answers:
"How centralized is this state over time?"

============================================================
INPUT: NET AUTHORITY (NA)
============================================================
Definitions:
- CA = Central Authority
- LA = Local Authority
- NA = CA − LA

Interpretation:
- Positive NA -> TA increases -> TR tends to rise
- Negative NA -> TA decreases -> TR tends to fall

============================================================
BUILD B (CURRENT AUTHORITY MATH)
============================================================
This system removed the old single "Authority" variable.
CA and LA are computed separately from the shared base.

(1) Population cap per location:
  EffPopsK(l) = min(PopsK(l), POP_CAP_K)

(2) Location base:
  BaseLoc(l) = Dev(l) × EffPopsK(l) × TaxBase(l)

(3) Aggregation:
  CapitalBase = Σ BaseLoc(l) for locations in capital province only
  LocalBase   = Σ BaseLoc(l) for locations NOT in capital province

(4) State capacity (merged stability + government power):
  StabNorm    = clamp((Stability + 3)/6, 0, 1)   # assumes stability range -3..+3
  StateScore  = (GovP_norm + StabNorm)/2
  StateMult   = CA_STATE_MIN + (1 - CA_STATE_MIN) × StateScore

(5) TR feedback into CA:
  TRMult = 1 + CA_TR_COEFF × TR

(6) Outputs:
  LA = LocalBase
  CA = ceil(CapitalBase × StateMult × TRMult)
  NA = CA − LA

(7) TA accumulation (no clamp, no decay):
  TA = TA + NA

AUTHORITATIVE FILES:
- Explainers/Formulas/Variables.txt
- Explainers/Formulas/Formulas_Only.txt

============================================================
TR DERIVATION (THRESHOLDS + HYSTERESIS)
============================================================
TR is derived from TA using a threshold ladder plus hysteresis to prevent flapping.

Promotion:
- if TA ≥ Threshold[TR+1] and Gate(TR+1) passes -> TR += 1

Demotion:
- if TA < Threshold[TR] − Buffer[TR] -> TR -= 1

Buffer rule:
- Buffer[TR] = max(250000, 0.15 × Threshold[TR])

Gate:
- TR10 -> TR11 requires Independence (TR capped at 10 unless independent)

AUTHORITATIVE FILE:
- Explainers/Formulas/TR_Thresholds.txt

============================================================
T-RANK (UI TREE NODES) — SEPARATE FROM TR
============================================================
T-ranks are the UI grid/tree nodes used for selecting a "type" within a tier band.
They are defined as Tn.m:
- n: row/tier band (0..15)
- m: slot/column (1..6)

Slot mapping:
- .1 .. .6 correspond to UI columns 1..6

EMPTY handling:
- Unused slots are explicit blocks with EMPTY values.

Locked upgrade paths (T0 -> T1):
- T0.2 (Monarchy seed) upgrades to: T1.1, T1.3
- T0.5 (Republic seed) upgrades to: T1.4

AUTHORITATIVE FILE:
- Explainers/T-Rank/EU5_T-RANK_TEMPLATE.txt
(Localization for node labels: deferred.)

============================================================
DESIGN PRINCIPLES
============================================================
- TR changes based on long-run structure (NA -> TA), not one-off events
- Thresholds tuned so France-scale states sit around TR 11–13 when successful
- TR14–TR15 are rare hegemon tiers


============================================================
STATUS / OPEN ITEMS
============================================================
- Localization: deferred
- Scripted hooks: only proceed if defined in repo KB
- T-rank upgrades beyond T1: TBD

============================================================
NOT DEFINED HERE
============================================================
- Any localization strings for T-rank nodes (add later, not in templates)
- Exact scripted implementation file paths (only if defined in repo KB)

END
